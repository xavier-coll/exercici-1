

============================== 2022-09-21 10:24:59.216512 | fa90d8b8-167d-4308-93a2-22de433dafde ==============================
10:24:59.216519 [info ] [MainThread]: Running with dbt=1.1.2
10:24:59.216795 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'config_dir': False, 'which': 'debug', 'indirect_selection': 'eager'}
10:24:59.216944 [debug] [MainThread]: Tracking: tracking
10:24:59.228150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112806910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112806a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112806e50>]}
10:24:59.508919 [debug] [MainThread]: Executing "git --help"
10:24:59.521483 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
10:24:59.522190 [debug] [MainThread]: STDERR: "b''"
10:24:59.526173 [debug] [MainThread]: Acquiring new bigquery connection "debug"
10:24:59.527123 [debug] [MainThread]: Opening a new connection, currently in state init
10:25:00.101475 [debug] [MainThread]: On debug: select 1 as id
10:25:01.669339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11053f4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113bb6850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113bb6220>]}
10:25:02.109035 [debug] [MainThread]: Connection 'debug' was properly closed.


============================== 2022-09-22 07:36:47.073509 | 70259a66-434b-479b-833c-c41a7c3146b0 ==============================
07:36:47.073548 [info ] [MainThread]: Running with dbt=1.1.2
07:36:47.074639 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
07:36:47.074827 [debug] [MainThread]: Tracking: tracking
07:36:47.090215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a7b3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a7baf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a7bac0>]}
07:36:47.106881 [info ] [MainThread]: Partial parse save file not found. Starting full parse.
07:36:47.107222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '70259a66-434b-479b-833c-c41a7c3146b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a4a430>]}
07:36:47.134966 [debug] [MainThread]: Parsing macros/etc.sql
07:36:47.136965 [debug] [MainThread]: Parsing macros/catalog.sql
07:36:47.142387 [debug] [MainThread]: Parsing macros/adapters.sql
07:36:47.163904 [debug] [MainThread]: Parsing macros/materializations/seed.sql
07:36:47.166135 [debug] [MainThread]: Parsing macros/materializations/view.sql
07:36:47.168387 [debug] [MainThread]: Parsing macros/materializations/table.sql
07:36:47.171860 [debug] [MainThread]: Parsing macros/materializations/copy.sql
07:36:47.174160 [debug] [MainThread]: Parsing macros/materializations/incremental.sql
07:36:47.187585 [debug] [MainThread]: Parsing macros/materializations/snapshot.sql
07:36:47.189026 [debug] [MainThread]: Parsing macros/materializations/hooks.sql
07:36:47.192527 [debug] [MainThread]: Parsing macros/materializations/configs.sql
07:36:47.194581 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot_merge.sql
07:36:47.196050 [debug] [MainThread]: Parsing macros/materializations/snapshots/strategies.sql
07:36:47.210957 [debug] [MainThread]: Parsing macros/materializations/snapshots/helpers.sql
07:36:47.222387 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot.sql
07:36:47.232035 [debug] [MainThread]: Parsing macros/materializations/tests/test.sql
07:36:47.235978 [debug] [MainThread]: Parsing macros/materializations/tests/helpers.sql
07:36:47.237510 [debug] [MainThread]: Parsing macros/materializations/tests/where_subquery.sql
07:36:47.239088 [debug] [MainThread]: Parsing macros/materializations/models/incremental/column_helpers.sql
07:36:47.243133 [debug] [MainThread]: Parsing macros/materializations/models/incremental/merge.sql
07:36:47.257556 [debug] [MainThread]: Parsing macros/materializations/models/incremental/is_incremental.sql
07:36:47.258899 [debug] [MainThread]: Parsing macros/materializations/models/incremental/incremental.sql
07:36:47.267340 [debug] [MainThread]: Parsing macros/materializations/models/incremental/on_schema_change.sql
07:36:47.280170 [debug] [MainThread]: Parsing macros/materializations/models/table/table.sql
07:36:47.286501 [debug] [MainThread]: Parsing macros/materializations/models/table/create_table_as.sql
07:36:47.288890 [debug] [MainThread]: Parsing macros/materializations/models/view/view.sql
07:36:47.294917 [debug] [MainThread]: Parsing macros/materializations/models/view/helpers.sql
07:36:47.296045 [debug] [MainThread]: Parsing macros/materializations/models/view/create_or_replace_view.sql
07:36:47.298261 [debug] [MainThread]: Parsing macros/materializations/models/view/create_view_as.sql
07:36:47.300169 [debug] [MainThread]: Parsing macros/materializations/seeds/seed.sql
07:36:47.305244 [debug] [MainThread]: Parsing macros/materializations/seeds/helpers.sql
07:36:47.319304 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_alias.sql
07:36:47.320523 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_schema.sql
07:36:47.322606 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_database.sql
07:36:47.323904 [debug] [MainThread]: Parsing macros/generic_test_sql/relationships.sql
07:36:47.324633 [debug] [MainThread]: Parsing macros/generic_test_sql/not_null.sql
07:36:47.325309 [debug] [MainThread]: Parsing macros/generic_test_sql/unique.sql
07:36:47.325950 [debug] [MainThread]: Parsing macros/generic_test_sql/accepted_values.sql
07:36:47.327093 [debug] [MainThread]: Parsing macros/etc/statement.sql
07:36:47.330795 [debug] [MainThread]: Parsing macros/etc/datetime.sql
07:36:47.338109 [debug] [MainThread]: Parsing macros/adapters/schema.sql
07:36:47.339916 [debug] [MainThread]: Parsing macros/adapters/indexes.sql
07:36:47.342158 [debug] [MainThread]: Parsing macros/adapters/relation.sql
07:36:47.350234 [debug] [MainThread]: Parsing macros/adapters/freshness.sql
07:36:47.352679 [debug] [MainThread]: Parsing macros/adapters/persist_docs.sql
07:36:47.356289 [debug] [MainThread]: Parsing macros/adapters/metadata.sql
07:36:47.362336 [debug] [MainThread]: Parsing macros/adapters/columns.sql
07:36:47.370221 [debug] [MainThread]: Parsing tests/generic/builtin.sql
07:36:47.548551 [debug] [MainThread]: 1699: static parser successfully parsed example/my_first_dbt_model.sql
07:36:47.561030 [debug] [MainThread]: 1699: static parser successfully parsed example/my_second_dbt_model.sql
07:36:47.606795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '70259a66-434b-479b-833c-c41a7c3146b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bc9190>]}
07:36:47.612084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '70259a66-434b-479b-833c-c41a7c3146b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a6bd30>]}
07:36:47.612477 [info ] [MainThread]: Found 2 models, 4 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
07:36:47.612730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '70259a66-434b-479b-833c-c41a7c3146b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104694eb0>]}
07:36:47.613950 [info ] [MainThread]: 
07:36:47.614349 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:36:47.615004 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
07:36:47.615237 [debug] [ThreadPool]: Opening a new connection, currently in state init
07:36:49.322283 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
07:36:49.322806 [debug] [ThreadPool]: Opening a new connection, currently in state closed
07:36:49.903571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '70259a66-434b-479b-833c-c41a7c3146b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bc9310>]}
07:36:49.904476 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
07:36:49.904952 [info ] [MainThread]: 
07:36:49.910907 [debug] [Thread-1  ]: Began running node model.exercise.my_first_dbt_model
07:36:49.911284 [info ] [Thread-1  ]: 1 of 2 START table model zz_xavier.my_first_dbt_model .......................... [RUN]
07:36:49.911863 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.my_first_dbt_model"
07:36:49.912076 [debug] [Thread-1  ]: Began compiling node model.exercise.my_first_dbt_model
07:36:49.912292 [debug] [Thread-1  ]: Compiling model.exercise.my_first_dbt_model
07:36:49.915750 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.my_first_dbt_model"
07:36:49.916483 [debug] [Thread-1  ]: finished collecting timing info
07:36:49.916681 [debug] [Thread-1  ]: Began executing node model.exercise.my_first_dbt_model
07:36:49.933233 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:36:50.437889 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.my_first_dbt_model"
07:36:50.438690 [debug] [Thread-1  ]: On model.exercise.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.my_first_dbt_model"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
07:36:55.709983 [debug] [Thread-1  ]: finished collecting timing info
07:36:55.710551 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70259a66-434b-479b-833c-c41a7c3146b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b87610>]}
07:36:55.710974 [info ] [Thread-1  ]: 1 of 2 OK created table model zz_xavier.my_first_dbt_model ..................... [[32mCREATE TABLE (2.0 rows, 0 processed)[0m in 5.80s]
07:36:55.711602 [debug] [Thread-1  ]: Finished running node model.exercise.my_first_dbt_model
07:36:55.712467 [debug] [Thread-1  ]: Began running node model.exercise.my_second_dbt_model
07:36:55.712785 [info ] [Thread-1  ]: 2 of 2 START view model zz_xavier.my_second_dbt_model .......................... [RUN]
07:36:55.713453 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.my_second_dbt_model"
07:36:55.713651 [debug] [Thread-1  ]: Began compiling node model.exercise.my_second_dbt_model
07:36:55.713825 [debug] [Thread-1  ]: Compiling model.exercise.my_second_dbt_model
07:36:55.716481 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.my_second_dbt_model"
07:36:55.716992 [debug] [Thread-1  ]: finished collecting timing info
07:36:55.717172 [debug] [Thread-1  ]: Began executing node model.exercise.my_second_dbt_model
07:36:55.792844 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.my_second_dbt_model"
07:36:55.793536 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:36:55.793801 [debug] [Thread-1  ]: On model.exercise.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.my_second_dbt_model"} */


  create or replace view `dwh-adev-observe`.`zz_xavier`.`my_second_dbt_model`
  OPTIONS()
  as -- Use the `ref` function to select from other models

select *
from `dwh-adev-observe`.`zz_xavier`.`my_first_dbt_model`
where id = 1;


07:36:57.174207 [debug] [Thread-1  ]: finished collecting timing info
07:36:57.174761 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70259a66-434b-479b-833c-c41a7c3146b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d10fd0>]}
07:36:57.175191 [info ] [Thread-1  ]: 2 of 2 OK created view model zz_xavier.my_second_dbt_model ..................... [[32mOK[0m in 1.46s]
07:36:57.175669 [debug] [Thread-1  ]: Finished running node model.exercise.my_second_dbt_model
07:36:57.176856 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:36:57.177283 [info ] [MainThread]: 
07:36:57.177753 [info ] [MainThread]: Finished running 1 table model, 1 view model in 9.56s.
07:36:57.178063 [debug] [MainThread]: Connection 'master' was properly closed.
07:36:57.178221 [debug] [MainThread]: Connection 'model.exercise.my_second_dbt_model' was properly closed.
07:36:57.185666 [info ] [MainThread]: 
07:36:57.185955 [info ] [MainThread]: [32mCompleted successfully[0m
07:36:57.186249 [info ] [MainThread]: 
07:36:57.186500 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
07:36:57.186834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b80a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b800a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b80400>]}


============================== 2022-09-22 07:43:41.098599 | 715698fd-831b-4187-a5f2-9521e19e2b13 ==============================
07:43:41.098614 [info ] [MainThread]: Running with dbt=1.1.2
07:43:41.099223 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
07:43:41.099466 [debug] [MainThread]: Tracking: tracking
07:43:41.110701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3ea5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3ea2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3ea220>]}
07:43:41.144921 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
07:43:41.145108 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
07:43:41.149743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '715698fd-831b-4187-a5f2-9521e19e2b13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b5240d0>]}
07:43:41.154347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '715698fd-831b-4187-a5f2-9521e19e2b13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b495bb0>]}
07:43:41.154585 [info ] [MainThread]: Found 2 models, 4 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
07:43:41.154831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '715698fd-831b-4187-a5f2-9521e19e2b13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b495c40>]}
07:43:41.155957 [info ] [MainThread]: 
07:43:41.156310 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:43:41.156950 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
07:43:41.157161 [debug] [ThreadPool]: Opening a new connection, currently in state init
07:43:42.297175 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
07:43:42.297630 [debug] [ThreadPool]: Opening a new connection, currently in state closed
07:43:42.877436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '715698fd-831b-4187-a5f2-9521e19e2b13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4f2bb0>]}
07:43:42.878336 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
07:43:42.878781 [info ] [MainThread]: 
07:43:42.883031 [debug] [Thread-1  ]: Began running node model.exercise.my_first_dbt_model
07:43:42.883430 [info ] [Thread-1  ]: 1 of 2 START table model zz_xavier.my_first_dbt_model .......................... [RUN]
07:43:42.884035 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.my_first_dbt_model"
07:43:42.884234 [debug] [Thread-1  ]: Began compiling node model.exercise.my_first_dbt_model
07:43:42.884468 [debug] [Thread-1  ]: Compiling model.exercise.my_first_dbt_model
07:43:42.887990 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.my_first_dbt_model"
07:43:42.888528 [debug] [Thread-1  ]: finished collecting timing info
07:43:42.888743 [debug] [Thread-1  ]: Began executing node model.exercise.my_first_dbt_model
07:43:42.906028 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:43:43.310989 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.my_first_dbt_model"
07:43:43.311581 [debug] [Thread-1  ]: On model.exercise.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.my_first_dbt_model"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
07:43:47.183283 [debug] [Thread-1  ]: finished collecting timing info
07:43:47.183837 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '715698fd-831b-4187-a5f2-9521e19e2b13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b633b50>]}
07:43:47.184252 [info ] [Thread-1  ]: 1 of 2 OK created table model zz_xavier.my_first_dbt_model ..................... [[32mCREATE TABLE (2.0 rows, 0 processed)[0m in 4.30s]
07:43:47.184734 [debug] [Thread-1  ]: Finished running node model.exercise.my_first_dbt_model
07:43:47.185303 [debug] [Thread-1  ]: Began running node model.exercise.my_second_dbt_model
07:43:47.185589 [info ] [Thread-1  ]: 2 of 2 START view model zz_xavier.my_second_dbt_model .......................... [RUN]
07:43:47.186208 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.my_second_dbt_model"
07:43:47.186546 [debug] [Thread-1  ]: Began compiling node model.exercise.my_second_dbt_model
07:43:47.186743 [debug] [Thread-1  ]: Compiling model.exercise.my_second_dbt_model
07:43:47.189303 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.my_second_dbt_model"
07:43:47.189827 [debug] [Thread-1  ]: finished collecting timing info
07:43:47.190003 [debug] [Thread-1  ]: Began executing node model.exercise.my_second_dbt_model
07:43:47.211314 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.my_second_dbt_model"
07:43:47.211863 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:43:47.212085 [debug] [Thread-1  ]: On model.exercise.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.my_second_dbt_model"} */


  create or replace view `dwh-adev-observe`.`zz_xavier`.`my_second_dbt_model`
  OPTIONS()
  as -- Use the `ref` function to select from other models

select *
from `dwh-adev-observe`.`zz_xavier`.`my_first_dbt_model`
where id = 1;


07:43:48.241777 [debug] [Thread-1  ]: finished collecting timing info
07:43:48.242324 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '715698fd-831b-4187-a5f2-9521e19e2b13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6373d0>]}
07:43:48.242748 [info ] [Thread-1  ]: 2 of 2 OK created view model zz_xavier.my_second_dbt_model ..................... [[32mOK[0m in 1.06s]
07:43:48.243232 [debug] [Thread-1  ]: Finished running node model.exercise.my_second_dbt_model
07:43:48.244492 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:43:48.244938 [info ] [MainThread]: 
07:43:48.245346 [info ] [MainThread]: Finished running 1 table model, 1 view model in 7.09s.
07:43:48.245618 [debug] [MainThread]: Connection 'master' was properly closed.
07:43:48.245773 [debug] [MainThread]: Connection 'model.exercise.my_second_dbt_model' was properly closed.
07:43:48.251778 [info ] [MainThread]: 
07:43:48.252071 [info ] [MainThread]: [32mCompleted successfully[0m
07:43:48.252388 [info ] [MainThread]: 
07:43:48.252627 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
07:43:48.252976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b5ea610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b5c91f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4f2ca0>]}


============================== 2022-09-22 09:11:40.365365 | 5d6d6765-d97e-43b2-82bb-9fec0213b5ce ==============================
09:11:40.365379 [info ] [MainThread]: Running with dbt=1.1.2
09:11:40.365938 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:11:40.366124 [debug] [MainThread]: Tracking: tracking
09:11:40.377983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a73970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a975b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a97460>]}
09:11:40.409916 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
09:11:40.410219 [debug] [MainThread]: Partial parsing: added file: exercise://models/model1.sql
09:11:40.420409 [debug] [MainThread]: 1699: static parser successfully parsed model1.sql
09:11:40.436013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5d6d6765-d97e-43b2-82bb-9fec0213b5ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114bfe0d0>]}
09:11:40.440382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5d6d6765-d97e-43b2-82bb-9fec0213b5ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114b93d90>]}
09:11:40.440605 [info ] [MainThread]: Found 3 models, 4 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:11:40.440831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d6d6765-d97e-43b2-82bb-9fec0213b5ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a73970>]}
09:11:40.441994 [info ] [MainThread]: 
09:11:40.442641 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:11:40.443467 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:11:40.443744 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:11:41.818710 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:11:41.819274 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:11:42.241467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d6d6765-d97e-43b2-82bb-9fec0213b5ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114b93ca0>]}
09:11:42.242245 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:11:42.242655 [info ] [MainThread]: 
09:11:42.246827 [debug] [Thread-1  ]: Began running node model.exercise.model1
09:11:42.247208 [info ] [Thread-1  ]: 1 of 3 START view model zz_xavier.model1 ....................................... [RUN]
09:11:42.247723 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model1"
09:11:42.247909 [debug] [Thread-1  ]: Began compiling node model.exercise.model1
09:11:42.248115 [debug] [Thread-1  ]: Compiling model.exercise.model1
09:11:42.250105 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model1"
09:11:42.250607 [debug] [Thread-1  ]: finished collecting timing info
09:11:42.250806 [debug] [Thread-1  ]: Began executing node model.exercise.model1
09:11:42.284408 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model1"
09:11:42.284957 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:11:42.285187 [debug] [Thread-1  ]: On model.exercise.model1: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model1"} */


  create or replace view `dwh-adev-observe`.`zz_xavier`.`model1`
  OPTIONS()
  as with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where (DATE_DIFF(d1.activity_day, d2.install_day, DAY) < 7 and d1.activity_type = 'payment')
  order by d1.user_id DESC
),

spent_per_user as (
  select distinct
      elegible_users.USER_ID,
      sum(elegible_users.spent) as money,
      elegible_users.campaign
  from elegible_users
  group by 
      elegible_users.campaign, elegible_users.USER_ID

),

spent_per_user_campaign as (
  select sum(cs.dollar_spend) as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.date_act = cs.spend_day and cs.campaign = eu.campaign
  group by eu.USER_ID, eu.campaign
),

final as (
  select
  eu.USER_ID, eu.money , eu.campaign, su.money
  from spent_per_user as eu join spent_per_user_campaign as su on 
  eu.USER_ID = su.USER_ID
  order by eu.USER_ID asc

)

select * from final;


09:11:43.737287 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('CREATE VIEW has columns with duplicate name money at [6:6]')
09:11:45.882974 [debug] [Thread-1  ]: finished collecting timing info
09:11:45.883593 [debug] [Thread-1  ]: Database Error in model model1 (models/model1.sql)
  CREATE VIEW has columns with duplicate name money at [6:6]
  compiled SQL at target/run/exercise/models/model1.sql
09:11:45.884036 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d6d6765-d97e-43b2-82bb-9fec0213b5ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114ce0910>]}
09:11:45.884460 [error] [Thread-1  ]: 1 of 3 ERROR creating view model zz_xavier.model1 .............................. [[31mERROR[0m in 3.64s]
09:11:45.884967 [debug] [Thread-1  ]: Finished running node model.exercise.model1
09:11:45.885220 [debug] [Thread-1  ]: Began running node model.exercise.my_first_dbt_model
09:11:45.885797 [info ] [Thread-1  ]: 2 of 3 START table model zz_xavier.my_first_dbt_model .......................... [RUN]
09:11:45.886337 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.my_first_dbt_model"
09:11:45.886532 [debug] [Thread-1  ]: Began compiling node model.exercise.my_first_dbt_model
09:11:45.886713 [debug] [Thread-1  ]: Compiling model.exercise.my_first_dbt_model
09:11:45.889722 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.my_first_dbt_model"
09:11:45.890288 [debug] [Thread-1  ]: finished collecting timing info
09:11:45.890481 [debug] [Thread-1  ]: Began executing node model.exercise.my_first_dbt_model
09:11:45.904276 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:11:46.255802 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.my_first_dbt_model"
09:11:46.256390 [debug] [Thread-1  ]: On model.exercise.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.my_first_dbt_model"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
09:11:48.802438 [debug] [Thread-1  ]: finished collecting timing info
09:11:48.802968 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d6d6765-d97e-43b2-82bb-9fec0213b5ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114d4ca30>]}
09:11:48.803363 [info ] [Thread-1  ]: 2 of 3 OK created table model zz_xavier.my_first_dbt_model ..................... [[32mCREATE TABLE (2.0 rows, 0 processed)[0m in 2.92s]
09:11:48.803800 [debug] [Thread-1  ]: Finished running node model.exercise.my_first_dbt_model
09:11:48.804451 [debug] [Thread-1  ]: Began running node model.exercise.my_second_dbt_model
09:11:48.804784 [info ] [Thread-1  ]: 3 of 3 START view model zz_xavier.my_second_dbt_model .......................... [RUN]
09:11:48.805256 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.my_second_dbt_model"
09:11:48.805488 [debug] [Thread-1  ]: Began compiling node model.exercise.my_second_dbt_model
09:11:48.805687 [debug] [Thread-1  ]: Compiling model.exercise.my_second_dbt_model
09:11:48.808271 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.my_second_dbt_model"
09:11:48.808774 [debug] [Thread-1  ]: finished collecting timing info
09:11:48.808955 [debug] [Thread-1  ]: Began executing node model.exercise.my_second_dbt_model
09:11:48.811500 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.my_second_dbt_model"
09:11:48.811951 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:11:48.812169 [debug] [Thread-1  ]: On model.exercise.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.my_second_dbt_model"} */


  create or replace view `dwh-adev-observe`.`zz_xavier`.`my_second_dbt_model`
  OPTIONS()
  as -- Use the `ref` function to select from other models

select *
from `dwh-adev-observe`.`zz_xavier`.`my_first_dbt_model`
where id = 1;


09:11:50.052726 [debug] [Thread-1  ]: finished collecting timing info
09:11:50.053281 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d6d6765-d97e-43b2-82bb-9fec0213b5ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114cf8fa0>]}
09:11:50.053690 [info ] [Thread-1  ]: 3 of 3 OK created view model zz_xavier.my_second_dbt_model ..................... [[32mOK[0m in 1.25s]
09:11:50.054169 [debug] [Thread-1  ]: Finished running node model.exercise.my_second_dbt_model
09:11:50.055465 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:11:50.055924 [info ] [MainThread]: 
09:11:50.056403 [info ] [MainThread]: Finished running 2 view models, 1 table model in 9.61s.
09:11:50.056667 [debug] [MainThread]: Connection 'master' was properly closed.
09:11:50.056815 [debug] [MainThread]: Connection 'model.exercise.my_second_dbt_model' was properly closed.
09:11:50.062780 [info ] [MainThread]: 
09:11:50.063090 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:11:50.063371 [info ] [MainThread]: 
09:11:50.063615 [error] [MainThread]: [33mDatabase Error in model model1 (models/model1.sql)[0m
09:11:50.063847 [error] [MainThread]:   CREATE VIEW has columns with duplicate name money at [6:6]
09:11:50.064064 [error] [MainThread]:   compiled SQL at target/run/exercise/models/model1.sql
09:11:50.064293 [info ] [MainThread]: 
09:11:50.064520 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
09:11:50.064867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a83640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a838b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114bd6cd0>]}


============================== 2022-09-22 09:12:49.909972 | b21a49a1-8627-4c42-81bf-bd04eedfb294 ==============================
09:12:49.910006 [info ] [MainThread]: Running with dbt=1.1.2
09:12:49.910496 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:12:49.910853 [debug] [MainThread]: Tracking: tracking
09:12:49.922941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125b4970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125a04c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125a0640>]}
09:12:49.943624 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
09:12:49.943924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'b21a49a1-8627-4c42-81bf-bd04eedfb294', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11258baf0>]}
09:12:49.958846 [debug] [MainThread]: Parsing macros/etc.sql
09:12:49.960886 [debug] [MainThread]: Parsing macros/catalog.sql
09:12:49.966474 [debug] [MainThread]: Parsing macros/adapters.sql
09:12:49.988012 [debug] [MainThread]: Parsing macros/materializations/seed.sql
09:12:49.990232 [debug] [MainThread]: Parsing macros/materializations/view.sql
09:12:49.992476 [debug] [MainThread]: Parsing macros/materializations/table.sql
09:12:49.995971 [debug] [MainThread]: Parsing macros/materializations/copy.sql
09:12:49.998223 [debug] [MainThread]: Parsing macros/materializations/incremental.sql
09:12:50.011467 [debug] [MainThread]: Parsing macros/materializations/snapshot.sql
09:12:50.012907 [debug] [MainThread]: Parsing macros/materializations/hooks.sql
09:12:50.016318 [debug] [MainThread]: Parsing macros/materializations/configs.sql
09:12:50.018331 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot_merge.sql
09:12:50.019762 [debug] [MainThread]: Parsing macros/materializations/snapshots/strategies.sql
09:12:50.034471 [debug] [MainThread]: Parsing macros/materializations/snapshots/helpers.sql
09:12:50.045479 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot.sql
09:12:50.054798 [debug] [MainThread]: Parsing macros/materializations/tests/test.sql
09:12:50.058580 [debug] [MainThread]: Parsing macros/materializations/tests/helpers.sql
09:12:50.060066 [debug] [MainThread]: Parsing macros/materializations/tests/where_subquery.sql
09:12:50.061590 [debug] [MainThread]: Parsing macros/materializations/models/incremental/column_helpers.sql
09:12:50.065396 [debug] [MainThread]: Parsing macros/materializations/models/incremental/merge.sql
09:12:50.079436 [debug] [MainThread]: Parsing macros/materializations/models/incremental/is_incremental.sql
09:12:50.080703 [debug] [MainThread]: Parsing macros/materializations/models/incremental/incremental.sql
09:12:50.089244 [debug] [MainThread]: Parsing macros/materializations/models/incremental/on_schema_change.sql
09:12:50.102742 [debug] [MainThread]: Parsing macros/materializations/models/table/table.sql
09:12:50.109104 [debug] [MainThread]: Parsing macros/materializations/models/table/create_table_as.sql
09:12:50.111563 [debug] [MainThread]: Parsing macros/materializations/models/view/view.sql
09:12:50.117847 [debug] [MainThread]: Parsing macros/materializations/models/view/helpers.sql
09:12:50.119010 [debug] [MainThread]: Parsing macros/materializations/models/view/create_or_replace_view.sql
09:12:50.121296 [debug] [MainThread]: Parsing macros/materializations/models/view/create_view_as.sql
09:12:50.123285 [debug] [MainThread]: Parsing macros/materializations/seeds/seed.sql
09:12:50.128576 [debug] [MainThread]: Parsing macros/materializations/seeds/helpers.sql
09:12:50.142625 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_alias.sql
09:12:50.143860 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_schema.sql
09:12:50.145914 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_database.sql
09:12:50.147222 [debug] [MainThread]: Parsing macros/generic_test_sql/relationships.sql
09:12:50.147954 [debug] [MainThread]: Parsing macros/generic_test_sql/not_null.sql
09:12:50.148638 [debug] [MainThread]: Parsing macros/generic_test_sql/unique.sql
09:12:50.149216 [debug] [MainThread]: Parsing macros/generic_test_sql/accepted_values.sql
09:12:50.150358 [debug] [MainThread]: Parsing macros/etc/statement.sql
09:12:50.154301 [debug] [MainThread]: Parsing macros/etc/datetime.sql
09:12:50.161533 [debug] [MainThread]: Parsing macros/adapters/schema.sql
09:12:50.163383 [debug] [MainThread]: Parsing macros/adapters/indexes.sql
09:12:50.165707 [debug] [MainThread]: Parsing macros/adapters/relation.sql
09:12:50.173833 [debug] [MainThread]: Parsing macros/adapters/freshness.sql
09:12:50.176355 [debug] [MainThread]: Parsing macros/adapters/persist_docs.sql
09:12:50.180163 [debug] [MainThread]: Parsing macros/adapters/metadata.sql
09:12:50.186301 [debug] [MainThread]: Parsing macros/adapters/columns.sql
09:12:50.194418 [debug] [MainThread]: Parsing tests/generic/builtin.sql
09:12:50.368140 [debug] [MainThread]: 1699: static parser successfully parsed model1.sql
09:12:50.377637 [debug] [MainThread]: 1699: static parser successfully parsed example/my_first_dbt_model.sql
09:12:50.379521 [debug] [MainThread]: 1699: static parser successfully parsed example/my_second_dbt_model.sql
09:12:50.420578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b21a49a1-8627-4c42-81bf-bd04eedfb294', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112654670>]}
09:12:50.424753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b21a49a1-8627-4c42-81bf-bd04eedfb294', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112699310>]}
09:12:50.424979 [info ] [MainThread]: Found 3 models, 4 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:12:50.425174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b21a49a1-8627-4c42-81bf-bd04eedfb294', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125b4970>]}
09:12:50.426294 [info ] [MainThread]: 
09:12:50.426678 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:12:50.427308 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:12:50.427446 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:12:51.707581 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:12:51.708093 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:12:52.123443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b21a49a1-8627-4c42-81bf-bd04eedfb294', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126332b0>]}
09:12:52.124328 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:12:52.124805 [info ] [MainThread]: 
09:12:52.131202 [debug] [Thread-1  ]: Began running node model.exercise.model1
09:12:52.131554 [info ] [Thread-1  ]: 1 of 3 START view model zz_xavier.model1 ....................................... [RUN]
09:12:52.132103 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model1"
09:12:52.132299 [debug] [Thread-1  ]: Began compiling node model.exercise.model1
09:12:52.132516 [debug] [Thread-1  ]: Compiling model.exercise.model1
09:12:52.188272 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model1"
09:12:52.188924 [debug] [Thread-1  ]: finished collecting timing info
09:12:52.189155 [debug] [Thread-1  ]: Began executing node model.exercise.model1
09:12:52.224832 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model1"
09:12:52.225361 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:12:52.225588 [debug] [Thread-1  ]: On model.exercise.model1: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model1"} */


  create or replace view `dwh-adev-observe`.`zz_xavier`.`model1`
  OPTIONS()
  as with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where (DATE_DIFF(d1.activity_day, d2.install_day, DAY) < 7 and d1.activity_type = 'payment')
  order by d1.user_id DESC
),

spent_per_user as (
  select distinct
      elegible_users.USER_ID,
      sum(elegible_users.spent) as money,
      elegible_users.campaign
  from elegible_users
  group by 
      elegible_users.campaign, elegible_users.USER_ID

),

spent_per_user_campaign as (
  select sum(cs.dollar_spend) as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.date_act = cs.spend_day and cs.campaign = eu.campaign
  group by eu.USER_ID, eu.campaign
),

final as (
  select
  eu.USER_ID, eu.money , eu.campaign, su.money
  from spent_per_user as eu join spent_per_user_campaign as su on 
  eu.USER_ID = su.USER_ID
  order by eu.USER_ID asc

)

select * from final;


09:12:54.450197 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('CREATE VIEW has columns with duplicate name money at [6:6]')
09:12:56.403687 [debug] [Thread-1  ]: finished collecting timing info
09:12:56.404301 [debug] [Thread-1  ]: Database Error in model model1 (models/model1.sql)
  CREATE VIEW has columns with duplicate name money at [6:6]
  compiled SQL at target/run/exercise/models/model1.sql
09:12:56.404721 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b21a49a1-8627-4c42-81bf-bd04eedfb294', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112725850>]}
09:12:56.405237 [error] [Thread-1  ]: 1 of 3 ERROR creating view model zz_xavier.model1 .............................. [[31mERROR[0m in 4.27s]
09:12:56.405790 [debug] [Thread-1  ]: Finished running node model.exercise.model1
09:12:56.406041 [debug] [Thread-1  ]: Began running node model.exercise.my_first_dbt_model
09:12:56.406477 [info ] [Thread-1  ]: 2 of 3 START table model zz_xavier.my_first_dbt_model .......................... [RUN]
09:12:56.407069 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.my_first_dbt_model"
09:12:56.407274 [debug] [Thread-1  ]: Began compiling node model.exercise.my_first_dbt_model
09:12:56.407472 [debug] [Thread-1  ]: Compiling model.exercise.my_first_dbt_model
09:12:56.410807 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.my_first_dbt_model"
09:12:56.411372 [debug] [Thread-1  ]: finished collecting timing info
09:12:56.411581 [debug] [Thread-1  ]: Began executing node model.exercise.my_first_dbt_model
09:12:56.423442 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:12:56.872709 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.my_first_dbt_model"
09:12:56.873298 [debug] [Thread-1  ]: On model.exercise.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.my_first_dbt_model"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
09:12:59.418532 [debug] [Thread-1  ]: finished collecting timing info
09:12:59.419011 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b21a49a1-8627-4c42-81bf-bd04eedfb294', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126938e0>]}
09:12:59.419357 [info ] [Thread-1  ]: 2 of 3 OK created table model zz_xavier.my_first_dbt_model ..................... [[32mCREATE TABLE (2.0 rows, 0 processed)[0m in 3.01s]
09:12:59.419762 [debug] [Thread-1  ]: Finished running node model.exercise.my_first_dbt_model
09:12:59.420417 [debug] [Thread-1  ]: Began running node model.exercise.my_second_dbt_model
09:12:59.420731 [info ] [Thread-1  ]: 3 of 3 START table model zz_xavier.my_second_dbt_model ......................... [RUN]
09:12:59.421169 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.my_second_dbt_model"
09:12:59.421442 [debug] [Thread-1  ]: Began compiling node model.exercise.my_second_dbt_model
09:12:59.421689 [debug] [Thread-1  ]: Compiling model.exercise.my_second_dbt_model
09:12:59.424183 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.my_second_dbt_model"
09:12:59.424662 [debug] [Thread-1  ]: finished collecting timing info
09:12:59.424838 [debug] [Thread-1  ]: Began executing node model.exercise.my_second_dbt_model
09:12:59.426507 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:13:00.160059 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.my_second_dbt_model"
09:13:00.160716 [debug] [Thread-1  ]: On model.exercise.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.my_second_dbt_model"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`my_second_dbt_model`
  
  
  OPTIONS()
  as (
    -- Use the `ref` function to select from other models

select *
from `dwh-adev-observe`.`zz_xavier`.`my_first_dbt_model`
where id = 1
  );
  
09:13:02.924909 [debug] [Thread-1  ]: finished collecting timing info
09:13:02.925593 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b21a49a1-8627-4c42-81bf-bd04eedfb294', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11283af40>]}
09:13:02.926119 [info ] [Thread-1  ]: 3 of 3 OK created table model zz_xavier.my_second_dbt_model .................... [[32mCREATE TABLE (1.0 rows, 8.0 Bytes processed)[0m in 3.50s]
09:13:02.926615 [debug] [Thread-1  ]: Finished running node model.exercise.my_second_dbt_model
09:13:02.928033 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:13:02.928600 [info ] [MainThread]: 
09:13:02.928953 [info ] [MainThread]: Finished running 1 view model, 2 table models in 12.50s.
09:13:02.929256 [debug] [MainThread]: Connection 'master' was properly closed.
09:13:02.929428 [debug] [MainThread]: Connection 'model.exercise.my_second_dbt_model' was properly closed.
09:13:02.936311 [info ] [MainThread]: 
09:13:02.936646 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:13:02.936942 [info ] [MainThread]: 
09:13:02.937199 [error] [MainThread]: [33mDatabase Error in model model1 (models/model1.sql)[0m
09:13:02.937472 [error] [MainThread]:   CREATE VIEW has columns with duplicate name money at [6:6]
09:13:02.937704 [error] [MainThread]:   compiled SQL at target/run/exercise/models/model1.sql
09:13:02.937941 [info ] [MainThread]: 
09:13:02.938181 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
09:13:02.938520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125b4190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112654250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112633250>]}


============================== 2022-09-22 09:13:55.427951 | dc30cf70-faad-48ba-9418-6dc03c3aa99a ==============================
09:13:55.427996 [info ] [MainThread]: Running with dbt=1.1.2
09:13:55.428585 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:13:55.428773 [debug] [MainThread]: Tracking: tracking
09:13:55.439234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10771a880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10771a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10771a340>]}
09:13:55.459030 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
09:13:55.459326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'dc30cf70-faad-48ba-9418-6dc03c3aa99a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077168b0>]}
09:13:55.474404 [debug] [MainThread]: Parsing macros/etc.sql
09:13:55.476408 [debug] [MainThread]: Parsing macros/catalog.sql
09:13:55.481638 [debug] [MainThread]: Parsing macros/adapters.sql
09:13:55.502630 [debug] [MainThread]: Parsing macros/materializations/seed.sql
09:13:55.504807 [debug] [MainThread]: Parsing macros/materializations/view.sql
09:13:55.507060 [debug] [MainThread]: Parsing macros/materializations/table.sql
09:13:55.510532 [debug] [MainThread]: Parsing macros/materializations/copy.sql
09:13:55.512824 [debug] [MainThread]: Parsing macros/materializations/incremental.sql
09:13:55.525921 [debug] [MainThread]: Parsing macros/materializations/snapshot.sql
09:13:55.527346 [debug] [MainThread]: Parsing macros/materializations/hooks.sql
09:13:55.530799 [debug] [MainThread]: Parsing macros/materializations/configs.sql
09:13:55.532828 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot_merge.sql
09:13:55.534256 [debug] [MainThread]: Parsing macros/materializations/snapshots/strategies.sql
09:13:55.549288 [debug] [MainThread]: Parsing macros/materializations/snapshots/helpers.sql
09:13:55.560565 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot.sql
09:13:55.570102 [debug] [MainThread]: Parsing macros/materializations/tests/test.sql
09:13:55.573970 [debug] [MainThread]: Parsing macros/materializations/tests/helpers.sql
09:13:55.575488 [debug] [MainThread]: Parsing macros/materializations/tests/where_subquery.sql
09:13:55.577052 [debug] [MainThread]: Parsing macros/materializations/models/incremental/column_helpers.sql
09:13:55.580921 [debug] [MainThread]: Parsing macros/materializations/models/incremental/merge.sql
09:13:55.595343 [debug] [MainThread]: Parsing macros/materializations/models/incremental/is_incremental.sql
09:13:55.596649 [debug] [MainThread]: Parsing macros/materializations/models/incremental/incremental.sql
09:13:55.605419 [debug] [MainThread]: Parsing macros/materializations/models/incremental/on_schema_change.sql
09:13:55.618805 [debug] [MainThread]: Parsing macros/materializations/models/table/table.sql
09:13:55.625299 [debug] [MainThread]: Parsing macros/materializations/models/table/create_table_as.sql
09:13:55.627790 [debug] [MainThread]: Parsing macros/materializations/models/view/view.sql
09:13:55.634090 [debug] [MainThread]: Parsing macros/materializations/models/view/helpers.sql
09:13:55.635216 [debug] [MainThread]: Parsing macros/materializations/models/view/create_or_replace_view.sql
09:13:55.637518 [debug] [MainThread]: Parsing macros/materializations/models/view/create_view_as.sql
09:13:55.639491 [debug] [MainThread]: Parsing macros/materializations/seeds/seed.sql
09:13:55.644455 [debug] [MainThread]: Parsing macros/materializations/seeds/helpers.sql
09:13:55.658371 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_alias.sql
09:13:55.659558 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_schema.sql
09:13:55.661562 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_database.sql
09:13:55.662826 [debug] [MainThread]: Parsing macros/generic_test_sql/relationships.sql
09:13:55.663528 [debug] [MainThread]: Parsing macros/generic_test_sql/not_null.sql
09:13:55.664258 [debug] [MainThread]: Parsing macros/generic_test_sql/unique.sql
09:13:55.664815 [debug] [MainThread]: Parsing macros/generic_test_sql/accepted_values.sql
09:13:55.665913 [debug] [MainThread]: Parsing macros/etc/statement.sql
09:13:55.669592 [debug] [MainThread]: Parsing macros/etc/datetime.sql
09:13:55.676544 [debug] [MainThread]: Parsing macros/adapters/schema.sql
09:13:55.678298 [debug] [MainThread]: Parsing macros/adapters/indexes.sql
09:13:55.680553 [debug] [MainThread]: Parsing macros/adapters/relation.sql
09:13:55.688505 [debug] [MainThread]: Parsing macros/adapters/freshness.sql
09:13:55.690921 [debug] [MainThread]: Parsing macros/adapters/persist_docs.sql
09:13:55.694652 [debug] [MainThread]: Parsing macros/adapters/metadata.sql
09:13:55.700755 [debug] [MainThread]: Parsing macros/adapters/columns.sql
09:13:55.708839 [debug] [MainThread]: Parsing tests/generic/builtin.sql
09:13:55.884315 [debug] [MainThread]: 1699: static parser successfully parsed model1.sql
09:13:55.893873 [debug] [MainThread]: 1699: static parser successfully parsed example/my_first_dbt_model.sql
09:13:55.895715 [debug] [MainThread]: 1699: static parser successfully parsed example/my_second_dbt_model.sql
09:13:55.936390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dc30cf70-faad-48ba-9418-6dc03c3aa99a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10780d880>]}
09:13:55.940934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dc30cf70-faad-48ba-9418-6dc03c3aa99a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076fac70>]}
09:13:55.941233 [info ] [MainThread]: Found 3 models, 4 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:13:55.941424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc30cf70-faad-48ba-9418-6dc03c3aa99a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078cb820>]}
09:13:55.942700 [info ] [MainThread]: 
09:13:55.943223 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:13:55.944396 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:13:55.944885 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:13:57.201840 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:13:57.202343 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:13:57.681267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc30cf70-faad-48ba-9418-6dc03c3aa99a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107820e50>]}
09:13:57.682172 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:13:57.682647 [info ] [MainThread]: 
09:13:57.689178 [debug] [Thread-1  ]: Began running node model.exercise.model1
09:13:57.689541 [info ] [Thread-1  ]: 1 of 3 START table model zz_xavier.model1 ...................................... [RUN]
09:13:57.690064 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model1"
09:13:57.690268 [debug] [Thread-1  ]: Began compiling node model.exercise.model1
09:13:57.690508 [debug] [Thread-1  ]: Compiling model.exercise.model1
09:13:57.744634 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model1"
09:13:57.745275 [debug] [Thread-1  ]: finished collecting timing info
09:13:57.745512 [debug] [Thread-1  ]: Began executing node model.exercise.model1
09:13:57.785587 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model1"
09:13:57.786083 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:13:57.786307 [debug] [Thread-1  ]: On model.exercise.model1: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model1"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model1`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where (DATE_DIFF(d1.activity_day, d2.install_day, DAY) < 7 and d1.activity_type = 'payment')
  order by d1.user_id DESC
),

spent_per_user as (
  select distinct
      elegible_users.USER_ID,
      sum(elegible_users.spent) as money,
      elegible_users.campaign
  from elegible_users
  group by 
      elegible_users.campaign, elegible_users.USER_ID

),

spent_per_user_campaign as (
  select sum(cs.dollar_spend) as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.date_act = cs.spend_day and cs.campaign = eu.campaign
  group by eu.USER_ID, eu.campaign
),

final as (
  select
  eu.USER_ID, eu.money , eu.campaign, su.money
  from spent_per_user as eu join spent_per_user_campaign as su on 
  eu.USER_ID = su.USER_ID
  order by eu.USER_ID asc

)

select * from final
  );
  
09:13:59.001025 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('CREATE TABLE has columns with duplicate name money at [8:6]')
09:14:01.193335 [debug] [Thread-1  ]: finished collecting timing info
09:14:01.193933 [debug] [Thread-1  ]: Database Error in model model1 (models/model1.sql)
  CREATE TABLE has columns with duplicate name money at [8:6]
  compiled SQL at target/run/exercise/models/model1.sql
09:14:01.194358 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc30cf70-faad-48ba-9418-6dc03c3aa99a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076eb8e0>]}
09:14:01.194856 [error] [Thread-1  ]: 1 of 3 ERROR creating table model zz_xavier.model1 ............................. [[31mERROR[0m in 3.50s]
09:14:01.195364 [debug] [Thread-1  ]: Finished running node model.exercise.model1
09:14:01.195622 [debug] [Thread-1  ]: Began running node model.exercise.my_first_dbt_model
09:14:01.196107 [info ] [Thread-1  ]: 2 of 3 START table model zz_xavier.my_first_dbt_model .......................... [RUN]
09:14:01.196684 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.my_first_dbt_model"
09:14:01.196890 [debug] [Thread-1  ]: Began compiling node model.exercise.my_first_dbt_model
09:14:01.197082 [debug] [Thread-1  ]: Compiling model.exercise.my_first_dbt_model
09:14:01.200247 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.my_first_dbt_model"
09:14:01.200843 [debug] [Thread-1  ]: finished collecting timing info
09:14:01.201054 [debug] [Thread-1  ]: Began executing node model.exercise.my_first_dbt_model
09:14:01.203321 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:14:01.706733 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.my_first_dbt_model"
09:14:01.707393 [debug] [Thread-1  ]: On model.exercise.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.my_first_dbt_model"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
09:14:04.681131 [debug] [Thread-1  ]: finished collecting timing info
09:14:04.681677 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc30cf70-faad-48ba-9418-6dc03c3aa99a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078eab80>]}
09:14:04.682099 [info ] [Thread-1  ]: 2 of 3 OK created table model zz_xavier.my_first_dbt_model ..................... [[32mCREATE TABLE (2.0 rows, 0 processed)[0m in 3.49s]
09:14:04.682566 [debug] [Thread-1  ]: Finished running node model.exercise.my_first_dbt_model
09:14:04.683315 [debug] [Thread-1  ]: Began running node model.exercise.my_second_dbt_model
09:14:04.683637 [info ] [Thread-1  ]: 3 of 3 START table model zz_xavier.my_second_dbt_model ......................... [RUN]
09:14:04.684121 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.my_second_dbt_model"
09:14:04.684412 [debug] [Thread-1  ]: Began compiling node model.exercise.my_second_dbt_model
09:14:04.684633 [debug] [Thread-1  ]: Compiling model.exercise.my_second_dbt_model
09:14:04.687255 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.my_second_dbt_model"
09:14:04.687751 [debug] [Thread-1  ]: finished collecting timing info
09:14:04.687936 [debug] [Thread-1  ]: Began executing node model.exercise.my_second_dbt_model
09:14:04.689596 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:14:05.189505 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.my_second_dbt_model"
09:14:05.190315 [debug] [Thread-1  ]: On model.exercise.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.my_second_dbt_model"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`my_second_dbt_model`
  
  
  OPTIONS()
  as (
    -- Use the `ref` function to select from other models

select *
from `dwh-adev-observe`.`zz_xavier`.`my_first_dbt_model`
where id = 1
  );
  
09:14:09.693572 [debug] [Thread-1  ]: finished collecting timing info
09:14:09.694241 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc30cf70-faad-48ba-9418-6dc03c3aa99a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079aafa0>]}
09:14:09.694778 [info ] [Thread-1  ]: 3 of 3 OK created table model zz_xavier.my_second_dbt_model .................... [[32mCREATE TABLE (1.0 rows, 8.0 Bytes processed)[0m in 5.01s]
09:14:09.695281 [debug] [Thread-1  ]: Finished running node model.exercise.my_second_dbt_model
09:14:09.696597 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:14:09.697063 [info ] [MainThread]: 
09:14:09.697509 [info ] [MainThread]: Finished running 3 table models in 13.75s.
09:14:09.697809 [debug] [MainThread]: Connection 'master' was properly closed.
09:14:09.697974 [debug] [MainThread]: Connection 'model.exercise.my_second_dbt_model' was properly closed.
09:14:09.704394 [info ] [MainThread]: 
09:14:09.704712 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:14:09.704989 [info ] [MainThread]: 
09:14:09.705229 [error] [MainThread]: [33mDatabase Error in model model1 (models/model1.sql)[0m
09:14:09.705463 [error] [MainThread]:   CREATE TABLE has columns with duplicate name money at [8:6]
09:14:09.705681 [error] [MainThread]:   compiled SQL at target/run/exercise/models/model1.sql
09:14:09.705910 [info ] [MainThread]: 
09:14:09.706137 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
09:14:09.706486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077cec40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077ce490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10771ad60>]}


============================== 2022-09-22 09:16:04.534053 | 591de9d2-5d9c-454d-aae2-1719ffae884c ==============================
09:16:04.534098 [info ] [MainThread]: Running with dbt=1.1.2
09:16:04.534745 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:16:04.535420 [debug] [MainThread]: Tracking: tracking
09:16:04.546500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084ea820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084ead00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084eaa90>]}
09:16:04.581875 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:16:04.582247 [debug] [MainThread]: Partial parsing: updated file: exercise://models/model1.sql
09:16:04.592278 [debug] [MainThread]: 1699: static parser successfully parsed model1.sql
09:16:04.608206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '591de9d2-5d9c-454d-aae2-1719ffae884c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10868f0d0>]}
09:16:04.612430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '591de9d2-5d9c-454d-aae2-1719ffae884c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108625d30>]}
09:16:04.612657 [info ] [MainThread]: Found 3 models, 4 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:16:04.612906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '591de9d2-5d9c-454d-aae2-1719ffae884c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10716e190>]}
09:16:04.614075 [info ] [MainThread]: 
09:16:04.614414 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:16:04.615057 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:16:04.615528 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:16:05.897740 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:16:05.898223 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:16:06.435175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '591de9d2-5d9c-454d-aae2-1719ffae884c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108625cd0>]}
09:16:06.436063 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:16:06.436519 [info ] [MainThread]: 
09:16:06.441156 [debug] [Thread-1  ]: Began running node model.exercise.model1
09:16:06.441572 [info ] [Thread-1  ]: 1 of 3 START table model zz_xavier.model1 ...................................... [RUN]
09:16:06.442146 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model1"
09:16:06.442350 [debug] [Thread-1  ]: Began compiling node model.exercise.model1
09:16:06.442576 [debug] [Thread-1  ]: Compiling model.exercise.model1
09:16:06.444710 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model1"
09:16:06.445230 [debug] [Thread-1  ]: finished collecting timing info
09:16:06.445443 [debug] [Thread-1  ]: Began executing node model.exercise.model1
09:16:06.483803 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model1"
09:16:06.484408 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:16:06.484646 [debug] [Thread-1  ]: On model.exercise.model1: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model1"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model1`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where (DATE_DIFF(d1.activity_day, d2.install_day, DAY) < 7 and d1.activity_type = 'payment')
  order by d1.user_id DESC
),

spent_per_user as (
  select distinct
      elegible_users.USER_ID,
      sum(elegible_users.spent) as money,
      elegible_users.campaign
  from elegible_users
  group by 
      elegible_users.campaign, elegible_users.USER_ID

),

spent_per_user_campaign as (
  select sum(cs.dollar_spend) as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.date_act = cs.spend_day and cs.campaign = eu.campaign
  group by eu.USER_ID, eu.campaign
),

final as (
  select
  eu.USER_ID, eu.money as user_spent_money, eu.campaign, su.money as money_spent_on_campaign
  from spent_per_user as eu join spent_per_user_campaign as su on 
  eu.USER_ID = su.USER_ID
  order by eu.USER_ID asc

)

select * from final
  );
  
09:16:11.455438 [debug] [Thread-1  ]: finished collecting timing info
09:16:11.456002 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '591de9d2-5d9c-454d-aae2-1719ffae884c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10875ce80>]}
09:16:11.456399 [info ] [Thread-1  ]: 1 of 3 OK created table model zz_xavier.model1 ................................. [[32mCREATE TABLE (34.4k rows, 464.1 MB processed)[0m in 5.01s]
09:16:11.456878 [debug] [Thread-1  ]: Finished running node model.exercise.model1
09:16:11.457111 [debug] [Thread-1  ]: Began running node model.exercise.my_first_dbt_model
09:16:11.457511 [info ] [Thread-1  ]: 2 of 3 START table model zz_xavier.my_first_dbt_model .......................... [RUN]
09:16:11.458013 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.my_first_dbt_model"
09:16:11.458198 [debug] [Thread-1  ]: Began compiling node model.exercise.my_first_dbt_model
09:16:11.458365 [debug] [Thread-1  ]: Compiling model.exercise.my_first_dbt_model
09:16:11.461080 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.my_first_dbt_model"
09:16:11.461591 [debug] [Thread-1  ]: finished collecting timing info
09:16:11.461777 [debug] [Thread-1  ]: Began executing node model.exercise.my_first_dbt_model
09:16:11.466298 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:16:11.888324 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.my_first_dbt_model"
09:16:11.889136 [debug] [Thread-1  ]: On model.exercise.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.my_first_dbt_model"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`my_first_dbt_model`
  
  
  OPTIONS()
  as (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
09:16:14.421860 [debug] [Thread-1  ]: finished collecting timing info
09:16:14.422531 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '591de9d2-5d9c-454d-aae2-1719ffae884c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10877fe80>]}
09:16:14.423026 [info ] [Thread-1  ]: 2 of 3 OK created table model zz_xavier.my_first_dbt_model ..................... [[32mCREATE TABLE (2.0 rows, 0 processed)[0m in 2.96s]
09:16:14.423525 [debug] [Thread-1  ]: Finished running node model.exercise.my_first_dbt_model
09:16:14.424302 [debug] [Thread-1  ]: Began running node model.exercise.my_second_dbt_model
09:16:14.424697 [info ] [Thread-1  ]: 3 of 3 START table model zz_xavier.my_second_dbt_model ......................... [RUN]
09:16:14.425228 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.my_second_dbt_model"
09:16:14.425507 [debug] [Thread-1  ]: Began compiling node model.exercise.my_second_dbt_model
09:16:14.425782 [debug] [Thread-1  ]: Compiling model.exercise.my_second_dbt_model
09:16:14.432360 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.my_second_dbt_model"
09:16:14.432879 [debug] [Thread-1  ]: finished collecting timing info
09:16:14.433074 [debug] [Thread-1  ]: Began executing node model.exercise.my_second_dbt_model
09:16:14.435799 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:16:14.869332 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.my_second_dbt_model"
09:16:14.870144 [debug] [Thread-1  ]: On model.exercise.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.my_second_dbt_model"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`my_second_dbt_model`
  
  
  OPTIONS()
  as (
    -- Use the `ref` function to select from other models

select *
from `dwh-adev-observe`.`zz_xavier`.`my_first_dbt_model`
where id = 1
  );
  
09:16:17.799952 [debug] [Thread-1  ]: finished collecting timing info
09:16:17.800637 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '591de9d2-5d9c-454d-aae2-1719ffae884c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108769520>]}
09:16:17.801144 [info ] [Thread-1  ]: 3 of 3 OK created table model zz_xavier.my_second_dbt_model .................... [[32mCREATE TABLE (1.0 rows, 8.0 Bytes processed)[0m in 3.38s]
09:16:17.801647 [debug] [Thread-1  ]: Finished running node model.exercise.my_second_dbt_model
09:16:17.803052 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:16:17.803627 [info ] [MainThread]: 
09:16:17.804012 [info ] [MainThread]: Finished running 3 table models in 13.19s.
09:16:17.804319 [debug] [MainThread]: Connection 'master' was properly closed.
09:16:17.804491 [debug] [MainThread]: Connection 'model.exercise.my_second_dbt_model' was properly closed.
09:16:17.811175 [info ] [MainThread]: 
09:16:17.811490 [info ] [MainThread]: [32mCompleted successfully[0m
09:16:17.811804 [info ] [MainThread]: 
09:16:17.812061 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
09:16:17.812430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108676be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086760d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086708e0>]}


============================== 2022-09-22 09:19:35.436692 | 6fa3090c-fc53-4074-bfc6-eed9f8133ae8 ==============================
09:19:35.436709 [info ] [MainThread]: Running with dbt=1.1.2
09:19:35.437202 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:19:35.437350 [debug] [MainThread]: Tracking: tracking
09:19:35.448349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d816250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8168b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8162b0>]}
09:19:35.483946 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 3 files added, 0 files changed.
09:19:35.484294 [debug] [MainThread]: Partial parsing: added file: exercise://models/model_30.sql
09:19:35.484504 [debug] [MainThread]: Partial parsing: added file: exercise://models/model_60.sql
09:19:35.484690 [debug] [MainThread]: Partial parsing: added file: exercise://models/model_7.sql
09:19:35.484890 [debug] [MainThread]: Partial parsing: deleted file: exercise://models/example/my_second_dbt_model.sql
09:19:35.485010 [debug] [MainThread]: Partial parsing: deleted file: exercise://models/model1.sql
09:19:35.485126 [debug] [MainThread]: Partial parsing: deleted file: exercise://models/example/my_first_dbt_model.sql
09:19:35.495503 [debug] [MainThread]: 1699: static parser successfully parsed model_30.sql
09:19:35.505815 [debug] [MainThread]: 1699: static parser successfully parsed model_60.sql
09:19:35.507745 [debug] [MainThread]: 1699: static parser successfully parsed model_7.sql
09:19:35.515745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6fa3090c-fc53-4074-bfc6-eed9f8133ae8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9880d0>]}
09:19:35.519720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6fa3090c-fc53-4074-bfc6-eed9f8133ae8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d913a90>]}
09:19:35.519945 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:19:35.520172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6fa3090c-fc53-4074-bfc6-eed9f8133ae8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9137c0>]}
09:19:35.521229 [info ] [MainThread]: 
09:19:35.521611 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:19:35.522455 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:19:35.523159 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:19:36.874552 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:19:36.875111 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:19:37.321700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6fa3090c-fc53-4074-bfc6-eed9f8133ae8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d921e20>]}
09:19:37.322629 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:19:37.323059 [info ] [MainThread]: 
09:19:37.327607 [debug] [Thread-1  ]: Began running node model.exercise.model_30
09:19:37.328067 [info ] [Thread-1  ]: 1 of 3 START table model zz_xavier.model_30 .................................... [RUN]
09:19:37.328727 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_30"
09:19:37.328939 [debug] [Thread-1  ]: Began compiling node model.exercise.model_30
09:19:37.329179 [debug] [Thread-1  ]: Compiling model.exercise.model_30
09:19:37.331384 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_30"
09:19:37.331930 [debug] [Thread-1  ]: finished collecting timing info
09:19:37.332142 [debug] [Thread-1  ]: Began executing node model.exercise.model_30
09:19:37.371854 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_30"
09:19:37.372461 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:19:37.372712 [debug] [Thread-1  ]: On model.exercise.model_30: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_30"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_30`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where (DATE_DIFF(d1.activity_day, d2.install_day, DAY) < 30 and d1.activity_type = 'payment')
  order by d1.user_id DESC
),

spent_per_user as (
  select distinct
      elegible_users.USER_ID,
      sum(elegible_users.spent) as money,
      elegible_users.campaign
  from elegible_users
  group by 
      elegible_users.campaign, elegible_users.USER_ID

),

spent_per_user_campaign as (
  select sum(cs.dollar_spend) as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.date_act = cs.spend_day and cs.campaign = eu.campaign
  group by eu.USER_ID, eu.campaign
),

final as (
  select
  eu.USER_ID, eu.money as user_spent_money, eu.campaign, su.money as money_spent_on_campaign
  from spent_per_user as eu join spent_per_user_campaign as su on 
  eu.USER_ID = su.USER_ID
  order by eu.USER_ID asc

)

select * from final
  );
  
09:19:42.267274 [debug] [Thread-1  ]: finished collecting timing info
09:19:42.267779 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fa3090c-fc53-4074-bfc6-eed9f8133ae8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d965f40>]}
09:19:42.268151 [info ] [Thread-1  ]: 1 of 3 OK created table model zz_xavier.model_30 ............................... [[32mCREATE TABLE (59.3k rows, 464.1 MB processed)[0m in 4.94s]
09:19:42.268588 [debug] [Thread-1  ]: Finished running node model.exercise.model_30
09:19:42.268801 [debug] [Thread-1  ]: Began running node model.exercise.model_60
09:19:42.269159 [info ] [Thread-1  ]: 2 of 3 START table model zz_xavier.model_60 .................................... [RUN]
09:19:42.269624 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_60"
09:19:42.269803 [debug] [Thread-1  ]: Began compiling node model.exercise.model_60
09:19:42.269967 [debug] [Thread-1  ]: Compiling model.exercise.model_60
09:19:42.271565 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_60"
09:19:42.272065 [debug] [Thread-1  ]: finished collecting timing info
09:19:42.272251 [debug] [Thread-1  ]: Began executing node model.exercise.model_60
09:19:42.277459 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_60"
09:19:42.277902 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:19:42.278114 [debug] [Thread-1  ]: On model.exercise.model_60: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_60"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_60`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where (DATE_DIFF(d1.activity_day, d2.install_day, DAY) < 60 and d1.activity_type = 'payment')
  order by d1.user_id DESC
),

spent_per_user as (
  select distinct
      elegible_users.USER_ID,
      sum(elegible_users.spent) as money,
      elegible_users.campaign
  from elegible_users
  group by 
      elegible_users.campaign, elegible_users.USER_ID

),

spent_per_user_campaign as (
  select sum(cs.dollar_spend) as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.date_act = cs.spend_day and cs.campaign = eu.campaign
  group by eu.USER_ID, eu.campaign
),

final as (
  select
  eu.USER_ID, eu.money as user_spent_money, eu.campaign, su.money as money_spent_on_campaign
  from spent_per_user as eu join spent_per_user_campaign as su on 
  eu.USER_ID = su.USER_ID
  order by eu.USER_ID asc

)

select * from final
  );
  
09:19:47.831569 [debug] [Thread-1  ]: finished collecting timing info
09:19:47.832173 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fa3090c-fc53-4074-bfc6-eed9f8133ae8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9657f0>]}
09:19:47.832622 [info ] [Thread-1  ]: 2 of 3 OK created table model zz_xavier.model_60 ............................... [[32mCREATE TABLE (72.5k rows, 464.1 MB processed)[0m in 5.56s]
09:19:47.833126 [debug] [Thread-1  ]: Finished running node model.exercise.model_60
09:19:47.833381 [debug] [Thread-1  ]: Began running node model.exercise.model_7
09:19:47.833803 [info ] [Thread-1  ]: 3 of 3 START table model zz_xavier.model_7 ..................................... [RUN]
09:19:47.834355 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_7"
09:19:47.834556 [debug] [Thread-1  ]: Began compiling node model.exercise.model_7
09:19:47.834747 [debug] [Thread-1  ]: Compiling model.exercise.model_7
09:19:47.840578 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_7"
09:19:47.841186 [debug] [Thread-1  ]: finished collecting timing info
09:19:47.841398 [debug] [Thread-1  ]: Began executing node model.exercise.model_7
09:19:47.845049 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_7"
09:19:47.845512 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:19:47.845734 [debug] [Thread-1  ]: On model.exercise.model_7: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_7"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_7`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where (DATE_DIFF(d1.activity_day, d2.install_day, DAY) < 7 and d1.activity_type = 'payment')
  order by d1.user_id DESC
),

spent_per_user as (
  select distinct
      elegible_users.USER_ID,
      sum(elegible_users.spent) as money,
      elegible_users.campaign
  from elegible_users
  group by 
      elegible_users.campaign, elegible_users.USER_ID

),

spent_per_user_campaign as (
  select sum(cs.dollar_spend) as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.date_act = cs.spend_day and cs.campaign = eu.campaign
  group by eu.USER_ID, eu.campaign
),

final as (
  select
  eu.USER_ID, eu.money as user_spent_money, eu.campaign, su.money as money_spent_on_campaign
  from spent_per_user as eu join spent_per_user_campaign as su on 
  eu.USER_ID = su.USER_ID
  order by eu.USER_ID asc

)

select * from final
  );
  
09:19:52.535592 [debug] [Thread-1  ]: finished collecting timing info
09:19:52.536265 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fa3090c-fc53-4074-bfc6-eed9f8133ae8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d965730>]}
09:19:52.536784 [info ] [Thread-1  ]: 3 of 3 OK created table model zz_xavier.model_7 ................................ [[32mCREATE TABLE (34.4k rows, 464.1 MB processed)[0m in 4.70s]
09:19:52.537280 [debug] [Thread-1  ]: Finished running node model.exercise.model_7
09:19:52.538604 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:19:52.539073 [info ] [MainThread]: 
09:19:52.539558 [info ] [MainThread]: Finished running 3 table models in 17.02s.
09:19:52.539904 [debug] [MainThread]: Connection 'master' was properly closed.
09:19:52.540074 [debug] [MainThread]: Connection 'model.exercise.model_7' was properly closed.
09:19:52.546293 [info ] [MainThread]: 
09:19:52.546619 [info ] [MainThread]: [32mCompleted successfully[0m
09:19:52.546952 [info ] [MainThread]: 
09:19:52.547206 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
09:19:52.547578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d826340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7f4490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da43e80>]}


============================== 2022-09-23 08:03:50.489800 | 9382a92e-091a-4c3f-ad5c-80947359d69f ==============================
08:03:50.489885 [info ] [MainThread]: Running with dbt=1.1.2
08:03:50.491063 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
08:03:50.491278 [debug] [MainThread]: Tracking: tracking
08:03:50.506726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10adf0910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c18eb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c18eb80>]}
08:03:50.557794 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
08:03:50.558215 [debug] [MainThread]: Partial parsing: added file: exercise://models/model_test.sql
08:03:50.558520 [debug] [MainThread]: Partial parsing: updated file: exercise://models/model_7.sql
08:03:50.571248 [debug] [MainThread]: 1699: static parser successfully parsed model_test.sql
08:03:50.583275 [debug] [MainThread]: 1699: static parser successfully parsed model_7.sql
08:03:50.592351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9382a92e-091a-4c3f-ad5c-80947359d69f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c2f70d0>]}
08:03:50.596380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9382a92e-091a-4c3f-ad5c-80947359d69f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c289cd0>]}
08:03:50.596604 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
08:03:50.596826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9382a92e-091a-4c3f-ad5c-80947359d69f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10adf0910>]}
08:03:50.597953 [info ] [MainThread]: 
08:03:50.598304 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:03:50.599099 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
08:03:50.599362 [debug] [ThreadPool]: Opening a new connection, currently in state init
08:03:52.872873 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
08:03:52.873383 [debug] [ThreadPool]: Opening a new connection, currently in state closed
08:03:53.444929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9382a92e-091a-4c3f-ad5c-80947359d69f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c18e8e0>]}
08:03:53.445884 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
08:03:53.446357 [info ] [MainThread]: 
08:03:53.452309 [debug] [Thread-1  ]: Began running node model.exercise.model_30
08:03:53.452672 [info ] [Thread-1  ]: 1 of 4 START table model zz_xavier.model_30 .................................... [RUN]
08:03:53.453218 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_30"
08:03:53.453409 [debug] [Thread-1  ]: Began compiling node model.exercise.model_30
08:03:53.453612 [debug] [Thread-1  ]: Compiling model.exercise.model_30
08:03:53.455620 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_30"
08:03:53.456114 [debug] [Thread-1  ]: finished collecting timing info
08:03:53.456309 [debug] [Thread-1  ]: Began executing node model.exercise.model_30
08:03:53.474264 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:03:54.082314 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_30"
08:03:54.082887 [debug] [Thread-1  ]: On model.exercise.model_30: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_30"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_30`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where (DATE_DIFF(d1.activity_day, d2.install_day, DAY) < 30 and d1.activity_type = 'payment')
  order by d1.user_id DESC
),

spent_per_user as (
  select distinct
      elegible_users.USER_ID,
      sum(elegible_users.spent) as money,
      elegible_users.campaign
  from elegible_users
  group by 
      elegible_users.campaign, elegible_users.USER_ID

),

spent_per_user_campaign as (
  select sum(cs.dollar_spend) as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.date_act = cs.spend_day and cs.campaign = eu.campaign
  group by eu.USER_ID, eu.campaign
),

final as (
  select
  eu.USER_ID, eu.money as user_spent_money, eu.campaign, su.money as money_spent_on_campaign
  from spent_per_user as eu join spent_per_user_campaign as su on 
  eu.USER_ID = su.USER_ID
  order by eu.USER_ID asc

)

select * from final
  );
  
08:03:58.778977 [debug] [Thread-1  ]: finished collecting timing info
08:03:58.779559 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9382a92e-091a-4c3f-ad5c-80947359d69f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c2b8430>]}
08:03:58.779937 [info ] [Thread-1  ]: 1 of 4 OK created table model zz_xavier.model_30 ............................... [[32mCREATE TABLE (59.3k rows, 464.1 MB processed)[0m in 5.33s]
08:03:58.780368 [debug] [Thread-1  ]: Finished running node model.exercise.model_30
08:03:58.780581 [debug] [Thread-1  ]: Began running node model.exercise.model_60
08:03:58.780957 [info ] [Thread-1  ]: 2 of 4 START table model zz_xavier.model_60 .................................... [RUN]
08:03:58.781438 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_60"
08:03:58.781607 [debug] [Thread-1  ]: Began compiling node model.exercise.model_60
08:03:58.781765 [debug] [Thread-1  ]: Compiling model.exercise.model_60
08:03:58.783395 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_60"
08:03:58.783909 [debug] [Thread-1  ]: finished collecting timing info
08:03:58.784092 [debug] [Thread-1  ]: Began executing node model.exercise.model_60
08:03:58.788452 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:03:59.302402 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_60"
08:03:59.303168 [debug] [Thread-1  ]: On model.exercise.model_60: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_60"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_60`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where (DATE_DIFF(d1.activity_day, d2.install_day, DAY) < 60 and d1.activity_type = 'payment')
  order by d1.user_id DESC
),

spent_per_user as (
  select distinct
      elegible_users.USER_ID,
      sum(elegible_users.spent) as money,
      elegible_users.campaign
  from elegible_users
  group by 
      elegible_users.campaign, elegible_users.USER_ID

),

spent_per_user_campaign as (
  select sum(cs.dollar_spend) as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.date_act = cs.spend_day and cs.campaign = eu.campaign
  group by eu.USER_ID, eu.campaign
),

final as (
  select
  eu.USER_ID, eu.money as user_spent_money, eu.campaign, su.money as money_spent_on_campaign
  from spent_per_user as eu join spent_per_user_campaign as su on 
  eu.USER_ID = su.USER_ID
  order by eu.USER_ID asc

)

select * from final
  );
  
08:04:04.299024 [debug] [Thread-1  ]: finished collecting timing info
08:04:04.299684 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9382a92e-091a-4c3f-ad5c-80947359d69f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4002b0>]}
08:04:04.300223 [info ] [Thread-1  ]: 2 of 4 OK created table model zz_xavier.model_60 ............................... [[32mCREATE TABLE (72.5k rows, 464.1 MB processed)[0m in 5.52s]
08:04:04.300706 [debug] [Thread-1  ]: Finished running node model.exercise.model_60
08:04:04.300952 [debug] [Thread-1  ]: Began running node model.exercise.model_7
08:04:04.301462 [info ] [Thread-1  ]: 3 of 4 START table model zz_xavier.model_7 ..................................... [RUN]
08:04:04.302071 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_7"
08:04:04.302280 [debug] [Thread-1  ]: Began compiling node model.exercise.model_7
08:04:04.302553 [debug] [Thread-1  ]: Compiling model.exercise.model_7
08:04:04.304103 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_7"
08:04:04.304666 [debug] [Thread-1  ]: finished collecting timing info
08:04:04.304866 [debug] [Thread-1  ]: Began executing node model.exercise.model_7
08:04:04.306802 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:04:04.779926 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_7"
08:04:04.780691 [debug] [Thread-1  ]: On model.exercise.model_7: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_7"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_7`
  
  
  OPTIONS()
  as (
    declare days ARRAY<INT64> DEFAULT [7,30,60];

declare d_index INT64 default 0;
declare maxd_index INT64 default ARRAY_LENGTH(days);



while d_index < maxd_index do
with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where (DATE_DIFF(d1.activity_day, d2.install_day, DAY) < days[offset(d_index)]+1 and d1.activity_type = 'payment')
  order by d1.user_id DESC
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(elegible_users.spent) as money,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.money as user_spent_money, 
    sc.campaign as Campaign, 
    sc.money as money_spent_on_campaign,
    days[offset(d_index)] as days_since_install 
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final;

end while;
  );
  
08:04:05.117010 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got keyword DECLARE at [9:5]')
08:04:05.626910 [debug] [Thread-1  ]: finished collecting timing info
08:04:05.627523 [debug] [Thread-1  ]: Database Error in model model_7 (models/model_7.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got keyword DECLARE at [9:5]
  compiled SQL at target/run/exercise/models/model_7.sql
08:04:05.627936 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9382a92e-091a-4c3f-ad5c-80947359d69f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3adc70>]}
08:04:05.628448 [error] [Thread-1  ]: 3 of 4 ERROR creating table model zz_xavier.model_7 ............................ [[31mERROR[0m in 1.33s]
08:04:05.628986 [debug] [Thread-1  ]: Finished running node model.exercise.model_7
08:04:05.629241 [debug] [Thread-1  ]: Began running node model.exercise.model_test
08:04:05.629686 [info ] [Thread-1  ]: 4 of 4 START table model zz_xavier.model_test .................................. [RUN]
08:04:05.630256 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
08:04:05.630473 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
08:04:05.630654 [debug] [Thread-1  ]: Compiling model.exercise.model_test
08:04:05.632481 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
08:04:05.633065 [debug] [Thread-1  ]: finished collecting timing info
08:04:05.633273 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
08:04:05.636057 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
08:04:05.636534 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:04:05.636761 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    declare days ARRAY<INT64> DEFAULT [7,30,60];

declare d_index INT64 default 0;
declare maxd_index INT64 default ARRAY_LENGTH(days);



while d_index < maxd_index do
with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where (DATE_DIFF(d1.activity_day, d2.install_day, DAY) < days[offset(d_index)]+1 and d1.activity_type = 'payment')
  order by d1.user_id DESC
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(elegible_users.spent) as money,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.money as user_spent_money, 
    sc.campaign as Campaign, 
    sc.money as money_spent_on_campaign,
    days[offset(d_index)] as days_since_install 
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final;

end while;
  );
  
08:04:06.140487 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got keyword DECLARE at [9:5]')
08:04:07.485848 [debug] [Thread-1  ]: finished collecting timing info
08:04:07.486446 [debug] [Thread-1  ]: Database Error in model model_test (models/model_test.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got keyword DECLARE at [9:5]
  compiled SQL at target/run/exercise/models/model_test.sql
08:04:07.486843 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9382a92e-091a-4c3f-ad5c-80947359d69f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c450be0>]}
08:04:07.487352 [error] [Thread-1  ]: 4 of 4 ERROR creating table model zz_xavier.model_test ......................... [[31mERROR[0m in 1.86s]
08:04:07.487875 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
08:04:07.489232 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:04:07.489711 [info ] [MainThread]: 
08:04:07.490200 [info ] [MainThread]: Finished running 4 table models in 16.89s.
08:04:07.490525 [debug] [MainThread]: Connection 'master' was properly closed.
08:04:07.490704 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
08:04:07.497224 [info ] [MainThread]: 
08:04:07.497540 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
08:04:07.497849 [info ] [MainThread]: 
08:04:07.498109 [error] [MainThread]: [33mDatabase Error in model model_7 (models/model_7.sql)[0m
08:04:07.498372 [error] [MainThread]:   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got keyword DECLARE at [9:5]
08:04:07.498599 [error] [MainThread]:   compiled SQL at target/run/exercise/models/model_7.sql
08:04:07.498830 [info ] [MainThread]: 
08:04:07.499141 [error] [MainThread]: [33mDatabase Error in model model_test (models/model_test.sql)[0m
08:04:07.499375 [error] [MainThread]:   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got keyword DECLARE at [9:5]
08:04:07.499608 [error] [MainThread]:   compiled SQL at target/run/exercise/models/model_test.sql
08:04:07.499836 [info ] [MainThread]: 
08:04:07.500063 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=2 SKIP=0 TOTAL=4
08:04:07.500408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c2b8ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c2927c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c442fd0>]}


============================== 2022-09-23 08:56:53.830469 | 601e3a5c-d284-4be8-bebb-18af5b7eeb7c ==============================
08:56:53.830488 [info ] [MainThread]: Running with dbt=1.1.2
08:56:53.831043 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
08:56:53.831264 [debug] [MainThread]: Tracking: tracking
08:56:53.842976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9dc070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9dc490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9dc640>]}
08:56:53.874220 [debug] [MainThread]: Partial parsing enabled: 3 files deleted, 0 files added, 1 files changed.
08:56:53.874443 [debug] [MainThread]: Partial parsing: deleted file: exercise://models/model_60.sql
08:56:53.874570 [debug] [MainThread]: Partial parsing: deleted file: exercise://models/model_30.sql
08:56:53.874670 [debug] [MainThread]: Partial parsing: deleted file: exercise://models/model_7.sql
08:56:53.874958 [debug] [MainThread]: Partial parsing: updated file: exercise://models/model_test.sql
08:56:53.884651 [debug] [MainThread]: 1699: static parser successfully parsed model_test.sql
08:56:53.899816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '601e3a5c-d284-4be8-bebb-18af5b7eeb7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb420d0>]}
08:56:53.903682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '601e3a5c-d284-4be8-bebb-18af5b7eeb7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cad7eb0>]}
08:56:53.903926 [info ] [MainThread]: Found 1 model, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
08:56:53.904147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '601e3a5c-d284-4be8-bebb-18af5b7eeb7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cad7dc0>]}
08:56:53.905140 [info ] [MainThread]: 
08:56:53.905477 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:56:53.906032 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
08:56:53.906391 [debug] [ThreadPool]: Opening a new connection, currently in state init
08:56:55.139417 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
08:56:55.139969 [debug] [ThreadPool]: Opening a new connection, currently in state closed
08:56:55.753875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '601e3a5c-d284-4be8-bebb-18af5b7eeb7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9dd340>]}
08:56:55.754632 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
08:56:55.755046 [info ] [MainThread]: 
08:56:55.759400 [debug] [Thread-1  ]: Began running node model.exercise.model_test
08:56:55.759770 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.model_test .................................. [RUN]
08:56:55.760318 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
08:56:55.760513 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
08:56:55.760731 [debug] [Thread-1  ]: Compiling model.exercise.model_test
08:56:55.762837 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
08:56:55.763357 [debug] [Thread-1  ]: finished collecting timing info
08:56:55.763558 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
08:56:55.801880 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
08:56:55.802506 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:56:55.802741 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

)

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
    days[offset(d_index)] as days_since_install 
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final;
  );
  
08:56:56.341750 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or "," or keyword SELECT but got identifier "spent_per_user_campaign" at [34:1]')
08:56:56.832358 [debug] [Thread-1  ]: finished collecting timing info
08:56:56.832982 [debug] [Thread-1  ]: Database Error in model model_test (models/model_test.sql)
  Syntax error: Expected "(" or "," or keyword SELECT but got identifier "spent_per_user_campaign" at [34:1]
  compiled SQL at target/run/exercise/models/model_test.sql
08:56:56.833453 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '601e3a5c-d284-4be8-bebb-18af5b7eeb7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cc3faf0>]}
08:56:56.834017 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.model_test ......................... [[31mERROR[0m in 1.07s]
08:56:56.834554 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
08:56:56.835861 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:56:56.836357 [info ] [MainThread]: 
08:56:56.836709 [info ] [MainThread]: Finished running 1 table model in 2.93s.
08:56:56.837011 [debug] [MainThread]: Connection 'master' was properly closed.
08:56:56.837179 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
08:56:56.843147 [info ] [MainThread]: 
08:56:56.843464 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
08:56:56.843756 [info ] [MainThread]: 
08:56:56.844003 [error] [MainThread]: [33mDatabase Error in model model_test (models/model_test.sql)[0m
08:56:56.844237 [error] [MainThread]:   Syntax error: Expected "(" or "," or keyword SELECT but got identifier "spent_per_user_campaign" at [34:1]
08:56:56.844459 [error] [MainThread]:   compiled SQL at target/run/exercise/models/model_test.sql
08:56:56.844688 [info ] [MainThread]: 
08:56:56.844921 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
08:56:56.845270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb20f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca2ba00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cadda90>]}


============================== 2022-09-23 08:57:14.498749 | 7fc2cd28-2b9f-4f29-b75b-216a0e2453b1 ==============================
08:57:14.498771 [info ] [MainThread]: Running with dbt=1.1.2
08:57:14.499377 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
08:57:14.499523 [debug] [MainThread]: Tracking: tracking
08:57:14.511794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ee42ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ee2edc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ee2e0d0>]}
08:57:14.544143 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
08:57:14.544567 [debug] [MainThread]: Partial parsing: updated file: exercise://models/model_test.sql
08:57:14.554929 [debug] [MainThread]: 1699: static parser successfully parsed model_test.sql
08:57:14.570434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7fc2cd28-2b9f-4f29-b75b-216a0e2453b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ef930d0>]}
08:57:14.574188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7fc2cd28-2b9f-4f29-b75b-216a0e2453b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ef2ad30>]}
08:57:14.574453 [info ] [MainThread]: Found 1 model, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
08:57:14.574850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7fc2cd28-2b9f-4f29-b75b-216a0e2453b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ef2adc0>]}
08:57:14.575826 [info ] [MainThread]: 
08:57:14.576162 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:57:14.576715 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
08:57:14.576928 [debug] [ThreadPool]: Opening a new connection, currently in state init
08:57:15.825087 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
08:57:15.825645 [debug] [ThreadPool]: Opening a new connection, currently in state closed
08:57:16.338077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7fc2cd28-2b9f-4f29-b75b-216a0e2453b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ee12580>]}
08:57:16.338862 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
08:57:16.339251 [info ] [MainThread]: 
08:57:16.343491 [debug] [Thread-1  ]: Began running node model.exercise.model_test
08:57:16.343838 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.model_test .................................. [RUN]
08:57:16.344365 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
08:57:16.344557 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
08:57:16.344770 [debug] [Thread-1  ]: Compiling model.exercise.model_test
08:57:16.346776 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
08:57:16.347280 [debug] [Thread-1  ]: finished collecting timing info
08:57:16.347475 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
08:57:16.385883 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
08:57:16.386420 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:57:16.386638 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
    days[offset(d_index)] as days_since_install 
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final;
  );
  
08:57:16.848563 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got ";" at [56:20]')
08:57:18.186427 [debug] [Thread-1  ]: finished collecting timing info
08:57:18.187043 [debug] [Thread-1  ]: Database Error in model model_test (models/model_test.sql)
  Syntax error: Expected ")" but got ";" at [56:20]
  compiled SQL at target/run/exercise/models/model_test.sql
08:57:18.187497 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7fc2cd28-2b9f-4f29-b75b-216a0e2453b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f085220>]}
08:57:18.188041 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.model_test ......................... [[31mERROR[0m in 1.84s]
08:57:18.188605 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
08:57:18.189974 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:57:18.190416 [info ] [MainThread]: 
08:57:18.190912 [info ] [MainThread]: Finished running 1 table model in 3.61s.
08:57:18.191223 [debug] [MainThread]: Connection 'master' was properly closed.
08:57:18.191404 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
08:57:18.197366 [info ] [MainThread]: 
08:57:18.197663 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
08:57:18.197962 [info ] [MainThread]: 
08:57:18.198216 [error] [MainThread]: [33mDatabase Error in model model_test (models/model_test.sql)[0m
08:57:18.198460 [error] [MainThread]:   Syntax error: Expected ")" but got ";" at [56:20]
08:57:18.198691 [error] [MainThread]:   compiled SQL at target/run/exercise/models/model_test.sql
08:57:18.198929 [info ] [MainThread]: 
08:57:18.199170 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
08:57:18.199546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ef5d6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ef93850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ef2a760>]}


============================== 2022-09-23 08:58:19.503045 | bc88f66b-d0f4-44d9-acca-a3cdb5a346ae ==============================
08:58:19.503064 [info ] [MainThread]: Running with dbt=1.1.2
08:58:19.503826 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
08:58:19.504065 [debug] [MainThread]: Tracking: tracking
08:58:19.516050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f2dfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f2dfa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f2dd90>]}
08:58:19.547346 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
08:58:19.547705 [debug] [MainThread]: Partial parsing: updated file: exercise://models/model_test.sql
08:58:19.557779 [debug] [MainThread]: 1699: static parser successfully parsed model_test.sql
08:58:19.572564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bc88f66b-d0f4-44d9-acca-a3cdb5a346ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a07c0d0>]}
08:58:19.576242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bc88f66b-d0f4-44d9-acca-a3cdb5a346ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a014fd0>]}
08:58:19.576454 [info ] [MainThread]: Found 1 model, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
08:58:19.576709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc88f66b-d0f4-44d9-acca-a3cdb5a346ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a014b80>]}
08:58:19.577684 [info ] [MainThread]: 
08:58:19.578008 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:58:19.578529 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
08:58:19.578734 [debug] [ThreadPool]: Opening a new connection, currently in state init
08:58:21.157049 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
08:58:21.157706 [debug] [ThreadPool]: Opening a new connection, currently in state closed
08:58:21.670027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc88f66b-d0f4-44d9-acca-a3cdb5a346ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f1d100>]}
08:58:21.670936 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
08:58:21.671324 [info ] [MainThread]: 
08:58:21.676030 [debug] [Thread-1  ]: Began running node model.exercise.model_test
08:58:21.676410 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.model_test .................................. [RUN]
08:58:21.676996 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
08:58:21.677191 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
08:58:21.677403 [debug] [Thread-1  ]: Compiling model.exercise.model_test
08:58:21.679471 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
08:58:21.680006 [debug] [Thread-1  ]: finished collecting timing info
08:58:21.680208 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
08:58:21.718386 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
08:58:21.718980 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:58:21.719214 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
08:58:26.941806 [debug] [Thread-1  ]: finished collecting timing info
08:58:26.942322 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc88f66b-d0f4-44d9-acca-a3cdb5a346ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a062f70>]}
08:58:26.942705 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 5.27s]
08:58:26.943149 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
08:58:26.944251 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:58:26.944612 [info ] [MainThread]: 
08:58:26.945025 [info ] [MainThread]: Finished running 1 table model in 7.37s.
08:58:26.945294 [debug] [MainThread]: Connection 'master' was properly closed.
08:58:26.945441 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
08:58:26.951600 [info ] [MainThread]: 
08:58:26.951929 [info ] [MainThread]: [32mCompleted successfully[0m
08:58:26.952236 [info ] [MainThread]: 
08:58:26.952485 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
08:58:26.952851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fc9880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fc9430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a014b80>]}


============================== 2022-09-27 11:12:48.248586 | 597a61a9-e225-4ed9-a390-b9a0db848790 ==============================
11:12:48.248612 [info ] [MainThread]: Running with dbt=1.1.2
11:12:48.249752 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:12:48.250046 [debug] [MainThread]: Tracking: tracking
11:12:48.267063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c569a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c566d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c564f0>]}
11:12:48.316139 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
11:12:48.316459 [debug] [MainThread]: Partial parsing: added file: exercise://models/ex_2.sql
11:12:48.327921 [debug] [MainThread]: 1699: static parser successfully parsed ex_2.sql
11:12:48.347582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '597a61a9-e225-4ed9-a390-b9a0db848790', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110da40d0>]}
11:12:48.352832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '597a61a9-e225-4ed9-a390-b9a0db848790', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110cf9e20>]}
11:12:48.353144 [info ] [MainThread]: Found 2 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:12:48.353421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '597a61a9-e225-4ed9-a390-b9a0db848790', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c2c340>]}
11:12:48.354795 [info ] [MainThread]: 
11:12:48.355265 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:12:48.356048 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:12:48.356314 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:12:50.269106 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:12:50.269680 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:12:50.707627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '597a61a9-e225-4ed9-a390-b9a0db848790', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c83e50>]}
11:12:50.708384 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:12:50.708774 [info ] [MainThread]: 
11:12:50.715035 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
11:12:50.715426 [info ] [Thread-1  ]: 1 of 2 START table model zz_xavier.ex_2 ........................................ [RUN]
11:12:50.715955 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
11:12:50.716137 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
11:12:50.716342 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
11:12:50.718237 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
11:12:50.718723 [debug] [Thread-1  ]: finished collecting timing info
11:12:50.718931 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
11:12:50.758105 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
11:12:50.758697 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:12:50.758921 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        ua.activity_type,
        ui.campaign,
        MAX(ua.activity_day) over (partition by ua.user_id) as last_day_played
    from dwh-adev-core.ae_challenge_data.ae_user_activity as ua
        join dwh-adev-core.ae_challenge_data.ae_user_info ui
        on ua.user_id = ui.user_id 
    where ua.activity_type = 'app_open'
  ),

last_played_days as (
  select 
  u2.user_id,
  u2.last_day_played,
  u2.campaign,
  count(*) as days
  from users u2 where DATE_DIFF(u2.last_day_played, u2.activity_day, DAY) <= 6
  group by u2.user_id, u2.last_day_played, u2.campaign
)

select u.user_id, u.last_day_played, u.campaing from last_played_days u where u.days = 7
  );
  
11:12:52.120954 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Name campaing not found inside u at [32:40]')
11:12:53.667684 [debug] [Thread-1  ]: finished collecting timing info
11:12:53.668206 [debug] [Thread-1  ]: Database Error in model ex_2 (models/ex_2.sql)
  Name campaing not found inside u at [32:40]
  compiled SQL at target/run/exercise/models/ex_2.sql
11:12:53.668586 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '597a61a9-e225-4ed9-a390-b9a0db848790', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ea1250>]}
11:12:53.669048 [error] [Thread-1  ]: 1 of 2 ERROR creating table model zz_xavier.ex_2 ............................... [[31mERROR[0m in 2.95s]
11:12:53.669696 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
11:12:53.670026 [debug] [Thread-1  ]: Began running node model.exercise.model_test
11:12:53.670480 [info ] [Thread-1  ]: 2 of 2 START table model zz_xavier.model_test .................................. [RUN]
11:12:53.670970 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
11:12:53.671228 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
11:12:53.671424 [debug] [Thread-1  ]: Compiling model.exercise.model_test
11:12:53.672996 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
11:12:53.673511 [debug] [Thread-1  ]: finished collecting timing info
11:12:53.673701 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
11:12:53.675336 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:12:54.142066 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
11:12:54.142726 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
11:12:59.239597 [debug] [Thread-1  ]: finished collecting timing info
11:12:59.240049 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '597a61a9-e225-4ed9-a390-b9a0db848790', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d3cd90>]}
11:12:59.240418 [info ] [Thread-1  ]: 2 of 2 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 5.57s]
11:12:59.240828 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
11:12:59.241924 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:12:59.242317 [info ] [MainThread]: 
11:12:59.242719 [info ] [MainThread]: Finished running 2 table models in 10.89s.
11:12:59.243040 [debug] [MainThread]: Connection 'master' was properly closed.
11:12:59.243225 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
11:12:59.250669 [info ] [MainThread]: 
11:12:59.250979 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
11:12:59.251257 [info ] [MainThread]: 
11:12:59.251498 [error] [MainThread]: [33mDatabase Error in model ex_2 (models/ex_2.sql)[0m
11:12:59.251729 [error] [MainThread]:   Name campaing not found inside u at [32:40]
11:12:59.251943 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ex_2.sql
11:12:59.252172 [info ] [MainThread]: 
11:12:59.252412 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
11:12:59.252923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d96220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d82d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d6f760>]}


============================== 2022-09-27 11:14:08.515465 | 2f8ecad1-c50f-4dec-ba43-d4ab6c50248f ==============================
11:14:08.515488 [info ] [MainThread]: Running with dbt=1.1.2
11:14:08.516085 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:14:08.516235 [debug] [MainThread]: Tracking: tracking
11:14:08.528006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104cf3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11115db20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11115d2e0>]}
11:14:08.563971 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:14:08.564388 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ex_2.sql
11:14:08.575304 [debug] [MainThread]: 1699: static parser successfully parsed ex_2.sql
11:14:08.591989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2f8ecad1-c50f-4dec-ba43-d4ab6c50248f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112bf0d0>]}
11:14:08.596306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2f8ecad1-c50f-4dec-ba43-d4ab6c50248f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111262f40>]}
11:14:08.596590 [info ] [MainThread]: Found 2 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:14:08.596882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2f8ecad1-c50f-4dec-ba43-d4ab6c50248f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104cf3d0>]}
11:14:08.598009 [info ] [MainThread]: 
11:14:08.598391 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:14:08.599028 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:14:08.599249 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:14:10.042148 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:14:10.042645 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:14:10.449144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2f8ecad1-c50f-4dec-ba43-d4ab6c50248f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111257a30>]}
11:14:10.449873 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:14:10.450290 [info ] [MainThread]: 
11:14:10.454398 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
11:14:10.454761 [info ] [Thread-1  ]: 1 of 2 START table model zz_xavier.ex_2 ........................................ [RUN]
11:14:10.455313 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
11:14:10.455503 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
11:14:10.455707 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
11:14:10.457642 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
11:14:10.458118 [debug] [Thread-1  ]: finished collecting timing info
11:14:10.458310 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
11:14:10.497266 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
11:14:10.497836 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:14:10.498069 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        ua.activity_type,
        ui.campaign,
        MAX(ua.activity_day) over (partition by ua.user_id) as last_day_played
    from dwh-adev-core.ae_challenge_data.ae_user_activity as ua
        join dwh-adev-core.ae_challenge_data.ae_user_info ui
        on ua.user_id = ui.user_id 
    where ua.activity_type = 'app_open'
  ),

last_played_days as (
  select 
  u2.user_id,
  u2.last_day_played,
  u2.campaign,
  count(*) as days
  from users u2 where DATE_DIFF(u2.last_day_played, u2.activity_day, DAY) <= 6
  group by u2.user_id, u2.last_day_played, u2.campaign
)

select u.user_id, u.last_day_played, u.campaign from last_played_days u where u.days = 7
  );
  
11:14:21.112835 [debug] [Thread-1  ]: finished collecting timing info
11:14:21.113389 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f8ecad1-c50f-4dec-ba43-d4ab6c50248f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111373130>]}
11:14:21.113801 [info ] [Thread-1  ]: 1 of 2 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (68.4k rows, 294.2 MB processed)[0m in 10.66s]
11:14:21.114270 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
11:14:21.114594 [debug] [Thread-1  ]: Began running node model.exercise.model_test
11:14:21.115165 [info ] [Thread-1  ]: 2 of 2 START table model zz_xavier.model_test .................................. [RUN]
11:14:21.115656 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
11:14:21.115835 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
11:14:21.116105 [debug] [Thread-1  ]: Compiling model.exercise.model_test
11:14:21.117722 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
11:14:21.118260 [debug] [Thread-1  ]: finished collecting timing info
11:14:21.118451 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
11:14:21.120202 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:14:21.715919 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
11:14:21.716604 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
11:14:28.062999 [debug] [Thread-1  ]: finished collecting timing info
11:14:28.063664 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f8ecad1-c50f-4dec-ba43-d4ab6c50248f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112841f0>]}
11:14:28.064137 [info ] [Thread-1  ]: 2 of 2 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 6.95s]
11:14:28.064694 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
11:14:28.066323 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:14:28.066914 [info ] [MainThread]: 
11:14:28.067307 [info ] [MainThread]: Finished running 2 table models in 19.47s.
11:14:28.067641 [debug] [MainThread]: Connection 'master' was properly closed.
11:14:28.067821 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
11:14:28.080893 [info ] [MainThread]: 
11:14:28.081233 [info ] [MainThread]: [32mCompleted successfully[0m
11:14:28.081536 [info ] [MainThread]: 
11:14:28.081785 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
11:14:28.082162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113aee20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113aeca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113ae4f0>]}


============================== 2022-09-27 11:19:09.298911 | 094028a0-6af3-4b61-afe5-693180b57dff ==============================
11:19:09.298948 [info ] [MainThread]: Running with dbt=1.1.2
11:19:09.299541 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:19:09.299720 [debug] [MainThread]: Tracking: tracking
11:19:09.312550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113454130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11481cdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11481c130>]}
11:19:09.349331 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 3 files added, 0 files changed.
11:19:09.349667 [debug] [MainThread]: Partial parsing: added file: exercise://models/copy_user_activity.sql
11:19:09.349862 [debug] [MainThread]: Partial parsing: added file: exercise://models/copy_user_information.sql
11:19:09.350029 [debug] [MainThread]: Partial parsing: added file: exercise://models/copy_user_campaign_spend.sql
11:19:09.360721 [debug] [MainThread]: 1699: static parser successfully parsed copy_user_activity.sql
11:19:09.371329 [debug] [MainThread]: 1699: static parser successfully parsed copy_user_information.sql
11:19:09.373623 [debug] [MainThread]: 1699: static parser successfully parsed copy_user_campaign_spend.sql
11:19:09.382062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '094028a0-6af3-4b61-afe5-693180b57dff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11498af40>]}
11:19:09.386306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '094028a0-6af3-4b61-afe5-693180b57dff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114926dc0>]}
11:19:09.386549 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:19:09.386772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '094028a0-6af3-4b61-afe5-693180b57dff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113454130>]}
11:19:09.387983 [info ] [MainThread]: 
11:19:09.388438 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:19:09.389235 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:19:09.389460 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:19:10.692932 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:19:10.693455 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:19:11.178749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '094028a0-6af3-4b61-afe5-693180b57dff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11481cbb0>]}
11:19:11.179531 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:19:11.179924 [info ] [MainThread]: 
11:19:11.184010 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_activity
11:19:11.184390 [info ] [Thread-1  ]: 1 of 5 START table model zz_xavier.copy_user_activity .......................... [RUN]
11:19:11.184932 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_activity"
11:19:11.185136 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_activity
11:19:11.185343 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_activity
11:19:11.187419 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_activity"
11:19:11.187923 [debug] [Thread-1  ]: finished collecting timing info
11:19:11.188126 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_activity
11:19:11.227349 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_activity"
11:19:11.227912 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:19:11.228164 [debug] [Thread-1  ]: On model.exercise.copy_user_activity: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_activity"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_activity`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_activity
  );
  
11:19:20.498154 [debug] [Thread-1  ]: finished collecting timing info
11:19:20.498662 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '094028a0-6af3-4b61-afe5-693180b57dff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a8edc0>]}
11:19:20.499044 [info ] [Thread-1  ]: 1 of 5 OK created table model zz_xavier.copy_user_activity ..................... [[32mCREATE TABLE (10.8m rows, 444.5 MB processed)[0m in 9.31s]
11:19:20.499479 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_activity
11:19:20.499694 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_campaign_spend
11:19:20.500108 [info ] [Thread-1  ]: 2 of 5 START table model zz_xavier.copy_user_campaign_spend .................... [RUN]
11:19:20.500590 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_campaign_spend"
11:19:20.500764 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_campaign_spend
11:19:20.501068 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_campaign_spend
11:19:20.503316 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_campaign_spend"
11:19:20.503897 [debug] [Thread-1  ]: finished collecting timing info
11:19:20.504148 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_campaign_spend
11:19:20.510218 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_campaign_spend"
11:19:20.510711 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:19:20.510922 [debug] [Thread-1  ]: On model.exercise.copy_user_campaign_spend: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_campaign_spend"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_campaign_spend`
  
  
  OPTIONS()
  as (
    select * from ae_challenge_data.ae_campaign_spend
  );
  
11:19:21.110101 [debug] [Thread-1  ]: BigQuery adapter: Unhandled error while running:
/* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_campaign_spend"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_campaign_spend`
  
  
  OPTIONS()
  as (
    select * from ae_challenge_data.ae_campaign_spend
  );
  
11:19:21.110362 [debug] [Thread-1  ]: BigQuery adapter: 404 Not found: Dataset dwh-adev-observe:ae_challenge_data was not found in location US

Location: US
Job ID: 53783fe6-7b08-404d-8d94-5f60a688dad9

11:19:21.110652 [debug] [Thread-1  ]: finished collecting timing info
11:19:21.111023 [debug] [Thread-1  ]: Runtime Error in model copy_user_campaign_spend (models/copy_user_campaign_spend.sql)
  404 Not found: Dataset dwh-adev-observe:ae_challenge_data was not found in location US
  
  Location: US
  Job ID: 53783fe6-7b08-404d-8d94-5f60a688dad9
  
11:19:21.111301 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '094028a0-6af3-4b61-afe5-693180b57dff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114ab0040>]}
11:19:21.111679 [error] [Thread-1  ]: 2 of 5 ERROR creating table model zz_xavier.copy_user_campaign_spend ........... [[31mERROR[0m in 0.61s]
11:19:21.112126 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_campaign_spend
11:19:21.112338 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_information
11:19:21.112680 [info ] [Thread-1  ]: 3 of 5 START table model zz_xavier.copy_user_information ....................... [RUN]
11:19:21.113135 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_information"
11:19:21.113305 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_information
11:19:21.113472 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_information
11:19:21.116950 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_information"
11:19:21.117419 [debug] [Thread-1  ]: finished collecting timing info
11:19:21.117602 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_information
11:19:21.120046 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_information"
11:19:21.120507 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:19:21.120722 [debug] [Thread-1  ]: On model.exercise.copy_user_information: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_information"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_information`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_info
  );
  
11:19:25.689723 [debug] [Thread-1  ]: finished collecting timing info
11:19:25.690354 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '094028a0-6af3-4b61-afe5-693180b57dff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1149487f0>]}
11:19:25.690792 [info ] [Thread-1  ]: 3 of 5 OK created table model zz_xavier.copy_user_information .................. [[32mCREATE TABLE (697.0k rows, 19.6 MB processed)[0m in 4.58s]
11:19:25.691274 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_information
11:19:25.691647 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
11:19:25.692066 [info ] [Thread-1  ]: 4 of 5 START table model zz_xavier.ex_2 ........................................ [RUN]
11:19:25.692762 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
11:19:25.692952 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
11:19:25.693270 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
11:19:25.694682 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
11:19:25.695170 [debug] [Thread-1  ]: finished collecting timing info
11:19:25.695357 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
11:19:25.697129 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:19:26.212006 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
11:19:26.212680 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        ua.activity_type,
        ui.campaign,
        MAX(ua.activity_day) over (partition by ua.user_id) as last_day_played
    from dwh-adev-core.ae_challenge_data.ae_user_activity as ua
        join dwh-adev-core.ae_challenge_data.ae_user_info ui
        on ua.user_id = ui.user_id 
    where ua.activity_type = 'app_open'
  ),

last_played_days as (
  select 
  u2.user_id,
  u2.last_day_played,
  u2.campaign,
  count(*) as days
  from users u2 where DATE_DIFF(u2.last_day_played, u2.activity_day, DAY) <= 6
  group by u2.user_id, u2.last_day_played, u2.campaign
)

select u.user_id, u.last_day_played, u.campaign from last_played_days u where u.days = 7
  );
  
11:19:35.547994 [debug] [Thread-1  ]: finished collecting timing info
11:19:35.548549 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '094028a0-6af3-4b61-afe5-693180b57dff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114ab6670>]}
11:19:35.548980 [info ] [Thread-1  ]: 4 of 5 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (68.4k rows, 294.2 MB processed)[0m in 9.86s]
11:19:35.549465 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
11:19:35.549755 [debug] [Thread-1  ]: Began running node model.exercise.model_test
11:19:35.550247 [info ] [Thread-1  ]: 5 of 5 START table model zz_xavier.model_test .................................. [RUN]
11:19:35.550789 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
11:19:35.551032 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
11:19:35.551212 [debug] [Thread-1  ]: Compiling model.exercise.model_test
11:19:35.552825 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
11:19:35.553334 [debug] [Thread-1  ]: finished collecting timing info
11:19:35.553552 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
11:19:35.555347 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:19:35.936634 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
11:19:35.937381 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
11:19:40.990441 [debug] [Thread-1  ]: finished collecting timing info
11:19:40.990932 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '094028a0-6af3-4b61-afe5-693180b57dff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114ad4e50>]}
11:19:40.991285 [info ] [Thread-1  ]: 5 of 5 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 5.44s]
11:19:40.991834 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
11:19:40.993107 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:19:40.993573 [info ] [MainThread]: 
11:19:40.993854 [info ] [MainThread]: Finished running 5 table models in 31.61s.
11:19:40.994102 [debug] [MainThread]: Connection 'master' was properly closed.
11:19:40.994240 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
11:19:40.999766 [info ] [MainThread]: 
11:19:41.000053 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
11:19:41.000334 [info ] [MainThread]: 
11:19:41.000589 [error] [MainThread]: [33mRuntime Error in model copy_user_campaign_spend (models/copy_user_campaign_spend.sql)[0m
11:19:41.000830 [error] [MainThread]:   404 Not found: Dataset dwh-adev-observe:ae_challenge_data was not found in location US
11:19:41.001056 [error] [MainThread]:   
11:19:41.001273 [error] [MainThread]:   Location: US
11:19:41.001584 [error] [MainThread]:   Job ID: 53783fe6-7b08-404d-8d94-5f60a688dad9
11:19:41.001929 [error] [MainThread]:   
11:19:41.002197 [info ] [MainThread]: 
11:19:41.002439 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
11:19:41.002826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114926a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114926880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114bacb80>]}


============================== 2022-09-27 11:21:21.478770 | d354dbda-ef55-481d-8ef1-6d31f77f05ca ==============================
11:21:21.478793 [info ] [MainThread]: Running with dbt=1.1.2
11:21:21.479407 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['copy_user_campaign_spend.sql'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:21:21.480097 [debug] [MainThread]: Tracking: tracking
11:21:21.492076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8a4b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8a43a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8a4ee0>]}
11:21:21.528765 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
11:21:21.528971 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
11:21:21.534171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd354dbda-ef55-481d-8ef1-6d31f77f05ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9ca0d0>]}
11:21:21.539600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd354dbda-ef55-481d-8ef1-6d31f77f05ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d94da00>]}
11:21:21.539925 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:21:21.540263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd354dbda-ef55-481d-8ef1-6d31f77f05ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5324c0>]}
11:21:21.540761 [warn ] [MainThread]: The selection criterion 'copy_user_campaign_spend.sql' does not match any nodes
11:21:21.541691 [info ] [MainThread]: 
11:21:21.541940 [warn ] [MainThread]: [[33mWARNING[0m]: Nothing to do. Try checking your model configs and model specification args
11:21:21.546455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d94d5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d94d730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d94d910>]}


============================== 2022-09-27 11:22:13.818266 | e0051af8-9ad6-4a1c-aaf7-06b27138bb25 ==============================
11:22:13.818290 [info ] [MainThread]: Running with dbt=1.1.2
11:22:13.819139 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['copy_user_campaign_spend.sql'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:22:13.819576 [debug] [MainThread]: Tracking: tracking
11:22:13.831808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c73460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108014400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108014190>]}
11:22:13.868484 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
11:22:13.868701 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
11:22:13.873995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e0051af8-9ad6-4a1c-aaf7-06b27138bb25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081460d0>]}
11:22:13.879169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e0051af8-9ad6-4a1c-aaf7-06b27138bb25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080c5820>]}
11:22:13.879466 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:22:13.879733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0051af8-9ad6-4a1c-aaf7-06b27138bb25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080c5a90>]}
11:22:13.880217 [warn ] [MainThread]: The selection criterion 'copy_user_campaign_spend.sql' does not match any nodes
11:22:13.881150 [info ] [MainThread]: 
11:22:13.881405 [warn ] [MainThread]: [[33mWARNING[0m]: Nothing to do. Try checking your model configs and model specification args
11:22:13.885649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080c5520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080c56a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080c5640>]}


============================== 2022-09-27 11:22:23.564758 | 299d2321-a35d-48bb-af61-58742042fc72 ==============================
11:22:23.564793 [info ] [MainThread]: Running with dbt=1.1.2
11:22:23.565397 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:22:23.565543 [debug] [MainThread]: Tracking: tracking
11:22:23.575699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd23640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd23520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd23be0>]}
11:22:23.612499 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
11:22:23.612695 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
11:22:23.617515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '299d2321-a35d-48bb-af61-58742042fc72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be540d0>]}
11:22:23.622407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '299d2321-a35d-48bb-af61-58742042fc72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bde1a30>]}
11:22:23.622697 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:22:23.622942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '299d2321-a35d-48bb-af61-58742042fc72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bde1ca0>]}
11:22:23.624230 [info ] [MainThread]: 
11:22:23.624614 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:22:23.625455 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:22:23.625684 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:22:24.964326 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:22:24.964815 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:22:25.324130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '299d2321-a35d-48bb-af61-58742042fc72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd24430>]}
11:22:25.324888 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:22:25.325301 [info ] [MainThread]: 
11:22:25.331406 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_activity
11:22:25.331778 [info ] [Thread-1  ]: 1 of 5 START table model zz_xavier.copy_user_activity .......................... [RUN]
11:22:25.332304 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_activity"
11:22:25.332490 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_activity
11:22:25.332711 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_activity
11:22:25.335757 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_activity"
11:22:25.336321 [debug] [Thread-1  ]: finished collecting timing info
11:22:25.336550 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_activity
11:22:25.353965 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:22:25.678578 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_activity"
11:22:25.679150 [debug] [Thread-1  ]: On model.exercise.copy_user_activity: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_activity"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_activity`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_activity
  );
  
11:22:35.167376 [debug] [Thread-1  ]: finished collecting timing info
11:22:35.167886 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '299d2321-a35d-48bb-af61-58742042fc72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf1d070>]}
11:22:35.168297 [info ] [Thread-1  ]: 1 of 5 OK created table model zz_xavier.copy_user_activity ..................... [[32mCREATE TABLE (10.8m rows, 444.5 MB processed)[0m in 9.84s]
11:22:35.168749 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_activity
11:22:35.168969 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_campaign_spend
11:22:35.169572 [info ] [Thread-1  ]: 2 of 5 START table model zz_xavier.copy_user_campaign_spend .................... [RUN]
11:22:35.170115 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_campaign_spend"
11:22:35.170395 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_campaign_spend
11:22:35.170592 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_campaign_spend
11:22:35.172322 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_campaign_spend"
11:22:35.172849 [debug] [Thread-1  ]: finished collecting timing info
11:22:35.173043 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_campaign_spend
11:22:35.175518 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_campaign_spend"
11:22:35.175975 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:22:35.176205 [debug] [Thread-1  ]: On model.exercise.copy_user_campaign_spend: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_campaign_spend"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_campaign_spend`
  
  
  OPTIONS()
  as (
    select * from ae_challenge_data.ae_campaign_spend
  );
  
11:22:35.722188 [debug] [Thread-1  ]: BigQuery adapter: Unhandled error while running:
/* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_campaign_spend"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_campaign_spend`
  
  
  OPTIONS()
  as (
    select * from ae_challenge_data.ae_campaign_spend
  );
  
11:22:35.722532 [debug] [Thread-1  ]: BigQuery adapter: 404 Not found: Dataset dwh-adev-observe:ae_challenge_data was not found in location US

Location: US
Job ID: a02262f2-96ee-4651-9430-9034d628131a

11:22:35.722884 [debug] [Thread-1  ]: finished collecting timing info
11:22:35.723481 [debug] [Thread-1  ]: Runtime Error in model copy_user_campaign_spend (models/copy_user_campaign_spend.sql)
  404 Not found: Dataset dwh-adev-observe:ae_challenge_data was not found in location US
  
  Location: US
  Job ID: a02262f2-96ee-4651-9430-9034d628131a
  
11:22:35.723816 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '299d2321-a35d-48bb-af61-58742042fc72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf9a310>]}
11:22:35.724245 [error] [Thread-1  ]: 2 of 5 ERROR creating table model zz_xavier.copy_user_campaign_spend ........... [[31mERROR[0m in 0.55s]
11:22:35.724723 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_campaign_spend
11:22:35.724969 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_information
11:22:35.725407 [info ] [Thread-1  ]: 3 of 5 START table model zz_xavier.copy_user_information ....................... [RUN]
11:22:35.725954 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_information"
11:22:35.726128 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_information
11:22:35.726295 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_information
11:22:35.727625 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_information"
11:22:35.728094 [debug] [Thread-1  ]: finished collecting timing info
11:22:35.728290 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_information
11:22:35.729973 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:22:36.289554 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_information"
11:22:36.290229 [debug] [Thread-1  ]: On model.exercise.copy_user_information: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_information"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_information`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_info
  );
  
11:22:40.520632 [debug] [Thread-1  ]: finished collecting timing info
11:22:40.521224 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '299d2321-a35d-48bb-af61-58742042fc72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf01820>]}
11:22:40.521682 [info ] [Thread-1  ]: 3 of 5 OK created table model zz_xavier.copy_user_information .................. [[32mCREATE TABLE (697.0k rows, 19.6 MB processed)[0m in 4.80s]
11:22:40.522286 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_information
11:22:40.522646 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
11:22:40.523130 [info ] [Thread-1  ]: 4 of 5 START table model zz_xavier.ex_2 ........................................ [RUN]
11:22:40.523599 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
11:22:40.523808 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
11:22:40.524060 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
11:22:40.525639 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
11:22:40.526123 [debug] [Thread-1  ]: finished collecting timing info
11:22:40.526308 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
11:22:40.527917 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:22:40.911267 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
11:22:40.911984 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        ua.activity_type,
        ui.campaign,
        MAX(ua.activity_day) over (partition by ua.user_id) as last_day_played
    from dwh-adev-core.ae_challenge_data.ae_user_activity as ua
        join dwh-adev-core.ae_challenge_data.ae_user_info ui
        on ua.user_id = ui.user_id 
    where ua.activity_type = 'app_open'
  ),

last_played_days as (
  select 
  u2.user_id,
  u2.last_day_played,
  u2.campaign,
  count(*) as days
  from users u2 where DATE_DIFF(u2.last_day_played, u2.activity_day, DAY) <= 6
  group by u2.user_id, u2.last_day_played, u2.campaign
)

select u.user_id, u.last_day_played, u.campaign from last_played_days u where u.days = 7
  );
  
11:22:50.358752 [debug] [Thread-1  ]: finished collecting timing info
11:22:50.359326 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '299d2321-a35d-48bb-af61-58742042fc72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bfd6c70>]}
11:22:50.359709 [info ] [Thread-1  ]: 4 of 5 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (68.4k rows, 294.2 MB processed)[0m in 9.84s]
11:22:50.360124 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
11:22:50.360347 [debug] [Thread-1  ]: Began running node model.exercise.model_test
11:22:50.360775 [info ] [Thread-1  ]: 5 of 5 START table model zz_xavier.model_test .................................. [RUN]
11:22:50.361307 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
11:22:50.361500 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
11:22:50.361753 [debug] [Thread-1  ]: Compiling model.exercise.model_test
11:22:50.365480 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
11:22:50.365982 [debug] [Thread-1  ]: finished collecting timing info
11:22:50.366169 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
11:22:50.370819 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:22:50.720997 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
11:22:50.721657 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
11:22:55.831933 [debug] [Thread-1  ]: finished collecting timing info
11:22:55.832504 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '299d2321-a35d-48bb-af61-58742042fc72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bfb3820>]}
11:22:55.832924 [info ] [Thread-1  ]: 5 of 5 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 5.47s]
11:22:55.833396 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
11:22:55.834778 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:22:55.835413 [info ] [MainThread]: 
11:22:55.835726 [info ] [MainThread]: Finished running 5 table models in 32.21s.
11:22:55.836004 [debug] [MainThread]: Connection 'master' was properly closed.
11:22:55.836218 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
11:22:55.842350 [info ] [MainThread]: 
11:22:55.842652 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
11:22:55.842933 [info ] [MainThread]: 
11:22:55.843175 [error] [MainThread]: [33mRuntime Error in model copy_user_campaign_spend (models/copy_user_campaign_spend.sql)[0m
11:22:55.843406 [error] [MainThread]:   404 Not found: Dataset dwh-adev-observe:ae_challenge_data was not found in location US
11:22:55.843623 [error] [MainThread]:   
11:22:55.843835 [error] [MainThread]:   Location: US
11:22:55.844045 [error] [MainThread]:   Job ID: a02262f2-96ee-4651-9430-9034d628131a
11:22:55.844252 [error] [MainThread]:   
11:22:55.844476 [info ] [MainThread]: 
11:22:55.844698 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
11:22:55.845044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf94fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd24dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bfac1c0>]}


============================== 2022-09-27 11:24:12.465361 | 0c86f56a-e0ca-45a1-bc1a-c4184fb71432 ==============================
11:24:12.465384 [info ] [MainThread]: Running with dbt=1.1.2
11:24:12.466199 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:24:12.466340 [debug] [MainThread]: Tracking: tracking
11:24:12.477805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112065280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112096040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120963a0>]}
11:24:12.515097 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:24:12.515507 [debug] [MainThread]: Partial parsing: updated file: exercise://models/copy_user_campaign_spend.sql
11:24:12.527387 [debug] [MainThread]: 1699: static parser successfully parsed copy_user_campaign_spend.sql
11:24:12.544677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0c86f56a-e0ca-45a1-bc1a-c4184fb71432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121f20d0>]}
11:24:12.549075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0c86f56a-e0ca-45a1-bc1a-c4184fb71432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11218aeb0>]}
11:24:12.549315 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:24:12.549534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0c86f56a-e0ca-45a1-bc1a-c4184fb71432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11206c790>]}
11:24:12.550785 [info ] [MainThread]: 
11:24:12.551359 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:24:12.552406 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:24:12.552698 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:24:13.777148 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:24:13.777687 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:24:14.108828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0c86f56a-e0ca-45a1-bc1a-c4184fb71432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11218ae20>]}
11:24:14.109622 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:24:14.110095 [info ] [MainThread]: 
11:24:14.113998 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_activity
11:24:14.114376 [info ] [Thread-1  ]: 1 of 5 START table model zz_xavier.copy_user_activity .......................... [RUN]
11:24:14.114898 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_activity"
11:24:14.115080 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_activity
11:24:14.115298 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_activity
11:24:14.117196 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_activity"
11:24:14.117704 [debug] [Thread-1  ]: finished collecting timing info
11:24:14.117973 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_activity
11:24:14.134917 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:24:14.468442 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_activity"
11:24:14.469045 [debug] [Thread-1  ]: On model.exercise.copy_user_activity: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_activity"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_activity`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_activity
  );
  
11:24:22.761759 [debug] [Thread-1  ]: finished collecting timing info
11:24:22.762268 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c86f56a-e0ca-45a1-bc1a-c4184fb71432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122bcbb0>]}
11:24:22.762652 [info ] [Thread-1  ]: 1 of 5 OK created table model zz_xavier.copy_user_activity ..................... [[32mCREATE TABLE (10.8m rows, 444.5 MB processed)[0m in 8.65s]
11:24:22.763081 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_activity
11:24:22.763295 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_campaign_spend
11:24:22.763691 [info ] [Thread-1  ]: 2 of 5 START table model zz_xavier.copy_user_campaign_spend .................... [RUN]
11:24:22.764166 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_campaign_spend"
11:24:22.764342 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_campaign_spend
11:24:22.764505 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_campaign_spend
11:24:22.766125 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_campaign_spend"
11:24:22.766637 [debug] [Thread-1  ]: finished collecting timing info
11:24:22.766823 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_campaign_spend
11:24:22.772488 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_campaign_spend"
11:24:22.772997 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:24:22.773218 [debug] [Thread-1  ]: On model.exercise.copy_user_campaign_spend: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_campaign_spend"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_campaign_spend`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_campaign_spend
  );
  
11:24:25.985844 [debug] [Thread-1  ]: finished collecting timing info
11:24:25.986436 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c86f56a-e0ca-45a1-bc1a-c4184fb71432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121b5fa0>]}
11:24:25.986942 [info ] [Thread-1  ]: 2 of 5 OK created table model zz_xavier.copy_user_campaign_spend ............... [[32mCREATE TABLE (356.0 rows, 12.2 KB processed)[0m in 3.22s]
11:24:25.987556 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_campaign_spend
11:24:25.987867 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_information
11:24:25.988592 [info ] [Thread-1  ]: 3 of 5 START table model zz_xavier.copy_user_information ....................... [RUN]
11:24:25.989157 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_information"
11:24:25.989355 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_information
11:24:25.989665 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_information
11:24:25.994809 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_information"
11:24:25.995301 [debug] [Thread-1  ]: finished collecting timing info
11:24:25.995482 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_information
11:24:25.998207 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:24:26.439227 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_information"
11:24:26.439835 [debug] [Thread-1  ]: On model.exercise.copy_user_information: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_information"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_information`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_info
  );
  
11:24:30.421434 [debug] [Thread-1  ]: finished collecting timing info
11:24:30.422102 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c86f56a-e0ca-45a1-bc1a-c4184fb71432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121b5100>]}
11:24:30.422465 [info ] [Thread-1  ]: 3 of 5 OK created table model zz_xavier.copy_user_information .................. [[32mCREATE TABLE (697.0k rows, 19.6 MB processed)[0m in 4.43s]
11:24:30.422851 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_information
11:24:30.423047 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
11:24:30.423435 [info ] [Thread-1  ]: 4 of 5 START table model zz_xavier.ex_2 ........................................ [RUN]
11:24:30.423878 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
11:24:30.424039 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
11:24:30.424188 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
11:24:30.425648 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
11:24:30.426120 [debug] [Thread-1  ]: finished collecting timing info
11:24:30.426298 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
11:24:30.428097 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:24:30.851179 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
11:24:30.851821 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        ua.activity_type,
        ui.campaign,
        MAX(ua.activity_day) over (partition by ua.user_id) as last_day_played
    from dwh-adev-core.ae_challenge_data.ae_user_activity as ua
        join dwh-adev-core.ae_challenge_data.ae_user_info ui
        on ua.user_id = ui.user_id 
    where ua.activity_type = 'app_open'
  ),

last_played_days as (
  select 
  u2.user_id,
  u2.last_day_played,
  u2.campaign,
  count(*) as days
  from users u2 where DATE_DIFF(u2.last_day_played, u2.activity_day, DAY) <= 6
  group by u2.user_id, u2.last_day_played, u2.campaign
)

select u.user_id, u.last_day_played, u.campaign from last_played_days u where u.days = 7
  );
  
11:24:40.156860 [debug] [Thread-1  ]: finished collecting timing info
11:24:40.157416 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c86f56a-e0ca-45a1-bc1a-c4184fb71432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121d85e0>]}
11:24:40.157846 [info ] [Thread-1  ]: 4 of 5 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (68.4k rows, 294.2 MB processed)[0m in 9.73s]
11:24:40.158310 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
11:24:40.158559 [debug] [Thread-1  ]: Began running node model.exercise.model_test
11:24:40.158830 [info ] [Thread-1  ]: 5 of 5 START table model zz_xavier.model_test .................................. [RUN]
11:24:40.159374 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
11:24:40.159550 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
11:24:40.159709 [debug] [Thread-1  ]: Compiling model.exercise.model_test
11:24:40.161527 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
11:24:40.162116 [debug] [Thread-1  ]: finished collecting timing info
11:24:40.162305 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
11:24:40.163953 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:24:40.524105 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
11:24:40.524755 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
11:24:45.068971 [debug] [Thread-1  ]: finished collecting timing info
11:24:45.069640 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c86f56a-e0ca-45a1-bc1a-c4184fb71432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11234cfa0>]}
11:24:45.070202 [info ] [Thread-1  ]: 5 of 5 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 4.91s]
11:24:45.070733 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
11:24:45.072617 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:24:45.073231 [info ] [MainThread]: 
11:24:45.073578 [info ] [MainThread]: Finished running 5 table models in 32.52s.
11:24:45.073838 [debug] [MainThread]: Connection 'master' was properly closed.
11:24:45.073988 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
11:24:45.079713 [info ] [MainThread]: 
11:24:45.079996 [info ] [MainThread]: [32mCompleted successfully[0m
11:24:45.080293 [info ] [MainThread]: 
11:24:45.080531 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
11:24:45.080885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121dd730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121ce6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11218a9d0>]}


============================== 2022-09-28 07:45:59.476418 | 1f5420d9-4021-47ea-baa9-b7b255925925 ==============================
07:45:59.476455 [info ] [MainThread]: Running with dbt=1.1.2
07:45:59.477412 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
07:45:59.477609 [debug] [MainThread]: Tracking: tracking
07:45:59.493701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d267160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5c9f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5c9280>]}
07:45:59.550354 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
07:45:59.550775 [debug] [MainThread]: Partial parsing: added file: exercise://models/ex_2_2.sql
07:45:59.568419 [debug] [MainThread]: 1699: static parser successfully parsed ex_2_2.sql
07:45:59.590882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1f5420d9-4021-47ea-baa9-b7b255925925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8110d0>]}
07:45:59.597561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1f5420d9-4021-47ea-baa9-b7b255925925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7a9fd0>]}
07:45:59.597969 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
07:45:59.598293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f5420d9-4021-47ea-baa9-b7b255925925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7a9be0>]}
07:45:59.599961 [info ] [MainThread]: 
07:45:59.600454 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:45:59.601459 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
07:45:59.601734 [debug] [ThreadPool]: Opening a new connection, currently in state init
07:46:01.299551 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
07:46:01.300064 [debug] [ThreadPool]: Opening a new connection, currently in state closed
07:46:01.712449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f5420d9-4021-47ea-baa9-b7b255925925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d223df0>]}
07:46:01.713200 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
07:46:01.713567 [info ] [MainThread]: 
07:46:01.719006 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_activity
07:46:01.719334 [info ] [Thread-1  ]: 1 of 6 START table model zz_xavier.copy_user_activity .......................... [RUN]
07:46:01.719923 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_activity"
07:46:01.720149 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_activity
07:46:01.720356 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_activity
07:46:01.722312 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_activity"
07:46:01.722790 [debug] [Thread-1  ]: finished collecting timing info
07:46:01.722979 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_activity
07:46:01.740066 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:46:02.109427 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_activity"
07:46:02.110034 [debug] [Thread-1  ]: On model.exercise.copy_user_activity: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_activity"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_activity`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_activity
  );
  
07:46:11.361797 [debug] [Thread-1  ]: finished collecting timing info
07:46:11.362323 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f5420d9-4021-47ea-baa9-b7b255925925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8debe0>]}
07:46:11.363013 [info ] [Thread-1  ]: 1 of 6 OK created table model zz_xavier.copy_user_activity ..................... [[32mCREATE TABLE (10.8m rows, 444.5 MB processed)[0m in 9.64s]
07:46:11.363463 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_activity
07:46:11.363680 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_campaign_spend
07:46:11.364078 [info ] [Thread-1  ]: 2 of 6 START table model zz_xavier.copy_user_campaign_spend .................... [RUN]
07:46:11.364539 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_campaign_spend"
07:46:11.364714 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_campaign_spend
07:46:11.364880 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_campaign_spend
07:46:11.366500 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_campaign_spend"
07:46:11.367015 [debug] [Thread-1  ]: finished collecting timing info
07:46:11.367200 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_campaign_spend
07:46:11.371456 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:46:11.685841 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_campaign_spend"
07:46:11.686667 [debug] [Thread-1  ]: On model.exercise.copy_user_campaign_spend: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_campaign_spend"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_campaign_spend`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_campaign_spend
  );
  
07:46:14.574637 [debug] [Thread-1  ]: finished collecting timing info
07:46:14.575315 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f5420d9-4021-47ea-baa9-b7b255925925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8ec250>]}
07:46:14.575816 [info ] [Thread-1  ]: 2 of 6 OK created table model zz_xavier.copy_user_campaign_spend ............... [[32mCREATE TABLE (356.0 rows, 12.2 KB processed)[0m in 3.21s]
07:46:14.576305 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_campaign_spend
07:46:14.576562 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_information
07:46:14.576883 [info ] [Thread-1  ]: 3 of 6 START table model zz_xavier.copy_user_information ....................... [RUN]
07:46:14.577525 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_information"
07:46:14.577746 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_information
07:46:14.577949 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_information
07:46:14.579530 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_information"
07:46:14.580073 [debug] [Thread-1  ]: finished collecting timing info
07:46:14.580283 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_information
07:46:14.582194 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:46:14.958265 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_information"
07:46:14.959076 [debug] [Thread-1  ]: On model.exercise.copy_user_information: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_information"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_information`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_info
  );
  
07:46:19.187376 [debug] [Thread-1  ]: finished collecting timing info
07:46:19.188072 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f5420d9-4021-47ea-baa9-b7b255925925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8ea850>]}
07:46:19.188605 [info ] [Thread-1  ]: 3 of 6 OK created table model zz_xavier.copy_user_information .................. [[32mCREATE TABLE (697.0k rows, 19.6 MB processed)[0m in 4.61s]
07:46:19.189106 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_information
07:46:19.189360 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
07:46:19.189672 [info ] [Thread-1  ]: 4 of 6 START table model zz_xavier.ex_2 ........................................ [RUN]
07:46:19.190360 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
07:46:19.190582 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
07:46:19.190855 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
07:46:19.192727 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
07:46:19.193284 [debug] [Thread-1  ]: finished collecting timing info
07:46:19.193503 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
07:46:19.195223 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:46:19.468524 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
07:46:19.469183 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        ua.activity_type,
        ui.campaign,
        MAX(ua.activity_day) over (partition by ua.user_id) as last_day_played
    from dwh-adev-core.ae_challenge_data.ae_user_activity as ua
        join dwh-adev-core.ae_challenge_data.ae_user_info ui
        on ua.user_id = ui.user_id 
    where ua.activity_type = 'app_open'
  ),

last_played_days as (
  select 
  u2.user_id,
  u2.last_day_played,
  u2.campaign,
  count(*) as days
  from users u2 where DATE_DIFF(u2.last_day_played, u2.activity_day, DAY) <= 6
  group by u2.user_id, u2.last_day_played, u2.campaign
)

select u.user_id, u.last_day_played, u.campaign from last_played_days u where u.days = 7
  );
  
07:46:29.621267 [debug] [Thread-1  ]: finished collecting timing info
07:46:29.621956 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f5420d9-4021-47ea-baa9-b7b255925925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7a9610>]}
07:46:29.622484 [info ] [Thread-1  ]: 4 of 6 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (68.4k rows, 294.2 MB processed)[0m in 10.43s]
07:46:29.622970 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
07:46:29.623217 [debug] [Thread-1  ]: Began running node model.exercise.ex_2_2
07:46:29.623580 [info ] [Thread-1  ]: 5 of 6 START table model zz_xavier.ex_2_2 ...................................... [RUN]
07:46:29.624235 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2_2"
07:46:29.624446 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2_2
07:46:29.624640 [debug] [Thread-1  ]: Compiling model.exercise.ex_2_2
07:46:29.626507 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2_2"
07:46:29.627024 [debug] [Thread-1  ]: finished collecting timing info
07:46:29.627224 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2_2
07:46:29.629804 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2_2"
07:46:29.630274 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:46:29.630492 [debug] [Thread-1  ]: On model.exercise.ex_2_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        ua.activity_type,
        ui.install_day,
        ui.campaign
    from dwh-adev-core.ae_challenge_data.ae_user_activity as ua
        join dwh-adev-core.ae_challenge_data.ae_user_info ui
        on ua.user_id = ui.user_id 
    where ua.activity_type = 'app_open' and DATE_DIFF(u.activity_type, ui.install_day, DAY) <= 6
  ),

last_played_days as (
  select
  u.user_id,
  u.install_day,
  u.campaign,
  from users
  where 7 >= (select count(u2.activity_day) from
  users u2 where u.user_id = u2.user_id)
)

select * from last_played_days
  );
  
07:46:30.564082 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: u at [19:55]')
07:46:32.494794 [debug] [Thread-1  ]: finished collecting timing info
07:46:32.495422 [debug] [Thread-1  ]: Database Error in model ex_2_2 (models/ex_2_2.sql)
  Unrecognized name: u at [19:55]
  compiled SQL at target/run/exercise/models/ex_2_2.sql
07:46:32.495838 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f5420d9-4021-47ea-baa9-b7b255925925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e97de50>]}
07:46:32.496355 [error] [Thread-1  ]: 5 of 6 ERROR creating table model zz_xavier.ex_2_2 ............................. [[31mERROR[0m in 2.87s]
07:46:32.496901 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2_2
07:46:32.497162 [debug] [Thread-1  ]: Began running node model.exercise.model_test
07:46:32.497621 [info ] [Thread-1  ]: 6 of 6 START table model zz_xavier.model_test .................................. [RUN]
07:46:32.498189 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
07:46:32.498412 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
07:46:32.498601 [debug] [Thread-1  ]: Compiling model.exercise.model_test
07:46:32.500394 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
07:46:32.500944 [debug] [Thread-1  ]: finished collecting timing info
07:46:32.501145 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
07:46:32.502953 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:46:32.879020 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
07:46:32.879833 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
07:46:37.425210 [debug] [Thread-1  ]: finished collecting timing info
07:46:37.425873 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f5420d9-4021-47ea-baa9-b7b255925925', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7dc730>]}
07:46:37.426320 [info ] [Thread-1  ]: 6 of 6 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 4.93s]
07:46:37.426812 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
07:46:37.428157 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:46:37.428683 [info ] [MainThread]: 
07:46:37.429046 [info ] [MainThread]: Finished running 6 table models in 37.83s.
07:46:37.429378 [debug] [MainThread]: Connection 'master' was properly closed.
07:46:37.429550 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
07:46:37.435926 [info ] [MainThread]: 
07:46:37.436246 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
07:46:37.436542 [info ] [MainThread]: 
07:46:37.436809 [error] [MainThread]: [33mDatabase Error in model ex_2_2 (models/ex_2_2.sql)[0m
07:46:37.437062 [error] [MainThread]:   Unrecognized name: u at [19:55]
07:46:37.437297 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ex_2_2.sql
07:46:37.437548 [info ] [MainThread]: 
07:46:37.437801 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
07:46:37.438191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7a9820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7a98b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7ebcd0>]}


============================== 2022-09-28 07:51:24.336113 | 936bac00-50de-4c1d-8601-e1c3d3e8a04e ==============================
07:51:24.336134 [info ] [MainThread]: Running with dbt=1.1.2
07:51:24.336769 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
07:51:24.337074 [debug] [MainThread]: Tracking: tracking
07:51:24.349581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091df910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091dfa90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091dfd90>]}
07:51:24.381067 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
07:51:24.381525 [debug] [MainThread]: Partial parsing: added file: exercise://models/extra/ex_2_2.sql
07:51:24.381657 [debug] [MainThread]: Partial parsing: deleted file: exercise://models/ex_2_2.sql
07:51:24.391943 [debug] [MainThread]: 1699: static parser successfully parsed extra/ex_2_2.sql
07:51:24.407268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '936bac00-50de-4c1d-8601-e1c3d3e8a04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10933a0d0>]}
07:51:24.411399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '936bac00-50de-4c1d-8601-e1c3d3e8a04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091df2b0>]}
07:51:24.411627 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
07:51:24.411842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '936bac00-50de-4c1d-8601-e1c3d3e8a04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091b6d90>]}
07:51:24.413029 [info ] [MainThread]: 
07:51:24.413391 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:51:24.414291 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
07:51:24.414521 [debug] [ThreadPool]: Opening a new connection, currently in state init
07:51:25.573435 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
07:51:25.573944 [debug] [ThreadPool]: Opening a new connection, currently in state closed
07:51:26.029259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '936bac00-50de-4c1d-8601-e1c3d3e8a04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092d5df0>]}
07:51:26.042365 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
07:51:26.062936 [info ] [MainThread]: 
07:51:26.068268 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_activity
07:51:26.083377 [info ] [Thread-1  ]: 1 of 6 START table model zz_xavier.copy_user_activity .......................... [RUN]
07:51:26.084627 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_activity"
07:51:26.104376 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_activity
07:51:26.104708 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_activity
07:51:26.106845 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_activity"
07:51:26.107391 [debug] [Thread-1  ]: finished collecting timing info
07:51:26.107590 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_activity
07:51:26.124178 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:51:26.429076 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_activity"
07:51:26.429649 [debug] [Thread-1  ]: On model.exercise.copy_user_activity: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_activity"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_activity`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_activity
  );
  
07:51:34.527246 [debug] [Thread-1  ]: finished collecting timing info
07:51:34.527765 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '936bac00-50de-4c1d-8601-e1c3d3e8a04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10940d5b0>]}
07:51:34.528156 [info ] [Thread-1  ]: 1 of 6 OK created table model zz_xavier.copy_user_activity ..................... [[32mCREATE TABLE (10.8m rows, 444.5 MB processed)[0m in 8.44s]
07:51:34.528619 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_activity
07:51:34.528867 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_campaign_spend
07:51:34.529318 [info ] [Thread-1  ]: 2 of 6 START table model zz_xavier.copy_user_campaign_spend .................... [RUN]
07:51:34.529809 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_campaign_spend"
07:51:34.529991 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_campaign_spend
07:51:34.530162 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_campaign_spend
07:51:34.531865 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_campaign_spend"
07:51:34.532371 [debug] [Thread-1  ]: finished collecting timing info
07:51:34.532557 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_campaign_spend
07:51:34.537212 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:51:34.948259 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_campaign_spend"
07:51:34.949048 [debug] [Thread-1  ]: On model.exercise.copy_user_campaign_spend: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_campaign_spend"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_campaign_spend`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_campaign_spend
  );
  
07:51:37.505297 [debug] [Thread-1  ]: finished collecting timing info
07:51:37.505983 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '936bac00-50de-4c1d-8601-e1c3d3e8a04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093207f0>]}
07:51:37.506511 [info ] [Thread-1  ]: 2 of 6 OK created table model zz_xavier.copy_user_campaign_spend ............... [[32mCREATE TABLE (356.0 rows, 12.2 KB processed)[0m in 2.98s]
07:51:37.507017 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_campaign_spend
07:51:37.507266 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_information
07:51:37.507647 [info ] [Thread-1  ]: 3 of 6 START table model zz_xavier.copy_user_information ....................... [RUN]
07:51:37.508176 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_information"
07:51:37.508378 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_information
07:51:37.508567 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_information
07:51:37.510208 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_information"
07:51:37.510769 [debug] [Thread-1  ]: finished collecting timing info
07:51:37.510982 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_information
07:51:37.512878 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:51:37.902031 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_information"
07:51:37.902821 [debug] [Thread-1  ]: On model.exercise.copy_user_information: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_information"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_information`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_info
  );
  
07:51:42.176265 [debug] [Thread-1  ]: finished collecting timing info
07:51:42.176952 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '936bac00-50de-4c1d-8601-e1c3d3e8a04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093206a0>]}
07:51:42.177473 [info ] [Thread-1  ]: 3 of 6 OK created table model zz_xavier.copy_user_information .................. [[32mCREATE TABLE (697.0k rows, 19.6 MB processed)[0m in 4.67s]
07:51:42.177967 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_information
07:51:42.178224 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
07:51:42.178717 [info ] [Thread-1  ]: 4 of 6 START table model zz_xavier.ex_2 ........................................ [RUN]
07:51:42.179276 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
07:51:42.179487 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
07:51:42.179683 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
07:51:42.181601 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
07:51:42.182160 [debug] [Thread-1  ]: finished collecting timing info
07:51:42.182376 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
07:51:42.184263 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:51:42.482503 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
07:51:42.483294 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        ua.activity_type,
        ui.campaign,
        MAX(ua.activity_day) over (partition by ua.user_id) as last_day_played
    from dwh-adev-core.ae_challenge_data.ae_user_activity as ua
        join dwh-adev-core.ae_challenge_data.ae_user_info ui
        on ua.user_id = ui.user_id 
    where ua.activity_type = 'app_open'
  ),

last_played_days as (
  select 
  u2.user_id,
  u2.last_day_played,
  u2.campaign,
  count(*) as days
  from users u2 where DATE_DIFF(u2.last_day_played, u2.activity_day, DAY) <= 6
  group by u2.user_id, u2.last_day_played, u2.campaign
)

select u.user_id, u.last_day_played, u.campaign from last_played_days u where u.days = 7
  );
  
07:51:50.579225 [debug] [Thread-1  ]: finished collecting timing info
07:51:50.579818 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '936bac00-50de-4c1d-8601-e1c3d3e8a04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092d5580>]}
07:51:50.580266 [info ] [Thread-1  ]: 4 of 6 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (68.4k rows, 294.2 MB processed)[0m in 8.40s]
07:51:50.580778 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
07:51:50.581050 [debug] [Thread-1  ]: Began running node model.exercise.ex_2_2
07:51:50.581512 [info ] [Thread-1  ]: 5 of 6 START table model zz_xavier.ex_2_2 ...................................... [RUN]
07:51:50.582061 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2_2"
07:51:50.582258 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2_2
07:51:50.582445 [debug] [Thread-1  ]: Compiling model.exercise.ex_2_2
07:51:50.584298 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2_2"
07:51:50.584961 [debug] [Thread-1  ]: finished collecting timing info
07:51:50.585175 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2_2
07:51:50.587902 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2_2"
07:51:50.588474 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:51:50.588710 [debug] [Thread-1  ]: On model.exercise.ex_2_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        ua.activity_type,
        ui.install_day,
        ui.campaign
    from dwh-adev-core.ae_challenge_data.ae_user_activity as ua
        join dwh-adev-core.ae_challenge_data.ae_user_info ui
        on ua.user_id = ui.user_id 
    where ua.activity_type = 'app_open' and DATE_DIFF(ua.activity_day, ui.install_day, DAY) <= 6
  ),

last_played_days as (
  select
  distinct u.user_id,
  u.install_day,
  u.campaign,
  from users u
  where 7 >= (select count(u2.activity_day) from
  users u2 where u.user_id = u2.user_id)
)

select * from last_played_days
  );
  
07:52:07.333931 [debug] [Thread-1  ]: finished collecting timing info
07:52:07.334628 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '936bac00-50de-4c1d-8601-e1c3d3e8a04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093f11c0>]}
07:52:07.335187 [info ] [Thread-1  ]: 5 of 6 OK created table model zz_xavier.ex_2_2 ................................. [[32mCREATE TABLE (697.0k rows, 299.6 MB processed)[0m in 16.75s]
07:52:07.335690 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2_2
07:52:07.335968 [debug] [Thread-1  ]: Began running node model.exercise.model_test
07:52:07.336329 [info ] [Thread-1  ]: 6 of 6 START table model zz_xavier.model_test .................................. [RUN]
07:52:07.336883 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
07:52:07.337088 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
07:52:07.337277 [debug] [Thread-1  ]: Compiling model.exercise.model_test
07:52:07.339578 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
07:52:07.340149 [debug] [Thread-1  ]: finished collecting timing info
07:52:07.340355 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
07:52:07.343376 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:52:07.642845 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
07:52:07.643583 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
07:52:12.903050 [debug] [Thread-1  ]: finished collecting timing info
07:52:12.903723 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '936bac00-50de-4c1d-8601-e1c3d3e8a04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093f1250>]}
07:52:12.904266 [info ] [Thread-1  ]: 6 of 6 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 5.57s]
07:52:12.904756 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
07:52:12.906130 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:52:12.906766 [info ] [MainThread]: 
07:52:12.907137 [info ] [MainThread]: Finished running 6 table models in 48.49s.
07:52:12.907446 [debug] [MainThread]: Connection 'master' was properly closed.
07:52:12.907622 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
07:52:12.914056 [info ] [MainThread]: 
07:52:12.914357 [info ] [MainThread]: [32mCompleted successfully[0m
07:52:12.914670 [info ] [MainThread]: 
07:52:12.914942 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
07:52:12.915307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10928bd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10928bd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109310d60>]}


============================== 2022-09-28 09:54:42.905225 | 2501cd3b-4f74-43f4-801d-fac3e44ad11c ==============================
09:54:42.905270 [info ] [MainThread]: Running with dbt=1.1.2
09:54:42.905991 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:54:42.906658 [debug] [MainThread]: Tracking: tracking
09:54:42.918940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fdcba00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111165310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111165bb0>]}
09:54:42.952098 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:54:42.952431 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ex_2.sql
09:54:42.963289 [debug] [MainThread]: 1699: static parser successfully parsed ex_2.sql
09:54:42.979098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2501cd3b-4f74-43f4-801d-fac3e44ad11c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112d60d0>]}
09:54:42.983356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2501cd3b-4f74-43f4-801d-fac3e44ad11c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111270c70>]}
09:54:42.983583 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:54:42.983824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2501cd3b-4f74-43f4-801d-fac3e44ad11c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11126ccd0>]}
09:54:42.985056 [info ] [MainThread]: 
09:54:42.985397 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:54:42.986280 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:54:42.986505 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:54:44.199841 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:54:44.200336 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:54:44.596385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2501cd3b-4f74-43f4-801d-fac3e44ad11c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112707f0>]}
09:54:44.597349 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:54:44.597776 [info ] [MainThread]: 
09:54:44.602210 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_activity
09:54:44.602586 [info ] [Thread-1  ]: 1 of 6 START table model zz_xavier.copy_user_activity .......................... [RUN]
09:54:44.603109 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_activity"
09:54:44.603293 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_activity
09:54:44.603496 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_activity
09:54:44.605540 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_activity"
09:54:44.606046 [debug] [Thread-1  ]: finished collecting timing info
09:54:44.606244 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_activity
09:54:44.623158 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:54:44.937425 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_activity"
09:54:44.938015 [debug] [Thread-1  ]: On model.exercise.copy_user_activity: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_activity"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_activity`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_activity
  );
  
09:54:53.338017 [debug] [Thread-1  ]: finished collecting timing info
09:54:53.338564 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2501cd3b-4f74-43f4-801d-fac3e44ad11c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112bbb50>]}
09:54:53.338982 [info ] [Thread-1  ]: 1 of 6 OK created table model zz_xavier.copy_user_activity ..................... [[32mCREATE TABLE (10.8m rows, 444.5 MB processed)[0m in 8.74s]
09:54:53.339441 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_activity
09:54:53.339664 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_campaign_spend
09:54:53.340190 [info ] [Thread-1  ]: 2 of 6 START table model zz_xavier.copy_user_campaign_spend .................... [RUN]
09:54:53.340857 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_campaign_spend"
09:54:53.341140 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_campaign_spend
09:54:53.341409 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_campaign_spend
09:54:53.342973 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_campaign_spend"
09:54:53.343508 [debug] [Thread-1  ]: finished collecting timing info
09:54:53.343711 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_campaign_spend
09:54:53.348113 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:54:53.728744 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_campaign_spend"
09:54:53.729551 [debug] [Thread-1  ]: On model.exercise.copy_user_campaign_spend: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_campaign_spend"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_campaign_spend`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_campaign_spend
  );
  
09:54:56.225296 [debug] [Thread-1  ]: finished collecting timing info
09:54:56.225990 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2501cd3b-4f74-43f4-801d-fac3e44ad11c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113e4e80>]}
09:54:56.226506 [info ] [Thread-1  ]: 2 of 6 OK created table model zz_xavier.copy_user_campaign_spend ............... [[32mCREATE TABLE (356.0 rows, 12.2 KB processed)[0m in 2.89s]
09:54:56.227004 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_campaign_spend
09:54:56.227263 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_information
09:54:56.227661 [info ] [Thread-1  ]: 3 of 6 START table model zz_xavier.copy_user_information ....................... [RUN]
09:54:56.228218 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_information"
09:54:56.228427 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_information
09:54:56.228628 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_information
09:54:56.234534 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_information"
09:54:56.235138 [debug] [Thread-1  ]: finished collecting timing info
09:54:56.235344 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_information
09:54:56.238224 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:54:56.630785 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_information"
09:54:56.631579 [debug] [Thread-1  ]: On model.exercise.copy_user_information: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_information"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_information`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_info
  );
  
09:54:59.918581 [debug] [Thread-1  ]: finished collecting timing info
09:54:59.919269 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2501cd3b-4f74-43f4-801d-fac3e44ad11c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111270dc0>]}
09:54:59.919803 [info ] [Thread-1  ]: 3 of 6 OK created table model zz_xavier.copy_user_information .................. [[32mCREATE TABLE (697.0k rows, 19.6 MB processed)[0m in 3.69s]
09:54:59.920281 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_information
09:54:59.920530 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
09:54:59.920957 [info ] [Thread-1  ]: 4 of 6 START table model zz_xavier.ex_2 ........................................ [RUN]
09:54:59.921494 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
09:54:59.921694 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
09:54:59.921882 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
09:54:59.923522 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
09:54:59.924056 [debug] [Thread-1  ]: finished collecting timing info
09:54:59.924271 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
09:54:59.926838 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
09:54:59.927290 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:54:59.927509 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        7 = DATE_DIFF(ua.activity_day,MIN(ua.activity_day) over (partition by ua.user_id order by ua.activity_day ROWS
        BETWEEN 7 PRECEDING AND 0 PRECEDING), DAY) as has_been_active
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_type = 'app_open'
  )

select * from users order by user_id
  );
  
09:55:15.496332 [debug] [Thread-1  ]: finished collecting timing info
09:55:15.497017 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2501cd3b-4f74-43f4-801d-fac3e44ad11c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112bbd90>]}
09:55:15.497558 [info ] [Thread-1  ]: 4 of 6 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (10.5m rows, 280.0 MB processed)[0m in 15.58s]
09:55:15.498067 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
09:55:15.498337 [debug] [Thread-1  ]: Began running node model.exercise.ex_2_2
09:55:15.498872 [info ] [Thread-1  ]: 5 of 6 START table model zz_xavier.ex_2_2 ...................................... [RUN]
09:55:15.499455 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2_2"
09:55:15.499655 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2_2
09:55:15.499847 [debug] [Thread-1  ]: Compiling model.exercise.ex_2_2
09:55:15.501746 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2_2"
09:55:15.502305 [debug] [Thread-1  ]: finished collecting timing info
09:55:15.502516 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2_2
09:55:15.505242 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2_2"
09:55:15.505716 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:55:15.505948 [debug] [Thread-1  ]: On model.exercise.ex_2_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        ua.activity_type,
        ui.install_day,
        ui.campaign
    from dwh-adev-core.ae_challenge_data.ae_user_activity as ua
        join dwh-adev-core.ae_challenge_data.ae_user_info ui
        on ua.user_id = ui.user_id 
    where ua.activity_type = 'app_open' and DATE_DIFF(ua.activity_day, ui.install_day, DAY) <= 6
  ),

last_played_days as (
  select
  distinct u.user_id,
  u.install_day,
  u.campaign,
  from users u
  where 7 >= (select count(u2.activity_day) from
  users u2 where u.user_id = u2.user_id)
)

select * from last_played_days
  );
  
09:55:33.348970 [debug] [Thread-1  ]: finished collecting timing info
09:55:33.349651 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2501cd3b-4f74-43f4-801d-fac3e44ad11c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11141b7f0>]}
09:55:33.350184 [info ] [Thread-1  ]: 5 of 6 OK created table model zz_xavier.ex_2_2 ................................. [[32mCREATE TABLE (697.0k rows, 299.6 MB processed)[0m in 17.85s]
09:55:33.350694 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2_2
09:55:33.350959 [debug] [Thread-1  ]: Began running node model.exercise.model_test
09:55:33.351430 [info ] [Thread-1  ]: 6 of 6 START table model zz_xavier.model_test .................................. [RUN]
09:55:33.351987 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
09:55:33.352190 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
09:55:33.352381 [debug] [Thread-1  ]: Compiling model.exercise.model_test
09:55:33.354710 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
09:55:33.355290 [debug] [Thread-1  ]: finished collecting timing info
09:55:33.355504 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
09:55:33.358511 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:55:33.675512 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
09:55:33.676316 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
09:55:38.316581 [debug] [Thread-1  ]: finished collecting timing info
09:55:38.317276 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2501cd3b-4f74-43f4-801d-fac3e44ad11c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112bb310>]}
09:55:38.317811 [info ] [Thread-1  ]: 6 of 6 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 4.97s]
09:55:38.318308 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
09:55:38.319619 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:55:38.320106 [info ] [MainThread]: 
09:55:38.320571 [info ] [MainThread]: Finished running 6 table models in 55.33s.
09:55:38.320876 [debug] [MainThread]: Connection 'master' was properly closed.
09:55:38.321051 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
09:55:38.327561 [info ] [MainThread]: 
09:55:38.327865 [info ] [MainThread]: [32mCompleted successfully[0m
09:55:38.328177 [info ] [MainThread]: 
09:55:38.328433 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
09:55:38.328804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112d6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112d6b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111270b20>]}


============================== 2022-09-28 09:58:11.263709 | 5bf0b6a8-b460-4da0-8401-a2c20af55e2d ==============================
09:58:11.263732 [info ] [MainThread]: Running with dbt=1.1.2
09:58:11.264647 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['/Users/xavier.coll/exercici-1/models/ex_2.sql'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:58:11.264819 [debug] [MainThread]: Tracking: tracking
09:58:11.277054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d2c2880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d2c2070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d2c27c0>]}
09:58:11.309990 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:58:11.310365 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ex_2.sql
09:58:11.320393 [debug] [MainThread]: 1699: static parser successfully parsed ex_2.sql
09:58:11.336234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5bf0b6a8-b460-4da0-8401-a2c20af55e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d41dfd0>]}
09:58:11.340367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5bf0b6a8-b460-4da0-8401-a2c20af55e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3b8b50>]}
09:58:11.340594 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:58:11.340842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5bf0b6a8-b460-4da0-8401-a2c20af55e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3b4bb0>]}
09:58:11.341299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3b8a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3b87f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3b8820>]}


============================== 2022-09-28 09:58:26.122820 | a7eb2a8f-c207-472d-9b22-f99e80a0a3bb ==============================
09:58:26.122843 [info ] [MainThread]: Running with dbt=1.1.2
09:58:26.123470 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:58:26.123674 [debug] [MainThread]: Tracking: tracking
09:58:26.136574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110688f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119ec280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119ecf70>]}
09:58:26.176745 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
09:58:26.176965 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
09:58:26.182762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a7eb2a8f-c207-472d-9b22-f99e80a0a3bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b1f0d0>]}
09:58:26.188142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a7eb2a8f-c207-472d-9b22-f99e80a0a3bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a55c70>]}
09:58:26.188451 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:58:26.188747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7eb2a8f-c207-472d-9b22-f99e80a0a3bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a55cd0>]}
09:58:26.190225 [info ] [MainThread]: 
09:58:26.190659 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:58:26.191653 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:58:26.191909 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:58:27.371080 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:58:27.371606 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:58:27.622295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7eb2a8f-c207-472d-9b22-f99e80a0a3bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110644bb0>]}
09:58:27.623220 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:58:27.623603 [info ] [MainThread]: 
09:58:27.629623 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_activity
09:58:27.629982 [info ] [Thread-1  ]: 1 of 6 START table model zz_xavier.copy_user_activity .......................... [RUN]
09:58:27.630468 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_activity"
09:58:27.630666 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_activity
09:58:27.630869 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_activity
09:58:27.633905 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_activity"
09:58:27.634454 [debug] [Thread-1  ]: finished collecting timing info
09:58:27.634655 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_activity
09:58:27.651469 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:58:27.985763 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_activity"
09:58:27.986362 [debug] [Thread-1  ]: On model.exercise.copy_user_activity: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_activity"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_activity`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_activity
  );
  
09:58:36.120906 [debug] [Thread-1  ]: finished collecting timing info
09:58:36.121472 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7eb2a8f-c207-472d-9b22-f99e80a0a3bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111be8160>]}
09:58:36.121890 [info ] [Thread-1  ]: 1 of 6 OK created table model zz_xavier.copy_user_activity ..................... [[32mCREATE TABLE (10.8m rows, 444.5 MB processed)[0m in 8.49s]
09:58:36.122376 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_activity
09:58:36.122604 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_campaign_spend
09:58:36.122997 [info ] [Thread-1  ]: 2 of 6 START table model zz_xavier.copy_user_campaign_spend .................... [RUN]
09:58:36.123485 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_campaign_spend"
09:58:36.123667 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_campaign_spend
09:58:36.123837 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_campaign_spend
09:58:36.125540 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_campaign_spend"
09:58:36.126040 [debug] [Thread-1  ]: finished collecting timing info
09:58:36.126222 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_campaign_spend
09:58:36.127868 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:58:36.407081 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_campaign_spend"
09:58:36.407870 [debug] [Thread-1  ]: On model.exercise.copy_user_campaign_spend: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_campaign_spend"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_campaign_spend`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_campaign_spend
  );
  
09:58:38.565483 [debug] [Thread-1  ]: finished collecting timing info
09:58:38.566158 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7eb2a8f-c207-472d-9b22-f99e80a0a3bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bcb820>]}
09:58:38.566698 [info ] [Thread-1  ]: 2 of 6 OK created table model zz_xavier.copy_user_campaign_spend ............... [[32mCREATE TABLE (356.0 rows, 12.2 KB processed)[0m in 2.44s]
09:58:38.567187 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_campaign_spend
09:58:38.567440 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_information
09:58:38.567866 [info ] [Thread-1  ]: 3 of 6 START table model zz_xavier.copy_user_information ....................... [RUN]
09:58:38.568409 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_information"
09:58:38.568615 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_information
09:58:38.568808 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_information
09:58:38.570424 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_information"
09:58:38.570972 [debug] [Thread-1  ]: finished collecting timing info
09:58:38.571192 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_information
09:58:38.573095 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:58:38.834520 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_information"
09:58:38.835314 [debug] [Thread-1  ]: On model.exercise.copy_user_information: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_information"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_information`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_info
  );
  
09:58:42.703234 [debug] [Thread-1  ]: finished collecting timing info
09:58:42.703905 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7eb2a8f-c207-472d-9b22-f99e80a0a3bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c79070>]}
09:58:42.704426 [info ] [Thread-1  ]: 3 of 6 OK created table model zz_xavier.copy_user_information .................. [[32mCREATE TABLE (697.0k rows, 19.6 MB processed)[0m in 4.14s]
09:58:42.704917 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_information
09:58:42.705173 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
09:58:42.705593 [info ] [Thread-1  ]: 4 of 6 START table model zz_xavier.ex_2 ........................................ [RUN]
09:58:42.706145 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
09:58:42.706343 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
09:58:42.706527 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
09:58:42.708302 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
09:58:42.708818 [debug] [Thread-1  ]: finished collecting timing info
09:58:42.709021 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
09:58:42.710739 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:58:43.005379 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
09:58:43.006151 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        ua.install_day,
        7 = DATE_DIFF(ua.activity_day,MIN(ua.activity_day) over (partition by ua.user_id order by ua.activity_day ROWS
        BETWEEN 7 PRECEDING AND 0 PRECEDING), DAY) as has_been_active
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_type = 'app_open'
  )

select * from users
  );
  
09:58:43.753579 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Name install_day not found inside ua at [13:12]')
09:58:44.701696 [debug] [Thread-1  ]: finished collecting timing info
09:58:44.702297 [debug] [Thread-1  ]: Database Error in model ex_2 (models/ex_2.sql)
  Name install_day not found inside ua at [13:12]
  compiled SQL at target/run/exercise/models/ex_2.sql
09:58:44.702710 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7eb2a8f-c207-472d-9b22-f99e80a0a3bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cadf40>]}
09:58:44.703238 [error] [Thread-1  ]: 4 of 6 ERROR creating table model zz_xavier.ex_2 ............................... [[31mERROR[0m in 2.00s]
09:58:44.703763 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
09:58:44.704012 [debug] [Thread-1  ]: Began running node model.exercise.ex_2_2
09:58:44.704383 [info ] [Thread-1  ]: 5 of 6 START table model zz_xavier.ex_2_2 ...................................... [RUN]
09:58:44.705118 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2_2"
09:58:44.705322 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2_2
09:58:44.705508 [debug] [Thread-1  ]: Compiling model.exercise.ex_2_2
09:58:44.709242 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2_2"
09:58:44.709711 [debug] [Thread-1  ]: finished collecting timing info
09:58:44.709900 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2_2
09:58:44.714558 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:58:45.002203 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2_2"
09:58:45.002979 [debug] [Thread-1  ]: On model.exercise.ex_2_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        ua.activity_type,
        ui.install_day,
        ui.campaign
    from dwh-adev-core.ae_challenge_data.ae_user_activity as ua
        join dwh-adev-core.ae_challenge_data.ae_user_info ui
        on ua.user_id = ui.user_id 
    where ua.activity_type = 'app_open' and DATE_DIFF(ua.activity_day, ui.install_day, DAY) <= 6
  ),

last_played_days as (
  select
  distinct u.user_id,
  u.install_day,
  u.campaign,
  from users u
  where 7 >= (select count(u2.activity_day) from
  users u2 where u.user_id = u2.user_id)
)

select * from last_played_days
  );
  
09:59:01.445821 [debug] [Thread-1  ]: finished collecting timing info
09:59:01.446362 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7eb2a8f-c207-472d-9b22-f99e80a0a3bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cade20>]}
09:59:01.446767 [info ] [Thread-1  ]: 5 of 6 OK created table model zz_xavier.ex_2_2 ................................. [[32mCREATE TABLE (697.0k rows, 299.6 MB processed)[0m in 16.74s]
09:59:01.447227 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2_2
09:59:01.447472 [debug] [Thread-1  ]: Began running node model.exercise.model_test
09:59:01.447849 [info ] [Thread-1  ]: 6 of 6 START table model zz_xavier.model_test .................................. [RUN]
09:59:01.448485 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
09:59:01.448698 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
09:59:01.448865 [debug] [Thread-1  ]: Compiling model.exercise.model_test
09:59:01.450455 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
09:59:01.451046 [debug] [Thread-1  ]: finished collecting timing info
09:59:01.451237 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
09:59:01.453060 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:59:01.712889 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
09:59:01.713660 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
09:59:05.891116 [debug] [Thread-1  ]: finished collecting timing info
09:59:05.891606 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7eb2a8f-c207-472d-9b22-f99e80a0a3bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c65700>]}
09:59:05.891966 [info ] [Thread-1  ]: 6 of 6 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 4.44s]
09:59:05.892427 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
09:59:05.893511 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:59:05.893894 [info ] [MainThread]: 
09:59:05.894161 [info ] [MainThread]: Finished running 6 table models in 39.70s.
09:59:05.894400 [debug] [MainThread]: Connection 'master' was properly closed.
09:59:05.894535 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
09:59:05.900029 [info ] [MainThread]: 
09:59:05.900309 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:59:05.900577 [info ] [MainThread]: 
09:59:05.900813 [error] [MainThread]: [33mDatabase Error in model ex_2 (models/ex_2.sql)[0m
09:59:05.901039 [error] [MainThread]:   Name install_day not found inside ua at [13:12]
09:59:05.901253 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ex_2.sql
09:59:05.901481 [info ] [MainThread]: 
09:59:05.901706 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
09:59:05.902039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cadd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bcbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a46070>]}


============================== 2022-09-28 09:59:48.169114 | f4acecf9-5280-4be6-a588-02844986fdd3 ==============================
09:59:48.169183 [info ] [MainThread]: Running with dbt=1.1.2
09:59:48.169843 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:59:48.170049 [debug] [MainThread]: Tracking: tracking
09:59:48.181545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae6c880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae6cc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae6cf70>]}
09:59:48.212324 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:59:48.212716 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ex_2.sql
09:59:48.223247 [debug] [MainThread]: 1699: static parser successfully parsed ex_2.sql
09:59:48.238996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f4acecf9-5280-4be6-a588-02844986fdd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afd80d0>]}
09:59:48.243054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f4acecf9-5280-4be6-a588-02844986fdd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aed3ee0>]}
09:59:48.243278 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:59:48.243486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f4acecf9-5280-4be6-a588-02844986fdd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aed3c40>]}
09:59:48.244680 [info ] [MainThread]: 
09:59:48.245096 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:59:48.245923 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:59:48.246136 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:59:49.270860 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:59:49.271410 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:59:49.540002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f4acecf9-5280-4be6-a588-02844986fdd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af917c0>]}
09:59:49.540771 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:59:49.541227 [info ] [MainThread]: 
09:59:49.545270 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_activity
09:59:49.545596 [info ] [Thread-1  ]: 1 of 6 START table model zz_xavier.copy_user_activity .......................... [RUN]
09:59:49.546083 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_activity"
09:59:49.546258 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_activity
09:59:49.546460 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_activity
09:59:49.548339 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_activity"
09:59:49.548801 [debug] [Thread-1  ]: finished collecting timing info
09:59:49.548990 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_activity
09:59:49.565385 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:59:49.900898 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_activity"
09:59:49.901488 [debug] [Thread-1  ]: On model.exercise.copy_user_activity: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_activity"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_activity`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_activity
  );
  
09:59:57.495395 [debug] [Thread-1  ]: finished collecting timing info
09:59:57.495906 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f4acecf9-5280-4be6-a588-02844986fdd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b0a5fd0>]}
09:59:57.496281 [info ] [Thread-1  ]: 1 of 6 OK created table model zz_xavier.copy_user_activity ..................... [[32mCREATE TABLE (10.8m rows, 444.5 MB processed)[0m in 7.95s]
09:59:57.496719 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_activity
09:59:57.496934 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_campaign_spend
09:59:57.497294 [info ] [Thread-1  ]: 2 of 6 START table model zz_xavier.copy_user_campaign_spend .................... [RUN]
09:59:57.497741 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_campaign_spend"
09:59:57.497912 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_campaign_spend
09:59:57.498076 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_campaign_spend
09:59:57.499599 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_campaign_spend"
09:59:57.500080 [debug] [Thread-1  ]: finished collecting timing info
09:59:57.500264 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_campaign_spend
09:59:57.504404 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:59:57.900086 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_campaign_spend"
09:59:57.900876 [debug] [Thread-1  ]: On model.exercise.copy_user_campaign_spend: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_campaign_spend"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_campaign_spend`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_campaign_spend
  );
  
10:00:00.379405 [debug] [Thread-1  ]: finished collecting timing info
10:00:00.379964 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f4acecf9-5280-4be6-a588-02844986fdd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afbb8e0>]}
10:00:00.380383 [info ] [Thread-1  ]: 2 of 6 OK created table model zz_xavier.copy_user_campaign_spend ............... [[32mCREATE TABLE (356.0 rows, 12.2 KB processed)[0m in 2.88s]
10:00:00.380859 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_campaign_spend
10:00:00.381105 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_information
10:00:00.381514 [info ] [Thread-1  ]: 3 of 6 START table model zz_xavier.copy_user_information ....................... [RUN]
10:00:00.382026 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_information"
10:00:00.382224 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_information
10:00:00.382412 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_information
10:00:00.383896 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_information"
10:00:00.384433 [debug] [Thread-1  ]: finished collecting timing info
10:00:00.384629 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_information
10:00:00.386432 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:00:00.678204 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_information"
10:00:00.678872 [debug] [Thread-1  ]: On model.exercise.copy_user_information: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_information"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_information`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_info
  );
  
10:00:04.923224 [debug] [Thread-1  ]: finished collecting timing info
10:00:04.923915 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f4acecf9-5280-4be6-a588-02844986fdd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107720460>]}
10:00:04.924386 [info ] [Thread-1  ]: 3 of 6 OK created table model zz_xavier.copy_user_information .................. [[32mCREATE TABLE (697.0k rows, 19.6 MB processed)[0m in 4.54s]
10:00:04.924983 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_information
10:00:04.925243 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
10:00:04.925653 [info ] [Thread-1  ]: 4 of 6 START table model zz_xavier.ex_2 ........................................ [RUN]
10:00:04.926179 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
10:00:04.926378 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
10:00:04.926572 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
10:00:04.928313 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
10:00:04.928875 [debug] [Thread-1  ]: finished collecting timing info
10:00:04.929073 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
10:00:04.930639 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:00:05.249280 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
10:00:05.250226 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        7 = DATE_DIFF(ua.activity_day,MIN(ua.activity_day) over (partition by ua.user_id order by ua.activity_day ROWS
        BETWEEN 7 PRECEDING AND 0 PRECEDING), DAY) as has_been_active
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_type = 'app_open'
  )

select * from users
  );
  
10:00:14.019601 [debug] [Thread-1  ]: finished collecting timing info
10:00:14.020311 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f4acecf9-5280-4be6-a588-02844986fdd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b0e1d00>]}
10:00:14.020814 [info ] [Thread-1  ]: 4 of 6 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (10.5m rows, 280.0 MB processed)[0m in 9.09s]
10:00:14.021336 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
10:00:14.021581 [debug] [Thread-1  ]: Began running node model.exercise.ex_2_2
10:00:14.022003 [info ] [Thread-1  ]: 5 of 6 START table model zz_xavier.ex_2_2 ...................................... [RUN]
10:00:14.022544 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2_2"
10:00:14.022745 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2_2
10:00:14.022933 [debug] [Thread-1  ]: Compiling model.exercise.ex_2_2
10:00:14.024825 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2_2"
10:00:14.025390 [debug] [Thread-1  ]: finished collecting timing info
10:00:14.025602 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2_2
10:00:14.027486 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:00:14.307557 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2_2"
10:00:14.308369 [debug] [Thread-1  ]: On model.exercise.ex_2_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        ua.activity_type,
        ui.install_day,
        ui.campaign
    from dwh-adev-core.ae_challenge_data.ae_user_activity as ua
        join dwh-adev-core.ae_challenge_data.ae_user_info ui
        on ua.user_id = ui.user_id 
    where ua.activity_type = 'app_open' and DATE_DIFF(ua.activity_day, ui.install_day, DAY) <= 6
  ),

last_played_days as (
  select
  distinct u.user_id,
  u.install_day,
  u.campaign,
  from users u
  where 7 >= (select count(u2.activity_day) from
  users u2 where u.user_id = u2.user_id)
)

select * from last_played_days
  );
  
10:00:34.173806 [debug] [Thread-1  ]: finished collecting timing info
10:00:34.174483 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f4acecf9-5280-4be6-a588-02844986fdd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b08e250>]}
10:00:34.174999 [info ] [Thread-1  ]: 5 of 6 OK created table model zz_xavier.ex_2_2 ................................. [[32mCREATE TABLE (697.0k rows, 299.6 MB processed)[0m in 20.15s]
10:00:34.175508 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2_2
10:00:34.175756 [debug] [Thread-1  ]: Began running node model.exercise.model_test
10:00:34.176194 [info ] [Thread-1  ]: 6 of 6 START table model zz_xavier.model_test .................................. [RUN]
10:00:34.176747 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
10:00:34.176949 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
10:00:34.177138 [debug] [Thread-1  ]: Compiling model.exercise.model_test
10:00:34.179460 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
10:00:34.180000 [debug] [Thread-1  ]: finished collecting timing info
10:00:34.180202 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
10:00:34.183014 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:00:34.441577 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
10:00:34.442378 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
10:00:39.249458 [debug] [Thread-1  ]: finished collecting timing info
10:00:39.250134 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f4acecf9-5280-4be6-a588-02844986fdd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b08e370>]}
10:00:39.250666 [info ] [Thread-1  ]: 6 of 6 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 5.07s]
10:00:39.251156 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
10:00:39.252490 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:00:39.253069 [info ] [MainThread]: 
10:00:39.253427 [info ] [MainThread]: Finished running 6 table models in 51.01s.
10:00:39.253737 [debug] [MainThread]: Connection 'master' was properly closed.
10:00:39.253928 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
10:00:39.260516 [info ] [MainThread]: 
10:00:39.260822 [info ] [MainThread]: [32mCompleted successfully[0m
10:00:39.261133 [info ] [MainThread]: 
10:00:39.261386 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
10:00:39.261759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af6fc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aed3760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b14b2b0>]}


============================== 2022-09-28 10:21:59.899628 | 385c1284-0709-4f7d-a554-f1ce818a8135 ==============================
10:21:59.899675 [info ] [MainThread]: Running with dbt=1.1.2
10:21:59.900347 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:21:59.900555 [debug] [MainThread]: Tracking: tracking
10:21:59.912119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105afe250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105afe460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105afeac0>]}
10:21:59.944503 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 2 files added, 0 files changed.
10:21:59.944793 [debug] [MainThread]: Partial parsing: added file: exercise://models/ex_3.sql
10:21:59.944963 [debug] [MainThread]: Partial parsing: added file: exercise://models/ae_user_info_inc.sql
10:21:59.945078 [debug] [MainThread]: Partial parsing: deleted file: exercise://models/extra/ex_2_2.sql
10:21:59.955155 [debug] [MainThread]: 1699: static parser successfully parsed ex_3.sql
10:21:59.964987 [debug] [MainThread]: 1699: static parser successfully parsed ae_user_info_inc.sql
10:21:59.972919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '385c1284-0709-4f7d-a554-f1ce818a8135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c5e0d0>]}
10:21:59.977122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '385c1284-0709-4f7d-a554-f1ce818a8135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bade50>]}
10:21:59.977347 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:21:59.977593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '385c1284-0709-4f7d-a554-f1ce818a8135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105badd30>]}
10:21:59.978844 [info ] [MainThread]: 
10:21:59.979184 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:21:59.980083 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:21:59.980297 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:22:01.139137 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:22:01.139630 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:22:01.636169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '385c1284-0709-4f7d-a554-f1ce818a8135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105afe370>]}
10:22:01.636905 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:22:01.637288 [info ] [MainThread]: 
10:22:01.641754 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
10:22:01.642103 [info ] [Thread-1  ]: 1 of 7 START table model zz_xavier.ae_user_info_inc ............................ [RUN]
10:22:01.642624 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
10:22:01.642812 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
10:22:01.643023 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
10:22:01.644983 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
10:22:01.645471 [debug] [Thread-1  ]: finished collecting timing info
10:22:01.645669 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
10:22:01.683693 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
10:22:01.684235 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:22:01.684464 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc`
  
  
  OPTIONS()
  as (
    select user_id, min(activity_day) as install_day, 'campaign 1' as campaign from dwh-adev-core.ae_challenge_data.ae_user_activity where user_id = '0' group by user_id
  );
  
10:22:04.841516 [debug] [Thread-1  ]: finished collecting timing info
10:22:04.842075 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385c1284-0709-4f7d-a554-f1ce818a8135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d2bf40>]}
10:22:04.842492 [info ] [Thread-1  ]: 1 of 7 OK created table model zz_xavier.ae_user_info_inc ....................... [[32mCREATE TABLE (1.0 rows, 177.4 MB processed)[0m in 3.20s]
10:22:04.842972 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
10:22:04.843205 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_activity
10:22:04.843624 [info ] [Thread-1  ]: 2 of 7 START table model zz_xavier.copy_user_activity .......................... [RUN]
10:22:04.844112 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_activity"
10:22:04.844297 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_activity
10:22:04.844469 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_activity
10:22:04.846652 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_activity"
10:22:04.847180 [debug] [Thread-1  ]: finished collecting timing info
10:22:04.847375 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_activity
10:22:04.852385 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:22:05.101631 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_activity"
10:22:05.102473 [debug] [Thread-1  ]: On model.exercise.copy_user_activity: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_activity"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_activity`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_activity
  );
  
10:22:13.612751 [debug] [Thread-1  ]: finished collecting timing info
10:22:13.613438 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385c1284-0709-4f7d-a554-f1ce818a8135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d3a790>]}
10:22:13.613927 [info ] [Thread-1  ]: 2 of 7 OK created table model zz_xavier.copy_user_activity ..................... [[32mCREATE TABLE (10.8m rows, 444.5 MB processed)[0m in 8.77s]
10:22:13.614420 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_activity
10:22:13.614744 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_campaign_spend
10:22:13.615118 [info ] [Thread-1  ]: 3 of 7 START table model zz_xavier.copy_user_campaign_spend .................... [RUN]
10:22:13.615768 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_campaign_spend"
10:22:13.615982 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_campaign_spend
10:22:13.616175 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_campaign_spend
10:22:13.617836 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_campaign_spend"
10:22:13.618433 [debug] [Thread-1  ]: finished collecting timing info
10:22:13.618646 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_campaign_spend
10:22:13.620630 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:22:14.041717 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_campaign_spend"
10:22:14.042495 [debug] [Thread-1  ]: On model.exercise.copy_user_campaign_spend: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_campaign_spend"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_campaign_spend`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_campaign_spend
  );
  
10:22:16.720294 [debug] [Thread-1  ]: finished collecting timing info
10:22:16.720979 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385c1284-0709-4f7d-a554-f1ce818a8135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d61490>]}
10:22:16.721501 [info ] [Thread-1  ]: 3 of 7 OK created table model zz_xavier.copy_user_campaign_spend ............... [[32mCREATE TABLE (356.0 rows, 12.2 KB processed)[0m in 3.11s]
10:22:16.722018 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_campaign_spend
10:22:16.722259 [debug] [Thread-1  ]: Began running node model.exercise.copy_user_information
10:22:16.722754 [info ] [Thread-1  ]: 4 of 7 START table model zz_xavier.copy_user_information ....................... [RUN]
10:22:16.723309 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.copy_user_information"
10:22:16.723515 [debug] [Thread-1  ]: Began compiling node model.exercise.copy_user_information
10:22:16.723710 [debug] [Thread-1  ]: Compiling model.exercise.copy_user_information
10:22:16.725623 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.copy_user_information"
10:22:16.726211 [debug] [Thread-1  ]: finished collecting timing info
10:22:16.726420 [debug] [Thread-1  ]: Began executing node model.exercise.copy_user_information
10:22:16.728161 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:22:16.999975 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.copy_user_information"
10:22:17.000779 [debug] [Thread-1  ]: On model.exercise.copy_user_information: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.copy_user_information"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`copy_user_information`
  
  
  OPTIONS()
  as (
    select * from dwh-adev-core.ae_challenge_data.ae_user_info
  );
  
10:22:21.052859 [debug] [Thread-1  ]: finished collecting timing info
10:22:21.053542 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385c1284-0709-4f7d-a554-f1ce818a8135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d99fa0>]}
10:22:21.054077 [info ] [Thread-1  ]: 4 of 7 OK created table model zz_xavier.copy_user_information .................. [[32mCREATE TABLE (697.0k rows, 19.6 MB processed)[0m in 4.33s]
10:22:21.054581 [debug] [Thread-1  ]: Finished running node model.exercise.copy_user_information
10:22:21.054847 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
10:22:21.055250 [info ] [Thread-1  ]: 5 of 7 START table model zz_xavier.ex_2 ........................................ [RUN]
10:22:21.055817 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
10:22:21.056031 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
10:22:21.056233 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
10:22:21.058147 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
10:22:21.058732 [debug] [Thread-1  ]: finished collecting timing info
10:22:21.058950 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
10:22:21.060811 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:22:21.335663 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
10:22:21.336475 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        7 = DATE_DIFF(ua.activity_day,MIN(ua.activity_day) over (partition by ua.user_id order by ua.activity_day ROWS
        BETWEEN 7 PRECEDING AND 0 PRECEDING), DAY) as has_been_active
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_type = 'app_open'
  )

select * from users
  );
  
10:22:30.719779 [debug] [Thread-1  ]: finished collecting timing info
10:22:30.720459 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385c1284-0709-4f7d-a554-f1ce818a8135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d12490>]}
10:22:30.720973 [info ] [Thread-1  ]: 5 of 7 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (10.5m rows, 280.0 MB processed)[0m in 9.66s]
10:22:30.721459 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
10:22:30.721714 [debug] [Thread-1  ]: Began running node model.exercise.ex_3
10:22:30.722147 [info ] [Thread-1  ]: 6 of 7 START table model zz_xavier.ex_3 ........................................ [RUN]
10:22:30.722698 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_3"
10:22:30.722911 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_3
10:22:30.723097 [debug] [Thread-1  ]: Compiling model.exercise.ex_3
10:22:30.724982 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_3"
10:22:30.725565 [debug] [Thread-1  ]: finished collecting timing info
10:22:30.725784 [debug] [Thread-1  ]: Began executing node model.exercise.ex_3
10:22:30.728456 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_3"
10:22:30.728925 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:22:30.729160 [debug] [Thread-1  ]: On model.exercise.ex_3: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_3"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_3`
  
  
  OPTIONS()
  as (
    select user_id, min(activity_day) as install_day, 'campaign 1' as campaign from dwh-adev-core.ae_challenge_data.ae_user_activity where user_id = '0' group by user_id
  );
  
10:22:33.963140 [debug] [Thread-1  ]: finished collecting timing info
10:22:33.963820 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385c1284-0709-4f7d-a554-f1ce818a8135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ddefa0>]}
10:22:33.964484 [info ] [Thread-1  ]: 6 of 7 OK created table model zz_xavier.ex_3 ................................... [[32mCREATE TABLE (1.0 rows, 177.4 MB processed)[0m in 3.24s]
10:22:33.965042 [debug] [Thread-1  ]: Finished running node model.exercise.ex_3
10:22:33.965309 [debug] [Thread-1  ]: Began running node model.exercise.model_test
10:22:33.965697 [info ] [Thread-1  ]: 7 of 7 START table model zz_xavier.model_test .................................. [RUN]
10:22:33.966259 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
10:22:33.966469 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
10:22:33.966667 [debug] [Thread-1  ]: Compiling model.exercise.model_test
10:22:33.968990 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
10:22:33.969567 [debug] [Thread-1  ]: finished collecting timing info
10:22:33.969779 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
10:22:33.972676 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:22:34.359391 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
10:22:34.360176 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
10:22:38.941441 [debug] [Thread-1  ]: finished collecting timing info
10:22:38.942131 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385c1284-0709-4f7d-a554-f1ce818a8135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105def0d0>]}
10:22:38.942644 [info ] [Thread-1  ]: 7 of 7 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 4.98s]
10:22:38.943136 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
10:22:38.944483 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:22:38.945079 [info ] [MainThread]: 
10:22:38.945440 [info ] [MainThread]: Finished running 7 table models in 38.97s.
10:22:38.945756 [debug] [MainThread]: Connection 'master' was properly closed.
10:22:38.945941 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
10:22:38.956760 [info ] [MainThread]: 
10:22:38.957091 [info ] [MainThread]: [32mCompleted successfully[0m
10:22:38.957398 [info ] [MainThread]: 
10:22:38.957652 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
10:22:38.958019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c37dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c370a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105dfb2b0>]}


============================== 2022-09-28 10:43:31.479833 | f6b541fd-9d91-4699-948a-db79ced87049 ==============================
10:43:31.479884 [info ] [MainThread]: Running with dbt=1.1.2
10:43:31.480439 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:43:31.480669 [debug] [MainThread]: Tracking: tracking
10:43:31.492400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e8bb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e8be50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e8bdc0>]}
10:43:31.525074 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 0 files added, 1 files changed.
10:43:31.525283 [debug] [MainThread]: Partial parsing: deleted file: exercise://models/copy_user_information.sql
10:43:31.525395 [debug] [MainThread]: Partial parsing: deleted file: exercise://models/copy_user_activity.sql
10:43:31.525495 [debug] [MainThread]: Partial parsing: deleted file: exercise://models/copy_user_campaign_spend.sql
10:43:31.525592 [debug] [MainThread]: Partial parsing: deleted file: exercise://models/ex_3.sql
10:43:31.525835 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
10:43:31.536545 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
10:43:31.556171 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
10:43:31.563372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f6b541fd-9d91-4699-948a-db79ced87049', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11100e0d0>]}
10:43:31.567409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f6b541fd-9d91-4699-948a-db79ced87049', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fadda00>]}
10:43:31.567647 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:43:31.567962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f6b541fd-9d91-4699-948a-db79ced87049', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e77790>]}
10:43:31.569180 [info ] [MainThread]: 
10:43:31.569533 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:43:31.570315 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:43:31.570528 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:43:32.686233 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:43:32.686759 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:43:32.979950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f6b541fd-9d91-4699-948a-db79ced87049', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e5a790>]}
10:43:32.980853 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:43:32.981220 [info ] [MainThread]: 
10:43:32.985538 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
10:43:32.985900 [info ] [Thread-1  ]: 1 of 3 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
10:43:32.986415 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
10:43:32.986603 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
10:43:32.986832 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
10:43:32.993461 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
10:43:32.993991 [debug] [Thread-1  ]: finished collecting timing info
10:43:32.994183 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
10:43:33.029518 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:43:33.328575 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
10:43:33.329187 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity 
    where activity_day <= 2021-09-01
    group by user_id



    where install_day >= (select max(install_day) from `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc`


        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
10:43:33.653326 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword WHERE at [24:5]')
10:43:34.915381 [debug] [Thread-1  ]: finished collecting timing info
10:43:34.916007 [debug] [Thread-1  ]: Database Error in model ae_user_info_inc (models/ae_user_info_inc.sql)
  Syntax error: Expected ")" but got keyword WHERE at [24:5]
  compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
10:43:34.916450 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6b541fd-9d91-4699-948a-db79ced87049', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110f8dc0>]}
10:43:34.916980 [error] [Thread-1  ]: 1 of 3 ERROR creating incremental model zz_xavier.ae_user_info_inc ............. [[31mERROR[0m in 1.93s]
10:43:34.917551 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
10:43:34.917812 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
10:43:34.918327 [info ] [Thread-1  ]: 2 of 3 START table model zz_xavier.ex_2 ........................................ [RUN]
10:43:34.918875 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
10:43:34.919087 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
10:43:34.919302 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
10:43:34.923921 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
10:43:34.924452 [debug] [Thread-1  ]: finished collecting timing info
10:43:34.924660 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
10:43:34.938396 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:43:35.257301 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
10:43:35.257878 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        7 = DATE_DIFF(ua.activity_day,MIN(ua.activity_day) over (partition by ua.user_id order by ua.activity_day ROWS
        BETWEEN 7 PRECEDING AND 0 PRECEDING), DAY) as has_been_active
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_type = 'app_open'
  )

select * from users
  );
  
10:43:43.766156 [debug] [Thread-1  ]: finished collecting timing info
10:43:43.766706 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6b541fd-9d91-4699-948a-db79ced87049', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111082280>]}
10:43:43.767127 [info ] [Thread-1  ]: 2 of 3 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (10.5m rows, 280.0 MB processed)[0m in 8.85s]
10:43:43.767588 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
10:43:43.767823 [debug] [Thread-1  ]: Began running node model.exercise.model_test
10:43:43.768273 [info ] [Thread-1  ]: 3 of 3 START table model zz_xavier.model_test .................................. [RUN]
10:43:43.768791 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
10:43:43.768985 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
10:43:43.769164 [debug] [Thread-1  ]: Compiling model.exercise.model_test
10:43:43.770912 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
10:43:43.771452 [debug] [Thread-1  ]: finished collecting timing info
10:43:43.771649 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
10:43:43.773441 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:43:44.069208 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
10:43:44.070016 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
10:43:49.049825 [debug] [Thread-1  ]: finished collecting timing info
10:43:49.050518 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6b541fd-9d91-4699-948a-db79ced87049', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110823a0>]}
10:43:49.051023 [info ] [Thread-1  ]: 3 of 3 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 5.28s]
10:43:49.051501 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
10:43:49.052783 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:43:49.053307 [info ] [MainThread]: 
10:43:49.053665 [info ] [MainThread]: Finished running 1 incremental model, 2 table models in 17.48s.
10:43:49.053971 [debug] [MainThread]: Connection 'master' was properly closed.
10:43:49.054143 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
10:43:49.060012 [info ] [MainThread]: 
10:43:49.060317 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
10:43:49.060609 [info ] [MainThread]: 
10:43:49.060861 [error] [MainThread]: [33mDatabase Error in model ae_user_info_inc (models/ae_user_info_inc.sql)[0m
10:43:49.061100 [error] [MainThread]:   Syntax error: Expected ")" but got keyword WHERE at [24:5]
10:43:49.061327 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
10:43:49.061566 [info ] [MainThread]: 
10:43:49.061804 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
10:43:49.062169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f3b8b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f3bbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111189730>]}


============================== 2022-09-28 10:45:15.572485 | e471d400-0d57-4aa1-b032-0a60c50efe30 ==============================
10:45:15.572521 [info ] [MainThread]: Running with dbt=1.1.2
10:45:15.573075 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:45:15.573225 [debug] [MainThread]: Tracking: tracking
10:45:15.585382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e101d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e101af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e101700>]}
10:45:15.621987 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:45:15.622384 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
10:45:15.632812 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
10:45:15.647792 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
10:45:15.654466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e471d400-0d57-4aa1-b032-0a60c50efe30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e2730d0>]}
10:45:15.658864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e471d400-0d57-4aa1-b032-0a60c50efe30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e206dc0>]}
10:45:15.659115 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:45:15.659380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e471d400-0d57-4aa1-b032-0a60c50efe30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e206f40>]}
10:45:15.660542 [info ] [MainThread]: 
10:45:15.660970 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:45:15.661660 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:45:15.661882 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:45:16.728099 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:45:16.728675 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:45:17.016463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e471d400-0d57-4aa1-b032-0a60c50efe30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0e1400>]}
10:45:17.017290 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:45:17.017672 [info ] [MainThread]: 
10:45:17.022051 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
10:45:17.022446 [info ] [Thread-1  ]: 1 of 3 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
10:45:17.022992 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
10:45:17.023177 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
10:45:17.023382 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
10:45:17.029957 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
10:45:17.030485 [debug] [Thread-1  ]: finished collecting timing info
10:45:17.030682 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
10:45:17.066934 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:45:17.534356 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
10:45:17.534973 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity 



    where install_day >= '2021-09-05'


group by user_id
        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
10:45:18.920628 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: install_day at [22:11]')
10:45:21.335769 [debug] [Thread-1  ]: finished collecting timing info
10:45:21.336399 [debug] [Thread-1  ]: Database Error in model ae_user_info_inc (models/ae_user_info_inc.sql)
  Unrecognized name: install_day at [22:11]
  compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
10:45:21.336849 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e471d400-0d57-4aa1-b032-0a60c50efe30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e3c61f0>]}
10:45:21.337382 [error] [Thread-1  ]: 1 of 3 ERROR creating incremental model zz_xavier.ae_user_info_inc ............. [[31mERROR[0m in 4.31s]
10:45:21.337951 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
10:45:21.338211 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
10:45:21.338758 [info ] [Thread-1  ]: 2 of 3 START table model zz_xavier.ex_2 ........................................ [RUN]
10:45:21.339315 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
10:45:21.339531 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
10:45:21.339734 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
10:45:21.344433 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
10:45:21.344995 [debug] [Thread-1  ]: finished collecting timing info
10:45:21.345205 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
10:45:21.359479 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:45:21.713834 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
10:45:21.714425 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        7 = DATE_DIFF(ua.activity_day,MIN(ua.activity_day) over (partition by ua.user_id order by ua.activity_day ROWS
        BETWEEN 7 PRECEDING AND 0 PRECEDING), DAY) as has_been_active
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_type = 'app_open'
  )

select * from users
  );
  
10:45:32.846015 [debug] [Thread-1  ]: finished collecting timing info
10:45:32.846577 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e471d400-0d57-4aa1-b032-0a60c50efe30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e306160>]}
10:45:32.847033 [info ] [Thread-1  ]: 2 of 3 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (10.5m rows, 280.0 MB processed)[0m in 11.51s]
10:45:32.847489 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
10:45:32.847726 [debug] [Thread-1  ]: Began running node model.exercise.model_test
10:45:32.848118 [info ] [Thread-1  ]: 3 of 3 START table model zz_xavier.model_test .................................. [RUN]
10:45:32.848616 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
10:45:32.848796 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
10:45:32.848969 [debug] [Thread-1  ]: Compiling model.exercise.model_test
10:45:32.850737 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
10:45:32.851293 [debug] [Thread-1  ]: finished collecting timing info
10:45:32.851498 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
10:45:32.853333 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:45:33.110129 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
10:45:33.110953 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
10:45:37.673951 [debug] [Thread-1  ]: finished collecting timing info
10:45:37.674619 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e471d400-0d57-4aa1-b032-0a60c50efe30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e3061f0>]}
10:45:37.675130 [info ] [Thread-1  ]: 3 of 3 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 4.83s]
10:45:37.675613 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
10:45:37.676919 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:45:37.677411 [info ] [MainThread]: 
10:45:37.677886 [info ] [MainThread]: Finished running 1 incremental model, 2 table models in 22.02s.
10:45:37.678187 [debug] [MainThread]: Connection 'master' was properly closed.
10:45:37.678351 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
10:45:37.684736 [info ] [MainThread]: 
10:45:37.685052 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
10:45:37.685342 [info ] [MainThread]: 
10:45:37.685593 [error] [MainThread]: [33mDatabase Error in model ae_user_info_inc (models/ae_user_info_inc.sql)[0m
10:45:37.685847 [error] [MainThread]:   Unrecognized name: install_day at [22:11]
10:45:37.686065 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
10:45:37.686297 [info ] [MainThread]: 
10:45:37.686557 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
10:45:37.686926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0fd760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e206bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e412e20>]}


============================== 2022-09-28 10:47:06.678640 | 77c25f42-df98-480d-935c-a8a2ac7054d2 ==============================
10:47:06.678701 [info ] [MainThread]: Running with dbt=1.1.2
10:47:06.679554 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:47:06.679789 [debug] [MainThread]: Tracking: tracking
10:47:06.691675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ee95880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ee95e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ee95f70>]}
10:47:06.724380 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:47:06.724724 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
10:47:06.734552 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
10:47:06.748903 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
10:47:06.755157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '77c25f42-df98-480d-935c-a8a2ac7054d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f0090d0>]}
10:47:06.759232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '77c25f42-df98-480d-935c-a8a2ac7054d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ef9a9a0>]}
10:47:06.759457 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:47:06.759670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '77c25f42-df98-480d-935c-a8a2ac7054d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dacb9a0>]}
10:47:06.760743 [info ] [MainThread]: 
10:47:06.761082 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:47:06.761717 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:47:06.762032 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:47:07.911420 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:47:07.911938 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:47:08.238504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '77c25f42-df98-480d-935c-a8a2ac7054d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ee76ac0>]}
10:47:08.239388 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:47:08.239895 [info ] [MainThread]: 
10:47:08.244163 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
10:47:08.244566 [info ] [Thread-1  ]: 1 of 3 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
10:47:08.245119 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
10:47:08.245315 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
10:47:08.245536 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
10:47:08.252371 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
10:47:08.252886 [debug] [Thread-1  ]: finished collecting timing info
10:47:08.253077 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
10:47:08.288973 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:47:08.657353 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
10:47:08.657943 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity 



    where install_day >= '2021-09-05' from `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc`


group by user_id
        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
10:47:08.930604 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword FROM at [23:39]')
10:47:10.195015 [debug] [Thread-1  ]: finished collecting timing info
10:47:10.195672 [debug] [Thread-1  ]: Database Error in model ae_user_info_inc (models/ae_user_info_inc.sql)
  Syntax error: Expected ")" but got keyword FROM at [23:39]
  compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
10:47:10.196123 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77c25f42-df98-480d-935c-a8a2ac7054d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f112e50>]}
10:47:10.196675 [error] [Thread-1  ]: 1 of 3 ERROR creating incremental model zz_xavier.ae_user_info_inc ............. [[31mERROR[0m in 1.95s]
10:47:10.197244 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
10:47:10.197510 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
10:47:10.197796 [info ] [Thread-1  ]: 2 of 3 START table model zz_xavier.ex_2 ........................................ [RUN]
10:47:10.198337 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
10:47:10.198737 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
10:47:10.198970 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
10:47:10.203569 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
10:47:10.204111 [debug] [Thread-1  ]: finished collecting timing info
10:47:10.204321 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
10:47:10.218288 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:47:10.525558 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
10:47:10.526134 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        7 = DATE_DIFF(ua.activity_day,MIN(ua.activity_day) over (partition by ua.user_id order by ua.activity_day ROWS
        BETWEEN 7 PRECEDING AND 0 PRECEDING), DAY) as has_been_active
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_type = 'app_open'
  )

select * from users
  );
  
10:47:18.704666 [debug] [Thread-1  ]: finished collecting timing info
10:47:18.705219 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77c25f42-df98-480d-935c-a8a2ac7054d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f116a60>]}
10:47:18.705637 [info ] [Thread-1  ]: 2 of 3 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (10.5m rows, 280.0 MB processed)[0m in 8.51s]
10:47:18.706098 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
10:47:18.706341 [debug] [Thread-1  ]: Began running node model.exercise.model_test
10:47:18.706752 [info ] [Thread-1  ]: 3 of 3 START table model zz_xavier.model_test .................................. [RUN]
10:47:18.707260 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
10:47:18.707464 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
10:47:18.707641 [debug] [Thread-1  ]: Compiling model.exercise.model_test
10:47:18.709357 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
10:47:18.709902 [debug] [Thread-1  ]: finished collecting timing info
10:47:18.710096 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
10:47:18.711860 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:47:19.013554 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
10:47:19.014356 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
10:47:24.054556 [debug] [Thread-1  ]: finished collecting timing info
10:47:24.055034 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77c25f42-df98-480d-935c-a8a2ac7054d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f1a0fa0>]}
10:47:24.055384 [info ] [Thread-1  ]: 3 of 3 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 5.35s]
10:47:24.055776 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
10:47:24.056837 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:47:24.057209 [info ] [MainThread]: 
10:47:24.057475 [info ] [MainThread]: Finished running 1 incremental model, 2 table models in 17.30s.
10:47:24.057719 [debug] [MainThread]: Connection 'master' was properly closed.
10:47:24.057859 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
10:47:24.063245 [info ] [MainThread]: 
10:47:24.063525 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
10:47:24.063800 [info ] [MainThread]: 
10:47:24.064039 [error] [MainThread]: [33mDatabase Error in model ae_user_info_inc (models/ae_user_info_inc.sql)[0m
10:47:24.064266 [error] [MainThread]:   Syntax error: Expected ")" but got keyword FROM at [23:39]
10:47:24.064481 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
10:47:24.064704 [info ] [MainThread]: 
10:47:24.064928 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
10:47:24.065264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ef500a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ef9ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f1a5fa0>]}


============================== 2022-09-28 10:50:27.787157 | 49135382-98db-4717-864c-059384702c90 ==============================
10:50:27.787187 [info ] [MainThread]: Running with dbt=1.1.2
10:50:27.787952 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:50:27.788180 [debug] [MainThread]: Tracking: tracking
10:50:27.799897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a0dcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116ab070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a0db80>]}
10:50:27.831358 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:50:27.831799 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
10:50:27.841877 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
10:50:27.856085 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
10:50:27.862274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '49135382-98db-4717-864c-059384702c90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b830d0>]}
10:50:27.866201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '49135382-98db-4717-864c-059384702c90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b17df0>]}
10:50:27.866423 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:50:27.866678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49135382-98db-4717-864c-059384702c90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b0fe80>]}
10:50:27.867828 [info ] [MainThread]: 
10:50:27.868166 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:50:27.868860 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:50:27.869011 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:50:28.950457 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:50:28.950983 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:50:29.227635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49135382-98db-4717-864c-059384702c90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111666df0>]}
10:50:29.228347 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:50:29.228802 [info ] [MainThread]: 
10:50:29.233375 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
10:50:29.233948 [info ] [Thread-1  ]: 1 of 3 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
10:50:29.234517 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
10:50:29.234709 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
10:50:29.234924 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
10:50:29.243478 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
10:50:29.244248 [debug] [Thread-1  ]: finished collecting timing info
10:50:29.244544 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
10:50:29.288810 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:50:29.573976 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
10:50:29.574574 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity 



    where activity_day >= '2021-09-05'


group by user_id
        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
10:50:44.941697 [debug] [Thread-1  ]: finished collecting timing info
10:50:44.942228 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49135382-98db-4717-864c-059384702c90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c155e0>]}
10:50:44.942642 [info ] [Thread-1  ]: 1 of 3 OK created incremental model zz_xavier.ae_user_info_inc ................. [[32mMERGE (676.0k rows, 177.4 MB processed)[0m in 15.71s]
10:50:44.943116 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
10:50:44.943347 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
10:50:44.943775 [info ] [Thread-1  ]: 2 of 3 START table model zz_xavier.ex_2 ........................................ [RUN]
10:50:44.944300 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
10:50:44.944484 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
10:50:44.944656 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
10:50:44.949227 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
10:50:44.949740 [debug] [Thread-1  ]: finished collecting timing info
10:50:44.949931 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
10:50:44.964116 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:50:45.295522 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
10:50:45.296112 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        7 = DATE_DIFF(ua.activity_day,MIN(ua.activity_day) over (partition by ua.user_id order by ua.activity_day ROWS
        BETWEEN 7 PRECEDING AND 0 PRECEDING), DAY) as has_been_active
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_type = 'app_open'
  )

select * from users
  );
  
10:50:53.753891 [debug] [Thread-1  ]: finished collecting timing info
10:50:53.754468 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49135382-98db-4717-864c-059384702c90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c150d0>]}
10:50:53.754903 [info ] [Thread-1  ]: 2 of 3 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (10.5m rows, 280.0 MB processed)[0m in 8.81s]
10:50:53.755449 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
10:50:53.755808 [debug] [Thread-1  ]: Began running node model.exercise.model_test
10:50:53.756208 [info ] [Thread-1  ]: 3 of 3 START table model zz_xavier.model_test .................................. [RUN]
10:50:53.756981 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
10:50:53.757263 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
10:50:53.757448 [debug] [Thread-1  ]: Compiling model.exercise.model_test
10:50:53.759060 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
10:50:53.759537 [debug] [Thread-1  ]: finished collecting timing info
10:50:53.759728 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
10:50:53.761287 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:50:54.061487 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
10:50:54.062079 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
10:50:59.306662 [debug] [Thread-1  ]: finished collecting timing info
10:50:59.307233 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49135382-98db-4717-864c-059384702c90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c15280>]}
10:50:59.307673 [info ] [Thread-1  ]: 3 of 3 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 5.55s]
10:50:59.308150 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
10:50:59.309338 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:50:59.309758 [info ] [MainThread]: 
10:50:59.310048 [info ] [MainThread]: Finished running 1 incremental model, 2 table models in 31.44s.
10:50:59.310300 [debug] [MainThread]: Connection 'master' was properly closed.
10:50:59.310444 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
10:50:59.315913 [info ] [MainThread]: 
10:50:59.316203 [info ] [MainThread]: [32mCompleted successfully[0m
10:50:59.316491 [info ] [MainThread]: 
10:50:59.316747 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
10:50:59.317264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b17940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b17b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112cfe160>]}


============================== 2022-09-28 10:52:40.961780 | c3d7c2b4-3368-4140-ba87-ba369425608b ==============================
10:52:40.961812 [info ] [MainThread]: Running with dbt=1.1.2
10:52:40.962547 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:52:40.962735 [debug] [MainThread]: Tracking: tracking
10:52:40.974334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f2b58b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f2b5460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f2b5c40>]}
10:52:41.006783 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:52:41.007154 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
10:52:41.017163 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
10:52:41.031642 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
10:52:41.037844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c3d7c2b4-3368-4140-ba87-ba369425608b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f4170d0>]}
10:52:41.041848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c3d7c2b4-3368-4140-ba87-ba369425608b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f285c40>]}
10:52:41.042077 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:52:41.042290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c3d7c2b4-3368-4140-ba87-ba369425608b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f3a3e20>]}
10:52:41.043358 [info ] [MainThread]: 
10:52:41.043700 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:52:41.044358 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:52:41.044588 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:52:42.162246 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:52:42.162915 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:52:42.461190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c3d7c2b4-3368-4140-ba87-ba369425608b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f359100>]}
10:52:42.462130 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:52:42.462524 [info ] [MainThread]: 
10:52:42.466887 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
10:52:42.467287 [info ] [Thread-1  ]: 1 of 3 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
10:52:42.467841 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
10:52:42.468036 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
10:52:42.468249 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
10:52:42.472390 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
10:52:42.472891 [debug] [Thread-1  ]: finished collecting timing info
10:52:42.473083 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
10:52:42.530955 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
10:52:42.531473 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:52:42.531689 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc`
  
  
  OPTIONS()
  as (
    

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity 


group by user_id
  );
  
10:52:50.401801 [debug] [Thread-1  ]: finished collecting timing info
10:52:50.402361 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3d7c2b4-3368-4140-ba87-ba369425608b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f50ecd0>]}
10:52:50.402765 [info ] [Thread-1  ]: 1 of 3 OK created incremental model zz_xavier.ae_user_info_inc ................. [[32mCREATE TABLE (697.0k rows, 177.4 MB processed)[0m in 7.93s]
10:52:50.403233 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
10:52:50.403463 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
10:52:50.403830 [info ] [Thread-1  ]: 2 of 3 START table model zz_xavier.ex_2 ........................................ [RUN]
10:52:50.404332 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
10:52:50.404530 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
10:52:50.404707 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
10:52:50.409008 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
10:52:50.409501 [debug] [Thread-1  ]: finished collecting timing info
10:52:50.409686 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
10:52:50.423808 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:52:50.714713 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
10:52:50.715515 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        7 = DATE_DIFF(ua.activity_day,MIN(ua.activity_day) over (partition by ua.user_id order by ua.activity_day ROWS
        BETWEEN 7 PRECEDING AND 0 PRECEDING), DAY) as has_been_active
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_type = 'app_open'
  )

select * from users
  );
  
10:52:59.723308 [debug] [Thread-1  ]: finished collecting timing info
10:52:59.723994 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3d7c2b4-3368-4140-ba87-ba369425608b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f499f40>]}
10:52:59.724512 [info ] [Thread-1  ]: 2 of 3 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (10.5m rows, 280.0 MB processed)[0m in 9.32s]
10:52:59.725014 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
10:52:59.725283 [debug] [Thread-1  ]: Began running node model.exercise.model_test
10:52:59.725698 [info ] [Thread-1  ]: 3 of 3 START table model zz_xavier.model_test .................................. [RUN]
10:52:59.726272 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
10:52:59.726474 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
10:52:59.726662 [debug] [Thread-1  ]: Compiling model.exercise.model_test
10:52:59.728808 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
10:52:59.729337 [debug] [Thread-1  ]: finished collecting timing info
10:52:59.729540 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
10:52:59.732452 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:53:00.053962 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
10:53:00.054632 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
10:53:04.741743 [debug] [Thread-1  ]: finished collecting timing info
10:53:04.742427 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3d7c2b4-3368-4140-ba87-ba369425608b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f56a2b0>]}
10:53:04.742943 [info ] [Thread-1  ]: 3 of 3 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 5.02s]
10:53:04.743429 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
10:53:04.744634 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:53:04.745096 [info ] [MainThread]: 
10:53:04.745418 [info ] [MainThread]: Finished running 1 incremental model, 2 table models in 23.70s.
10:53:04.745709 [debug] [MainThread]: Connection 'master' was properly closed.
10:53:04.745872 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
10:53:04.751861 [info ] [MainThread]: 
10:53:04.752183 [info ] [MainThread]: [32mCompleted successfully[0m
10:53:04.752479 [info ] [MainThread]: 
10:53:04.752723 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
10:53:04.753084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f3590d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f3abc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f588d60>]}


============================== 2022-09-28 10:56:54.492015 | 70918013-eb49-4ad8-b098-3573b6d7b740 ==============================
10:56:54.492036 [info ] [MainThread]: Running with dbt=1.1.2
10:56:54.492585 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:56:54.492841 [debug] [MainThread]: Tracking: tracking
10:56:54.504663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096a9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096a9f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096a9370>]}
10:56:54.536934 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:56:54.537270 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
10:56:54.547088 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
10:56:54.561526 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
10:56:54.567749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '70918013-eb49-4ad8-b098-3573b6d7b740', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10981b0d0>]}
10:56:54.571800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '70918013-eb49-4ad8-b098-3573b6d7b740', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097a5df0>]}
10:56:54.572024 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:56:54.572237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '70918013-eb49-4ad8-b098-3573b6d7b740', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10967d850>]}
10:56:54.573335 [info ] [MainThread]: 
10:56:54.573673 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:56:54.574623 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:56:54.574979 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:56:55.647619 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:56:55.648109 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:56:55.928016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '70918013-eb49-4ad8-b098-3573b6d7b740', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096898b0>]}
10:56:55.928891 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:56:55.929340 [info ] [MainThread]: 
10:56:55.933604 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
10:56:55.933994 [info ] [Thread-1  ]: 1 of 3 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
10:56:55.934536 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
10:56:55.934724 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
10:56:55.934943 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
10:56:55.939185 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
10:56:55.939666 [debug] [Thread-1  ]: finished collecting timing info
10:56:55.939858 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
10:56:55.997537 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
10:56:55.998051 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:56:55.998259 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc`
  
  
  OPTIONS()
  as (
    

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity 
    where activity_day <= '2021-09-05'
    group by user_id


  );
  
10:56:59.821471 [debug] [Thread-1  ]: finished collecting timing info
10:56:59.822015 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70918013-eb49-4ad8-b098-3573b6d7b740', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109913cd0>]}
10:56:59.822436 [info ] [Thread-1  ]: 1 of 3 OK created incremental model zz_xavier.ae_user_info_inc ................. [[32mCREATE TABLE (199.3k rows, 177.4 MB processed)[0m in 3.89s]
10:56:59.822908 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
10:56:59.823140 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
10:56:59.823516 [info ] [Thread-1  ]: 2 of 3 START table model zz_xavier.ex_2 ........................................ [RUN]
10:56:59.824001 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
10:56:59.824200 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
10:56:59.824369 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
10:56:59.828874 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
10:56:59.829392 [debug] [Thread-1  ]: finished collecting timing info
10:56:59.829580 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
10:56:59.844399 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:57:00.201981 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
10:57:00.202749 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        7 = DATE_DIFF(ua.activity_day,MIN(ua.activity_day) over (partition by ua.user_id order by ua.activity_day ROWS
        BETWEEN 7 PRECEDING AND 0 PRECEDING), DAY) as has_been_active
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_type = 'app_open'
  )

select * from users
  );
  
10:57:08.789246 [debug] [Thread-1  ]: finished collecting timing info
10:57:08.789890 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70918013-eb49-4ad8-b098-3573b6d7b740', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10989ff40>]}
10:57:08.790333 [info ] [Thread-1  ]: 2 of 3 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (10.5m rows, 280.0 MB processed)[0m in 8.97s]
10:57:08.790828 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
10:57:08.791093 [debug] [Thread-1  ]: Began running node model.exercise.model_test
10:57:08.791535 [info ] [Thread-1  ]: 3 of 3 START table model zz_xavier.model_test .................................. [RUN]
10:57:08.792084 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
10:57:08.792288 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
10:57:08.792479 [debug] [Thread-1  ]: Compiling model.exercise.model_test
10:57:08.794741 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
10:57:08.795337 [debug] [Thread-1  ]: finished collecting timing info
10:57:08.795552 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
10:57:08.798484 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:57:09.129127 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
10:57:09.129951 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
10:57:13.749246 [debug] [Thread-1  ]: finished collecting timing info
10:57:13.751755 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70918013-eb49-4ad8-b098-3573b6d7b740', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10996bcd0>]}
10:57:13.752301 [info ] [Thread-1  ]: 3 of 3 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 4.96s]
10:57:13.752876 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
10:57:13.754245 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:57:13.754830 [info ] [MainThread]: 
10:57:13.755168 [info ] [MainThread]: Finished running 1 incremental model, 2 table models in 19.18s.
10:57:13.755524 [debug] [MainThread]: Connection 'master' was properly closed.
10:57:13.755832 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
10:57:13.761694 [info ] [MainThread]: 
10:57:13.762014 [info ] [MainThread]: [32mCompleted successfully[0m
10:57:13.762308 [info ] [MainThread]: 
10:57:13.762546 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
10:57:13.762901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097ae370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097aeaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10998bdf0>]}


============================== 2022-09-28 10:58:10.830688 | 560e8930-27be-4603-beb9-f016773718a0 ==============================
10:58:10.830739 [info ] [MainThread]: Running with dbt=1.1.2
10:58:10.831263 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:58:10.831476 [debug] [MainThread]: Tracking: tracking
10:58:10.843166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e893460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e893cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e893be0>]}
10:58:10.877960 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:58:10.878340 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
10:58:10.888283 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
10:58:10.902772 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
10:58:10.908991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '560e8930-27be-4603-beb9-f016773718a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea080d0>]}
10:58:10.912916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '560e8930-27be-4603-beb9-f016773718a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e997ee0>]}
10:58:10.913150 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:58:10.913364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '560e8930-27be-4603-beb9-f016773718a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e98ee50>]}
10:58:10.914454 [info ] [MainThread]: 
10:58:10.914797 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:58:10.915445 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:58:10.915601 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:58:11.983674 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:58:11.984159 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:58:12.290185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '560e8930-27be-4603-beb9-f016773718a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8e1a00>]}
10:58:12.291075 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:58:12.291501 [info ] [MainThread]: 
10:58:12.295470 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
10:58:12.295809 [info ] [Thread-1  ]: 1 of 3 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
10:58:12.296300 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
10:58:12.296513 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
10:58:12.296729 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
10:58:12.303343 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
10:58:12.303847 [debug] [Thread-1  ]: finished collecting timing info
10:58:12.304040 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
10:58:12.340564 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:58:12.639611 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
10:58:12.640219 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity 
    where activity_day <= '2021-09-06'
    group by user_id



    where install_day >= (select max(install_day) from `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc`


        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
10:58:12.921104 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword WHERE at [25:5]')
10:58:14.178412 [debug] [Thread-1  ]: finished collecting timing info
10:58:14.179036 [debug] [Thread-1  ]: Database Error in model ae_user_info_inc (models/ae_user_info_inc.sql)
  Syntax error: Expected ")" but got keyword WHERE at [25:5]
  compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
10:58:14.179475 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '560e8930-27be-4603-beb9-f016773718a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eb0ebe0>]}
10:58:14.180010 [error] [Thread-1  ]: 1 of 3 ERROR creating incremental model zz_xavier.ae_user_info_inc ............. [[31mERROR[0m in 1.88s]
10:58:14.180594 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
10:58:14.180850 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
10:58:14.181140 [info ] [Thread-1  ]: 2 of 3 START table model zz_xavier.ex_2 ........................................ [RUN]
10:58:14.181861 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
10:58:14.182076 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
10:58:14.182271 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
10:58:14.186783 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
10:58:14.187314 [debug] [Thread-1  ]: finished collecting timing info
10:58:14.187530 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
10:58:14.201033 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:58:14.553659 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
10:58:14.554233 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        7 = DATE_DIFF(ua.activity_day,MIN(ua.activity_day) over (partition by ua.user_id order by ua.activity_day ROWS
        BETWEEN 7 PRECEDING AND 0 PRECEDING), DAY) as has_been_active
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_type = 'app_open'
  )

select * from users
  );
  
10:58:22.939021 [debug] [Thread-1  ]: finished collecting timing info
10:58:22.939592 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '560e8930-27be-4603-beb9-f016773718a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eb3b340>]}
10:58:22.939990 [info ] [Thread-1  ]: 2 of 3 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (10.5m rows, 280.0 MB processed)[0m in 8.76s]
10:58:22.940426 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
10:58:22.940706 [debug] [Thread-1  ]: Began running node model.exercise.model_test
10:58:22.941135 [info ] [Thread-1  ]: 3 of 3 START table model zz_xavier.model_test .................................. [RUN]
10:58:22.941640 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
10:58:22.941829 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
10:58:22.942008 [debug] [Thread-1  ]: Compiling model.exercise.model_test
10:58:22.943800 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
10:58:22.944322 [debug] [Thread-1  ]: finished collecting timing info
10:58:22.944515 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
10:58:22.946264 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:58:23.252668 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
10:58:23.253449 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
10:58:27.861158 [debug] [Thread-1  ]: finished collecting timing info
10:58:27.861730 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '560e8930-27be-4603-beb9-f016773718a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea962b0>]}
10:58:27.862126 [info ] [Thread-1  ]: 3 of 3 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 4.92s]
10:58:27.862550 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
10:58:27.863696 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:58:27.864100 [info ] [MainThread]: 
10:58:27.864464 [info ] [MainThread]: Finished running 1 incremental model, 2 table models in 16.95s.
10:58:27.864719 [debug] [MainThread]: Connection 'master' was properly closed.
10:58:27.864883 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
10:58:27.870593 [info ] [MainThread]: 
10:58:27.870899 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
10:58:27.871190 [info ] [MainThread]: 
10:58:27.871437 [error] [MainThread]: [33mDatabase Error in model ae_user_info_inc (models/ae_user_info_inc.sql)[0m
10:58:27.871673 [error] [MainThread]:   Syntax error: Expected ")" but got keyword WHERE at [25:5]
10:58:27.871895 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
10:58:27.872125 [info ] [MainThread]: 
10:58:27.872356 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
10:58:27.872705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e9504f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e997b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eba1e50>]}


============================== 2022-09-28 10:59:52.160631 | dc755fce-cae2-44f9-a572-4e9ee5919d63 ==============================
10:59:52.160652 [info ] [MainThread]: Running with dbt=1.1.2
10:59:52.161196 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'exclude': ['ex_2.sql', 'model_test.sql'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:59:52.161392 [debug] [MainThread]: Tracking: tracking
10:59:52.173136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053da790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053dae80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053dac10>]}
10:59:52.204149 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:59:52.204519 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
10:59:52.214437 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
10:59:52.228340 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
10:59:52.234578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dc755fce-cae2-44f9-a572-4e9ee5919d63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10553d0d0>]}
10:59:52.238427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dc755fce-cae2-44f9-a572-4e9ee5919d63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054cb9a0>]}
10:59:52.238646 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:59:52.238855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc755fce-cae2-44f9-a572-4e9ee5919d63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054c6fd0>]}
10:59:52.239391 [warn ] [MainThread]: The selection criterion 'ex_2.sql' does not match any nodes
10:59:52.239625 [warn ] [MainThread]: The selection criterion 'model_test.sql' does not match any nodes
10:59:52.240448 [info ] [MainThread]: 
10:59:52.240783 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:59:52.241438 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:59:52.241892 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:59:53.349793 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:59:53.350303 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:59:53.634229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc755fce-cae2-44f9-a572-4e9ee5919d63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053daa00>]}
10:59:53.635127 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:59:53.635519 [info ] [MainThread]: 
10:59:53.639748 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
10:59:53.640136 [info ] [Thread-1  ]: 1 of 3 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
10:59:53.640649 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
10:59:53.640830 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
10:59:53.641034 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
10:59:53.647660 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
10:59:53.648174 [debug] [Thread-1  ]: finished collecting timing info
10:59:53.648368 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
10:59:53.683980 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:59:54.033141 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
10:59:54.033722 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity 
    where activity_day <= '2021-09-05'
    group by user_id



    where install_day >= (select max(install_day) `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc`


        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
10:59:54.338302 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword WHERE at [25:5]')
10:59:55.615047 [debug] [Thread-1  ]: finished collecting timing info
10:59:55.615666 [debug] [Thread-1  ]: Database Error in model ae_user_info_inc (models/ae_user_info_inc.sql)
  Syntax error: Expected ")" but got keyword WHERE at [25:5]
  compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
10:59:55.616100 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc755fce-cae2-44f9-a572-4e9ee5919d63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056470d0>]}
10:59:55.616614 [error] [Thread-1  ]: 1 of 3 ERROR creating incremental model zz_xavier.ae_user_info_inc ............. [[31mERROR[0m in 1.98s]
10:59:55.617178 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
10:59:55.617439 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
10:59:55.617730 [info ] [Thread-1  ]: 2 of 3 START table model zz_xavier.ex_2 ........................................ [RUN]
10:59:55.618451 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
10:59:55.618654 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
10:59:55.618842 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
10:59:55.623381 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
10:59:55.623892 [debug] [Thread-1  ]: finished collecting timing info
10:59:55.624095 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
10:59:55.637745 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:59:55.915240 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
10:59:55.915829 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        7 = DATE_DIFF(ua.activity_day,MIN(ua.activity_day) over (partition by ua.user_id order by ua.activity_day ROWS
        BETWEEN 7 PRECEDING AND 0 PRECEDING), DAY) as has_been_active
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_type = 'app_open'
  )

select * from users
  );
  
11:00:04.728504 [debug] [Thread-1  ]: finished collecting timing info
11:00:04.729028 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc755fce-cae2-44f9-a572-4e9ee5919d63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105642040>]}
11:00:04.729398 [info ] [Thread-1  ]: 2 of 3 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (10.5m rows, 280.0 MB processed)[0m in 9.11s]
11:00:04.729808 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
11:00:04.730022 [debug] [Thread-1  ]: Began running node model.exercise.model_test
11:00:04.730405 [info ] [Thread-1  ]: 3 of 3 START table model zz_xavier.model_test .................................. [RUN]
11:00:04.730871 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
11:00:04.731049 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
11:00:04.731213 [debug] [Thread-1  ]: Compiling model.exercise.model_test
11:00:04.732830 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
11:00:04.733367 [debug] [Thread-1  ]: finished collecting timing info
11:00:04.733556 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
11:00:04.735279 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:00:05.013382 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
11:00:05.014181 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
11:00:09.994447 [debug] [Thread-1  ]: finished collecting timing info
11:00:09.995121 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc755fce-cae2-44f9-a572-4e9ee5919d63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056d4c70>]}
11:00:09.995618 [info ] [Thread-1  ]: 3 of 3 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 5.26s]
11:00:09.996114 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
11:00:09.997604 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:00:09.998212 [info ] [MainThread]: 
11:00:09.998547 [info ] [MainThread]: Finished running 1 incremental model, 2 table models in 17.76s.
11:00:09.998847 [debug] [MainThread]: Connection 'master' was properly closed.
11:00:09.999018 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
11:00:10.005304 [info ] [MainThread]: 
11:00:10.005618 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
11:00:10.005928 [info ] [MainThread]: 
11:00:10.006203 [error] [MainThread]: [33mDatabase Error in model ae_user_info_inc (models/ae_user_info_inc.sql)[0m
11:00:10.006444 [error] [MainThread]:   Syntax error: Expected ")" but got keyword WHERE at [25:5]
11:00:10.006673 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
11:00:10.006913 [info ] [MainThread]: 
11:00:10.007150 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
11:00:10.007604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10541aac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056d4c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056d9f40>]}


============================== 2022-09-28 11:02:14.199195 | 8801cd8b-1bfa-48d1-85fd-fabec0e9dab7 ==============================
11:02:14.199217 [info ] [MainThread]: Running with dbt=1.1.2
11:02:14.199719 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:02:14.199934 [debug] [MainThread]: Tracking: tracking
11:02:14.211344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca287f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca288e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca28d60>]}
11:02:14.242190 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:02:14.242586 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
11:02:14.252691 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
11:02:14.266974 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
11:02:14.273212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8801cd8b-1bfa-48d1-85fd-fabec0e9dab7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb8d0d0>]}
11:02:14.277153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8801cd8b-1bfa-48d1-85fd-fabec0e9dab7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b679970>]}
11:02:14.277382 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:02:14.277614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8801cd8b-1bfa-48d1-85fd-fabec0e9dab7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb13fd0>]}
11:02:14.278740 [info ] [MainThread]: 
11:02:14.279077 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:02:14.279721 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:02:14.279929 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:02:15.544999 [debug] [MainThread]: Connection 'master' was properly closed.
11:02:15.545514 [debug] [MainThread]: Connection 'list_dwh-adev-observe' was properly closed.


============================== 2022-09-28 11:02:25.493093 | ec527d49-6b13-4908-9b99-2c36c7fd7ce8 ==============================
11:02:25.493144 [info ] [MainThread]: Running with dbt=1.1.2
11:02:25.493756 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:02:25.494075 [debug] [MainThread]: Tracking: tracking
11:02:25.506650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111edef10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111edeb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ede3a0>]}
11:02:25.540003 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:02:25.540385 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
11:02:25.550258 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
11:02:25.564765 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
11:02:25.571494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ec527d49-6b13-4908-9b99-2c36c7fd7ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120420d0>]}
11:02:25.575688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ec527d49-6b13-4908-9b99-2c36c7fd7ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111fd2e20>]}
11:02:25.575914 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:02:25.576125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ec527d49-6b13-4908-9b99-2c36c7fd7ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111fcad60>]}
11:02:25.577218 [info ] [MainThread]: 
11:02:25.577771 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:02:25.578465 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:02:25.578698 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:02:26.789098 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:02:26.789586 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:02:27.268866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ec527d49-6b13-4908-9b99-2c36c7fd7ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f8a040>]}
11:02:27.269702 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:02:27.270102 [info ] [MainThread]: 
11:02:27.274490 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
11:02:27.274883 [info ] [Thread-1  ]: 1 of 3 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
11:02:27.275423 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
11:02:27.275606 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
11:02:27.275816 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
11:02:27.282411 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
11:02:27.282924 [debug] [Thread-1  ]: finished collecting timing info
11:02:27.283114 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
11:02:27.319132 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:02:27.815726 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
11:02:27.816297 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity 
    where activity_day <= '2021-09-05'
    group by user_id



    where install_day > (select max(install_day) `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc`


        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
11:02:28.131398 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword WHERE at [25:5]')
11:02:29.441953 [debug] [Thread-1  ]: finished collecting timing info
11:02:29.442580 [debug] [Thread-1  ]: Database Error in model ae_user_info_inc (models/ae_user_info_inc.sql)
  Syntax error: Expected ")" but got keyword WHERE at [25:5]
  compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
11:02:29.443024 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec527d49-6b13-4908-9b99-2c36c7fd7ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11216e610>]}
11:02:29.443547 [error] [Thread-1  ]: 1 of 3 ERROR creating incremental model zz_xavier.ae_user_info_inc ............. [[31mERROR[0m in 2.17s]
11:02:29.444112 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
11:02:29.444358 [debug] [Thread-1  ]: Began running node model.exercise.ex_2
11:02:29.444818 [info ] [Thread-1  ]: 2 of 3 START table model zz_xavier.ex_2 ........................................ [RUN]
11:02:29.445359 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_2"
11:02:29.445561 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_2
11:02:29.445751 [debug] [Thread-1  ]: Compiling model.exercise.ex_2
11:02:29.450073 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_2"
11:02:29.450578 [debug] [Thread-1  ]: finished collecting timing info
11:02:29.450772 [debug] [Thread-1  ]: Began executing node model.exercise.ex_2
11:02:29.464158 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:02:29.920256 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_2"
11:02:29.920836 [debug] [Thread-1  ]: On model.exercise.ex_2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_2`
  
  
  OPTIONS()
  as (
    with users as (
    select
        ua.user_id,
        ua.activity_day,
        7 = DATE_DIFF(ua.activity_day,MIN(ua.activity_day) over (partition by ua.user_id order by ua.activity_day ROWS
        BETWEEN 7 PRECEDING AND 0 PRECEDING), DAY) as has_been_active
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_type = 'app_open'
  )

select * from users
  );
  
11:02:38.161526 [debug] [Thread-1  ]: finished collecting timing info
11:02:38.162037 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec527d49-6b13-4908-9b99-2c36c7fd7ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120d4100>]}
11:02:38.162413 [info ] [Thread-1  ]: 2 of 3 OK created table model zz_xavier.ex_2 ................................... [[32mCREATE TABLE (10.5m rows, 280.0 MB processed)[0m in 8.72s]
11:02:38.162936 [debug] [Thread-1  ]: Finished running node model.exercise.ex_2
11:02:38.163241 [debug] [Thread-1  ]: Began running node model.exercise.model_test
11:02:38.163710 [info ] [Thread-1  ]: 3 of 3 START table model zz_xavier.model_test .................................. [RUN]
11:02:38.164185 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.model_test"
11:02:38.164374 [debug] [Thread-1  ]: Began compiling node model.exercise.model_test
11:02:38.164611 [debug] [Thread-1  ]: Compiling model.exercise.model_test
11:02:38.166330 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.model_test"
11:02:38.166803 [debug] [Thread-1  ]: finished collecting timing info
11:02:38.166979 [debug] [Thread-1  ]: Began executing node model.exercise.model_test
11:02:38.168708 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:02:38.622791 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.model_test"
11:02:38.623451 [debug] [Thread-1  ]: On model.exercise.model_test: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.model_test"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`model_test`
  
  
  OPTIONS()
  as (
    with elegible_users as (
  select
    d1.user_id as USER_ID,
    d2.campaign as campaign,
    d1.amount as spent,
    d1.activity_day as date_act,
    d2.install_day as inst_day
  from dwh-adev-core.ae_challenge_data.ae_user_activity as d1
  join dwh-adev-core.ae_challenge_data.ae_user_info as d2
  on d1.user_id = d2.user_id
  where d1.activity_type = 'payment'
),

spent_per_user as (
  select
      elegible_users.USER_ID,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 8, elegible_users.spent, null)) as spent_money_7_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 31, elegible_users.spent, null)) as spent_money_30_days,
      sum(if(DATE_DIFF(elegible_users.date_act, elegible_users.inst_day, DAY) < 61, elegible_users.spent, null)) as spent_money_60_days,
  from elegible_users
  group by 
      elegible_users.USER_ID

),

spent_per_user_campaign as (
  select
  cs.dollar_spend as money,
  eu.USER_ID as user_id,
  eu.campaign,
  from elegible_users as eu, dwh-adev-core.ae_challenge_data.ae_campaign_spend as cs
  where eu.inst_day = cs.spend_day and cs.campaign = eu.campaign
),

final as (
  select distinct
    su.USER_ID as user_id, 
    su.spent_money_7_days,
    su.spent_money_30_days,
    su.spent_money_60_days, 
    sc.campaign as campaign_name, 
    sc.money as money_spent_on_campaign,
  from spent_per_user as su join spent_per_user_campaign as sc on 
  su.USER_ID = sc.USER_ID
)

select * from final
  );
  
11:02:43.010639 [debug] [Thread-1  ]: finished collecting timing info
11:02:43.011233 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec527d49-6b13-4908-9b99-2c36c7fd7ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121c01c0>]}
11:02:43.011658 [info ] [Thread-1  ]: 3 of 3 OK created table model zz_xavier.model_test ............................. [[32mCREATE TABLE (77.5k rows, 464.1 MB processed)[0m in 4.85s]
11:02:43.012132 [debug] [Thread-1  ]: Finished running node model.exercise.model_test
11:02:43.013440 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:02:43.013903 [info ] [MainThread]: 
11:02:43.014283 [info ] [MainThread]: Finished running 1 incremental model, 2 table models in 17.44s.
11:02:43.014561 [debug] [MainThread]: Connection 'master' was properly closed.
11:02:43.014702 [debug] [MainThread]: Connection 'model.exercise.model_test' was properly closed.
11:02:43.020271 [info ] [MainThread]: 
11:02:43.020554 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
11:02:43.020830 [info ] [MainThread]: 
11:02:43.021074 [error] [MainThread]: [33mDatabase Error in model ae_user_info_inc (models/ae_user_info_inc.sql)[0m
11:02:43.021309 [error] [MainThread]:   Syntax error: Expected ")" but got keyword WHERE at [25:5]
11:02:43.021530 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
11:02:43.021759 [info ] [MainThread]: 
11:02:43.021990 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
11:02:43.022330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f8a0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111fd2b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121da4f0>]}


============================== 2022-09-28 11:17:34.818243 | 99051562-fc03-4d18-a20a-bdcd6181c3b1 ==============================
11:17:34.818273 [info ] [MainThread]: Running with dbt=1.1.2
11:17:34.819038 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_info_inc'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:17:34.819246 [debug] [MainThread]: Tracking: tracking
11:17:34.831738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10653a280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10653a1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10653ac40>]}
11:17:34.862174 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:17:34.862525 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
11:17:34.872617 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
11:17:34.886779 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
11:17:34.892878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '99051562-fc03-4d18-a20a-bdcd6181c3b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10669f0d0>]}
11:17:34.896772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '99051562-fc03-4d18-a20a-bdcd6181c3b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106631ee0>]}
11:17:34.897003 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:17:34.897247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '99051562-fc03-4d18-a20a-bdcd6181c3b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10662ad30>]}
11:17:34.898225 [info ] [MainThread]: 
11:17:34.898555 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:17:34.899102 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:17:34.899536 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:17:36.153038 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:17:36.153557 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:17:36.459598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '99051562-fc03-4d18-a20a-bdcd6181c3b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10518d8e0>]}
11:17:36.460478 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:17:36.460875 [info ] [MainThread]: 
11:17:36.465256 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
11:17:36.465649 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
11:17:36.466202 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
11:17:36.466398 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
11:17:36.466746 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
11:17:36.473620 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
11:17:36.474141 [debug] [Thread-1  ]: finished collecting timing info
11:17:36.474333 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
11:17:36.511467 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:17:36.843188 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
11:17:36.843776 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity 
    where activity_day <= '2021-09-06'
    group by user_id



    where install_day > (select max(install_day) `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc`)


        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
11:17:37.141692 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword WHERE at [25:5]')
11:17:38.437916 [debug] [Thread-1  ]: finished collecting timing info
11:17:38.438524 [debug] [Thread-1  ]: Database Error in model ae_user_info_inc (models/ae_user_info_inc.sql)
  Syntax error: Expected ")" but got keyword WHERE at [25:5]
  compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
11:17:38.438961 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99051562-fc03-4d18-a20a-bdcd6181c3b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067c09a0>]}
11:17:38.439514 [error] [Thread-1  ]: 1 of 1 ERROR creating incremental model zz_xavier.ae_user_info_inc ............. [[31mERROR[0m in 1.97s]
11:17:38.440090 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
11:17:38.441449 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:17:38.441874 [info ] [MainThread]: 
11:17:38.442364 [info ] [MainThread]: Finished running 1 incremental model in 3.54s.
11:17:38.442677 [debug] [MainThread]: Connection 'master' was properly closed.
11:17:38.442858 [debug] [MainThread]: Connection 'model.exercise.ae_user_info_inc' was properly closed.
11:17:38.451332 [info ] [MainThread]: 
11:17:38.451644 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
11:17:38.451944 [info ] [MainThread]: 
11:17:38.452193 [error] [MainThread]: [33mDatabase Error in model ae_user_info_inc (models/ae_user_info_inc.sql)[0m
11:17:38.452438 [error] [MainThread]:   Syntax error: Expected ")" but got keyword WHERE at [25:5]
11:17:38.452666 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
11:17:38.452898 [info ] [MainThread]: 
11:17:38.453133 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
11:17:38.453490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106799310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106711370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106782850>]}


============================== 2022-09-28 11:19:05.646222 | 80d3511a-591f-47bd-a890-24b32970a7e1 ==============================
11:19:05.646247 [info ] [MainThread]: Running with dbt=1.1.2
11:19:05.647301 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_info_inc'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:19:05.647541 [debug] [MainThread]: Tracking: tracking
11:19:05.658927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108200a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bea130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111beadc0>]}
11:19:05.693399 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:19:05.693764 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
11:19:05.704666 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
11:19:05.719243 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
11:19:05.725888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '80d3511a-591f-47bd-a890-24b32970a7e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111d620d0>]}
11:19:05.731065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '80d3511a-591f-47bd-a890-24b32970a7e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cebc10>]}
11:19:05.731342 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:19:05.731555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '80d3511a-591f-47bd-a890-24b32970a7e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108200a0>]}
11:19:05.732599 [info ] [MainThread]: 
11:19:05.732967 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:19:05.733555 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:19:05.733777 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:19:06.814486 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:19:06.815240 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:19:07.230734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '80d3511a-591f-47bd-a890-24b32970a7e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cf2fa0>]}
11:19:07.231669 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:19:07.232097 [info ] [MainThread]: 
11:19:07.236380 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
11:19:07.236781 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
11:19:07.237327 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
11:19:07.237521 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
11:19:07.237749 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
11:19:07.244384 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
11:19:07.244914 [debug] [Thread-1  ]: finished collecting timing info
11:19:07.245109 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
11:19:07.281230 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:19:07.607730 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
11:19:07.608329 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity 
    where activity_day <= '2021-09-06'
    group by user_id



    where install_day > (select max(install_day) from `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc`)


        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
11:19:07.929300 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword WHERE at [25:5]')
11:19:09.224219 [debug] [Thread-1  ]: finished collecting timing info
11:19:09.224833 [debug] [Thread-1  ]: Database Error in model ae_user_info_inc (models/ae_user_info_inc.sql)
  Syntax error: Expected ")" but got keyword WHERE at [25:5]
  compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
11:19:09.225295 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '80d3511a-591f-47bd-a890-24b32970a7e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111eafcd0>]}
11:19:09.225741 [error] [Thread-1  ]: 1 of 1 ERROR creating incremental model zz_xavier.ae_user_info_inc ............. [[31mERROR[0m in 1.99s]
11:19:09.226257 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
11:19:09.227520 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:19:09.227942 [info ] [MainThread]: 
11:19:09.228382 [info ] [MainThread]: Finished running 1 incremental model in 3.50s.
11:19:09.228685 [debug] [MainThread]: Connection 'master' was properly closed.
11:19:09.228870 [debug] [MainThread]: Connection 'model.exercise.ae_user_info_inc' was properly closed.
11:19:09.236814 [info ] [MainThread]: 
11:19:09.237113 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
11:19:09.237402 [info ] [MainThread]: 
11:19:09.237643 [error] [MainThread]: [33mDatabase Error in model ae_user_info_inc (models/ae_user_info_inc.sql)[0m
11:19:09.237873 [error] [MainThread]:   Syntax error: Expected ")" but got keyword WHERE at [25:5]
11:19:09.238090 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
11:19:09.238491 [info ] [MainThread]: 
11:19:09.238760 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
11:19:09.239125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e83250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e58f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e455b0>]}


============================== 2022-09-28 11:22:09.701472 | e80b1215-7631-4711-89d2-72ab20f15e57 ==============================
11:22:09.701505 [info ] [MainThread]: Running with dbt=1.1.2
11:22:09.702071 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_info_inc'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:22:09.702680 [debug] [MainThread]: Tracking: tracking
11:22:09.714701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d952be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c59cb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d952610>]}
11:22:09.746363 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:22:09.746738 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
11:22:09.756975 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
11:22:09.771349 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
11:22:09.777538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e80b1215-7631-4711-89d2-72ab20f15e57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dae70d0>]}
11:22:09.781503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e80b1215-7631-4711-89d2-72ab20f15e57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9d8d90>]}
11:22:09.781727 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:22:09.781982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e80b1215-7631-4711-89d2-72ab20f15e57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c59cb50>]}
11:22:09.783002 [info ] [MainThread]: 
11:22:09.783345 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:22:09.783915 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:22:09.784236 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:22:10.957369 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:22:10.957869 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:22:11.353925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e80b1215-7631-4711-89d2-72ab20f15e57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da73c10>]}
11:22:11.354665 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:22:11.355037 [info ] [MainThread]: 
11:22:11.359064 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
11:22:11.359423 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
11:22:11.359925 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
11:22:11.360106 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
11:22:11.360329 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
11:22:11.367531 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
11:22:11.368070 [debug] [Thread-1  ]: finished collecting timing info
11:22:11.368270 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
11:22:11.403980 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:22:11.720763 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
11:22:11.721363 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity 



    where activity_day > (select max(install_day) from `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc`) and activity_day = '2021-09-06'


group by user_id
        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
11:22:17.917669 [debug] [Thread-1  ]: finished collecting timing info
11:22:17.918197 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e80b1215-7631-4711-89d2-72ab20f15e57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dbbf100>]}
11:22:17.918662 [info ] [Thread-1  ]: 1 of 1 OK created incremental model zz_xavier.ae_user_info_inc ................. [[32mMERGE (121.9k rows, 183.1 MB processed)[0m in 6.56s]
11:22:17.919146 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
11:22:17.920334 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:22:17.920734 [info ] [MainThread]: 
11:22:17.921195 [info ] [MainThread]: Finished running 1 incremental model in 8.14s.
11:22:17.921488 [debug] [MainThread]: Connection 'master' was properly closed.
11:22:17.921660 [debug] [MainThread]: Connection 'model.exercise.ae_user_info_inc' was properly closed.
11:22:17.929679 [info ] [MainThread]: 
11:22:17.930004 [info ] [MainThread]: [32mCompleted successfully[0m
11:22:17.930351 [info ] [MainThread]: 
11:22:17.930602 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
11:22:17.930966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d984b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10db5d100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dbe1af0>]}


============================== 2022-09-29 09:16:02.712854 | 206530e5-ab65-403c-924f-7425628fc2c8 ==============================
09:16:02.712896 [info ] [MainThread]: Running with dbt=1.1.2
09:16:02.713834 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_info_inc'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:16:02.714052 [debug] [MainThread]: Tracking: tracking
09:16:02.729415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10943c850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10943cca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10943c460>]}
09:16:02.782167 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
09:16:02.782616 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ex_2.sql
09:16:02.782880 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
09:16:02.795115 [debug] [MainThread]: 1699: static parser successfully parsed ex_2.sql
09:16:02.805610 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
09:16:02.812025 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
09:16:02.819061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '206530e5-ab65-403c-924f-7425628fc2c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10959e0d0>]}
09:16:02.823339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '206530e5-ab65-403c-924f-7425628fc2c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109526f40>]}
09:16:02.823552 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:16:02.823760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '206530e5-ab65-403c-924f-7425628fc2c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109526e80>]}
09:16:02.824705 [info ] [MainThread]: 
09:16:02.825036 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:16:02.825580 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:16:02.825728 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:16:04.818716 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:16:04.819243 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:16:05.330610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '206530e5-ab65-403c-924f-7425628fc2c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10942cfa0>]}
09:16:05.331516 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:16:05.331908 [info ] [MainThread]: 
09:16:05.338156 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
09:16:05.338547 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
09:16:05.339090 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
09:16:05.339282 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
09:16:05.339489 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
09:16:05.346434 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
09:16:05.346916 [debug] [Thread-1  ]: finished collecting timing info
09:16:05.347111 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
09:16:05.383342 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:16:05.892125 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
09:16:05.892784 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua



    where ua.activity_day >= (select max(install_day) from `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc`)


group by user_id
        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
09:16:21.410273 [debug] [Thread-1  ]: finished collecting timing info
09:16:21.410828 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '206530e5-ab65-403c-924f-7425628fc2c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109632760>]}
09:16:21.411236 [info ] [Thread-1  ]: 1 of 1 OK created incremental model zz_xavier.ae_user_info_inc ................. [[32mMERGE (670.4k rows, 183.4 MB processed)[0m in 16.07s]
09:16:21.411731 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
09:16:21.412956 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:16:21.413413 [info ] [MainThread]: 
09:16:21.413750 [info ] [MainThread]: Finished running 1 incremental model in 18.59s.
09:16:21.414010 [debug] [MainThread]: Connection 'master' was properly closed.
09:16:21.414161 [debug] [MainThread]: Connection 'model.exercise.ae_user_info_inc' was properly closed.
09:16:21.425779 [info ] [MainThread]: 
09:16:21.426092 [info ] [MainThread]: [32mCompleted successfully[0m
09:16:21.426386 [info ] [MainThread]: 
09:16:21.426625 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
09:16:21.426974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105dc5460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095affd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096c2190>]}


============================== 2022-09-29 09:55:37.143881 | f7f470f0-7ecd-4a83-acb1-8dbc90425086 ==============================
09:55:37.143901 [info ] [MainThread]: Running with dbt=1.1.2
09:55:37.144969 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_info_inc'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:55:37.145283 [debug] [MainThread]: Tracking: tracking
09:55:37.159437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106011100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106011f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060111c0>]}
09:55:37.198342 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:55:37.198785 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
09:55:37.210733 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
09:55:37.225806 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
09:55:37.232571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f7f470f0-7ecd-4a83-acb1-8dbc90425086', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061890d0>]}
09:55:37.236713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f7f470f0-7ecd-4a83-acb1-8dbc90425086', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061189a0>]}
09:55:37.236950 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:55:37.237171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f7f470f0-7ecd-4a83-acb1-8dbc90425086', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106011e80>]}
09:55:37.238271 [info ] [MainThread]: 
09:55:37.238673 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:55:37.239288 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:55:37.239508 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:55:38.451309 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:55:38.452062 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:55:38.888931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f7f470f0-7ecd-4a83-acb1-8dbc90425086', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ff2e20>]}
09:55:38.889673 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:55:38.890158 [info ] [MainThread]: 
09:55:38.894336 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
09:55:38.894712 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
09:55:38.895240 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
09:55:38.895423 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
09:55:38.895644 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
09:55:38.899769 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
09:55:38.900267 [debug] [Thread-1  ]: finished collecting timing info
09:55:38.900465 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
09:55:38.965254 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
09:55:38.965840 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:55:38.966075 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc`
  
  
  OPTIONS()
  as (
    

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_day <= '2021-09-05'
    group by user_id


  );
  
09:55:43.089821 [debug] [Thread-1  ]: finished collecting timing info
09:55:43.090341 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7f470f0-7ecd-4a83-acb1-8dbc90425086', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10627fd00>]}
09:55:43.090732 [info ] [Thread-1  ]: 1 of 1 OK created incremental model zz_xavier.ae_user_info_inc ................. [[32mCREATE TABLE (199.3k rows, 177.4 MB processed)[0m in 4.20s]
09:55:43.091168 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
09:55:43.092245 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:55:43.092614 [info ] [MainThread]: 
09:55:43.092954 [info ] [MainThread]: Finished running 1 incremental model in 5.85s.
09:55:43.093225 [debug] [MainThread]: Connection 'master' was properly closed.
09:55:43.093373 [debug] [MainThread]: Connection 'model.exercise.ae_user_info_inc' was properly closed.
09:55:43.104747 [info ] [MainThread]: 
09:55:43.105046 [info ] [MainThread]: [32mCompleted successfully[0m
09:55:43.105336 [info ] [MainThread]: 
09:55:43.105603 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
09:55:43.105964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1029ae4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061fa490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062bbbb0>]}


============================== 2022-09-29 09:57:22.603766 | 3832703c-9c7c-4b62-8f80-c645e1de87a0 ==============================
09:57:22.603781 [info ] [MainThread]: Running with dbt=1.1.2
09:57:22.604373 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_info_inc'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:57:22.604586 [debug] [MainThread]: Tracking: tracking
09:57:22.617294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108860ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088601f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108860310>]}
09:57:22.650511 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:57:22.650864 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
09:57:22.660459 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
09:57:22.674529 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
09:57:22.680504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3832703c-9c7c-4b62-8f80-c645e1de87a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089d60d0>]}
09:57:22.684299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3832703c-9c7c-4b62-8f80-c645e1de87a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108965ee0>]}
09:57:22.684520 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:57:22.684800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3832703c-9c7c-4b62-8f80-c645e1de87a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10895ddf0>]}
09:57:22.685742 [info ] [MainThread]: 
09:57:22.686069 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:57:22.686592 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:57:22.686830 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:57:23.850664 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:57:23.851182 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:57:24.261600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3832703c-9c7c-4b62-8f80-c645e1de87a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108840f70>]}
09:57:24.262510 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:57:24.263082 [info ] [MainThread]: 
09:57:24.267363 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
09:57:24.267767 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
09:57:24.268342 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
09:57:24.268545 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
09:57:24.268789 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
09:57:24.275730 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
09:57:24.276229 [debug] [Thread-1  ]: finished collecting timing info
09:57:24.276423 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
09:57:24.312452 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:57:24.809290 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
09:57:24.809860 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua



    where not exists (select user_id from `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` 
    where ua.user_id = user_id) and ua.activity_day <= '2021-09-17'


    group by user_id
        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
09:57:30.308014 [debug] [Thread-1  ]: finished collecting timing info
09:57:30.308633 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3832703c-9c7c-4b62-8f80-c645e1de87a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a663d0>]}
09:57:30.309073 [info ] [Thread-1  ]: 1 of 1 OK created incremental model zz_xavier.ae_user_info_inc ................. [[32mMERGE (91.8k rows, 183.1 MB processed)[0m in 6.04s]
09:57:30.309568 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
09:57:30.310859 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:57:30.311319 [info ] [MainThread]: 
09:57:30.311653 [info ] [MainThread]: Finished running 1 incremental model in 7.63s.
09:57:30.311931 [debug] [MainThread]: Connection 'master' was properly closed.
09:57:30.312087 [debug] [MainThread]: Connection 'model.exercise.ae_user_info_inc' was properly closed.
09:57:30.320400 [info ] [MainThread]: 
09:57:30.320705 [info ] [MainThread]: [32mCompleted successfully[0m
09:57:30.321002 [info ] [MainThread]: 
09:57:30.321243 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
09:57:30.321594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051fa4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a473d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b28d60>]}


============================== 2022-09-29 09:58:59.254534 | b731157a-0a02-4261-ac0a-7e0e53d3ecfe ==============================
09:58:59.254550 [info ] [MainThread]: Running with dbt=1.1.2
09:58:59.255152 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_info_inc'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:58:59.255448 [debug] [MainThread]: Tracking: tracking
09:58:59.267433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9dbe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd79a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd79220>]}
09:58:59.300931 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:58:59.301339 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
09:58:59.311846 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
09:58:59.326418 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
09:58:59.332645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b731157a-0a02-4261-ac0a-7e0e53d3ecfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10beec0d0>]}
09:58:59.336628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b731157a-0a02-4261-ac0a-7e0e53d3ecfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be02df0>]}
09:58:59.336858 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:58:59.337084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b731157a-0a02-4261-ac0a-7e0e53d3ecfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be76c40>]}
09:58:59.338073 [info ] [MainThread]: 
09:58:59.338415 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:58:59.339009 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:58:59.339400 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:59:00.439219 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:59:00.439710 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:59:00.927608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b731157a-0a02-4261-ac0a-7e0e53d3ecfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd75520>]}
09:59:00.928538 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:59:00.928921 [info ] [MainThread]: 
09:59:00.933286 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
09:59:00.933696 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
09:59:00.934271 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
09:59:00.934472 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
09:59:00.934701 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
09:59:00.941674 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
09:59:00.942182 [debug] [Thread-1  ]: finished collecting timing info
09:59:00.942373 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
09:59:00.979301 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:59:01.462505 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
09:59:01.463105 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua



    where not exists (select user_id from `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` 
    where ua.user_id = user_id)


    group by user_id
        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
09:59:12.578812 [debug] [Thread-1  ]: finished collecting timing info
09:59:12.579347 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b731157a-0a02-4261-ac0a-7e0e53d3ecfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bfe4ca0>]}
09:59:12.579738 [info ] [Thread-1  ]: 1 of 1 OK created incremental model zz_xavier.ae_user_info_inc ................. [[32mMERGE (405.9k rows, 185.8 MB processed)[0m in 11.65s]
09:59:12.580206 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
09:59:12.581363 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:59:12.581805 [info ] [MainThread]: 
09:59:12.582102 [info ] [MainThread]: Finished running 1 incremental model in 13.24s.
09:59:12.582356 [debug] [MainThread]: Connection 'master' was properly closed.
09:59:12.582496 [debug] [MainThread]: Connection 'model.exercise.ae_user_info_inc' was properly closed.
09:59:12.590610 [info ] [MainThread]: 
09:59:12.590905 [info ] [MainThread]: [32mCompleted successfully[0m
09:59:12.591199 [info ] [MainThread]: 
09:59:12.591435 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
09:59:12.591779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108713490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bfe4070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bfe4190>]}


============================== 2022-09-29 10:01:27.167066 | 3ed82d52-3618-4171-90d3-15377b59bf3d ==============================
10:01:27.167083 [info ] [MainThread]: Running with dbt=1.1.2
10:01:27.167776 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_info_inc'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:01:27.167999 [debug] [MainThread]: Tracking: tracking
10:01:27.180045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11034ea90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11034e0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11034ed00>]}
10:01:27.216361 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:01:27.216790 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
10:01:27.226929 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
10:01:27.241317 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
10:01:27.247474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3ed82d52-3618-4171-90d3-15377b59bf3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104b10d0>]}
10:01:27.251552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3ed82d52-3618-4171-90d3-15377b59bf3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11031dbb0>]}
10:01:27.251782 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:01:27.252086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3ed82d52-3618-4171-90d3-15377b59bf3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110439f70>]}
10:01:27.253083 [info ] [MainThread]: 
10:01:27.253437 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:01:27.253992 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:01:27.254307 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:01:28.590621 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:01:28.591150 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:01:29.100271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3ed82d52-3618-4171-90d3-15377b59bf3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11033ef40>]}
10:01:29.101113 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:01:29.101494 [info ] [MainThread]: 
10:01:29.105528 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
10:01:29.105881 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
10:01:29.106397 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
10:01:29.106584 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
10:01:29.106804 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
10:01:29.113666 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
10:01:29.114156 [debug] [Thread-1  ]: finished collecting timing info
10:01:29.114347 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
10:01:29.150589 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:01:29.844871 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
10:01:29.845432 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua



    where not exists (select user_id from `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` 
    where ua.user_id = user_id)
    group by user_id


        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
10:01:36.700213 [debug] [Thread-1  ]: finished collecting timing info
10:01:36.700763 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ed82d52-3618-4171-90d3-15377b59bf3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105a4f70>]}
10:01:36.701188 [info ] [Thread-1  ]: 1 of 1 OK created incremental model zz_xavier.ae_user_info_inc ................. [[32mMERGE (0.0 rows, 197.7 MB processed)[0m in 7.59s]
10:01:36.701652 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
10:01:36.702952 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:01:36.703412 [info ] [MainThread]: 
10:01:36.703734 [info ] [MainThread]: Finished running 1 incremental model in 9.45s.
10:01:36.703999 [debug] [MainThread]: Connection 'master' was properly closed.
10:01:36.704147 [debug] [MainThread]: Connection 'model.exercise.ae_user_info_inc' was properly closed.
10:01:36.712266 [info ] [MainThread]: 
10:01:36.712582 [info ] [MainThread]: [32mCompleted successfully[0m
10:01:36.712935 [info ] [MainThread]: 
10:01:36.713186 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
10:01:36.713543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ccd9430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110523490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1106055b0>]}


============================== 2022-09-29 10:03:36.085949 | 42597c85-2992-4117-a8e8-a01bc06b72f4 ==============================
10:03:36.086000 [info ] [MainThread]: Running with dbt=1.1.2
10:03:36.086505 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_info_inc'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:03:36.087032 [debug] [MainThread]: Tracking: tracking
10:03:36.098416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ede070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ede7f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112edeaf0>]}
10:03:36.135522 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:03:36.135951 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
10:03:36.147656 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
10:03:36.162015 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
10:03:36.168211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '42597c85-2992-4117-a8e8-a01bc06b72f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1130420d0>]}
10:03:36.172305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '42597c85-2992-4117-a8e8-a01bc06b72f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ede250>]}
10:03:36.172539 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:03:36.172751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42597c85-2992-4117-a8e8-a01bc06b72f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112fcdf70>]}
10:03:36.173733 [info ] [MainThread]: 
10:03:36.174075 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:03:36.174742 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:03:36.174965 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:03:37.357780 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:03:37.358318 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:03:37.717515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42597c85-2992-4117-a8e8-a01bc06b72f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ea2970>]}
10:03:37.718458 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:03:37.718897 [info ] [MainThread]: 
10:03:37.723388 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
10:03:37.723783 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
10:03:37.724364 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
10:03:37.724561 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
10:03:37.724781 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
10:03:37.731638 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
10:03:37.732154 [debug] [Thread-1  ]: finished collecting timing info
10:03:37.732359 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
10:03:37.769040 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:03:38.152831 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
10:03:38.153405 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua



    where not exists (select distinct user_id from `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` 
    where ua.user_id = user_id)
    group by user_id


        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
10:04:00.661401 [debug] [Thread-1  ]: finished collecting timing info
10:04:00.661913 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42597c85-2992-4117-a8e8-a01bc06b72f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1130d3520>]}
10:04:00.662301 [info ] [Thread-1  ]: 1 of 1 OK created incremental model zz_xavier.ae_user_info_inc ................. [[32mMERGE (0.0 rows, 197.7 MB processed)[0m in 22.94s]
10:04:00.662752 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
10:04:00.663856 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:04:00.664229 [info ] [MainThread]: 
10:04:00.664623 [info ] [MainThread]: Finished running 1 incremental model in 24.49s.
10:04:00.664882 [debug] [MainThread]: Connection 'master' was properly closed.
10:04:00.665026 [debug] [MainThread]: Connection 'model.exercise.ae_user_info_inc' was properly closed.
10:04:00.676686 [info ] [MainThread]: 
10:04:00.676999 [info ] [MainThread]: [32mCompleted successfully[0m
10:04:00.677301 [info ] [MainThread]: 
10:04:00.677543 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
10:04:00.677897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f868490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1130b2550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1131710d0>]}


============================== 2022-09-29 10:05:26.647773 | 73863ea2-19b2-41ac-95af-488936d2e140 ==============================
10:05:26.647790 [info ] [MainThread]: Running with dbt=1.1.2
10:05:26.648555 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_info_inc'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:05:26.648724 [debug] [MainThread]: Tracking: tracking
10:05:26.660067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081f1dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081f1eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081f1cd0>]}
10:05:26.693593 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:05:26.693977 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
10:05:26.704120 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
10:05:26.719014 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
10:05:26.725258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '73863ea2-19b2-41ac-95af-488936d2e140', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083910d0>]}
10:05:26.729376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '73863ea2-19b2-41ac-95af-488936d2e140', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081f13a0>]}
10:05:26.729608 [info ] [MainThread]: Found 3 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:05:26.729837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73863ea2-19b2-41ac-95af-488936d2e140', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10831cbb0>]}
10:05:26.730841 [info ] [MainThread]: 
10:05:26.731185 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:05:26.731750 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:05:26.732054 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:05:27.926953 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:05:27.927443 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:05:28.411306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73863ea2-19b2-41ac-95af-488936d2e140', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082862b0>]}
10:05:28.411963 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:05:28.412307 [info ] [MainThread]: 
10:05:28.416029 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
10:05:28.416381 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
10:05:28.416886 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
10:05:28.417056 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
10:05:28.417251 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
10:05:28.421645 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
10:05:28.422209 [debug] [Thread-1  ]: finished collecting timing info
10:05:28.422406 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
10:05:28.481850 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
10:05:28.482375 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:05:28.482586 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc`
  
  
  OPTIONS()
  as (
    

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_day <= '2021-09-6'

    group by ua.user_id
  );
  
10:05:32.231186 [debug] [Thread-1  ]: finished collecting timing info
10:05:32.231709 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73863ea2-19b2-41ac-95af-488936d2e140', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10849a970>]}
10:05:32.232088 [info ] [Thread-1  ]: 1 of 1 OK created incremental model zz_xavier.ae_user_info_inc ................. [[32mCREATE TABLE (209.9k rows, 177.4 MB processed)[0m in 3.81s]
10:05:32.232530 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
10:05:32.233612 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:05:32.233985 [info ] [MainThread]: 
10:05:32.234359 [info ] [MainThread]: Finished running 1 incremental model in 5.50s.
10:05:32.234636 [debug] [MainThread]: Connection 'master' was properly closed.
10:05:32.234774 [debug] [MainThread]: Connection 'model.exercise.ae_user_info_inc' was properly closed.
10:05:32.246005 [info ] [MainThread]: 
10:05:32.246326 [info ] [MainThread]: [32mCompleted successfully[0m
10:05:32.246617 [info ] [MainThread]: 
10:05:32.246846 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
10:05:32.247191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bb7490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083702b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10849a160>]}


============================== 2022-09-29 10:11:32.625468 | 82073d28-cbbe-4c45-9173-382b60eebbb9 ==============================
10:11:32.625494 [info ] [MainThread]: Running with dbt=1.1.2
10:11:32.626219 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ex_3'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:11:32.626352 [debug] [MainThread]: Tracking: tracking
10:11:32.638040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113cb48e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128d7550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c94eb0>]}
10:11:32.667823 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
10:11:32.668150 [debug] [MainThread]: Partial parsing: added file: exercise://models/ex_3.sql
10:11:32.678532 [debug] [MainThread]: 1699: static parser successfully parsed ex_3.sql
10:11:32.695488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '82073d28-cbbe-4c45-9173-382b60eebbb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113e0c0d0>]}
10:11:32.700219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '82073d28-cbbe-4c45-9173-382b60eebbb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d63eb0>]}
10:11:32.700477 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:11:32.700699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '82073d28-cbbe-4c45-9173-382b60eebbb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128d7550>]}
10:11:32.701802 [info ] [MainThread]: 
10:11:32.702289 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:11:32.702976 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:11:32.703409 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:11:33.891414 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:11:33.891933 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:11:34.306262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '82073d28-cbbe-4c45-9173-382b60eebbb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c825b0>]}
10:11:34.307162 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:11:34.307555 [info ] [MainThread]: 
10:11:34.311733 [debug] [Thread-1  ]: Began running node model.exercise.ex_3
10:11:34.312094 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.ex_3 ........................................ [RUN]
10:11:34.312611 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ex_3"
10:11:34.312797 [debug] [Thread-1  ]: Began compiling node model.exercise.ex_3
10:11:34.313019 [debug] [Thread-1  ]: Compiling model.exercise.ex_3
10:11:34.314980 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ex_3"
10:11:34.315522 [debug] [Thread-1  ]: finished collecting timing info
10:11:34.315722 [debug] [Thread-1  ]: Began executing node model.exercise.ex_3
10:11:34.354956 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ex_3"
10:11:34.355559 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:11:34.355802 [debug] [Thread-1  ]: On model.exercise.ex_3: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ex_3"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ex_3`
  
  
  OPTIONS()
  as (
    select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_day <= '2021-09-6'
    group by ua.user_id
  );
  
10:11:38.437700 [debug] [Thread-1  ]: finished collecting timing info
10:11:38.438262 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '82073d28-cbbe-4c45-9173-382b60eebbb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ed8fa0>]}
10:11:38.438680 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.ex_3 ................................... [[32mCREATE TABLE (209.9k rows, 177.4 MB processed)[0m in 4.13s]
10:11:38.439173 [debug] [Thread-1  ]: Finished running node model.exercise.ex_3
10:11:38.440419 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:11:38.440879 [info ] [MainThread]: 
10:11:38.441181 [info ] [MainThread]: Finished running 1 table model in 5.74s.
10:11:38.441447 [debug] [MainThread]: Connection 'master' was properly closed.
10:11:38.441593 [debug] [MainThread]: Connection 'model.exercise.ex_3' was properly closed.
10:11:38.449808 [info ] [MainThread]: 
10:11:38.450109 [info ] [MainThread]: [32mCompleted successfully[0m
10:11:38.450402 [info ] [MainThread]: 
10:11:38.450645 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
10:11:38.450988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11063d490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ed59d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ed52b0>]}


============================== 2022-09-29 10:18:59.209734 | a806600f-c9b6-4c9c-80fb-66d77e2f9755 ==============================
10:18:59.209751 [info ] [MainThread]: Running with dbt=1.1.2
10:18:59.210479 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_info_inc'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:18:59.210616 [debug] [MainThread]: Tracking: tracking
10:18:59.221793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1131c6c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125d3430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1131c6610>]}
10:18:59.255205 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:18:59.255552 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
10:18:59.265268 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
10:18:59.280067 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
10:18:59.286408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a806600f-c9b6-4c9c-80fb-66d77e2f9755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133400d0>]}
10:18:59.290588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a806600f-c9b6-4c9c-80fb-66d77e2f9755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132cff70>]}
10:18:59.290812 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:18:59.291023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a806600f-c9b6-4c9c-80fb-66d77e2f9755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132cafa0>]}
10:18:59.292005 [info ] [MainThread]: 
10:18:59.292338 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:18:59.292917 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:18:59.293174 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:19:00.518517 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:19:00.519076 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:19:00.839658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a806600f-c9b6-4c9c-80fb-66d77e2f9755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1131da4f0>]}
10:19:00.840573 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:19:00.841023 [info ] [MainThread]: 
10:19:00.845420 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
10:19:00.845799 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
10:19:00.846349 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
10:19:00.846538 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
10:19:00.846751 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
10:19:00.853504 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
10:19:00.854019 [debug] [Thread-1  ]: finished collecting timing info
10:19:00.854222 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
10:19:00.890055 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:19:01.391599 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
10:19:01.392175 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_day <= '2021-09-6'


    where not exists (select distinct user_id from `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` 
    where ua.user_id = user_id)


group by ua.user_id
        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
10:19:01.791824 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword WHERE at [23:5]')
10:19:03.060301 [debug] [Thread-1  ]: finished collecting timing info
10:19:03.060925 [debug] [Thread-1  ]: Database Error in model ae_user_info_inc (models/ae_user_info_inc.sql)
  Syntax error: Expected ")" but got keyword WHERE at [23:5]
  compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
10:19:03.061366 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a806600f-c9b6-4c9c-80fb-66d77e2f9755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c64190>]}
10:19:03.061906 [error] [Thread-1  ]: 1 of 1 ERROR creating incremental model zz_xavier.ae_user_info_inc ............. [[31mERROR[0m in 2.22s]
10:19:03.062466 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
10:19:03.063852 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:19:03.064311 [info ] [MainThread]: 
10:19:03.064700 [info ] [MainThread]: Finished running 1 incremental model in 3.77s.
10:19:03.065099 [debug] [MainThread]: Connection 'master' was properly closed.
10:19:03.065296 [debug] [MainThread]: Connection 'model.exercise.ae_user_info_inc' was properly closed.
10:19:03.073588 [info ] [MainThread]: 
10:19:03.073895 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
10:19:03.074194 [info ] [MainThread]: 
10:19:03.074446 [error] [MainThread]: [33mDatabase Error in model ae_user_info_inc (models/ae_user_info_inc.sql)[0m
10:19:03.074693 [error] [MainThread]:   Syntax error: Expected ")" but got keyword WHERE at [23:5]
10:19:03.074920 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_info_inc.sql
10:19:03.075220 [info ] [MainThread]: 
10:19:03.075564 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
10:19:03.075955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113353c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113353be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133c1cd0>]}


============================== 2022-09-29 10:19:21.534674 | 859b2207-edf7-485f-9e8d-4c341189456a ==============================
10:19:21.534724 [info ] [MainThread]: Running with dbt=1.1.2
10:19:21.535297 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_info_inc'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:19:21.536002 [debug] [MainThread]: Tracking: tracking
10:19:21.546703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069ad940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069ad280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069adbb0>]}
10:19:21.579374 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:19:21.579776 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
10:19:21.590185 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
10:19:21.607167 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
10:19:21.613977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '859b2207-edf7-485f-9e8d-4c341189456a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b46fd0>]}
10:19:21.618431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '859b2207-edf7-485f-9e8d-4c341189456a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a62e80>]}
10:19:21.618665 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:19:21.618904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '859b2207-edf7-485f-9e8d-4c341189456a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a62ee0>]}
10:19:21.619894 [info ] [MainThread]: 
10:19:21.620289 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:19:21.620844 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:19:21.621073 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:19:22.761455 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:19:22.762013 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:19:23.298256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '859b2207-edf7-485f-9e8d-4c341189456a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069ac6d0>]}
10:19:23.299176 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:19:23.299606 [info ] [MainThread]: 
10:19:23.304011 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
10:19:23.304371 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
10:19:23.304912 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
10:19:23.305111 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
10:19:23.305319 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
10:19:23.312182 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
10:19:23.312704 [debug] [Thread-1  ]: finished collecting timing info
10:19:23.312899 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
10:19:23.350320 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:19:23.843973 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
10:19:23.844533 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua


    where not exists (select distinct user_id from `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` 
    where ua.user_id = user_id)


group by ua.user_id
        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
10:19:52.175429 [debug] [Thread-1  ]: finished collecting timing info
10:19:52.175943 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '859b2207-edf7-485f-9e8d-4c341189456a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b2dc70>]}
10:19:52.176319 [info ] [Thread-1  ]: 1 of 1 OK created incremental model zz_xavier.ae_user_info_inc ................. [[32mMERGE (487.1k rows, 183.4 MB processed)[0m in 28.87s]
10:19:52.176762 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
10:19:52.177939 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:19:52.178379 [info ] [MainThread]: 
10:19:52.178684 [info ] [MainThread]: Finished running 1 incremental model in 30.56s.
10:19:52.178946 [debug] [MainThread]: Connection 'master' was properly closed.
10:19:52.179093 [debug] [MainThread]: Connection 'model.exercise.ae_user_info_inc' was properly closed.
10:19:52.187020 [info ] [MainThread]: 
10:19:52.187354 [info ] [MainThread]: [32mCompleted successfully[0m
10:19:52.187659 [info ] [MainThread]: 
10:19:52.187906 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
10:19:52.188270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c1c790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b33850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b9efd0>]}


============================== 2022-09-29 10:20:45.448000 | cb9bdd4e-9bc5-4966-9fd6-67a87f8b1f57 ==============================
10:20:45.448025 [info ] [MainThread]: Running with dbt=1.1.2
10:20:45.448627 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_info_inc'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:20:45.449177 [debug] [MainThread]: Tracking: tracking
10:20:45.461041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd7d9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd7d730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd7da90>]}
10:20:45.495316 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:20:45.495701 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_info_inc.sql
10:20:45.505557 [debug] [MainThread]: 1603: static parser failed on ae_user_info_inc.sql
10:20:45.520115 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_info_inc.sql
10:20:45.526436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cb9bdd4e-9bc5-4966-9fd6-67a87f8b1f57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ff220d0>]}
10:20:45.530676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cb9bdd4e-9bc5-4966-9fd6-67a87f8b1f57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10feadd30>]}
10:20:45.530906 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:20:45.531176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb9bdd4e-9bc5-4966-9fd6-67a87f8b1f57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea0e880>]}
10:20:45.532190 [info ] [MainThread]: 
10:20:45.532529 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:20:45.533254 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:20:45.533544 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:20:46.702065 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:20:46.702575 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:20:47.083597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb9bdd4e-9bc5-4966-9fd6-67a87f8b1f57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fe5f280>]}
10:20:47.084542 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:20:47.085041 [info ] [MainThread]: 
10:20:47.089275 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_info_inc
10:20:47.089683 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_info_inc ...................... [RUN]
10:20:47.090266 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_info_inc"
10:20:47.090475 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_info_inc
10:20:47.090700 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_info_inc
10:20:47.097693 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_info_inc"
10:20:47.098206 [debug] [Thread-1  ]: finished collecting timing info
10:20:47.098399 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_info_inc
10:20:47.134540 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:20:47.607016 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_info_inc"
10:20:47.607666 [debug] [Thread-1  ]: On model.exercise.ae_user_info_inc: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_info_inc"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` as DBT_INTERNAL_DEST
        using (
          

select 
    user_id, 
    min(activity_day) as install_day, 
    'campaign 1' as campaign 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua


    where not exists (select user_id from `dwh-adev-observe`.`zz_xavier`.`ae_user_info_inc` 
    where ua.user_id = user_id)


group by ua.user_id
        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`)
    values
        (`user_id`, `install_day`, `campaign`)


  
10:20:54.315777 [debug] [Thread-1  ]: finished collecting timing info
10:20:54.316333 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cb9bdd4e-9bc5-4966-9fd6-67a87f8b1f57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11001e8e0>]}
10:20:54.316755 [info ] [Thread-1  ]: 1 of 1 OK created incremental model zz_xavier.ae_user_info_inc ................. [[32mMERGE (0.0 rows, 197.7 MB processed)[0m in 7.23s]
10:20:54.317249 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_info_inc
10:20:54.318411 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:20:54.318813 [info ] [MainThread]: 
10:20:54.319225 [info ] [MainThread]: Finished running 1 incremental model in 8.79s.
10:20:54.319497 [debug] [MainThread]: Connection 'master' was properly closed.
10:20:54.319651 [debug] [MainThread]: Connection 'model.exercise.ae_user_info_inc' was properly closed.
10:20:54.327564 [info ] [MainThread]: 
10:20:54.327882 [info ] [MainThread]: [32mCompleted successfully[0m
10:20:54.328235 [info ] [MainThread]: 
10:20:54.328489 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
10:20:54.328847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11001e8b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ff953a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110076e50>]}


============================== 2022-09-29 11:13:07.661275 | 2ec4e670-fcf0-4c66-aa46-5afa935c3e99 ==============================
11:13:07.661292 [info ] [MainThread]: Running with dbt=1.1.2
11:13:07.661889 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:13:07.662025 [debug] [MainThread]: Tracking: tracking
11:13:07.673737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075cb5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075cb640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075cb730>]}
11:13:07.709503 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
11:13:07.709854 [debug] [MainThread]: Partial parsing: added file: exercise://models/ae_user_inc_array.sql
11:13:07.720442 [debug] [MainThread]: 1699: static parser successfully parsed ae_user_inc_array.sql
11:13:07.737049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2ec4e670-fcf0-4c66-aa46-5afa935c3e99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107755fa0>]}
11:13:07.741249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2ec4e670-fcf0-4c66-aa46-5afa935c3e99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076f0910>]}
11:13:07.741476 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:13:07.741705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ec4e670-fcf0-4c66-aa46-5afa935c3e99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075c0df0>]}
11:13:07.742743 [info ] [MainThread]: 
11:13:07.743238 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:13:07.743841 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:13:07.744059 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:13:09.053414 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:13:09.053894 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:13:09.485736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ec4e670-fcf0-4c66-aa46-5afa935c3e99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076f06d0>]}
11:13:09.486537 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:13:09.486951 [info ] [MainThread]: 
11:13:09.491187 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
11:13:09.491558 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.ae_user_inc_array ........................... [RUN]
11:13:09.492099 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
11:13:09.492287 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
11:13:09.492493 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
11:13:09.494549 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
11:13:09.495056 [debug] [Thread-1  ]: finished collecting timing info
11:13:09.495257 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
11:13:09.534639 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
11:13:09.535206 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:13:09.535433 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    select ua2.user_id,
    ARRAY(select ua.activity_day 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.user_id = ua2.user_id)
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua2 where user_id = '0'
    group by ua2.user_id
  );
  
11:13:10.790489 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('CREATE TABLE columns must be named, but column 2 has no name at [8:6]')
11:13:12.929522 [debug] [Thread-1  ]: finished collecting timing info
11:13:12.930147 [debug] [Thread-1  ]: Database Error in model ae_user_inc_array (models/ae_user_inc_array.sql)
  CREATE TABLE columns must be named, but column 2 has no name at [8:6]
  compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
11:13:12.930513 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ec4e670-fcf0-4c66-aa46-5afa935c3e99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107854a90>]}
11:13:12.930936 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.ae_user_inc_array .................. [[31mERROR[0m in 3.44s]
11:13:12.931457 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
11:13:12.932876 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:13:12.933407 [info ] [MainThread]: 
11:13:12.933756 [info ] [MainThread]: Finished running 1 table model in 5.19s.
11:13:12.934023 [debug] [MainThread]: Connection 'master' was properly closed.
11:13:12.934168 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
11:13:12.942155 [info ] [MainThread]: 
11:13:12.942449 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
11:13:12.942751 [info ] [MainThread]: 
11:13:12.942987 [error] [MainThread]: [33mDatabase Error in model ae_user_inc_array (models/ae_user_inc_array.sql)[0m
11:13:12.943212 [error] [MainThread]:   CREATE TABLE columns must be named, but column 2 has no name at [8:6]
11:13:12.943424 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
11:13:12.943650 [info ] [MainThread]: 
11:13:12.943896 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
11:13:12.944244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107741ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107741910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077414f0>]}


============================== 2022-09-29 11:14:41.984298 | e0fefb34-50f3-4735-83ed-8470e7faf4d3 ==============================
11:14:41.984316 [info ] [MainThread]: Running with dbt=1.1.2
11:14:41.984827 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:14:41.984982 [debug] [MainThread]: Tracking: tracking
11:14:41.996011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110eeebb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110edaf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110eda880>]}
11:14:42.032186 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
11:14:42.032402 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
11:14:42.037656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e0fefb34-50f3-4735-83ed-8470e7faf4d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110120d0>]}
11:14:42.042179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e0fefb34-50f3-4735-83ed-8470e7faf4d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f8e5e0>]}
11:14:42.042411 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:14:42.042623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0fefb34-50f3-4735-83ed-8470e7faf4d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f8e940>]}
11:14:42.043668 [info ] [MainThread]: 
11:14:42.044018 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:14:42.044615 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:14:42.044835 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:14:43.248350 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:14:43.248810 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:14:43.635160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0fefb34-50f3-4735-83ed-8470e7faf4d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110eda460>]}
11:14:43.636083 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:14:43.636471 [info ] [MainThread]: 
11:14:43.642342 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
11:14:43.642672 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.ae_user_inc_array ........................... [RUN]
11:14:43.643168 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
11:14:43.643351 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
11:14:43.643552 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
11:14:43.646498 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
11:14:43.647008 [debug] [Thread-1  ]: finished collecting timing info
11:14:43.647209 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
11:14:43.685872 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
11:14:43.686455 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:14:43.686684 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    select ua2.user_id,
    ARRAY(select ua.activity_day 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.user_id = ua2.user_id)
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua2 where user_id = '0'
    group by ua2.user_id
  );
  
11:14:44.801156 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('CREATE TABLE columns must be named, but column 2 has no name at [8:6]')
11:14:45.415635 [info ] [MainThread]: [33mThe bigquery adapter does not support query cancellation. Some queries may still be running![0m
11:14:46.626892 [debug] [Thread-1  ]: finished collecting timing info
11:14:46.627504 [debug] [Thread-1  ]: Database Error in model ae_user_inc_array (models/ae_user_inc_array.sql)
  CREATE TABLE columns must be named, but column 2 has no name at [8:6]
  compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
11:14:46.627952 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0fefb34-50f3-4735-83ed-8470e7faf4d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11111ff70>]}
11:14:46.628495 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.ae_user_inc_array .................. [[31mERROR[0m in 2.98s]
11:14:46.628997 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
11:14:46.629306 [info ] [MainThread]: 
11:14:46.629651 [info ] [MainThread]: [33mExited because of keyboard interrupt.[0m
11:14:46.630000 [info ] [MainThread]: 
11:14:46.630277 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=0 SKIP=0 TOTAL=0
11:14:46.630584 [debug] [MainThread]: Connection 'master' was properly closed.
11:14:46.630748 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.


============================== 2022-09-29 11:15:05.878059 | c9c57412-cc2b-4fa0-a9d0-8d8419cec00a ==============================
11:15:05.878085 [info ] [MainThread]: Running with dbt=1.1.2
11:15:05.878653 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:15:05.878850 [debug] [MainThread]: Tracking: tracking
11:15:05.890173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b111f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b11910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b11940>]}
11:15:05.926153 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:15:05.926615 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
11:15:05.938789 [debug] [MainThread]: 1699: static parser successfully parsed ae_user_inc_array.sql
11:15:05.955078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c9c57412-cc2b-4fa0-a9d0-8d8419cec00a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c790d0>]}
11:15:05.959291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c9c57412-cc2b-4fa0-a9d0-8d8419cec00a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bd0c10>]}
11:15:05.959525 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:15:05.959764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c9c57412-cc2b-4fa0-a9d0-8d8419cec00a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bd0e80>]}
11:15:05.960790 [info ] [MainThread]: 
11:15:05.961138 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:15:05.961914 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:15:05.962127 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:15:07.118035 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:15:07.118518 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:15:07.456988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c9c57412-cc2b-4fa0-a9d0-8d8419cec00a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b9f160>]}
11:15:07.457936 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:15:07.458355 [info ] [MainThread]: 
11:15:07.462643 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
11:15:07.463027 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.ae_user_inc_array ........................... [RUN]
11:15:07.463569 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
11:15:07.463755 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
11:15:07.463983 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
11:15:07.466029 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
11:15:07.466515 [debug] [Thread-1  ]: finished collecting timing info
11:15:07.466711 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
11:15:07.505707 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
11:15:07.506281 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:15:07.506513 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    select ua2.user_id,
ARRAY(select ua.activity_day 
from dwh-adev-core.ae_challenge_data.ae_user_activity ua
where ua.user_id = ua2.user_id) as active_days
from dwh-adev-core.ae_challenge_data.ae_user_activity ua2 where user_id = '0'
group by ua2.user_id
  );
  
11:15:11.517365 [debug] [Thread-1  ]: finished collecting timing info
11:15:11.517933 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c9c57412-cc2b-4fa0-a9d0-8d8419cec00a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d322e0>]}
11:15:11.518341 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.ae_user_inc_array ...................... [[32mCREATE TABLE (1.0 rows, 177.4 MB processed)[0m in 4.05s]
11:15:11.518809 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
11:15:11.520005 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:15:11.520404 [info ] [MainThread]: 
11:15:11.520828 [info ] [MainThread]: Finished running 1 table model in 5.56s.
11:15:11.521101 [debug] [MainThread]: Connection 'master' was properly closed.
11:15:11.521257 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
11:15:11.529723 [info ] [MainThread]: 
11:15:11.530039 [info ] [MainThread]: [32mCompleted successfully[0m
11:15:11.530335 [info ] [MainThread]: 
11:15:11.530578 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
11:15:11.530932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063c94c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d45700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d45130>]}


============================== 2022-09-29 11:16:06.743399 | 35c8849f-a544-4eca-8b38-a6bf32bb538c ==============================
11:16:06.743425 [info ] [MainThread]: Running with dbt=1.1.2
11:16:06.743967 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:16:06.744547 [debug] [MainThread]: Tracking: tracking
11:16:06.757054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113facdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113facdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113facee0>]}
11:16:06.793963 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:16:06.794390 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
11:16:06.804837 [debug] [MainThread]: 1699: static parser successfully parsed ae_user_inc_array.sql
11:16:06.820691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '35c8849f-a544-4eca-8b38-a6bf32bb538c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1141060d0>]}
11:16:06.824775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '35c8849f-a544-4eca-8b38-a6bf32bb538c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113facdc0>]}
11:16:06.825005 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:16:06.825219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '35c8849f-a544-4eca-8b38-a6bf32bb538c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c388e0>]}
11:16:06.826215 [info ] [MainThread]: 
11:16:06.826557 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:16:06.827325 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:16:06.827504 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:16:08.038311 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:16:08.038839 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:16:08.414260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '35c8849f-a544-4eca-8b38-a6bf32bb538c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114106f70>]}
11:16:08.415182 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:16:08.415669 [info ] [MainThread]: 
11:16:08.420335 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
11:16:08.420719 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.ae_user_inc_array ........................... [RUN]
11:16:08.421263 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
11:16:08.421461 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
11:16:08.421660 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
11:16:08.423600 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
11:16:08.424109 [debug] [Thread-1  ]: finished collecting timing info
11:16:08.424301 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
11:16:08.441729 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:16:08.815355 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
11:16:08.815978 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    select ua2.user_id,
ARRAY(select ua.activity_day 
from dwh-adev-core.ae_challenge_data.ae_user_activity ua
where ua.user_id = ua2.user_id) as active_days
from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
group by ua2.user_id
  );
  
11:16:23.106823 [debug] [Thread-1  ]: finished collecting timing info
11:16:23.107402 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35c8849f-a544-4eca-8b38-a6bf32bb538c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1140d58e0>]}
11:16:23.107832 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.ae_user_inc_array ...................... [[32mCREATE TABLE (697.0k rows, 177.4 MB processed)[0m in 14.69s]
11:16:23.108326 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
11:16:23.109593 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:16:23.110068 [info ] [MainThread]: 
11:16:23.110395 [info ] [MainThread]: Finished running 1 table model in 16.28s.
11:16:23.110673 [debug] [MainThread]: Connection 'master' was properly closed.
11:16:23.110834 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
11:16:23.119505 [info ] [MainThread]: 
11:16:23.119819 [info ] [MainThread]: [32mCompleted successfully[0m
11:16:23.120121 [info ] [MainThread]: 
11:16:23.120367 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
11:16:23.120722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1141d1f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1141d1bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1141d1a30>]}


============================== 2022-09-29 11:18:55.931238 | 10e9c910-923f-457c-ad5b-9e370d8bc54d ==============================
11:18:55.931254 [info ] [MainThread]: Running with dbt=1.1.2
11:18:55.932030 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:18:55.932294 [debug] [MainThread]: Tracking: tracking
11:18:55.945758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d33ff10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d33f0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d33f3a0>]}
11:18:55.983715 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:18:55.984196 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
11:18:55.997349 [debug] [MainThread]: 1699: static parser successfully parsed ae_user_inc_array.sql
11:18:56.019206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '10e9c910-923f-457c-ad5b-9e370d8bc54d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d49a0d0>]}
11:18:56.024927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '10e9c910-923f-457c-ad5b-9e370d8bc54d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d30f6d0>]}
11:18:56.025269 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:18:56.025561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10e9c910-923f-457c-ad5b-9e370d8bc54d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf918b0>]}
11:18:56.026823 [info ] [MainThread]: 
11:18:56.027268 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:18:56.027945 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:18:56.028215 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:18:57.329512 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:18:57.330045 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:18:57.819402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10e9c910-923f-457c-ad5b-9e370d8bc54d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d32f430>]}
11:18:57.820348 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:18:57.820774 [info ] [MainThread]: 
11:18:57.825186 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
11:18:57.825551 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.ae_user_inc_array ........................... [RUN]
11:18:57.826111 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
11:18:57.826302 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
11:18:57.826509 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
11:18:57.828522 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
11:18:57.829072 [debug] [Thread-1  ]: finished collecting timing info
11:18:57.829290 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
11:18:57.846363 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:18:58.251353 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
11:18:58.251964 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    select ua2.user_id,
ARRAY(select ua.activity_day 
from dwh-adev-core.ae_challenge_data.ae_user_activity ua
where ua.user_id = ua2.user_id) as active_days
from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
group by ua2.user_id
order_by ua2.user_id
  );
  
11:18:58.634225 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got identifier "order_by" at [15:1]')
11:18:59.865747 [debug] [Thread-1  ]: finished collecting timing info
11:18:59.866374 [debug] [Thread-1  ]: Database Error in model ae_user_inc_array (models/ae_user_inc_array.sql)
  Syntax error: Expected ")" but got identifier "order_by" at [15:1]
  compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
11:18:59.866836 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10e9c910-923f-457c-ad5b-9e370d8bc54d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d59db50>]}
11:18:59.867397 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.ae_user_inc_array .................. [[31mERROR[0m in 2.04s]
11:18:59.867916 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
11:18:59.869348 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:18:59.869986 [info ] [MainThread]: 
11:18:59.870442 [info ] [MainThread]: Finished running 1 table model in 3.84s.
11:18:59.870872 [debug] [MainThread]: Connection 'master' was properly closed.
11:18:59.871035 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
11:18:59.879058 [info ] [MainThread]: 
11:18:59.879350 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
11:18:59.879637 [info ] [MainThread]: 
11:18:59.879878 [error] [MainThread]: [33mDatabase Error in model ae_user_inc_array (models/ae_user_inc_array.sql)[0m
11:18:59.880107 [error] [MainThread]:   Syntax error: Expected ")" but got identifier "order_by" at [15:1]
11:18:59.880322 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
11:18:59.880544 [info ] [MainThread]: 
11:18:59.880768 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
11:18:59.881130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d448ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d448b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3e9a90>]}


============================== 2022-09-29 11:19:18.701975 | c2ae381e-318d-4c7d-a728-f03c66dd36d3 ==============================
11:19:18.702004 [info ] [MainThread]: Running with dbt=1.1.2
11:19:18.702597 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:19:18.702780 [debug] [MainThread]: Tracking: tracking
11:19:18.713425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1139fd0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1139fdb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1139fdbe0>]}
11:19:18.749742 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:19:18.750146 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
11:19:18.760920 [debug] [MainThread]: 1699: static parser successfully parsed ae_user_inc_array.sql
11:19:18.776812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c2ae381e-318d-4c7d-a728-f03c66dd36d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113b530d0>]}
11:19:18.780912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c2ae381e-318d-4c7d-a728-f03c66dd36d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113aace80>]}
11:19:18.781145 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:19:18.781383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c2ae381e-318d-4c7d-a728-f03c66dd36d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11264d610>]}
11:19:18.782397 [info ] [MainThread]: 
11:19:18.782742 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:19:18.783296 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:19:18.783610 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:19:20.087804 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:19:20.088353 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:19:20.556455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c2ae381e-318d-4c7d-a728-f03c66dd36d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1139fd400>]}
11:19:20.557246 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:19:20.557660 [info ] [MainThread]: 
11:19:20.561764 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
11:19:20.562141 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.ae_user_inc_array ........................... [RUN]
11:19:20.562688 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
11:19:20.562879 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
11:19:20.563087 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
11:19:20.565114 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
11:19:20.565636 [debug] [Thread-1  ]: finished collecting timing info
11:19:20.565839 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
11:19:20.583441 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:19:21.089479 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
11:19:21.090059 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    select ua2.user_id,
ARRAY(select ua.activity_day 
from dwh-adev-core.ae_challenge_data.ae_user_activity ua
where ua.user_id = ua2.user_id) as active_days
from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
group by ua2.user_id
order by ua2.user_id
  );
  
11:19:33.601652 [debug] [Thread-1  ]: finished collecting timing info
11:19:33.602170 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2ae381e-318d-4c7d-a728-f03c66dd36d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c0b5e0>]}
11:19:33.602564 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.ae_user_inc_array ...................... [[32mCREATE TABLE (697.0k rows, 177.4 MB processed)[0m in 13.04s]
11:19:33.603026 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
11:19:33.604129 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:19:33.604677 [info ] [MainThread]: 
11:19:33.605011 [info ] [MainThread]: Finished running 1 table model in 14.82s.
11:19:33.605271 [debug] [MainThread]: Connection 'master' was properly closed.
11:19:33.605416 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
11:19:33.613696 [info ] [MainThread]: 
11:19:33.613993 [info ] [MainThread]: [32mCompleted successfully[0m
11:19:33.614278 [info ] [MainThread]: 
11:19:33.614514 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
11:19:33.614858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c21400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c21a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c219d0>]}


============================== 2022-09-29 11:31:48.240844 | 516649ea-13ac-4652-8229-9a9875545e06 ==============================
11:31:48.240860 [info ] [MainThread]: Running with dbt=1.1.2
11:31:48.241434 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:31:48.241680 [debug] [MainThread]: Tracking: tracking
11:31:48.253425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd166a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd16280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd16520>]}
11:31:48.287307 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:31:48.287694 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
11:31:48.297961 [debug] [MainThread]: 1603: static parser failed on ae_user_inc_array.sql
11:31:48.312727 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_inc_array.sql
11:31:48.319329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '516649ea-13ac-4652-8229-9a9875545e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10feb1f40>]}
11:31:48.323578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '516649ea-13ac-4652-8229-9a9875545e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fdd0bb0>]}
11:31:48.323811 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:31:48.324052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '516649ea-13ac-4652-8229-9a9875545e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fdd0f10>]}
11:31:48.325096 [info ] [MainThread]: 
11:31:48.325445 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:31:48.326012 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:31:48.326325 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:31:49.486867 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:31:49.487347 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:31:49.919320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '516649ea-13ac-4652-8229-9a9875545e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fda4100>]}
11:31:49.920204 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:31:49.920607 [info ] [MainThread]: 
11:31:49.924904 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
11:31:49.925309 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_inc_array ..................... [RUN]
11:31:49.925892 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
11:31:49.926086 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
11:31:49.926309 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
11:31:49.930705 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
11:31:49.931204 [debug] [Thread-1  ]: finished collecting timing info
11:31:49.931396 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
11:31:49.990023 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
11:31:49.990558 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:31:49.990770 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    

select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua.activity_day 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
    where ua.user_id = ua2.user_id) as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_day <= '2021-09-03'

group by ua.user_id
  );
  
11:31:51.334569 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('An expression references ua.activity_day which is neither grouped nor aggregated at [15:18]')
11:31:53.401418 [debug] [Thread-1  ]: finished collecting timing info
11:31:53.402046 [debug] [Thread-1  ]: Database Error in model ae_user_inc_array (models/ae_user_inc_array.sql)
  An expression references ua.activity_day which is neither grouped nor aggregated at [15:18]
  compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
11:31:53.402494 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '516649ea-13ac-4652-8229-9a9875545e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ff5bb80>]}
11:31:53.403020 [error] [Thread-1  ]: 1 of 1 ERROR creating incremental model zz_xavier.ae_user_inc_array ............ [[31mERROR[0m in 3.48s]
11:31:53.403598 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
11:31:53.404959 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:31:53.405447 [info ] [MainThread]: 
11:31:53.405809 [info ] [MainThread]: Finished running 1 incremental model in 5.08s.
11:31:53.406105 [debug] [MainThread]: Connection 'master' was properly closed.
11:31:53.406271 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
11:31:53.414785 [info ] [MainThread]: 
11:31:53.415108 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
11:31:53.415406 [info ] [MainThread]: 
11:31:53.415657 [error] [MainThread]: [33mDatabase Error in model ae_user_inc_array (models/ae_user_inc_array.sql)[0m
11:31:53.415968 [error] [MainThread]:   An expression references ua.activity_day which is neither grouped nor aggregated at [15:18]
11:31:53.416210 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
11:31:53.416446 [info ] [MainThread]: 
11:31:53.416682 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
11:31:53.417041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fe9cac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fe9c9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ff71130>]}


============================== 2022-09-29 11:33:22.498680 | 17889591-9f9e-4c58-bc78-1c7553aed3c8 ==============================
11:33:22.498703 [info ] [MainThread]: Running with dbt=1.1.2
11:33:22.499486 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:33:22.499964 [debug] [MainThread]: Tracking: tracking
11:33:22.513881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4cfd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4cfd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4cf8e0>]}
11:33:22.557308 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:33:22.557760 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
11:33:22.572551 [debug] [MainThread]: 1603: static parser failed on ae_user_inc_array.sql
11:33:22.592261 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_inc_array.sql
11:33:22.600928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '17889591-9f9e-4c58-bc78-1c7553aed3c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c63a0d0>]}
11:33:22.606967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '17889591-9f9e-4c58-bc78-1c7553aed3c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5d0e50>]}
11:33:22.607309 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:33:22.607593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '17889591-9f9e-4c58-bc78-1c7553aed3c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5c9c70>]}
11:33:22.608908 [info ] [MainThread]: 
11:33:22.609378 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:33:22.610080 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:33:22.610341 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:33:24.069477 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:33:24.069925 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:33:24.581145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '17889591-9f9e-4c58-bc78-1c7553aed3c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b128dc0>]}
11:33:24.582156 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:33:24.582659 [info ] [MainThread]: 
11:33:24.587641 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
11:33:24.588027 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_inc_array ..................... [RUN]
11:33:24.588553 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
11:33:24.588736 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
11:33:24.588938 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
11:33:24.593391 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
11:33:24.593948 [debug] [Thread-1  ]: finished collecting timing info
11:33:24.594145 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
11:33:24.656684 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
11:33:24.657257 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:33:24.657489 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    

select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua2.activity_day 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
    where ua.user_id = ua2.user_id) as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_day <= '2021-09-03'

group by ua.user_id
  );
  
11:33:34.007185 [debug] [Thread-1  ]: finished collecting timing info
11:33:34.007759 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '17889591-9f9e-4c58-bc78-1c7553aed3c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c71e310>]}
11:33:34.008182 [info ] [Thread-1  ]: 1 of 1 OK created incremental model zz_xavier.ae_user_inc_array ................ [[32mCREATE TABLE (171.5k rows, 177.4 MB processed)[0m in 9.42s]
11:33:34.008667 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
11:33:34.009945 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:33:34.010409 [info ] [MainThread]: 
11:33:34.010727 [info ] [MainThread]: Finished running 1 incremental model in 11.40s.
11:33:34.011005 [debug] [MainThread]: Connection 'master' was properly closed.
11:33:34.011156 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
11:33:34.019156 [info ] [MainThread]: 
11:33:34.019458 [info ] [MainThread]: [32mCompleted successfully[0m
11:33:34.019760 [info ] [MainThread]: 
11:33:34.020000 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
11:33:34.020349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c730ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c6f13a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c735af0>]}


============================== 2022-09-29 11:34:49.656920 | bfde4409-d7fa-46da-a29d-4430c227649b ==============================
11:34:49.656936 [info ] [MainThread]: Running with dbt=1.1.2
11:34:49.658072 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:34:49.658376 [debug] [MainThread]: Tracking: tracking
11:34:49.670095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105741d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043e1f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10572a3d0>]}
11:34:49.706663 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:34:49.707120 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
11:34:49.718782 [debug] [MainThread]: 1603: static parser failed on ae_user_inc_array.sql
11:34:49.733582 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_inc_array.sql
11:34:49.740078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bfde4409-d7fa-46da-a29d-4430c227649b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058b70d0>]}
11:34:49.744284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bfde4409-d7fa-46da-a29d-4430c227649b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105744340>]}
11:34:49.744518 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:34:49.744736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bfde4409-d7fa-46da-a29d-4430c227649b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105744940>]}
11:34:49.745724 [info ] [MainThread]: 
11:34:49.746069 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:34:49.746606 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:34:49.746872 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:34:51.093898 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:34:51.094406 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:34:51.517024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bfde4409-d7fa-46da-a29d-4430c227649b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105724760>]}
11:34:51.517925 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:34:51.518394 [info ] [MainThread]: 
11:34:51.522619 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
11:34:51.523005 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_inc_array ..................... [RUN]
11:34:51.523554 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
11:34:51.523747 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
11:34:51.523971 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
11:34:51.528477 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
11:34:51.529015 [debug] [Thread-1  ]: finished collecting timing info
11:34:51.529212 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
11:34:51.587782 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
11:34:51.588297 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:34:51.588504 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    

select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua2.activity_day 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
    where ua.user_id = ua2.user_id and where ua.activity_day <= '2021-09-03') 
    as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_day <= '2021-09-03'

group by ua.user_id
  );
  
11:34:52.108505 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected keyword WHERE at [17:40]')
11:34:52.894217 [debug] [Thread-1  ]: finished collecting timing info
11:34:52.894840 [debug] [Thread-1  ]: Database Error in model ae_user_inc_array (models/ae_user_inc_array.sql)
  Syntax error: Unexpected keyword WHERE at [17:40]
  compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
11:34:52.895285 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bfde4409-d7fa-46da-a29d-4430c227649b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059a0d30>]}
11:34:52.895814 [error] [Thread-1  ]: 1 of 1 ERROR creating incremental model zz_xavier.ae_user_inc_array ............ [[31mERROR[0m in 1.37s]
11:34:52.896364 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
11:34:52.897741 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:34:52.898187 [info ] [MainThread]: 
11:34:52.898663 [info ] [MainThread]: Finished running 1 incremental model in 3.15s.
11:34:52.898961 [debug] [MainThread]: Connection 'master' was properly closed.
11:34:52.899130 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
11:34:52.907458 [info ] [MainThread]: 
11:34:52.907763 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
11:34:52.908050 [info ] [MainThread]: 
11:34:52.908289 [error] [MainThread]: [33mDatabase Error in model ae_user_inc_array (models/ae_user_inc_array.sql)[0m
11:34:52.908522 [error] [MainThread]:   Syntax error: Unexpected keyword WHERE at [17:40]
11:34:52.908739 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
11:34:52.908963 [info ] [MainThread]: 
11:34:52.909192 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
11:34:52.909645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058ca430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058cafd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059aef10>]}


============================== 2022-09-29 11:35:22.182383 | ce34c0de-5503-4446-a573-823f21dde949 ==============================
11:35:22.182401 [info ] [MainThread]: Running with dbt=1.1.2
11:35:22.182983 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:35:22.183188 [debug] [MainThread]: Tracking: tracking
11:35:22.195067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eaa91c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eaa9580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eaa9070>]}
11:35:22.230183 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:35:22.230578 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
11:35:22.240797 [debug] [MainThread]: 1603: static parser failed on ae_user_inc_array.sql
11:35:22.254973 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_inc_array.sql
11:35:22.261018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ce34c0de-5503-4446-a573-823f21dde949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ec1c0d0>]}
11:35:22.264985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ce34c0de-5503-4446-a573-823f21dde949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ebaedf0>]}
11:35:22.265215 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:35:22.265444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce34c0de-5503-4446-a573-823f21dde949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ebaee80>]}
11:35:22.266443 [info ] [MainThread]: 
11:35:22.266780 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:35:22.267351 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:35:22.267736 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:35:23.676616 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:35:23.677188 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:35:24.080838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce34c0de-5503-4446-a573-823f21dde949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ebaec10>]}
11:35:24.081716 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:35:24.082107 [info ] [MainThread]: 
11:35:24.086568 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
11:35:24.086960 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_inc_array ..................... [RUN]
11:35:24.087510 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
11:35:24.087708 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
11:35:24.087923 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
11:35:24.092313 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
11:35:24.092812 [debug] [Thread-1  ]: finished collecting timing info
11:35:24.093007 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
11:35:24.151208 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
11:35:24.151725 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:35:24.151933 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    

select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua2.activity_day 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
    where ua.user_id = ua2.user_id and ua2.activity_day <= '2021-09-03') 
    as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua
    where ua.activity_day <= '2021-09-03'

group by ua.user_id
  );
  
11:35:29.339201 [debug] [Thread-1  ]: finished collecting timing info
11:35:29.339693 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce34c0de-5503-4446-a573-823f21dde949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ecee9a0>]}
11:35:29.340051 [info ] [Thread-1  ]: 1 of 1 OK created incremental model zz_xavier.ae_user_inc_array ................ [[32mCREATE TABLE (171.5k rows, 177.4 MB processed)[0m in 5.25s]
11:35:29.340472 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
11:35:29.341509 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:35:29.341882 [info ] [MainThread]: 
11:35:29.342270 [info ] [MainThread]: Finished running 1 incremental model in 7.08s.
11:35:29.342534 [debug] [MainThread]: Connection 'master' was properly closed.
11:35:29.342675 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
11:35:29.350411 [info ] [MainThread]: 
11:35:29.350734 [info ] [MainThread]: [32mCompleted successfully[0m
11:35:29.351039 [info ] [MainThread]: 
11:35:29.351280 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
11:35:29.351630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ed12eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ec2f3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eafacd0>]}


============================== 2022-09-29 11:42:05.173830 | 931a4200-e7d0-4bcf-98ad-06e20b834b7a ==============================
11:42:05.173856 [info ] [MainThread]: Running with dbt=1.1.2
11:42:05.174683 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:42:05.174872 [debug] [MainThread]: Tracking: tracking
11:42:05.188252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085ac070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10857ba00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10857bb80>]}
11:42:05.222929 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:42:05.223300 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
11:42:05.233051 [debug] [MainThread]: 1603: static parser failed on ae_user_inc_array.sql
11:42:05.247098 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_inc_array.sql
11:42:05.253209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '931a4200-e7d0-4bcf-98ad-06e20b834b7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108735f40>]}
11:42:05.257226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '931a4200-e7d0-4bcf-98ad-06e20b834b7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10859c490>]}
11:42:05.257446 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:42:05.257651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '931a4200-e7d0-4bcf-98ad-06e20b834b7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10859c340>]}
11:42:05.258658 [info ] [MainThread]: 
11:42:05.259067 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:42:05.259733 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:42:05.259943 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:42:06.526164 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:42:06.526682 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:42:07.008876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '931a4200-e7d0-4bcf-98ad-06e20b834b7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086a3eb0>]}
11:42:07.009760 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:42:07.010129 [info ] [MainThread]: 
11:42:07.014464 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
11:42:07.014849 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_inc_array ..................... [RUN]
11:42:07.015404 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
11:42:07.015599 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
11:42:07.015849 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
11:42:07.022604 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
11:42:07.023081 [debug] [Thread-1  ]: finished collecting timing info
11:42:07.023275 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
11:42:07.059570 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:42:07.674393 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
11:42:07.674998 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array` as DBT_INTERNAL_DEST
        using (
          

select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua2.activity_day 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
    where ua.user_id = ua2.user_id as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua


    where (not exists (select user_id from `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array` 
    where ua.user_id = user_id) 
    or (user_id = ua.user_id and active_days <> ua.active_days)) 
    and ua.activity_day <= '2021-09-06'


group by ua.user_id
        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`,`active_days` = DBT_INTERNAL_SOURCE.`active_days`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`, `active_days`)
    values
        (`user_id`, `install_day`, `campaign`, `active_days`)


  
11:42:08.019535 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword AS at [21:36]')
11:42:09.392629 [debug] [Thread-1  ]: finished collecting timing info
11:42:09.393272 [debug] [Thread-1  ]: Database Error in model ae_user_inc_array (models/ae_user_inc_array.sql)
  Syntax error: Expected ")" but got keyword AS at [21:36]
  compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
11:42:09.393753 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '931a4200-e7d0-4bcf-98ad-06e20b834b7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087f9be0>]}
11:42:09.394307 [error] [Thread-1  ]: 1 of 1 ERROR creating incremental model zz_xavier.ae_user_inc_array ............ [[31mERROR[0m in 2.38s]
11:42:09.394846 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
11:42:09.396282 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:42:09.396829 [info ] [MainThread]: 
11:42:09.397192 [info ] [MainThread]: Finished running 1 incremental model in 4.14s.
11:42:09.397503 [debug] [MainThread]: Connection 'master' was properly closed.
11:42:09.397678 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
11:42:09.406100 [info ] [MainThread]: 
11:42:09.406400 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
11:42:09.406692 [info ] [MainThread]: 
11:42:09.406943 [error] [MainThread]: [33mDatabase Error in model ae_user_inc_array (models/ae_user_inc_array.sql)[0m
11:42:09.407182 [error] [MainThread]:   Syntax error: Expected ")" but got keyword AS at [21:36]
11:42:09.407406 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
11:42:09.407634 [info ] [MainThread]: 
11:42:09.407873 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
11:42:09.408226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087cfd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087cfbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087f93a0>]}


============================== 2022-09-29 11:42:38.429947 | 39278d95-847e-47f1-b95c-273d1e938c69 ==============================
11:42:38.429965 [info ] [MainThread]: Running with dbt=1.1.2
11:42:38.430855 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:42:38.431000 [debug] [MainThread]: Tracking: tracking
11:42:38.442093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056ed370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056ed400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056ede20>]}
11:42:38.480548 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:42:38.480994 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
11:42:38.492321 [debug] [MainThread]: 1603: static parser failed on ae_user_inc_array.sql
11:42:38.511412 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_inc_array.sql
11:42:38.521159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '39278d95-847e-47f1-b95c-273d1e938c69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10587b0d0>]}
11:42:38.527056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '39278d95-847e-47f1-b95c-273d1e938c69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057e4e50>]}
11:42:38.527407 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:42:38.527764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '39278d95-847e-47f1-b95c-273d1e938c69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057e4ee0>]}
11:42:38.529118 [info ] [MainThread]: 
11:42:38.529599 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:42:38.530320 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:42:38.530588 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:42:39.910114 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:42:39.910666 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:42:40.392707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '39278d95-847e-47f1-b95c-273d1e938c69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057e4c70>]}
11:42:40.393479 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:42:40.394033 [info ] [MainThread]: 
11:42:40.398024 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
11:42:40.398369 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_inc_array ..................... [RUN]
11:42:40.398891 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
11:42:40.399076 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
11:42:40.399290 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
11:42:40.406201 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
11:42:40.406715 [debug] [Thread-1  ]: finished collecting timing info
11:42:40.406926 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
11:42:40.443040 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:42:40.879502 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
11:42:40.880069 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array` as DBT_INTERNAL_DEST
        using (
          

select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua2.activity_day 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
    where ua.user_id = ua2.user_id) as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua


    where (not exists (select user_id from `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array` 
    where ua.user_id = user_id) 
    or (user_id = ua.user_id and active_days <> ua.active_days)) 
    and ua.activity_day <= '2021-09-06'


group by ua.user_id
        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`,`active_days` = DBT_INTERNAL_SOURCE.`active_days`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`, `active_days`)
    values
        (`user_id`, `install_day`, `campaign`, `active_days`)


  
11:42:42.347489 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: active_days; Did you mean activity_day? at [27:34]')
11:42:44.520401 [debug] [Thread-1  ]: finished collecting timing info
11:42:44.520912 [debug] [Thread-1  ]: Database Error in model ae_user_inc_array (models/ae_user_inc_array.sql)
  Unrecognized name: active_days; Did you mean activity_day? at [27:34]
  compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
11:42:44.521253 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '39278d95-847e-47f1-b95c-273d1e938c69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10593a370>]}
11:42:44.521650 [error] [Thread-1  ]: 1 of 1 ERROR creating incremental model zz_xavier.ae_user_inc_array ............ [[31mERROR[0m in 4.12s]
11:42:44.522118 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
11:42:44.523346 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:42:44.523805 [info ] [MainThread]: 
11:42:44.524125 [info ] [MainThread]: Finished running 1 incremental model in 5.99s.
11:42:44.524400 [debug] [MainThread]: Connection 'master' was properly closed.
11:42:44.524548 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
11:42:44.532197 [info ] [MainThread]: 
11:42:44.532491 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
11:42:44.532779 [info ] [MainThread]: 
11:42:44.533027 [error] [MainThread]: [33mDatabase Error in model ae_user_inc_array (models/ae_user_inc_array.sql)[0m
11:42:44.533267 [error] [MainThread]:   Unrecognized name: active_days; Did you mean activity_day? at [27:34]
11:42:44.533484 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
11:42:44.533707 [info ] [MainThread]: 
11:42:44.533933 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
11:42:44.534279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105911bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105911a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10593a1c0>]}


============================== 2022-09-29 11:43:48.932931 | ef481cb6-3459-4b72-998f-899085ff2dd7 ==============================
11:43:48.932960 [info ] [MainThread]: Running with dbt=1.1.2
11:43:48.933658 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:43:48.933823 [debug] [MainThread]: Tracking: tracking
11:43:48.945536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104293c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105631b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056314f0>]}
11:43:48.983645 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:43:48.984102 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
11:43:48.996913 [debug] [MainThread]: 1603: static parser failed on ae_user_inc_array.sql
11:43:49.013304 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_inc_array.sql
11:43:49.019758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ef481cb6-3459-4b72-998f-899085ff2dd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057a40d0>]}
11:43:49.023926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ef481cb6-3459-4b72-998f-899085ff2dd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105738a90>]}
11:43:49.024154 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
11:43:49.024390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ef481cb6-3459-4b72-998f-899085ff2dd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104293c10>]}
11:43:49.025408 [info ] [MainThread]: 
11:43:49.025757 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:43:49.026326 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
11:43:49.026548 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:43:50.130182 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
11:43:50.130734 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:43:50.567461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ef481cb6-3459-4b72-998f-899085ff2dd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105738b80>]}
11:43:50.568407 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
11:43:50.568915 [info ] [MainThread]: 
11:43:50.573258 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
11:43:50.573666 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_inc_array ..................... [RUN]
11:43:50.574214 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
11:43:50.574421 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
11:43:50.574639 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
11:43:50.581562 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
11:43:50.582066 [debug] [Thread-1  ]: finished collecting timing info
11:43:50.582258 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
11:43:50.617872 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:43:51.052640 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
11:43:51.053210 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array` as DBT_INTERNAL_DEST
        using (
          

select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua2.activity_day 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
    where ua.user_id = ua2.user_id) as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua


    where (not exists (select user_id from `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array` 
    where ua.user_id = user_id) 
    or (user_id = ua.user_id and active_days = ua.active_days)) 
    and ua.activity_day <= '2021-09-06'


group by ua.user_id
        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`,`active_days` = DBT_INTERNAL_SOURCE.`active_days`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`, `active_days`)
    values
        (`user_id`, `install_day`, `campaign`, `active_days`)


  
11:43:52.621132 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: active_days; Did you mean activity_day? at [27:34]')
11:43:54.456241 [debug] [Thread-1  ]: finished collecting timing info
11:43:54.456875 [debug] [Thread-1  ]: Database Error in model ae_user_inc_array (models/ae_user_inc_array.sql)
  Unrecognized name: active_days; Did you mean activity_day? at [27:34]
  compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
11:43:54.457327 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ef481cb6-3459-4b72-998f-899085ff2dd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10588f520>]}
11:43:54.457870 [error] [Thread-1  ]: 1 of 1 ERROR creating incremental model zz_xavier.ae_user_inc_array ............ [[31mERROR[0m in 3.88s]
11:43:54.458438 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
11:43:54.459941 [debug] [MainThread]: Acquiring new bigquery connection "master"
11:43:54.460380 [info ] [MainThread]: 
11:43:54.460713 [info ] [MainThread]: Finished running 1 incremental model in 5.43s.
11:43:54.461027 [debug] [MainThread]: Connection 'master' was properly closed.
11:43:54.461191 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
11:43:54.469514 [info ] [MainThread]: 
11:43:54.469807 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
11:43:54.470104 [info ] [MainThread]: 
11:43:54.470345 [error] [MainThread]: [33mDatabase Error in model ae_user_inc_array (models/ae_user_inc_array.sql)[0m
11:43:54.470574 [error] [MainThread]:   Unrecognized name: active_days; Did you mean activity_day? at [27:34]
11:43:54.470792 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
11:43:54.471018 [info ] [MainThread]: 
11:43:54.471246 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
11:43:54.471589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057b8c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057b8730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058a6cd0>]}


============================== 2022-09-30 06:22:03.925857 | 5c23e136-9e9f-4ba4-ae74-fd4430e381ea ==============================
06:22:03.925872 [info ] [MainThread]: Running with dbt=1.1.2
06:22:03.926758 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
06:22:03.927445 [debug] [MainThread]: Tracking: tracking
06:22:03.943081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111372940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113726a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111372550>]}
06:22:03.996629 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
06:22:03.997106 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
06:22:04.011753 [debug] [MainThread]: 1603: static parser failed on ae_user_inc_array.sql
06:22:04.029955 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_inc_array.sql
06:22:04.038670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5c23e136-9e9f-4ba4-ae74-fd4430e381ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11152f0d0>]}
06:22:04.044485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5c23e136-9e9f-4ba4-ae74-fd4430e381ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113f6640>]}
06:22:04.044767 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
06:22:04.045028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c23e136-9e9f-4ba4-ae74-fd4430e381ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11149eee0>]}
06:22:04.046205 [info ] [MainThread]: 
06:22:04.046620 [debug] [MainThread]: Acquiring new bigquery connection "master"
06:22:04.047286 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
06:22:04.047533 [debug] [ThreadPool]: Opening a new connection, currently in state init
06:22:06.023660 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
06:22:06.024184 [debug] [ThreadPool]: Opening a new connection, currently in state closed
06:22:06.451060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c23e136-9e9f-4ba4-ae74-fd4430e381ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11139a7c0>]}
06:22:06.451905 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
06:22:06.452268 [info ] [MainThread]: 
06:22:06.458655 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
06:22:06.459073 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_inc_array ..................... [RUN]
06:22:06.459629 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
06:22:06.459812 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
06:22:06.460016 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
06:22:06.467032 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
06:22:06.467610 [debug] [Thread-1  ]: finished collecting timing info
06:22:06.467800 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
06:22:06.503581 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
06:22:07.110861 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
06:22:07.111495 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array` as DBT_INTERNAL_DEST
        using (
          

select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua2.activity_day 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
    where ua.user_id = ua2.user_id) as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua


    where (not exists (select user_id from `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array` 
    where ua.user_id = user_id) 
    or (user_id = ua.user_id and ARRAY_LENGTH(active_days) = (ua.active_days))) 
    and ua.activity_day <= '2021-09-06'


group by ua.user_id
        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`,`active_days` = DBT_INTERNAL_SOURCE.`active_days`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`, `active_days`)
    values
        (`user_id`, `install_day`, `campaign`, `active_days`)


  
06:22:09.620030 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: active_days; Did you mean activity_day? at [27:47]')
06:22:12.282008 [debug] [Thread-1  ]: finished collecting timing info
06:22:12.282665 [debug] [Thread-1  ]: Database Error in model ae_user_inc_array (models/ae_user_inc_array.sql)
  Unrecognized name: active_days; Did you mean activity_day? at [27:47]
  compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
06:22:12.283118 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c23e136-9e9f-4ba4-ae74-fd4430e381ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115f7370>]}
06:22:12.283649 [error] [Thread-1  ]: 1 of 1 ERROR creating incremental model zz_xavier.ae_user_inc_array ............ [[31mERROR[0m in 5.82s]
06:22:12.284200 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
06:22:12.285659 [debug] [MainThread]: Acquiring new bigquery connection "master"
06:22:12.286191 [info ] [MainThread]: 
06:22:12.286567 [info ] [MainThread]: Finished running 1 incremental model in 8.24s.
06:22:12.286877 [debug] [MainThread]: Connection 'master' was properly closed.
06:22:12.287064 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
06:22:12.295759 [info ] [MainThread]: 
06:22:12.296066 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
06:22:12.296447 [info ] [MainThread]: 
06:22:12.296723 [error] [MainThread]: [33mDatabase Error in model ae_user_inc_array (models/ae_user_inc_array.sql)[0m
06:22:12.296976 [error] [MainThread]:   Unrecognized name: active_days; Did you mean activity_day? at [27:47]
06:22:12.297216 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
06:22:12.297453 [info ] [MainThread]: 
06:22:12.297687 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
06:22:12.298147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115c16d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115c1790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115d1fa0>]}


============================== 2022-09-30 06:22:53.018207 | 93037442-f5ab-41bf-88ee-f36decd2376a ==============================
06:22:53.018222 [info ] [MainThread]: Running with dbt=1.1.2
06:22:53.018775 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
06:22:53.018960 [debug] [MainThread]: Tracking: tracking
06:22:53.031378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088a9c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088a9f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088a90a0>]}
06:22:53.063218 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
06:22:53.063583 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
06:22:53.073318 [debug] [MainThread]: 1603: static parser failed on ae_user_inc_array.sql
06:22:53.087308 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ae_user_inc_array.sql
06:22:53.093398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '93037442-f5ab-41bf-88ee-f36decd2376a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a1c0d0>]}
06:22:53.097370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '93037442-f5ab-41bf-88ee-f36decd2376a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088b9bb0>]}
06:22:53.097587 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
06:22:53.097804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '93037442-f5ab-41bf-88ee-f36decd2376a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088b9640>]}
06:22:53.098765 [info ] [MainThread]: 
06:22:53.099098 [debug] [MainThread]: Acquiring new bigquery connection "master"
06:22:53.099629 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
06:22:53.099930 [debug] [ThreadPool]: Opening a new connection, currently in state init
06:22:54.288691 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
06:22:54.289232 [debug] [ThreadPool]: Opening a new connection, currently in state closed
06:22:54.765259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '93037442-f5ab-41bf-88ee-f36decd2376a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089afd60>]}
06:22:54.766142 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
06:22:54.766521 [info ] [MainThread]: 
06:22:54.770845 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
06:22:54.771222 [info ] [Thread-1  ]: 1 of 1 START incremental model zz_xavier.ae_user_inc_array ..................... [RUN]
06:22:54.771770 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
06:22:54.771959 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
06:22:54.772170 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
06:22:54.778895 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
06:22:54.779396 [debug] [Thread-1  ]: finished collecting timing info
06:22:54.779602 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
06:22:54.815389 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
06:22:55.316751 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
06:22:55.317332 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */

        
            
            
        
    

    

    merge into `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array` as DBT_INTERNAL_DEST
        using (
          

select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua2.activity_day 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
    where ua.user_id = ua2.user_id) as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua


    where (not exists (select user_id from `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array` 
    where ua.user_id = user_id) 
    or (user_id = ua.user_id and 
    ARRAY_LENGTH(active_days) = ARRAY_LENGTH(ua.active_days))) 
    and ua.activity_day <= '2021-09-06'


group by ua.user_id
        ) as DBT_INTERNAL_SOURCE
        on 
                DBT_INTERNAL_SOURCE.user_id = DBT_INTERNAL_DEST.user_id
            

    
    when matched then update set
        `user_id` = DBT_INTERNAL_SOURCE.`user_id`,`install_day` = DBT_INTERNAL_SOURCE.`install_day`,`campaign` = DBT_INTERNAL_SOURCE.`campaign`,`active_days` = DBT_INTERNAL_SOURCE.`active_days`
    

    when not matched then insert
        (`user_id`, `install_day`, `campaign`, `active_days`)
    values
        (`user_id`, `install_day`, `campaign`, `active_days`)


  
06:22:57.751093 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: active_days; Did you mean activity_day? at [28:18]')
06:23:00.331583 [debug] [Thread-1  ]: finished collecting timing info
06:23:00.332225 [debug] [Thread-1  ]: Database Error in model ae_user_inc_array (models/ae_user_inc_array.sql)
  Unrecognized name: active_days; Did you mean activity_day? at [28:18]
  compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
06:23:00.332675 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93037442-f5ab-41bf-88ee-f36decd2376a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b05340>]}
06:23:00.333213 [error] [Thread-1  ]: 1 of 1 ERROR creating incremental model zz_xavier.ae_user_inc_array ............ [[31mERROR[0m in 5.56s]
06:23:00.333750 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
06:23:00.335208 [debug] [MainThread]: Acquiring new bigquery connection "master"
06:23:00.335817 [info ] [MainThread]: 
06:23:00.336175 [info ] [MainThread]: Finished running 1 incremental model in 7.24s.
06:23:00.336498 [debug] [MainThread]: Connection 'master' was properly closed.
06:23:00.336679 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
06:23:00.344906 [info ] [MainThread]: 
06:23:00.345197 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
06:23:00.345488 [info ] [MainThread]: 
06:23:00.345733 [error] [MainThread]: [33mDatabase Error in model ae_user_inc_array (models/ae_user_inc_array.sql)[0m
06:23:00.345968 [error] [MainThread]:   Unrecognized name: active_days; Did you mean activity_day? at [28:18]
06:23:00.346345 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
06:23:00.346598 [info ] [MainThread]: 
06:23:00.346845 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
06:23:00.347264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a2e850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a2e2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b71100>]}


============================== 2022-09-30 07:09:10.391277 | 7843c80a-3191-4609-881d-7bbe6a72256b ==============================
07:09:10.391293 [info ] [MainThread]: Running with dbt=1.1.2
07:09:10.391954 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
07:09:10.392206 [debug] [MainThread]: Tracking: tracking
07:09:10.404851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c26a8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c256460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c2560a0>]}
07:09:10.437449 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
07:09:10.437812 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
07:09:10.451640 [debug] [MainThread]: 1699: static parser successfully parsed ae_user_inc_array.sql
07:09:10.470817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7843c80a-3191-4609-881d-7bbe6a72256b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3c3fd0>]}
07:09:10.475567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7843c80a-3191-4609-881d-7bbe6a72256b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c360f40>]}
07:09:10.475812 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
07:09:10.476037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7843c80a-3191-4609-881d-7bbe6a72256b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c360b50>]}
07:09:10.477289 [info ] [MainThread]: 
07:09:10.477806 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:09:10.478452 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
07:09:10.478685 [debug] [ThreadPool]: Opening a new connection, currently in state init
07:09:11.639660 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
07:09:11.640152 [debug] [ThreadPool]: Opening a new connection, currently in state closed
07:09:12.099474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7843c80a-3191-4609-881d-7bbe6a72256b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c26ae80>]}
07:09:12.100352 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
07:09:12.100739 [info ] [MainThread]: 
07:09:12.104975 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
07:09:12.105336 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.ae_user_inc_array ........................... [RUN]
07:09:12.105881 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
07:09:12.106080 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
07:09:12.106330 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
07:09:12.108396 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
07:09:12.108907 [debug] [Thread-1  ]: finished collecting timing info
07:09:12.109102 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
07:09:12.126148 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:09:12.701998 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
07:09:12.702610 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua2.activity_day 
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
    where ua.user_id = ua2.user_id) as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua    
    and ua.activity_day <= '2021-09-06'
group by ua.user_id
  );
  
07:09:13.086454 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword AND at [17:5]')
07:09:14.433812 [debug] [Thread-1  ]: finished collecting timing info
07:09:14.434442 [debug] [Thread-1  ]: Database Error in model ae_user_inc_array (models/ae_user_inc_array.sql)
  Syntax error: Expected ")" but got keyword AND at [17:5]
  compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
07:09:14.434890 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7843c80a-3191-4609-881d-7bbe6a72256b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4bf220>]}
07:09:14.435418 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.ae_user_inc_array .................. [[31mERROR[0m in 2.33s]
07:09:14.435979 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
07:09:14.437348 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:09:14.437800 [info ] [MainThread]: 
07:09:14.438185 [info ] [MainThread]: Finished running 1 table model in 3.96s.
07:09:14.438490 [debug] [MainThread]: Connection 'master' was properly closed.
07:09:14.438664 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
07:09:14.447466 [info ] [MainThread]: 
07:09:14.447791 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
07:09:14.448089 [info ] [MainThread]: 
07:09:14.448336 [error] [MainThread]: [33mDatabase Error in model ae_user_inc_array (models/ae_user_inc_array.sql)[0m
07:09:14.448570 [error] [MainThread]:   Syntax error: Expected ")" but got keyword AND at [17:5]
07:09:14.448793 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
07:09:14.449019 [info ] [MainThread]: 
07:09:14.449253 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
07:09:14.449602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3afdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3af2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c382d00>]}


============================== 2022-09-30 07:10:03.027184 | 7dcfc591-e4ef-427c-a50b-1bb33576080d ==============================
07:10:03.027229 [info ] [MainThread]: Running with dbt=1.1.2
07:10:03.027903 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
07:10:03.028074 [debug] [MainThread]: Tracking: tracking
07:10:03.040373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074078b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087a6820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087a6220>]}
07:10:03.072523 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
07:10:03.072865 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
07:10:03.083046 [debug] [MainThread]: 1699: static parser successfully parsed ae_user_inc_array.sql
07:10:03.098547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7dcfc591-e4ef-427c-a50b-1bb33576080d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10890d0d0>]}
07:10:03.102545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7dcfc591-e4ef-427c-a50b-1bb33576080d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088ab9d0>]}
07:10:03.102768 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
07:10:03.102980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7dcfc591-e4ef-427c-a50b-1bb33576080d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088abbe0>]}
07:10:03.103935 [info ] [MainThread]: 
07:10:03.104261 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:10:03.104789 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
07:10:03.105109 [debug] [ThreadPool]: Opening a new connection, currently in state init
07:10:04.393340 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
07:10:04.393916 [debug] [ThreadPool]: Opening a new connection, currently in state closed
07:10:04.801711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7dcfc591-e4ef-427c-a50b-1bb33576080d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087a2730>]}
07:10:04.802548 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
07:10:04.802945 [info ] [MainThread]: 
07:10:04.807184 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
07:10:04.807572 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.ae_user_inc_array ........................... [RUN]
07:10:04.808141 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
07:10:04.808337 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
07:10:04.808578 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
07:10:04.810673 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
07:10:04.811205 [debug] [Thread-1  ]: finished collecting timing info
07:10:04.811404 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
07:10:04.828667 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:10:05.320464 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
07:10:05.321081 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua2.activity_day 
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id) as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua    
    where ua.activity_day <= '2021-09-06'
group by ua.user_id
  );
  
07:10:15.353515 [debug] [Thread-1  ]: finished collecting timing info
07:10:15.354026 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7dcfc591-e4ef-427c-a50b-1bb33576080d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088dca90>]}
07:10:15.354402 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.ae_user_inc_array ...................... [[32mCREATE TABLE (209.9k rows, 177.4 MB processed)[0m in 10.55s]
07:10:15.354836 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
07:10:15.356056 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:10:15.356816 [info ] [MainThread]: 
07:10:15.357123 [info ] [MainThread]: Finished running 1 table model in 12.25s.
07:10:15.357398 [debug] [MainThread]: Connection 'master' was properly closed.
07:10:15.357553 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
07:10:15.366468 [info ] [MainThread]: 
07:10:15.366798 [info ] [MainThread]: [32mCompleted successfully[0m
07:10:15.367106 [info ] [MainThread]: 
07:10:15.367528 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
07:10:15.368131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105140400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089d8a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089d8be0>]}


============================== 2022-09-30 07:10:46.159792 | 7c55d9eb-8d2a-487a-8cca-ea8dcc435009 ==============================
07:10:46.159807 [info ] [MainThread]: Running with dbt=1.1.2
07:10:46.160357 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
07:10:46.160573 [debug] [MainThread]: Tracking: tracking
07:10:46.172744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a15580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a15d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a158e0>]}
07:10:46.204311 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
07:10:46.204682 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
07:10:46.214994 [debug] [MainThread]: 1699: static parser successfully parsed ae_user_inc_array.sql
07:10:46.232366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7c55d9eb-8d2a-487a-8cca-ea8dcc435009', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b720d0>]}
07:10:46.237066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7c55d9eb-8d2a-487a-8cca-ea8dcc435009', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b18e50>]}
07:10:46.237298 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
07:10:46.237514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c55d9eb-8d2a-487a-8cca-ea8dcc435009', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b0fc70>]}
07:10:46.238594 [info ] [MainThread]: 
07:10:46.238962 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:10:46.239582 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
07:10:46.239812 [debug] [ThreadPool]: Opening a new connection, currently in state init
07:10:47.353614 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
07:10:47.354149 [debug] [ThreadPool]: Opening a new connection, currently in state closed
07:10:47.915216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c55d9eb-8d2a-487a-8cca-ea8dcc435009', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11166ed90>]}
07:10:47.915994 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
07:10:47.916376 [info ] [MainThread]: 
07:10:47.920762 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
07:10:47.921148 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.ae_user_inc_array ........................... [RUN]
07:10:47.921701 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
07:10:47.921892 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
07:10:47.922116 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
07:10:47.924118 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
07:10:47.924634 [debug] [Thread-1  ]: finished collecting timing info
07:10:47.924839 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
07:10:47.942156 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:10:48.445369 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
07:10:48.445958 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua2.activity_day 
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id) as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua    
group by ua.user_id
  );
  
07:11:05.429679 [debug] [Thread-1  ]: finished collecting timing info
07:11:05.430299 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c55d9eb-8d2a-487a-8cca-ea8dcc435009', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c24bb0>]}
07:11:05.430713 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.ae_user_inc_array ...................... [[32mCREATE TABLE (697.0k rows, 177.4 MB processed)[0m in 17.51s]
07:11:05.431179 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
07:11:05.432910 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:11:05.433813 [info ] [MainThread]: 
07:11:05.434141 [info ] [MainThread]: Finished running 1 table model in 19.19s.
07:11:05.434411 [debug] [MainThread]: Connection 'master' was properly closed.
07:11:05.434560 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
07:11:05.443127 [info ] [MainThread]: 
07:11:05.443602 [info ] [MainThread]: [32mCompleted successfully[0m
07:11:05.443899 [info ] [MainThread]: 
07:11:05.444127 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
07:11:05.444475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c3e910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c3eaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c3e190>]}


============================== 2022-09-30 07:11:42.019145 | 6cddd805-82e5-419d-b045-a8d7918c7e12 ==============================
07:11:42.019169 [info ] [MainThread]: Running with dbt=1.1.2
07:11:42.019780 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
07:11:42.020131 [debug] [MainThread]: Tracking: tracking
07:11:42.032870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b8b1c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b8b4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b8b940>]}
07:11:42.064320 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
07:11:42.064692 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
07:11:42.074464 [debug] [MainThread]: 1699: static parser successfully parsed ae_user_inc_array.sql
07:11:42.089540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6cddd805-82e5-419d-b045-a8d7918c7e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110cf20d0>]}
07:11:42.093448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6cddd805-82e5-419d-b045-a8d7918c7e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c8fdf0>]}
07:11:42.093703 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
07:11:42.093945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6cddd805-82e5-419d-b045-a8d7918c7e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c8fe80>]}
07:11:42.094891 [info ] [MainThread]: 
07:11:42.095212 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:11:42.095735 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
07:11:42.095940 [debug] [ThreadPool]: Opening a new connection, currently in state init
07:11:43.213027 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
07:11:43.213510 [debug] [ThreadPool]: Opening a new connection, currently in state closed
07:11:43.549497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6cddd805-82e5-419d-b045-a8d7918c7e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c8fc10>]}
07:11:43.550375 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
07:11:43.550981 [info ] [MainThread]: 
07:11:43.555178 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
07:11:43.555538 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.ae_user_inc_array ........................... [RUN]
07:11:43.556053 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
07:11:43.556233 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
07:11:43.556460 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
07:11:43.558436 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
07:11:43.558946 [debug] [Thread-1  ]: finished collecting timing info
07:11:43.559140 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
07:11:43.575990 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:11:43.972361 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
07:11:43.972941 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua2.activity_day 
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id
        order by au2.activity_day) as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua    
group by ua.user_id
  );
  
07:11:45.039977 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: au2 at [16:18]')
07:11:47.093856 [debug] [Thread-1  ]: finished collecting timing info
07:11:47.094468 [debug] [Thread-1  ]: Database Error in model ae_user_inc_array (models/ae_user_inc_array.sql)
  Unrecognized name: au2 at [16:18]
  compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
07:11:47.094920 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6cddd805-82e5-419d-b045-a8d7918c7e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110de96a0>]}
07:11:47.095456 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.ae_user_inc_array .................. [[31mERROR[0m in 3.54s]
07:11:47.096031 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
07:11:47.097477 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:11:47.098028 [info ] [MainThread]: 
07:11:47.098385 [info ] [MainThread]: Finished running 1 table model in 5.00s.
07:11:47.098699 [debug] [MainThread]: Connection 'master' was properly closed.
07:11:47.098895 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
07:11:47.107740 [info ] [MainThread]: 
07:11:47.108051 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
07:11:47.108348 [info ] [MainThread]: 
07:11:47.108598 [error] [MainThread]: [33mDatabase Error in model ae_user_inc_array (models/ae_user_inc_array.sql)[0m
07:11:47.108851 [error] [MainThread]:   Unrecognized name: au2 at [16:18]
07:11:47.109068 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
07:11:47.109290 [info ] [MainThread]: 
07:11:47.109520 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
07:11:47.109860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ce20d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ce2ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ce2640>]}


============================== 2022-09-30 07:12:02.262910 | d102c71d-995e-4ffd-9d61-c60b56856e2e ==============================
07:12:02.262950 [info ] [MainThread]: Running with dbt=1.1.2
07:12:02.263552 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
07:12:02.263724 [debug] [MainThread]: Tracking: tracking
07:12:02.275857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095f66d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095f6dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095f65b0>]}
07:12:02.311264 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
07:12:02.311651 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
07:12:02.322359 [debug] [MainThread]: 1699: static parser successfully parsed ae_user_inc_array.sql
07:12:02.338140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd102c71d-995e-4ffd-9d61-c60b56856e2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10974d0d0>]}
07:12:02.342254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd102c71d-995e-4ffd-9d61-c60b56856e2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096f1f70>]}
07:12:02.342481 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
07:12:02.342737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd102c71d-995e-4ffd-9d61-c60b56856e2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096e9e80>]}
07:12:02.343695 [info ] [MainThread]: 
07:12:02.344030 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:12:02.344677 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
07:12:02.344960 [debug] [ThreadPool]: Opening a new connection, currently in state init
07:12:03.609261 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
07:12:03.609782 [debug] [ThreadPool]: Opening a new connection, currently in state closed
07:12:04.101862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd102c71d-995e-4ffd-9d61-c60b56856e2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095e6130>]}
07:12:04.102642 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
07:12:04.103032 [info ] [MainThread]: 
07:12:04.107296 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
07:12:04.107696 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.ae_user_inc_array ........................... [RUN]
07:12:04.108252 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
07:12:04.108448 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
07:12:04.108671 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
07:12:04.110781 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
07:12:04.111285 [debug] [Thread-1  ]: finished collecting timing info
07:12:04.111485 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
07:12:04.128795 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:12:04.634763 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
07:12:04.635341 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua2.activity_day 
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id
        order by ua2.activity_day) as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua    
group by ua.user_id
  );
  
07:12:05.590177 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Correlated subqueries that reference other tables are not supported unless they can be de-correlated, such as by transforming them into an efficient JOIN.')
07:12:07.568686 [debug] [Thread-1  ]: finished collecting timing info
07:12:07.569228 [debug] [Thread-1  ]: Database Error in model ae_user_inc_array (models/ae_user_inc_array.sql)
  Correlated subqueries that reference other tables are not supported unless they can be de-correlated, such as by transforming them into an efficient JOIN.
  compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
07:12:07.569613 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102c71d-995e-4ffd-9d61-c60b56856e2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10985eb20>]}
07:12:07.570057 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.ae_user_inc_array .................. [[31mERROR[0m in 3.46s]
07:12:07.570602 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
07:12:07.572006 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:12:07.572536 [info ] [MainThread]: 
07:12:07.572880 [info ] [MainThread]: Finished running 1 table model in 5.23s.
07:12:07.573179 [debug] [MainThread]: Connection 'master' was properly closed.
07:12:07.573353 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
07:12:07.581898 [info ] [MainThread]: 
07:12:07.582215 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
07:12:07.582517 [info ] [MainThread]: 
07:12:07.582763 [error] [MainThread]: [33mDatabase Error in model ae_user_inc_array (models/ae_user_inc_array.sql)[0m
07:12:07.582998 [error] [MainThread]:   Correlated subqueries that reference other tables are not supported unless they can be de-correlated, such as by transforming them into an efficient JOIN.
07:12:07.583221 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
07:12:07.583450 [info ] [MainThread]: 
07:12:07.583681 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
07:12:07.584036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097354c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109735a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109811af0>]}


============================== 2022-09-30 07:13:36.636132 | e9f4f3aa-c3f7-4771-b0e0-28a5e35019f1 ==============================
07:13:36.636168 [info ] [MainThread]: Running with dbt=1.1.2
07:13:36.636988 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
07:13:36.637200 [debug] [MainThread]: Tracking: tracking
07:13:36.649474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105af9e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aea190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aea940>]}
07:13:36.680541 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
07:13:36.680998 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
07:13:36.691268 [debug] [MainThread]: 1699: static parser successfully parsed ae_user_inc_array.sql
07:13:36.706571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e9f4f3aa-c3f7-4771-b0e0-28a5e35019f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c500d0>]}
07:13:36.710397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e9f4f3aa-c3f7-4771-b0e0-28a5e35019f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ba4eb0>]}
07:13:36.710611 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
07:13:36.710816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e9f4f3aa-c3f7-4771-b0e0-28a5e35019f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aea940>]}
07:13:36.711812 [info ] [MainThread]: 
07:13:36.712130 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:13:36.712713 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
07:13:36.713051 [debug] [ThreadPool]: Opening a new connection, currently in state init
07:13:37.869484 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
07:13:37.869979 [debug] [ThreadPool]: Opening a new connection, currently in state closed
07:13:38.416291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e9f4f3aa-c3f7-4771-b0e0-28a5e35019f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bf0f10>]}
07:13:38.417231 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
07:13:38.417711 [info ] [MainThread]: 
07:13:38.422075 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
07:13:38.422454 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.ae_user_inc_array ........................... [RUN]
07:13:38.422996 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
07:13:38.423204 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
07:13:38.423419 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
07:13:38.425382 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
07:13:38.425859 [debug] [Thread-1  ]: finished collecting timing info
07:13:38.426052 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
07:13:38.443132 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:13:38.914749 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
07:13:38.915316 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua2.activity_day 
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua2 as x
        where ua.user_id = ua2.user_id
        order by x) as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua    
group by ua.user_id
  );
  
07:13:39.233809 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword AS at [14:67]')
07:13:39.925931 [debug] [Thread-1  ]: finished collecting timing info
07:13:39.926545 [debug] [Thread-1  ]: Database Error in model ae_user_inc_array (models/ae_user_inc_array.sql)
  Syntax error: Expected ")" but got keyword AS at [14:67]
  compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
07:13:39.926990 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e9f4f3aa-c3f7-4771-b0e0-28a5e35019f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d59d60>]}
07:13:39.927519 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.ae_user_inc_array .................. [[31mERROR[0m in 1.50s]
07:13:39.928079 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
07:13:39.929389 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:13:39.929824 [info ] [MainThread]: 
07:13:39.930244 [info ] [MainThread]: Finished running 1 table model in 3.22s.
07:13:39.930556 [debug] [MainThread]: Connection 'master' was properly closed.
07:13:39.930733 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
07:13:39.939444 [info ] [MainThread]: 
07:13:39.939754 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
07:13:39.940047 [info ] [MainThread]: 
07:13:39.940296 [error] [MainThread]: [33mDatabase Error in model ae_user_inc_array (models/ae_user_inc_array.sql)[0m
07:13:39.940535 [error] [MainThread]:   Syntax error: Expected ")" but got keyword AS at [14:67]
07:13:39.940761 [error] [MainThread]:   compiled SQL at target/run/exercise/models/ae_user_inc_array.sql
07:13:39.940990 [info ] [MainThread]: 
07:13:39.941225 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
07:13:39.941577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d4b880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d4b820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c40a90>]}


============================== 2022-09-30 07:14:15.027692 | a215e552-1e17-4a24-bc91-d3841371f81b ==============================
07:14:15.027731 [info ] [MainThread]: Running with dbt=1.1.2
07:14:15.028315 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['ae_user_inc_array'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
07:14:15.028928 [debug] [MainThread]: Tracking: tracking
07:14:15.041038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088f40a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088f48e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088f4460>]}
07:14:15.072312 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
07:14:15.072678 [debug] [MainThread]: Partial parsing: updated file: exercise://models/ae_user_inc_array.sql
07:14:15.082669 [debug] [MainThread]: 1699: static parser successfully parsed ae_user_inc_array.sql
07:14:15.097801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a215e552-1e17-4a24-bc91-d3841371f81b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a4c0d0>]}
07:14:15.101699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a215e552-1e17-4a24-bc91-d3841371f81b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088f43a0>]}
07:14:15.101914 [info ] [MainThread]: Found 5 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
07:14:15.102163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a215e552-1e17-4a24-bc91-d3841371f81b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107518af0>]}
07:14:15.103089 [info ] [MainThread]: 
07:14:15.103415 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:14:15.103940 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
07:14:15.104148 [debug] [ThreadPool]: Opening a new connection, currently in state init
07:14:16.298218 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
07:14:16.298748 [debug] [ThreadPool]: Opening a new connection, currently in state closed
07:14:16.690050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a215e552-1e17-4a24-bc91-d3841371f81b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089ebee0>]}
07:14:16.690920 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
07:14:16.691321 [info ] [MainThread]: 
07:14:16.695494 [debug] [Thread-1  ]: Began running node model.exercise.ae_user_inc_array
07:14:16.695875 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.ae_user_inc_array ........................... [RUN]
07:14:16.696422 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.ae_user_inc_array"
07:14:16.696623 [debug] [Thread-1  ]: Began compiling node model.exercise.ae_user_inc_array
07:14:16.696841 [debug] [Thread-1  ]: Compiling model.exercise.ae_user_inc_array
07:14:16.698892 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.ae_user_inc_array"
07:14:16.699596 [debug] [Thread-1  ]: finished collecting timing info
07:14:16.699807 [debug] [Thread-1  ]: Began executing node model.exercise.ae_user_inc_array
07:14:16.717169 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:14:17.202883 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.ae_user_inc_array"
07:14:17.203470 [debug] [Thread-1  ]: On model.exercise.ae_user_inc_array: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.ae_user_inc_array"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`ae_user_inc_array`
  
  
  OPTIONS()
  as (
    select 
    ua.user_id, 
    min(ua.activity_day) as install_day, 
    'campaign 1' as campaign,
    ARRAY(select ua2.activity_day 
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id) as active_days
    from dwh-adev-core.ae_challenge_data.ae_user_activity ua    
group by ua.user_id
  );
  
07:14:33.509351 [debug] [Thread-1  ]: finished collecting timing info
07:14:33.509898 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a215e552-1e17-4a24-bc91-d3841371f81b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a387f0>]}
07:14:33.510304 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.ae_user_inc_array ...................... [[32mCREATE TABLE (697.0k rows, 177.4 MB processed)[0m in 16.81s]
07:14:33.510797 [debug] [Thread-1  ]: Finished running node model.exercise.ae_user_inc_array
07:14:33.512047 [debug] [MainThread]: Acquiring new bigquery connection "master"
07:14:33.512511 [info ] [MainThread]: 
07:14:33.512807 [info ] [MainThread]: Finished running 1 table model in 18.41s.
07:14:33.513085 [debug] [MainThread]: Connection 'master' was properly closed.
07:14:33.513237 [debug] [MainThread]: Connection 'model.exercise.ae_user_inc_array' was properly closed.
07:14:33.522115 [info ] [MainThread]: 
07:14:33.522427 [info ] [MainThread]: [32mCompleted successfully[0m
07:14:33.522730 [info ] [MainThread]: 
07:14:33.522976 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
07:14:33.523331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b4eee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b4e070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b4e3d0>]}


============================== 2022-10-03 08:01:14.794327 | e1a3b8a7-3fd2-4add-9209-cb6294d1c876 ==============================
08:01:14.794353 [info ] [MainThread]: Running with dbt=1.1.2
08:01:14.795035 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
08:01:14.795248 [debug] [MainThread]: Tracking: tracking
08:01:14.810021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101ace80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101ac730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101ac6d0>]}
08:01:14.857616 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
08:01:14.858023 [debug] [MainThread]: Partial parsing: added file: exercise://models/prova_jinja.sql
08:01:14.870536 [debug] [MainThread]: 1603: static parser failed on prova_jinja.sql
08:01:14.884256 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja.sql
08:01:14.891774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e1a3b8a7-3fd2-4add-9209-cb6294d1c876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11030e0d0>]}
08:01:14.896764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e1a3b8a7-3fd2-4add-9209-cb6294d1c876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110256ee0>]}
08:01:14.897021 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
08:01:14.897275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1a3b8a7-3fd2-4add-9209-cb6294d1c876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110256f40>]}
08:01:14.898426 [info ] [MainThread]: 
08:01:14.898793 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:01:14.899369 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
08:01:14.899617 [debug] [ThreadPool]: Opening a new connection, currently in state init
08:01:16.652358 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
08:01:16.652957 [debug] [ThreadPool]: Opening a new connection, currently in state closed
08:01:17.217067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1a3b8a7-3fd2-4add-9209-cb6294d1c876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11017b8b0>]}
08:01:17.218039 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
08:01:17.218466 [info ] [MainThread]: 
08:01:17.223641 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja
08:01:17.224002 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja ................................. [RUN]
08:01:17.224509 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja"
08:01:17.224695 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja
08:01:17.224915 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja
08:01:17.228694 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja"
08:01:17.229174 [debug] [Thread-1  ]: finished collecting timing info
08:01:17.229368 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja
08:01:17.266952 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja"
08:01:17.267484 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:01:17.267715 [debug] [Thread-1  ]: On model.exercise.prova_jinja: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja`
  
  
  OPTIONS()
  as (
    

select
    u.user_id,
    ç
    sum(case when u.activity_type = 'app_open' then amount end) as app_open_amount,
    ç
    sum(case when u.activity_type = 'payment' then amount end) as payment_amount,
    
from dwh-adev-core.ae_challenge_data.ae_user_activity u
group by u.user_id
  );
  
08:01:17.818311 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Illegal input character "\\303" at [13:5]')
08:01:19.128251 [debug] [Thread-1  ]: finished collecting timing info
08:01:19.128872 [debug] [Thread-1  ]: Database Error in model prova_jinja (models/prova_jinja.sql)
  Syntax error: Illegal input character "\303" at [13:5]
  compiled SQL at target/run/exercise/models/prova_jinja.sql
08:01:19.129342 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1a3b8a7-3fd2-4add-9209-cb6294d1c876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110417eb0>]}
08:01:19.129869 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja ........................ [[31mERROR[0m in 1.90s]
08:01:19.130426 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja
08:01:19.131913 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:01:19.132399 [info ] [MainThread]: 
08:01:19.132756 [info ] [MainThread]: Finished running 1 table model in 4.23s.
08:01:19.133080 [debug] [MainThread]: Connection 'master' was properly closed.
08:01:19.133254 [debug] [MainThread]: Connection 'model.exercise.prova_jinja' was properly closed.
08:01:19.144022 [info ] [MainThread]: 
08:01:19.144358 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
08:01:19.144653 [info ] [MainThread]: 
08:01:19.144904 [error] [MainThread]: [33mDatabase Error in model prova_jinja (models/prova_jinja.sql)[0m
08:01:19.145143 [error] [MainThread]:   Syntax error: Illegal input character "\303" at [13:5]
08:01:19.145368 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja.sql
08:01:19.145598 [info ] [MainThread]: 
08:01:19.145833 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
08:01:19.146199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110302670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11043bf40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103fa0a0>]}


============================== 2022-10-03 08:02:39.629456 | 188a590a-7151-4c6c-9cc0-da76deff2a81 ==============================
08:02:39.629473 [info ] [MainThread]: Running with dbt=1.1.2
08:02:39.630044 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
08:02:39.630227 [debug] [MainThread]: Tracking: tracking
08:02:39.640617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e60ee50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e60e550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5fb1f0>]}
08:02:39.671763 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
08:02:39.672154 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja.sql
08:02:39.682255 [debug] [MainThread]: 1603: static parser failed on prova_jinja.sql
08:02:39.693752 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja.sql
08:02:39.700425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '188a590a-7151-4c6c-9cc0-da76deff2a81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e79d0d0>]}
08:02:39.704832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '188a590a-7151-4c6c-9cc0-da76deff2a81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7062b0>]}
08:02:39.705073 [info ] [MainThread]: Found 6 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
08:02:39.705294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '188a590a-7151-4c6c-9cc0-da76deff2a81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5db760>]}
08:02:39.706299 [info ] [MainThread]: 
08:02:39.706649 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:02:39.707274 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
08:02:39.707494 [debug] [ThreadPool]: Opening a new connection, currently in state init
08:02:40.934080 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
08:02:40.934559 [debug] [ThreadPool]: Opening a new connection, currently in state closed
08:02:41.413663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '188a590a-7151-4c6c-9cc0-da76deff2a81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e630460>]}
08:02:41.414581 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
08:02:41.414972 [info ] [MainThread]: 
08:02:41.419147 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja
08:02:41.419489 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja ................................. [RUN]
08:02:41.419999 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja"
08:02:41.420193 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja
08:02:41.420398 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja
08:02:41.424191 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja"
08:02:41.424692 [debug] [Thread-1  ]: finished collecting timing info
08:02:41.424887 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja
08:02:41.462455 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja"
08:02:41.463019 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:02:41.463241 [debug] [Thread-1  ]: On model.exercise.prova_jinja: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja`
  
  
  OPTIONS()
  as (
    

select
    u.user_id,
    
    sum(case when u.activity_type = 'app_open' then amount end) as app_open_amount,
    
    sum(case when u.activity_type = 'payment' then amount end) as payment_amount,
    
from dwh-adev-core.ae_challenge_data.ae_user_activity u
group by u.user_id
  );
  
08:02:53.035258 [debug] [Thread-1  ]: finished collecting timing info
08:02:53.035823 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '188a590a-7151-4c6c-9cc0-da76deff2a81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e86bdf0>]}
08:02:53.036247 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.prova_jinja ............................ [[32mCREATE TABLE (697.0k rows, 362.2 MB processed)[0m in 11.62s]
08:02:53.036746 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja
08:02:53.038060 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:02:53.038529 [info ] [MainThread]: 
08:02:53.038864 [info ] [MainThread]: Finished running 1 table model in 13.33s.
08:02:53.039157 [debug] [MainThread]: Connection 'master' was properly closed.
08:02:53.039316 [debug] [MainThread]: Connection 'model.exercise.prova_jinja' was properly closed.
08:02:53.051230 [info ] [MainThread]: 
08:02:53.051553 [info ] [MainThread]: [32mCompleted successfully[0m
08:02:53.051887 [info ] [MainThread]: 
08:02:53.052143 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
08:02:53.052518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af974f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e829640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e88feb0>]}


============================== 2022-10-03 08:12:43.069221 | 6f955bbf-ac93-4e91-ace4-db6b0e8e9cb6 ==============================
08:12:43.069239 [info ] [MainThread]: Running with dbt=1.1.2
08:12:43.069872 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
08:12:43.070089 [debug] [MainThread]: Tracking: tracking
08:12:43.082583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133d4e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133d4c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133d4ac0>]}
08:12:43.115453 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
08:12:43.115769 [debug] [MainThread]: Partial parsing: added file: exercise://models/prova_jinja2.sql
08:12:43.116071 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja.sql
08:12:43.125982 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
08:12:43.129523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113493700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135348b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113534910>]}


============================== 2022-10-03 08:13:07.779434 | ad9b044f-c904-4991-beda-ded44e97b390 ==============================
08:13:07.779451 [info ] [MainThread]: Running with dbt=1.1.2
08:13:07.780014 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
08:13:07.780241 [debug] [MainThread]: Tracking: tracking
08:13:07.791844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3bf0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3bfbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3bfee0>]}
08:13:07.823274 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
08:13:07.823576 [debug] [MainThread]: Partial parsing: added file: exercise://models/prova_jinja2.sql
08:13:07.823802 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja.sql
08:13:07.833783 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
08:13:07.844663 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
08:13:07.845561 [debug] [MainThread]: 1603: static parser failed on prova_jinja.sql
08:13:07.848586 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja.sql
08:13:07.855210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ad9b044f-c904-4991-beda-ded44e97b390', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a55f0d0>]}
08:13:07.859437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ad9b044f-c904-4991-beda-ded44e97b390', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a47ecd0>]}
08:13:07.859656 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
08:13:07.859938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad9b044f-c904-4991-beda-ded44e97b390', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a47ed60>]}
08:13:07.860938 [info ] [MainThread]: 
08:13:07.861280 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:13:07.861814 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
08:13:07.862153 [debug] [ThreadPool]: Opening a new connection, currently in state init
08:13:09.127300 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
08:13:09.127813 [debug] [ThreadPool]: Opening a new connection, currently in state closed
08:13:09.558405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad9b044f-c904-4991-beda-ded44e97b390', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a533370>]}
08:13:09.559254 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
08:13:09.559714 [info ] [MainThread]: 
08:13:09.563649 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja
08:13:09.564039 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja ................................. [RUN]
08:13:09.564570 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja"
08:13:09.564759 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja
08:13:09.564964 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja
08:13:09.568969 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja"
08:13:09.569549 [debug] [Thread-1  ]: finished collecting timing info
08:13:09.569753 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja
08:13:09.586980 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:13:10.099414 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja"
08:13:10.099990 [debug] [Thread-1  ]: On model.exercise.prova_jinja: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja`
  
  
  OPTIONS()
  as (
    

select
    u.user_id,
    
    sum(case when u.activity_type = 'app_open' then amount end) as app_open_amount,
    sum(case when u.activity_type = 'payment' then amount end) as payment_amount,from dwh-adev-core.ae_challenge_data.ae_user_activity u
group by u.user_id
  );
  
08:13:20.867712 [debug] [Thread-1  ]: finished collecting timing info
08:13:20.868233 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad9b044f-c904-4991-beda-ded44e97b390', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a53ca00>]}
08:13:20.868633 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.prova_jinja ............................ [[32mCREATE TABLE (697.0k rows, 362.2 MB processed)[0m in 11.30s]
08:13:20.869064 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja
08:13:20.870275 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:13:20.870725 [info ] [MainThread]: 
08:13:20.871012 [info ] [MainThread]: Finished running 1 table model in 13.01s.
08:13:20.871265 [debug] [MainThread]: Connection 'master' was properly closed.
08:13:20.871406 [debug] [MainThread]: Connection 'model.exercise.prova_jinja' was properly closed.
08:13:20.877105 [info ] [MainThread]: 
08:13:20.877397 [info ] [MainThread]: [32mCompleted successfully[0m
08:13:20.877692 [info ] [MainThread]: 
08:13:20.877930 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
08:13:20.878286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a635910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5fafa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a53c400>]}


============================== 2022-10-03 08:18:17.540404 | 3aedcd0f-e0d3-4328-b85a-bc5be5cf2a76 ==============================
08:18:17.540422 [info ] [MainThread]: Running with dbt=1.1.2
08:18:17.541095 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
08:18:17.541355 [debug] [MainThread]: Tracking: tracking
08:18:17.553136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c40310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c409a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c40370>]}
08:18:17.584853 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
08:18:17.585243 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja.sql
08:18:17.595369 [debug] [MainThread]: 1603: static parser failed on prova_jinja.sql
08:18:17.598044 [info ] [MainThread]: Line: 
08:18:17.598271 [info ] [MainThread]: Line: 
08:18:17.607585 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja.sql
08:18:17.614626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3aedcd0f-e0d3-4328-b85a-bc5be5cf2a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ddefa0>]}
08:18:17.619258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3aedcd0f-e0d3-4328-b85a-bc5be5cf2a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112cfed00>]}
08:18:17.619501 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
08:18:17.619708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3aedcd0f-e0d3-4328-b85a-bc5be5cf2a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c14d90>]}
08:18:17.620738 [info ] [MainThread]: 
08:18:17.621397 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:18:17.622256 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
08:18:17.622580 [debug] [ThreadPool]: Opening a new connection, currently in state init
08:18:18.814046 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
08:18:18.814551 [debug] [ThreadPool]: Opening a new connection, currently in state closed
08:18:19.170486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3aedcd0f-e0d3-4328-b85a-bc5be5cf2a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c910d0>]}
08:18:19.171354 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
08:18:19.171744 [info ] [MainThread]: 
08:18:19.176110 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja
08:18:19.176489 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja ................................. [RUN]
08:18:19.177014 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja"
08:18:19.177200 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja
08:18:19.177412 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja
08:18:19.181736 [info ] [Thread-1  ]: Line: 
08:18:19.182033 [info ] [Thread-1  ]: Line: 
08:18:19.182368 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja"
08:18:19.182873 [debug] [Thread-1  ]: finished collecting timing info
08:18:19.183072 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja
08:18:19.199575 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:18:19.565671 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja"
08:18:19.566253 [debug] [Thread-1  ]: On model.exercise.prova_jinja: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja`
  
  
  OPTIONS()
  as (
    

select
    u.user_id,
    
    sum(case when u.activity_type = 'app_open' then amount end) as app_open_amount,
    
    
    sum(case when u.activity_type = 'payment' then amount end) as payment_amount,
    
    
from dwh-adev-core.ae_challenge_data.ae_user_activity u
group by u.user_id
  );
  
08:18:29.008229 [debug] [Thread-1  ]: finished collecting timing info
08:18:29.008745 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3aedcd0f-e0d3-4328-b85a-bc5be5cf2a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e89b80>]}
08:18:29.009144 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.prova_jinja ............................ [[32mCREATE TABLE (697.0k rows, 362.2 MB processed)[0m in 9.83s]
08:18:29.009576 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja
08:18:29.010909 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:18:29.011324 [info ] [MainThread]: 
08:18:29.011621 [info ] [MainThread]: Finished running 1 table model in 11.39s.
08:18:29.011882 [debug] [MainThread]: Connection 'master' was properly closed.
08:18:29.012032 [debug] [MainThread]: Connection 'model.exercise.prova_jinja' was properly closed.
08:18:29.023250 [info ] [MainThread]: 
08:18:29.023556 [info ] [MainThread]: [32mCompleted successfully[0m
08:18:29.023864 [info ] [MainThread]: 
08:18:29.024113 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
08:18:29.024469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c50460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112da9820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e73ee0>]}


============================== 2022-10-03 08:19:05.282714 | a7a287dd-68b1-4c39-a99d-353431b785b8 ==============================
08:19:05.282731 [info ] [MainThread]: Running with dbt=1.1.2
08:19:05.283467 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
08:19:05.283716 [debug] [MainThread]: Tracking: tracking
08:19:05.295041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112246520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122468b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112246e50>]}
08:19:05.328104 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
08:19:05.328468 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja.sql
08:19:05.338211 [debug] [MainThread]: 1603: static parser failed on prova_jinja.sql
08:19:05.340747 [info ] [MainThread]: Line: 
08:19:05.349726 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja.sql
08:19:05.356856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a7a287dd-68b1-4c39-a99d-353431b785b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1123ba0d0>]}
08:19:05.361213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a7a287dd-68b1-4c39-a99d-353431b785b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11234efd0>]}
08:19:05.361438 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
08:19:05.361640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7a287dd-68b1-4c39-a99d-353431b785b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11234ef70>]}
08:19:05.362638 [info ] [MainThread]: 
08:19:05.362965 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:19:05.363596 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
08:19:05.363816 [debug] [ThreadPool]: Opening a new connection, currently in state init
08:19:06.491041 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
08:19:06.491543 [debug] [ThreadPool]: Opening a new connection, currently in state closed
08:19:06.906571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7a287dd-68b1-4c39-a99d-353431b785b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122566d0>]}
08:19:06.907449 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
08:19:06.907887 [info ] [MainThread]: 
08:19:06.912208 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja
08:19:06.912586 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja ................................. [RUN]
08:19:06.913150 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja"
08:19:06.913354 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja
08:19:06.913585 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja
08:19:06.917999 [info ] [Thread-1  ]: Line: 
08:19:06.918369 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja"
08:19:06.918834 [debug] [Thread-1  ]: finished collecting timing info
08:19:06.919030 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja
08:19:06.935744 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:19:07.369131 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja"
08:19:07.369701 [debug] [Thread-1  ]: On model.exercise.prova_jinja: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja`
  
  
  OPTIONS()
  as (
    

select
    u.user_id,
    
    sum(case when u.activity_type = 'app_open' then amount end) as app_open_amount,
    
    sum(case when u.activity_type = 'payment' then amount end) as payment_amount,
    
from dwh-adev-core.ae_challenge_data.ae_user_activity u
group by u.user_id

  );
  
08:19:17.270545 [debug] [Thread-1  ]: finished collecting timing info
08:19:17.271055 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7a287dd-68b1-4c39-a99d-353431b785b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112491dc0>]}
08:19:17.271425 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.prova_jinja ............................ [[32mCREATE TABLE (697.0k rows, 362.2 MB processed)[0m in 10.36s]
08:19:17.271870 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja
08:19:17.273009 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:19:17.273386 [info ] [MainThread]: 
08:19:17.273668 [info ] [MainThread]: Finished running 1 table model in 11.91s.
08:19:17.273926 [debug] [MainThread]: Connection 'master' was properly closed.
08:19:17.274069 [debug] [MainThread]: Connection 'model.exercise.prova_jinja' was properly closed.
08:19:17.285245 [info ] [MainThread]: 
08:19:17.285551 [info ] [MainThread]: [32mCompleted successfully[0m
08:19:17.285854 [info ] [MainThread]: 
08:19:17.286178 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
08:19:17.286596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ebd1400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112478f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124f32b0>]}


============================== 2022-10-03 08:20:35.638096 | 4547abb3-834a-429c-a9ce-c9fd8d2233cb ==============================
08:20:35.638113 [info ] [MainThread]: Running with dbt=1.1.2
08:20:35.638676 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
08:20:35.639428 [debug] [MainThread]: Tracking: tracking
08:20:35.650695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a242a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a242790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a242b50>]}
08:20:35.681792 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
08:20:35.682159 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja.sql
08:20:35.692193 [debug] [MainThread]: 1603: static parser failed on prova_jinja.sql
08:20:35.694397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2fa160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3a81c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3a8370>]}


============================== 2022-10-03 08:56:53.774126 | 8fe8b284-1a08-4e9d-9d1b-e480d2864cb7 ==============================
08:56:53.774140 [info ] [MainThread]: Running with dbt=1.1.2
08:56:53.774803 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
08:56:53.775237 [debug] [MainThread]: Tracking: tracking
08:56:53.786658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060f8310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060f8c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060f8610>]}
08:56:53.820652 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
08:56:53.821006 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
08:56:53.821232 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja.sql
08:56:53.831474 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
08:56:53.833530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061a5850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10623da00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10623da60>]}


============================== 2022-10-03 08:57:08.217160 | 365699b3-770a-423b-81a3-11d0fcaa13a2 ==============================
08:57:08.217206 [info ] [MainThread]: Running with dbt=1.1.2
08:57:08.217803 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
08:57:08.217950 [debug] [MainThread]: Tracking: tracking
08:57:08.229269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081ca2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081cab50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081ca3a0>]}
08:57:08.264400 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
08:57:08.264763 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
08:57:08.264982 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja.sql
08:57:08.275152 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
08:57:08.277250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108262730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082fb8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082fb940>]}


============================== 2022-10-03 08:57:40.573854 | 7a1c31ae-2fe3-4fa1-963b-a75b82d902f7 ==============================
08:57:40.573871 [info ] [MainThread]: Running with dbt=1.1.2
08:57:40.574727 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
08:57:40.574867 [debug] [MainThread]: Tracking: tracking
08:57:40.587673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eaebee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eaeb340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eaeb460>]}
08:57:40.622801 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
08:57:40.623329 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
08:57:40.623592 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja.sql
08:57:40.633871 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
08:57:40.645408 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
08:57:40.646322 [debug] [MainThread]: 1603: static parser failed on prova_jinja.sql
08:57:40.649239 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja.sql
08:57:40.655978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7a1c31ae-2fe3-4fa1-963b-a75b82d902f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ec8c0d0>]}
08:57:40.660351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7a1c31ae-2fe3-4fa1-963b-a75b82d902f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eaeb820>]}
08:57:40.660604 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
08:57:40.660821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a1c31ae-2fe3-4fa1-963b-a75b82d902f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d74ba60>]}
08:57:40.661872 [info ] [MainThread]: 
08:57:40.662231 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:57:40.662923 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
08:57:40.663209 [debug] [ThreadPool]: Opening a new connection, currently in state init
08:57:41.810911 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
08:57:41.811478 [debug] [ThreadPool]: Opening a new connection, currently in state closed
08:57:42.248907 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a1c31ae-2fe3-4fa1-963b-a75b82d902f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eac8670>]}
08:57:42.249792 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
08:57:42.250191 [info ] [MainThread]: 
08:57:42.254501 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
08:57:42.254867 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
08:57:42.255417 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
08:57:42.255614 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
08:57:42.255830 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
08:57:42.259815 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
08:57:42.260323 [debug] [Thread-1  ]: finished collecting timing info
08:57:42.260522 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
08:57:42.301870 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
08:57:42.302414 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:57:42.302639 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

select
    
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
  );
  
08:57:42.664830 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got integer literal "10000" at [20:5]')
08:57:43.310752 [debug] [Thread-1  ]: finished collecting timing info
08:57:43.311407 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected ")" but got integer literal "10000" at [20:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
08:57:43.311867 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a1c31ae-2fe3-4fa1-963b-a75b82d902f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ec4aa30>]}
08:57:43.312417 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.06s]
08:57:43.313051 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
08:57:43.314643 [debug] [MainThread]: Acquiring new bigquery connection "master"
08:57:43.315129 [info ] [MainThread]: 
08:57:43.315461 [info ] [MainThread]: Finished running 1 table model in 2.65s.
08:57:43.315758 [debug] [MainThread]: Connection 'master' was properly closed.
08:57:43.315925 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
08:57:43.324177 [info ] [MainThread]: 
08:57:43.324511 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
08:57:43.324803 [info ] [MainThread]: 
08:57:43.325049 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
08:57:43.325286 [error] [MainThread]:   Syntax error: Expected ")" but got integer literal "10000" at [20:5]
08:57:43.325506 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
08:57:43.325734 [info ] [MainThread]: 
08:57:43.325964 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
08:57:43.326325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ed60be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eaeb580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ed30340>]}


============================== 2022-10-03 09:00:17.560072 | 594f6bd9-9a95-4dc3-921b-00aa2e635091 ==============================
09:00:17.560101 [info ] [MainThread]: Running with dbt=1.1.2
09:00:17.560624 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:00:17.560762 [debug] [MainThread]: Tracking: tracking
09:00:17.573863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e318310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e318040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e318fa0>]}
09:00:17.611066 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:00:17.611459 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:00:17.622411 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:00:17.634894 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:00:17.641929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '594f6bd9-9a95-4dc3-921b-00aa2e635091', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4a60d0>]}
09:00:17.646390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '594f6bd9-9a95-4dc3-921b-00aa2e635091', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e411d30>]}
09:00:17.646623 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:00:17.646837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '594f6bd9-9a95-4dc3-921b-00aa2e635091', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e411f70>]}
09:00:17.647972 [info ] [MainThread]: 
09:00:17.648466 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:00:17.649217 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:00:17.649629 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:00:18.909761 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:00:18.910200 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:00:19.335399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '594f6bd9-9a95-4dc3-921b-00aa2e635091', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e35b670>]}
09:00:19.336199 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:00:19.336635 [info ] [MainThread]: 
09:00:19.340435 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:00:19.340813 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:00:19.341340 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:00:19.341520 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:00:19.341716 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:00:19.345580 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:00:19.346118 [debug] [Thread-1  ]: finished collecting timing info
09:00:19.346304 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:00:19.385340 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:00:19.385918 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:00:19.386144 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

select
    
    "1000" as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    "10000" as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    "20000" as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    "30000" as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    "50000" as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    "100000" as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    "500000" as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
  );
  
09:00:19.849965 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got string literal "10000" at [20:5]')
09:00:20.815268 [debug] [Thread-1  ]: finished collecting timing info
09:00:20.815846 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected ")" but got string literal "10000" at [20:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:00:20.816220 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '594f6bd9-9a95-4dc3-921b-00aa2e635091', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5acc40>]}
09:00:20.816813 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.48s]
09:00:20.817345 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:00:20.819013 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:00:20.819471 [info ] [MainThread]: 
09:00:20.819743 [info ] [MainThread]: Finished running 1 table model in 3.17s.
09:00:20.819993 [debug] [MainThread]: Connection 'master' was properly closed.
09:00:20.820128 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:00:20.830035 [info ] [MainThread]: 
09:00:20.830324 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:00:20.830603 [info ] [MainThread]: 
09:00:20.830866 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:00:20.831155 [error] [MainThread]:   Syntax error: Expected ")" but got string literal "10000" at [20:5]
09:00:20.831376 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:00:20.831609 [info ] [MainThread]: 
09:00:20.831837 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:00:20.832375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e59c040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e46f7f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5937f0>]}


============================== 2022-10-03 09:01:22.814851 | 824ab31c-90b4-410f-a5fb-77b204396dd6 ==============================
09:01:22.814871 [info ] [MainThread]: Running with dbt=1.1.2
09:01:22.815725 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:01:22.815919 [debug] [MainThread]: Tracking: tracking
09:01:22.827463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c76c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c76ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c76f40>]}
09:01:22.867107 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:01:22.867571 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:01:22.879566 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:01:22.893366 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:01:22.900485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '824ab31c-90b4-410f-a5fb-77b204396dd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e11f70>]}
09:01:22.905224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '824ab31c-90b4-410f-a5fb-77b204396dd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d35cd0>]}
09:01:22.905472 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:01:22.905740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '824ab31c-90b4-410f-a5fb-77b204396dd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d35ee0>]}
09:01:22.906807 [info ] [MainThread]: 
09:01:22.907199 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:01:22.907808 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:01:22.908029 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:01:24.163703 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:01:24.164141 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:01:24.635100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '824ab31c-90b4-410f-a5fb-77b204396dd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d1e340>]}
09:01:24.635873 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:01:24.636348 [info ] [MainThread]: 
09:01:24.640232 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:01:24.640590 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:01:24.641119 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:01:24.641300 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:01:24.641505 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:01:24.645380 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:01:24.645898 [debug] [Thread-1  ]: finished collecting timing info
09:01:24.646097 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:01:24.685372 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:01:24.685935 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:01:24.686165 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

select
    
    "joan" as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    "joan" as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    "joan" as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    "joan" as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    "joan" as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    "joan" as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    "joan" as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
  );
  
09:01:25.235445 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got string literal "joan" at [20:5]')
09:01:26.585122 [debug] [Thread-1  ]: finished collecting timing info
09:01:26.585579 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected ")" but got string literal "joan" at [20:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:01:26.585963 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '824ab31c-90b4-410f-a5fb-77b204396dd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f12610>]}
09:01:26.586402 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.94s]
09:01:26.586878 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:01:26.588142 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:01:26.588510 [info ] [MainThread]: 
09:01:26.588792 [info ] [MainThread]: Finished running 1 table model in 3.68s.
09:01:26.589061 [debug] [MainThread]: Connection 'master' was properly closed.
09:01:26.589211 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:01:26.599916 [info ] [MainThread]: 
09:01:26.600388 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:01:26.600837 [info ] [MainThread]: 
09:01:26.601112 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:01:26.601359 [error] [MainThread]:   Syntax error: Expected ")" but got string literal "joan" at [20:5]
09:01:26.601576 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:01:26.601798 [info ] [MainThread]: 
09:01:26.602023 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:01:26.602376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109dd2c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ea7d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f00250>]}


============================== 2022-10-03 09:07:43.830650 | be78c258-2aac-454f-a764-b087797e1f4c ==============================
09:07:43.830680 [info ] [MainThread]: Running with dbt=1.1.2
09:07:43.831352 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:07:43.831612 [debug] [MainThread]: Tracking: tracking
09:07:43.842927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4c2df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4c29a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4c2670>]}
09:07:43.876266 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:07:43.876635 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:07:43.886724 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:07:43.897957 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:07:43.904963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'be78c258-2aac-454f-a764-b087797e1f4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e660fd0>]}
09:07:43.909158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'be78c258-2aac-454f-a764-b087797e1f4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5cf880>]}
09:07:43.909395 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:07:43.909625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be78c258-2aac-454f-a764-b087797e1f4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5c8bb0>]}
09:07:43.910648 [info ] [MainThread]: 
09:07:43.910985 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:07:43.911521 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:07:43.911670 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:07:45.140225 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:07:45.140732 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:07:45.527653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be78c258-2aac-454f-a764-b087797e1f4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e510460>]}
09:07:45.528465 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:07:45.528866 [info ] [MainThread]: 
09:07:45.532834 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:07:45.533218 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:07:45.533813 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:07:45.533999 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:07:45.534202 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:07:45.538231 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:07:45.538725 [debug] [Thread-1  ]: finished collecting timing info
09:07:45.538915 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:07:45.577373 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:07:45.577941 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:07:45.578223 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    


    
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
  );
  
09:07:46.086547 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]')
09:07:47.432437 [debug] [Thread-1  ]: finished collecting timing info
09:07:47.433054 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:07:47.433501 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be78c258-2aac-454f-a764-b087797e1f4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e764940>]}
09:07:47.433977 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.90s]
09:07:47.434496 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:07:47.435810 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:07:47.436221 [info ] [MainThread]: 
09:07:47.436541 [info ] [MainThread]: Finished running 1 table model in 3.53s.
09:07:47.436829 [debug] [MainThread]: Connection 'master' was properly closed.
09:07:47.436988 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:07:47.447149 [info ] [MainThread]: 
09:07:47.447461 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:07:47.447826 [info ] [MainThread]: 
09:07:47.448079 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:07:47.448314 [error] [MainThread]:   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
09:07:47.448532 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:07:47.448756 [info ] [MainThread]: 
09:07:47.448982 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:07:47.449324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e62a640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7286a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e760130>]}


============================== 2022-10-03 09:09:18.665289 | f98e04cf-7bf5-402e-9325-00d0f9b99287 ==============================
09:09:18.665338 [info ] [MainThread]: Running with dbt=1.1.2
09:09:18.665901 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:09:18.666039 [debug] [MainThread]: Tracking: tracking
09:09:18.678238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc16ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc164c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc16fd0>]}
09:09:18.710210 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:09:18.710566 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:09:18.720768 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:09:18.732415 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:09:18.738932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f98e04cf-7bf5-402e-9325-00d0f9b99287', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd9b0d0>]}
09:09:18.743067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f98e04cf-7bf5-402e-9325-00d0f9b99287', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd13f10>]}
09:09:18.743286 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:09:18.743498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f98e04cf-7bf5-402e-9325-00d0f9b99287', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd13b50>]}
09:09:18.744514 [info ] [MainThread]: 
09:09:18.744845 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:09:18.745596 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:09:18.745841 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:09:19.881505 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:09:19.881968 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:09:20.295916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f98e04cf-7bf5-402e-9325-00d0f9b99287', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc16fd0>]}
09:09:20.296760 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:09:20.297201 [info ] [MainThread]: 
09:09:20.301436 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:09:20.301831 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:09:20.302346 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:09:20.302542 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:09:20.302744 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:09:20.306668 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:09:20.307165 [debug] [Thread-1  ]: finished collecting timing info
09:09:20.307356 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:09:20.346126 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:09:20.346664 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:09:20.346894 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

select
    
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
from dwh-adev-core.ae_challenge_data.ae_user_activity
  );
  
09:09:20.818611 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got integer literal "10000" at [20:5]')
09:09:22.142031 [debug] [Thread-1  ]: finished collecting timing info
09:09:22.142675 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected ")" but got integer literal "10000" at [20:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:09:22.143188 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f98e04cf-7bf5-402e-9325-00d0f9b99287', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fe997c0>]}
09:09:22.143736 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.84s]
09:09:22.144254 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:09:22.145624 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:09:22.146100 [info ] [MainThread]: 
09:09:22.146445 [info ] [MainThread]: Finished running 1 table model in 3.40s.
09:09:22.146755 [debug] [MainThread]: Connection 'master' was properly closed.
09:09:22.146926 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:09:22.156930 [info ] [MainThread]: 
09:09:22.157236 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:09:22.157528 [info ] [MainThread]: 
09:09:22.157776 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:09:22.158008 [error] [MainThread]:   Syntax error: Expected ")" but got integer literal "10000" at [20:5]
09:09:22.158232 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:09:22.158462 [info ] [MainThread]: 
09:09:22.158696 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:09:22.159107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd6f4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10feaf8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fea0e50>]}


============================== 2022-10-03 09:18:51.323030 | fdefafd9-8051-4c13-b308-de2860de6e4b ==============================
09:18:51.323074 [info ] [MainThread]: Running with dbt=1.1.2
09:18:51.323675 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:18:51.323809 [debug] [MainThread]: Tracking: tracking
09:18:51.335582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4fdd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4eadc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4ea0d0>]}
09:18:51.370449 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:18:51.371016 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:18:51.381725 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:18:51.394212 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:18:51.400933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fdefafd9-8051-4c13-b308-de2860de6e4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6820d0>]}
09:18:51.405725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fdefafd9-8051-4c13-b308-de2860de6e4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5a7dc0>]}
09:18:51.405985 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:18:51.406206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fdefafd9-8051-4c13-b308-de2860de6e4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5a7d30>]}
09:18:51.407262 [info ] [MainThread]: 
09:18:51.407666 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:18:51.408305 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:18:51.408538 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:18:52.607031 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:18:52.607524 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:18:52.999304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fdefafd9-8051-4c13-b308-de2860de6e4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4ca8e0>]}
09:18:53.000045 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:18:53.000437 [info ] [MainThread]: 
09:18:53.004412 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:18:53.004755 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:18:53.005274 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:18:53.005454 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:18:53.005651 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:18:53.009767 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:18:53.010274 [debug] [Thread-1  ]: finished collecting timing info
09:18:53.010472 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:18:53.050990 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:18:53.051595 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:18:53.051826 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (
    
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0] and money_segments[loop.index]) as user_group
    
)

select * from a1
  );
  
09:18:53.539263 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]')
09:18:54.061609 [debug] [Thread-1  ]: finished collecting timing info
09:18:54.062232 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:18:54.062643 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdefafd9-8051-4c13-b308-de2860de6e4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e790d90>]}
09:18:54.063068 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.06s]
09:18:54.063577 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:18:54.064923 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:18:54.065359 [info ] [MainThread]: 
09:18:54.065683 [info ] [MainThread]: Finished running 1 table model in 2.66s.
09:18:54.065998 [debug] [MainThread]: Connection 'master' was properly closed.
09:18:54.066154 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:18:54.076358 [info ] [MainThread]: 
09:18:54.076667 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:18:54.076960 [info ] [MainThread]: 
09:18:54.077253 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:18:54.077566 [error] [MainThread]:   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
09:18:54.077807 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:18:54.078046 [info ] [MainThread]: 
09:18:54.078355 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:18:54.078736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e64c4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e655bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e720df0>]}


============================== 2022-10-03 09:25:58.567766 | 48b0e276-4ef9-45bb-90c5-5a241b10f19c ==============================
09:25:58.567810 [info ] [MainThread]: Running with dbt=1.1.2
09:25:58.568349 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:25:58.568635 [debug] [MainThread]: Tracking: tracking
09:25:58.581842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109751550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109751070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097511f0>]}
09:25:58.615298 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:25:58.615655 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:25:58.625573 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:25:58.636983 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:25:58.643510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '48b0e276-4ef9-45bb-90c5-5a241b10f19c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098e60d0>]}
09:25:58.647737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '48b0e276-4ef9-45bb-90c5-5a241b10f19c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10980cd60>]}
09:25:58.647965 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:25:58.648213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '48b0e276-4ef9-45bb-90c5-5a241b10f19c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10980cf10>]}
09:25:58.649241 [info ] [MainThread]: 
09:25:58.649581 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:25:58.650212 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:25:58.650425 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:25:59.709325 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:25:59.709835 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:26:00.192341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '48b0e276-4ef9-45bb-90c5-5a241b10f19c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10985a790>]}
09:26:00.193220 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:26:00.193612 [info ] [MainThread]: 
09:26:00.197761 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:26:00.198101 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:26:00.198620 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:26:00.198803 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:26:00.199022 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:26:00.203020 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:26:00.203512 [debug] [Thread-1  ]: finished collecting timing info
09:26:00.203707 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:26:00.241181 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:26:00.241722 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:26:00.241942 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (
    
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0 - 1] and money_segments[loop.index +1]) as user_group
    
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0 - 1] and money_segments[loop.index +1]) as user_group
    
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0 - 1] and money_segments[loop.index +1]) as user_group
    
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0 - 1] and money_segments[loop.index +1]) as user_group
    
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0 - 1] and money_segments[loop.index +1]) as user_group
    
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0 - 1] and money_segments[loop.index +1]) as user_group
    
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[loop.index0 - 1] and money_segments[loop.index +1]) as user_group
    
)

select * from a1
  );
  
09:26:00.616529 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]')
09:26:01.940014 [debug] [Thread-1  ]: finished collecting timing info
09:26:01.940634 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:26:01.941087 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48b0e276-4ef9-45bb-90c5-5a241b10f19c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099cd490>]}
09:26:01.941611 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.74s]
09:26:01.942160 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:26:01.943451 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:26:01.943864 [info ] [MainThread]: 
09:26:01.944260 [info ] [MainThread]: Finished running 1 table model in 3.29s.
09:26:01.944555 [debug] [MainThread]: Connection 'master' was properly closed.
09:26:01.944720 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:26:01.955012 [info ] [MainThread]: 
09:26:01.955323 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:26:01.955620 [info ] [MainThread]: 
09:26:01.955866 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:26:01.956097 [error] [MainThread]:   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
09:26:01.956320 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:26:01.956546 [info ] [MainThread]: 
09:26:01.956775 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:26:01.957122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109761040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098bab50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099f2af0>]}


============================== 2022-10-03 09:27:29.175820 | 24468d5b-b493-49ca-ab4d-c6dcf08d2fcd ==============================
09:27:29.175839 [info ] [MainThread]: Running with dbt=1.1.2
09:27:29.176446 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:27:29.176584 [debug] [MainThread]: Tracking: tracking
09:27:29.188023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109522a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095221c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095221f0>]}
09:27:29.222003 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:27:29.222360 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:27:29.232369 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:27:29.243989 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:27:29.250430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '24468d5b-b493-49ca-ab4d-c6dcf08d2fcd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096970d0>]}
09:27:29.254651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '24468d5b-b493-49ca-ab4d-c6dcf08d2fcd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109629bb0>]}
09:27:29.254874 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:27:29.255085 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '24468d5b-b493-49ca-ab4d-c6dcf08d2fcd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10968ef70>]}
09:27:29.256102 [info ] [MainThread]: 
09:27:29.256441 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:27:29.256990 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:27:29.257284 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:27:30.483084 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:27:30.483595 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:27:30.872897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '24468d5b-b493-49ca-ab4d-c6dcf08d2fcd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095323d0>]}
09:27:30.873635 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:27:30.873976 [info ] [MainThread]: 
09:27:30.878097 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:27:30.878449 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:27:30.878958 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:27:30.879134 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:27:30.879344 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:27:30.883603 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:27:30.884116 [debug] [Thread-1  ]: finished collecting timing info
09:27:30.884305 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:27:30.922428 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:27:30.922991 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:27:30.923257 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (
    
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[0 - 1] and money_segments[1 +1]) as user_group
    
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[1 - 1] and money_segments[2 +1]) as user_group
    
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[2 - 1] and money_segments[3 +1]) as user_group
    
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[3 - 1] and money_segments[4 +1]) as user_group
    
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[4 - 1] and money_segments[5 +1]) as user_group
    
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[5 - 1] and money_segments[6 +1]) as user_group
    
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[6 - 1] and money_segments[7 +1]) as user_group
    
)

select * from a1
  );
  
09:27:31.414632 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]')
09:27:31.891482 [debug] [Thread-1  ]: finished collecting timing info
09:27:31.892113 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:27:31.892590 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '24468d5b-b493-49ca-ab4d-c6dcf08d2fcd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097c90d0>]}
09:27:31.893149 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.01s]
09:27:31.893672 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:27:31.895018 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:27:31.895500 [info ] [MainThread]: 
09:27:31.895843 [info ] [MainThread]: Finished running 1 table model in 2.64s.
09:27:31.896142 [debug] [MainThread]: Connection 'master' was properly closed.
09:27:31.896313 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:27:31.906594 [info ] [MainThread]: 
09:27:31.906931 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:27:31.907236 [info ] [MainThread]: 
09:27:31.907492 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:27:31.907728 [error] [MainThread]:   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
09:27:31.907951 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:27:31.908185 [info ] [MainThread]: 
09:27:31.908426 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:27:31.908787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095222b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109754fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097c8f70>]}


============================== 2022-10-03 09:28:23.670059 | 10e65df9-e0c2-4b22-8ef5-9c867fd73154 ==============================
09:28:23.670091 [info ] [MainThread]: Running with dbt=1.1.2
09:28:23.670713 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:28:23.670859 [debug] [MainThread]: Tracking: tracking
09:28:23.682585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1146ac220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1146ac4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1146ace20>]}
09:28:23.714929 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:28:23.715296 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:28:23.725317 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:28:23.736809 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:28:23.743283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '10e65df9-e0c2-4b22-8ef5-9c867fd73154', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11481f0d0>]}
09:28:23.747494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '10e65df9-e0c2-4b22-8ef5-9c867fd73154', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114767df0>]}
09:28:23.747716 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:28:23.747926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10e65df9-e0c2-4b22-8ef5-9c867fd73154', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114767f10>]}
09:28:23.748944 [info ] [MainThread]: 
09:28:23.749315 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:28:23.749855 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:28:23.750167 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:28:24.978571 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:28:24.979083 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:28:25.343530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10e65df9-e0c2-4b22-8ef5-9c867fd73154', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1147b5400>]}
09:28:25.344397 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:28:25.344803 [info ] [MainThread]: 
09:28:25.349042 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:28:25.349409 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:28:25.349944 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:28:25.350137 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:28:25.350348 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:28:25.354872 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:28:25.355386 [debug] [Thread-1  ]: finished collecting timing info
09:28:25.355581 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:28:25.393701 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:28:25.394289 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:28:25.394534 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (
    
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[0 - 1] and money_segments[1]) as user_group
    
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[1 - 1] and money_segments[2]) as user_group
    
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[2 - 1] and money_segments[3]) as user_group
    
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[3 - 1] and money_segments[4]) as user_group
    
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[4 - 1] and money_segments[5]) as user_group
    
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[5 - 1] and money_segments[6]) as user_group
    
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        between money_segments[6 - 1] and money_segments[7]) as user_group
    
)

select * from a1
  );
  
09:28:25.832343 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]')
09:28:27.186322 [debug] [Thread-1  ]: finished collecting timing info
09:28:27.186950 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:28:27.187382 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10e65df9-e0c2-4b22-8ef5-9c867fd73154', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114950ee0>]}
09:28:27.187849 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.84s]
09:28:27.188362 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:28:27.189675 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:28:27.190297 [info ] [MainThread]: 
09:28:27.190649 [info ] [MainThread]: Finished running 1 table model in 3.44s.
09:28:27.190962 [debug] [MainThread]: Connection 'master' was properly closed.
09:28:27.191127 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:28:27.201527 [info ] [MainThread]: 
09:28:27.201837 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:28:27.202122 [info ] [MainThread]: 
09:28:27.202364 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:28:27.202595 [error] [MainThread]:   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
09:28:27.202814 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:28:27.203039 [info ] [MainThread]: 
09:28:27.203268 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:28:27.203614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114830d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114830b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148e1c10>]}


============================== 2022-10-03 09:30:57.479674 | 38026a87-3f84-4026-8811-c2371d40af09 ==============================
09:30:57.479699 [info ] [MainThread]: Running with dbt=1.1.2
09:30:57.480260 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:30:57.480865 [debug] [MainThread]: Tracking: tracking
09:30:57.493448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10568e3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10568ed60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10568e610>]}
09:30:57.526151 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:30:57.526566 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:30:57.536555 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:30:57.538693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105739700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057d28b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057d2940>]}


============================== 2022-10-03 09:31:23.024670 | 119bd7a1-8f7a-4d24-9d44-52975178d8cf ==============================
09:31:23.024699 [info ] [MainThread]: Running with dbt=1.1.2
09:31:23.025420 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:31:23.025613 [debug] [MainThread]: Tracking: tracking
09:31:23.039012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e121f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e12280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e122e0>]}
09:31:23.074330 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:31:23.074687 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:31:23.084254 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:31:23.086350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110eb8760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f52910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f529a0>]}


============================== 2022-10-03 09:36:56.241432 | 5e5b7d6b-4aa5-4cf9-899f-81d9c4304008 ==============================
09:36:56.241449 [info ] [MainThread]: Running with dbt=1.1.2
09:36:56.242059 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:36:56.242609 [debug] [MainThread]: Tracking: tracking
09:36:56.254166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1142070a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114207e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114207dc0>]}
09:36:56.288859 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:36:56.289257 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:36:56.300079 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:36:56.302306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1142a0490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114339640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1143396d0>]}


============================== 2022-10-03 09:38:17.406133 | c75b4bdb-66d5-485e-a759-99b267d5a5bd ==============================
09:38:17.406159 [info ] [MainThread]: Running with dbt=1.1.2
09:38:17.406821 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:38:17.406970 [debug] [MainThread]: Tracking: tracking
09:38:17.419415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11104a7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11104a850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11104a970>]}
09:38:17.458207 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:38:17.458673 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:38:17.471796 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:38:17.474637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110f0760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11118a910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11118a9a0>]}


============================== 2022-10-03 09:40:44.602413 | de5b9a56-d543-403f-8adc-16413ecbd312 ==============================
09:40:44.602430 [info ] [MainThread]: Running with dbt=1.1.2
09:40:44.603625 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:40:44.603915 [debug] [MainThread]: Tracking: tracking
09:40:44.616783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d5430a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c1d1f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d5431c0>]}
09:40:44.648009 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:40:44.648378 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:40:44.658144 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:40:44.670147 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:40:44.676539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'de5b9a56-d543-403f-8adc-16413ecbd312', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6a70d0>]}
09:40:44.680769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'de5b9a56-d543-403f-8adc-16413ecbd312', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d530eb0>]}
09:40:44.680995 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:40:44.681252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'de5b9a56-d543-403f-8adc-16413ecbd312', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d63dc10>]}
09:40:44.682309 [info ] [MainThread]: 
09:40:44.682645 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:40:44.683185 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:40:44.683499 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:40:45.868501 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:40:45.869039 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:40:46.324312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'de5b9a56-d543-403f-8adc-16413ecbd312', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c196970>]}
09:40:46.325178 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:40:46.325560 [info ] [MainThread]: 
09:40:46.329591 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:40:46.329974 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:40:46.330543 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:40:46.330727 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:40:46.330927 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:40:46.336074 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:40:46.336592 [debug] [Thread-1  ]: finished collecting timing info
09:40:46.336784 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:40:46.374142 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:40:46.374689 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:40:46.374903 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (
    
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 0 and money_segments[0]
        
    
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between money_segments[1000] and money_segments[2]) as user_group
        
    
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between money_segments[10000] and money_segments[3]) as user_group
        
    
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between money_segments[20000] and money_segments[4]) as user_group
        
    
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between money_segments[30000] and money_segments[5]) as user_group
        
    
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between money_segments[50000] and money_segments[6]) as user_group
        
    
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between money_segments[100000] and money_segments[7]) as user_group
        
    
)

select * from a1
  );
  
09:40:46.874718 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]')
09:40:48.141254 [debug] [Thread-1  ]: finished collecting timing info
09:40:48.141866 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:40:48.142294 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'de5b9a56-d543-403f-8adc-16413ecbd312', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7d86d0>]}
09:40:48.142827 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.81s]
09:40:48.143357 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:40:48.144870 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:40:48.145304 [info ] [MainThread]: 
09:40:48.145624 [info ] [MainThread]: Finished running 1 table model in 3.46s.
09:40:48.145914 [debug] [MainThread]: Connection 'master' was properly closed.
09:40:48.146073 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:40:48.157303 [info ] [MainThread]: 
09:40:48.157628 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:40:48.157918 [info ] [MainThread]: 
09:40:48.158162 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:40:48.158395 [error] [MainThread]:   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
09:40:48.158630 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:40:48.158859 [info ] [MainThread]: 
09:40:48.159090 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:40:48.159440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6a1250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7a33a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7c7f70>]}


============================== 2022-10-03 09:41:24.656509 | e03351e3-bc08-4180-98ef-0ac880a2ba9c ==============================
09:41:24.656558 [info ] [MainThread]: Running with dbt=1.1.2
09:41:24.657267 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:41:24.657438 [debug] [MainThread]: Tracking: tracking
09:41:24.668615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f86220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f864c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f86e20>]}
09:41:24.700124 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:41:24.700517 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:41:24.710705 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:41:24.722748 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:41:24.729266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e03351e3-bc08-4180-98ef-0ac880a2ba9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050fa0d0>]}
09:41:24.733511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e03351e3-bc08-4180-98ef-0ac880a2ba9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105046df0>]}
09:41:24.733738 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:41:24.733950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e03351e3-bc08-4180-98ef-0ac880a2ba9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105046f10>]}
09:41:24.734988 [info ] [MainThread]: 
09:41:24.735321 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:41:24.735893 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:41:24.736220 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:41:25.870078 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:41:25.870610 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:41:26.323469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e03351e3-bc08-4180-98ef-0ac880a2ba9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105090400>]}
09:41:26.324351 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:41:26.324741 [info ] [MainThread]: 
09:41:26.328991 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:41:26.329376 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:41:26.329930 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:41:26.330121 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:41:26.330333 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:41:26.335528 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:41:26.336033 [debug] [Thread-1  ]: finished collecting timing info
09:41:26.336226 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:41:26.373664 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:41:26.374201 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:41:26.374415 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (
    
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 0 and money_segments[0]
        
    
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 1000 and money_segments[2]) as user_group
        
    
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 10000 and money_segments[3]) as user_group
        
    
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 20000 and money_segments[4]) as user_group
        
    
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 30000 and money_segments[5]) as user_group
        
    
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 50000 and money_segments[6]) as user_group
        
    
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 100000 and money_segments[7]) as user_group
        
    
)

select * from a1
  );
  
09:41:26.899515 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]')
09:41:28.240174 [debug] [Thread-1  ]: finished collecting timing info
09:41:28.240818 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:41:28.241268 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e03351e3-bc08-4180-98ef-0ac880a2ba9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10522b040>]}
09:41:28.241838 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.91s]
09:41:28.242368 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:41:28.243857 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:41:28.244349 [info ] [MainThread]: 
09:41:28.244718 [info ] [MainThread]: Finished running 1 table model in 3.51s.
09:41:28.245018 [debug] [MainThread]: Connection 'master' was properly closed.
09:41:28.245190 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:41:28.255692 [info ] [MainThread]: 
09:41:28.255994 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:41:28.256287 [info ] [MainThread]: 
09:41:28.256531 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:41:28.256763 [error] [MainThread]:   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
09:41:28.256987 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:41:28.257212 [info ] [MainThread]: 
09:41:28.257443 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:41:28.257793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105109d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105109af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051bec40>]}


============================== 2022-10-03 09:42:36.141168 | d325e99f-182f-4b3b-ae32-d1cc860521e8 ==============================
09:42:36.141197 [info ] [MainThread]: Running with dbt=1.1.2
09:42:36.141811 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:42:36.142531 [debug] [MainThread]: Tracking: tracking
09:42:36.154237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc6ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc4e610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc6e490>]}
09:42:36.189985 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:42:36.190384 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:42:36.200868 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:42:36.213308 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:42:36.220107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd325e99f-182f-4b3b-ae32-d1cc860521e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fe10ee0>]}
09:42:36.224526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd325e99f-182f-4b3b-ae32-d1cc860521e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc6ed00>]}
09:42:36.224758 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:42:36.224974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd325e99f-182f-4b3b-ae32-d1cc860521e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc4e610>]}
09:42:36.226025 [info ] [MainThread]: 
09:42:36.226585 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:42:36.227209 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:42:36.227529 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:42:37.399822 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:42:37.400318 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:42:37.804929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd325e99f-182f-4b3b-ae32-d1cc860521e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8d1a00>]}
09:42:37.805833 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:42:37.806234 [info ] [MainThread]: 
09:42:37.810345 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:42:37.810737 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:42:37.811257 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:42:37.811441 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:42:37.811670 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:42:37.816674 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:42:37.817215 [debug] [Thread-1  ]: finished collecting timing info
09:42:37.817413 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:42:37.855797 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:42:37.856354 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:42:37.856579 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (
    
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 0 and money_segments[0]
        
    
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 1000 and 10000 as user_group
        
    
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 10000 and 20000 as user_group
        
    
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 20000 and 30000 as user_group
        
    
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 30000 and 50000 as user_group
        
    
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 50000 and 100000 as user_group
        
    
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 100000 and 500000 as user_group
        
    
)

select * from a1
  );
  
09:42:38.338610 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]')
09:42:39.674538 [debug] [Thread-1  ]: finished collecting timing info
09:42:39.675167 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:42:39.675670 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd325e99f-182f-4b3b-ae32-d1cc860521e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fef1460>]}
09:42:39.676244 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.86s]
09:42:39.676773 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:42:39.678332 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:42:39.678836 [info ] [MainThread]: 
09:42:39.679197 [info ] [MainThread]: Finished running 1 table model in 3.45s.
09:42:39.679511 [debug] [MainThread]: Connection 'master' was properly closed.
09:42:39.679693 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:42:39.690198 [info ] [MainThread]: 
09:42:39.690505 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:42:39.690810 [info ] [MainThread]: 
09:42:39.691060 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:42:39.691297 [error] [MainThread]:   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
09:42:39.691524 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:42:39.691767 [info ] [MainThread]: 
09:42:39.692016 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:42:39.692381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fdd2130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fddbb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ff153a0>]}


============================== 2022-10-03 09:43:15.954369 | 1f57e9a1-af76-4cb7-93cc-b2ac95c5e926 ==============================
09:43:15.954386 [info ] [MainThread]: Running with dbt=1.1.2
09:43:15.954946 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:43:15.955119 [debug] [MainThread]: Tracking: tracking
09:43:15.966693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b93d280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b93d790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b93de20>]}
09:43:16.003107 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:43:16.003518 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:43:16.014185 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:43:16.026853 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:43:16.034858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1f57e9a1-af76-4cb7-93cc-b2ac95c5e926', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10baaf0d0>]}
09:43:16.039319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1f57e9a1-af76-4cb7-93cc-b2ac95c5e926', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9f8df0>]}
09:43:16.039566 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:43:16.039808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f57e9a1-af76-4cb7-93cc-b2ac95c5e926', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9f8f10>]}
09:43:16.040961 [info ] [MainThread]: 
09:43:16.041358 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:43:16.041935 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:43:16.042159 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:43:17.189572 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:43:17.190120 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:43:17.583882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f57e9a1-af76-4cb7-93cc-b2ac95c5e926', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba46400>]}
09:43:17.584761 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:43:17.585173 [info ] [MainThread]: 
09:43:17.589424 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:43:17.589799 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:43:17.590333 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:43:17.590534 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:43:17.590732 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:43:17.595583 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:43:17.596176 [debug] [Thread-1  ]: finished collecting timing info
09:43:17.596421 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:43:17.634375 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:43:17.634945 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:43:17.635173 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (
    
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 0 and 1000
        
    
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 1000 and 10000 as user_group
        
    
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 10000 and 20000 as user_group
        
    
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 20000 and 30000 as user_group
        
    
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 30000 and 50000 as user_group
        
    
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 50000 and 100000 as user_group
        
    
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 100000 and 500000 as user_group
        
    
)

select * from a1
  );
  
09:43:18.017463 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]')
09:43:19.076395 [debug] [Thread-1  ]: finished collecting timing info
09:43:19.077036 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:43:19.077492 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f57e9a1-af76-4cb7-93cc-b2ac95c5e926', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bbe2c40>]}
09:43:19.078037 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.49s]
09:43:19.078549 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:43:19.079885 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:43:19.080313 [info ] [MainThread]: 
09:43:19.080643 [info ] [MainThread]: Finished running 1 table model in 3.04s.
09:43:19.080951 [debug] [MainThread]: Connection 'master' was properly closed.
09:43:19.081116 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:43:19.091884 [info ] [MainThread]: 
09:43:19.092201 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:43:19.092494 [info ] [MainThread]: 
09:43:19.092739 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:43:19.092969 [error] [MainThread]:   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got integer literal "1000" at [13:5]
09:43:19.093189 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:43:19.093442 [info ] [MainThread]: 
09:43:19.093747 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:43:19.094124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bac0d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bac03a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb73fa0>]}


============================== 2022-10-03 09:48:36.071272 | 9e9872df-b90a-4851-9315-902be06c38ac ==============================
09:48:36.071288 [info ] [MainThread]: Running with dbt=1.1.2
09:48:36.072069 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:48:36.072303 [debug] [MainThread]: Tracking: tracking
09:48:36.085530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b2cd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b2cb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b2cf70>]}
09:48:36.117395 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:48:36.117760 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:48:36.127654 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:48:36.139659 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:48:36.146428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9e9872df-b90a-4851-9315-902be06c38ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ca10d0>]}
09:48:36.150716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9e9872df-b90a-4851-9315-902be06c38ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b3d310>]}
09:48:36.150941 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:48:36.151189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9e9872df-b90a-4851-9315-902be06c38ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c33df0>]}
09:48:36.152265 [info ] [MainThread]: 
09:48:36.152596 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:48:36.153151 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:48:36.153447 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:48:37.336269 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:48:37.336792 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:48:37.780098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9e9872df-b90a-4851-9315-902be06c38ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b7cb80>]}
09:48:37.780845 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:48:37.781209 [info ] [MainThread]: 
09:48:37.785442 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:48:37.785819 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:48:37.786345 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:48:37.786526 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:48:37.786721 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:48:37.791599 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:48:37.792169 [debug] [Thread-1  ]: finished collecting timing info
09:48:37.792410 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:48:37.831200 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:48:37.831752 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:48:37.831975 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (
select
    
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 0 and 1000
        
    
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 1000 and 10000 as user_group
        
    
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 10000 and 20000 as user_group
        
    
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 20000 and 30000 as user_group
        
    
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 30000 and 50000 as user_group
        
    
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 50000 and 100000 as user_group
        
    
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 100000 and 500000 as user_group
        
    
)

select * from a1
  );
  
09:48:38.194249 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got integer literal "10000" at [23:5]')
09:48:38.752428 [debug] [Thread-1  ]: finished collecting timing info
09:48:38.753045 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected ")" but got integer literal "10000" at [23:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:48:38.753494 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9e9872df-b90a-4851-9315-902be06c38ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111dd0850>]}
09:48:38.754036 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 0.97s]
09:48:38.754591 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:48:38.755928 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:48:38.756411 [info ] [MainThread]: 
09:48:38.756759 [info ] [MainThread]: Finished running 1 table model in 2.60s.
09:48:38.757063 [debug] [MainThread]: Connection 'master' was properly closed.
09:48:38.757230 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:48:38.767852 [info ] [MainThread]: 
09:48:38.768170 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:48:38.768462 [info ] [MainThread]: 
09:48:38.768714 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:48:38.768954 [error] [MainThread]:   Syntax error: Expected ")" but got integer literal "10000" at [23:5]
09:48:38.769184 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:48:38.769421 [info ] [MainThread]: 
09:48:38.769670 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:48:38.770021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111d9b580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111d5deb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111dccf70>]}


============================== 2022-10-03 09:49:38.208006 | 1cafff17-da46-400b-9f0a-c3cfd79df746 ==============================
09:49:38.208023 [info ] [MainThread]: Running with dbt=1.1.2
09:49:38.208928 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:49:38.209239 [debug] [MainThread]: Tracking: tracking
09:49:38.221504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10981d220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10981d790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10981d670>]}
09:49:38.254714 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:49:38.255108 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:49:38.265218 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:49:38.277354 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:49:38.284059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1cafff17-da46-400b-9f0a-c3cfd79df746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099910d0>]}
09:49:38.288364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1cafff17-da46-400b-9f0a-c3cfd79df746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098d8df0>]}
09:49:38.288593 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:49:38.288827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1cafff17-da46-400b-9f0a-c3cfd79df746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098d8f10>]}
09:49:38.289841 [info ] [MainThread]: 
09:49:38.290178 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:49:38.290737 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:49:38.291042 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:49:39.449054 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:49:39.449581 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:49:39.777633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1cafff17-da46-400b-9f0a-c3cfd79df746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109927400>]}
09:49:39.778405 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:49:39.778832 [info ] [MainThread]: 
09:49:39.782910 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:49:39.783258 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:49:39.783759 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:49:39.783936 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:49:39.784134 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:49:39.788872 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:49:39.789368 [debug] [Thread-1  ]: finished collecting timing info
09:49:39.789555 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:49:39.825393 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:49:39.825896 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:49:39.826098 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (
select
    
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 0 and 1000
        
    union all
    
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 1000 and 10000 as user_group
        
    union all
    
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 10000 and 20000 as user_group
        
    union all
    
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 20000 and 30000 as user_group
        
    union all
    
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 30000 and 50000 as user_group
        
    union all
    
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 50000 and 100000 as user_group
        
    union all
    
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 100000 and 500000 as user_group
        
    union all
    
)

select * from a1
  );
  
09:49:40.205429 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or keyword SELECT but got integer literal "10000" at [24:5]')
09:49:40.550274 [debug] [Thread-1  ]: finished collecting timing info
09:49:40.550896 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected "(" or keyword SELECT but got integer literal "10000" at [24:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:49:40.551351 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1cafff17-da46-400b-9f0a-c3cfd79df746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ac1e50>]}
09:49:40.551879 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 0.77s]
09:49:40.552453 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:49:40.553835 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:49:40.554295 [info ] [MainThread]: 
09:49:40.554636 [info ] [MainThread]: Finished running 1 table model in 2.26s.
09:49:40.554936 [debug] [MainThread]: Connection 'master' was properly closed.
09:49:40.555102 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:49:40.565519 [info ] [MainThread]: 
09:49:40.565823 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:49:40.566111 [info ] [MainThread]: 
09:49:40.566354 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:49:40.566587 [error] [MainThread]:   Syntax error: Expected "(" or keyword SELECT but got integer literal "10000" at [24:5]
09:49:40.566808 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:49:40.567034 [info ] [MainThread]: 
09:49:40.567265 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:49:40.567611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099a3b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099a3280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a54970>]}


============================== 2022-10-03 09:51:30.648003 | ecc2e73a-7c0a-47f9-b1ae-d29990084222 ==============================
09:51:30.648020 [info ] [MainThread]: Running with dbt=1.1.2
09:51:30.648757 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:51:30.649013 [debug] [MainThread]: Tracking: tracking
09:51:30.660955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ede7f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104edeb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104edebb0>]}
09:51:30.695346 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:51:30.695735 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:51:30.705563 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:51:30.718305 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:51:30.724837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ecc2e73a-7c0a-47f9-b1ae-d29990084222', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10507df10>]}
09:51:30.729064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ecc2e73a-7c0a-47f9-b1ae-d29990084222', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f99d60>]}
09:51:30.729286 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:51:30.729513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ecc2e73a-7c0a-47f9-b1ae-d29990084222', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f99f10>]}
09:51:30.730564 [info ] [MainThread]: 
09:51:30.730903 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:51:30.731465 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:51:30.731753 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:51:31.775059 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:51:31.775569 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:51:32.198873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ecc2e73a-7c0a-47f9-b1ae-d29990084222', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104edb490>]}
09:51:32.199733 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:51:32.200136 [info ] [MainThread]: 
09:51:32.204498 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:51:32.204870 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:51:32.205382 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:51:32.205559 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:51:32.205762 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:51:32.211048 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:51:32.211589 [debug] [Thread-1  ]: finished collecting timing info
09:51:32.211818 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:51:32.250018 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:51:32.250599 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:51:32.250830 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (
select
    
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 0 and 1000
        
    
    union all
    
    
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 1000 and 10000 as user_group
        
    
    union all
    
    
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 10000 and 20000 as user_group
        
    
    union all
    
    
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 20000 and 30000 as user_group
        
    
    union all
    
    
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 30000 and 50000 as user_group
        
    
    union all
    
    
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 50000 and 100000 as user_group
        
    
    union all
    
    
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 100000 and 500000 as user_group
        
    
    
)

select * from a1
  );
  
09:51:32.826869 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or keyword SELECT but got integer literal "10000" at [26:5]')
09:51:33.494200 [debug] [Thread-1  ]: finished collecting timing info
09:51:33.494829 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected "(" or keyword SELECT but got integer literal "10000" at [26:5]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:51:33.495269 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ecc2e73a-7c0a-47f9-b1ae-d29990084222', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105182160>]}
09:51:33.495821 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.29s]
09:51:33.496323 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:51:33.497592 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:51:33.498006 [info ] [MainThread]: 
09:51:33.498394 [info ] [MainThread]: Finished running 1 table model in 2.77s.
09:51:33.498695 [debug] [MainThread]: Connection 'master' was properly closed.
09:51:33.498864 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:51:33.509526 [info ] [MainThread]: 
09:51:33.509836 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:51:33.510132 [info ] [MainThread]: 
09:51:33.510382 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:51:33.510618 [error] [MainThread]:   Syntax error: Expected "(" or keyword SELECT but got integer literal "10000" at [26:5]
09:51:33.510841 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:51:33.511070 [info ] [MainThread]: 
09:51:33.511304 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:51:33.511663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105046a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105040b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10516ac70>]}


============================== 2022-10-03 09:52:35.851480 | 11d0e5a0-5f58-44a6-9312-8b2e9e454029 ==============================
09:52:35.851496 [info ] [MainThread]: Running with dbt=1.1.2
09:52:35.852142 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:52:35.852378 [debug] [MainThread]: Tracking: tracking
09:52:35.864128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128fbc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c9b250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c9b070>]}
09:52:35.897441 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:52:35.897821 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:52:35.907928 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:52:35.920279 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:52:35.926755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '11d0e5a0-5f58-44a6-9312-8b2e9e454029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113e100d0>]}
09:52:35.930933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '11d0e5a0-5f58-44a6-9312-8b2e9e454029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d59d90>]}
09:52:35.931155 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:52:35.931404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '11d0e5a0-5f58-44a6-9312-8b2e9e454029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d59fd0>]}
09:52:35.932425 [info ] [MainThread]: 
09:52:35.932801 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:52:35.933362 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:52:35.933551 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:52:36.954085 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:52:36.954619 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:52:37.362653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '11d0e5a0-5f58-44a6-9312-8b2e9e454029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113cab0a0>]}
09:52:37.363543 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:52:37.364000 [info ] [MainThread]: 
09:52:37.367979 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:52:37.368338 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:52:37.368843 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:52:37.369037 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:52:37.369238 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:52:37.374598 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:52:37.375089 [debug] [Thread-1  ]: finished collecting timing info
09:52:37.375296 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:52:37.413899 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:52:37.414459 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:52:37.414684 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (

    
    select
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 0 and 1000
        
    
    union all
    
    
    select
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 1000 and 10000 as user_group
        
    
    union all
    
    
    select
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 10000 and 20000 as user_group
        
    
    union all
    
    
    select
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 20000 and 30000 as user_group
        
    
    union all
    
    
    select
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 30000 and 50000 as user_group
        
    
    union all
    
    
    select
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 50000 and 100000 as user_group
        
    
    union all
    
    
    select
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 100000 and 500000 as user_group
        
    
    
)

select * from a1
  );
  
09:52:37.784977 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword AS at [34:32]')
09:52:39.277786 [debug] [Thread-1  ]: finished collecting timing info
09:52:39.278410 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected ")" but got keyword AS at [34:32]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:52:39.278887 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11d0e5a0-5f58-44a6-9312-8b2e9e454029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113f1a250>]}
09:52:39.279394 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.91s]
09:52:39.279902 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:52:39.281348 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:52:39.281832 [info ] [MainThread]: 
09:52:39.282166 [info ] [MainThread]: Finished running 1 table model in 3.35s.
09:52:39.282461 [debug] [MainThread]: Connection 'master' was properly closed.
09:52:39.282624 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:52:39.293106 [info ] [MainThread]: 
09:52:39.293409 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:52:39.293786 [info ] [MainThread]: 
09:52:39.294049 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:52:39.294289 [error] [MainThread]:   Syntax error: Expected ")" but got keyword AS at [34:32]
09:52:39.294514 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:52:39.294751 [info ] [MainThread]: 
09:52:39.295089 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:52:39.295451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113e04b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113df93d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113f2fac0>]}


============================== 2022-10-03 09:55:25.099690 | b7679942-55a1-495b-81cd-d1b4fc21b4ff ==============================
09:55:25.099708 [info ] [MainThread]: Running with dbt=1.1.2
09:55:25.100298 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:55:25.100561 [debug] [MainThread]: Tracking: tracking
09:55:25.112373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc94490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc94b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc94a60>]}
09:55:25.146438 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:55:25.146802 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:55:25.156767 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:55:25.169275 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:55:25.175876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b7679942-55a1-495b-81cd-d1b4fc21b4ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bdf90d0>]}
09:55:25.180277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b7679942-55a1-495b-81cd-d1b4fc21b4ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc80220>]}
09:55:25.180504 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:55:25.180712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b7679942-55a1-495b-81cd-d1b4fc21b4ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc80dc0>]}
09:55:25.181738 [info ] [MainThread]: 
09:55:25.182127 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:55:25.182846 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:55:25.183056 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:55:26.807253 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:55:26.807708 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:55:27.608654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b7679942-55a1-495b-81cd-d1b4fc21b4ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc820d0>]}
09:55:27.609383 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:55:27.609767 [info ] [MainThread]: 
09:55:27.614030 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:55:27.614406 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:55:27.614921 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:55:27.615105 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:55:27.615306 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:55:27.620509 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:55:27.621005 [debug] [Thread-1  ]: finished collecting timing info
09:55:27.621196 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:55:27.658608 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:55:27.659156 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:55:27.659381 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (

    
    select
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 0 and 1000 as user_group
        
    
    union all
    
    
    select
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 1000 and 10000 as user_group
        
    
    union all
    
    
    select
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 10000 and 20000 as user_group
        
    
    union all
    
    
    select
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 20000 and 30000 as user_group
        
    
    union all
    
    
    select
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 30000 and 50000 as user_group
        
    
    union all
    
    
    select
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 50000 and 100000 as user_group
        
    
    union all
    
    
    select
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 100000 and 500000 as user_group
        
    
    
)

select * from a1
  );
  
09:55:28.149106 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword AS at [21:28]')
09:55:29.487076 [debug] [Thread-1  ]: finished collecting timing info
09:55:29.487697 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected ")" but got keyword AS at [21:28]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:55:29.488139 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b7679942-55a1-495b-81cd-d1b4fc21b4ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf2aca0>]}
09:55:29.488670 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.87s]
09:55:29.489185 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:55:29.490456 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:55:29.490877 [info ] [MainThread]: 
09:55:29.491199 [info ] [MainThread]: Finished running 1 table model in 4.31s.
09:55:29.491489 [debug] [MainThread]: Connection 'master' was properly closed.
09:55:29.491655 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:55:29.502364 [info ] [MainThread]: 
09:55:29.502675 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:55:29.502966 [info ] [MainThread]: 
09:55:29.503212 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:55:29.503445 [error] [MainThread]:   Syntax error: Expected ")" but got keyword AS at [21:28]
09:55:29.503668 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:55:29.503895 [info ] [MainThread]: 
09:55:29.504123 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:55:29.504534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf180a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bef6130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf11820>]}


============================== 2022-10-03 09:57:22.157634 | f29452c9-1c5d-4b07-8a07-a95fad742d09 ==============================
09:57:22.157678 [info ] [MainThread]: Running with dbt=1.1.2
09:57:22.158331 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:57:22.158570 [debug] [MainThread]: Tracking: tracking
09:57:22.170598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11326a520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11326a490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11326aee0>]}
09:57:22.206029 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:57:22.206444 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:57:22.217330 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:57:22.229955 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:57:22.236442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f29452c9-1c5d-4b07-8a07-a95fad742d09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133e00d0>]}
09:57:22.240804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f29452c9-1c5d-4b07-8a07-a95fad742d09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113378f70>]}
09:57:22.241047 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:57:22.241341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f29452c9-1c5d-4b07-8a07-a95fad742d09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113371dc0>]}
09:57:22.242397 [info ] [MainThread]: 
09:57:22.242865 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:57:22.243481 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:57:22.243702 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:57:23.404640 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:57:23.405290 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:57:23.852494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f29452c9-1c5d-4b07-8a07-a95fad742d09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132ba460>]}
09:57:23.853397 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:57:23.853786 [info ] [MainThread]: 
09:57:23.857922 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:57:23.858295 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:57:23.858840 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:57:23.859026 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:57:23.859272 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:57:23.864827 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:57:23.865423 [debug] [Thread-1  ]: finished collecting timing info
09:57:23.865623 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:57:23.903628 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:57:23.904169 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:57:23.904383 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (

    
    select
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where ((select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 0 and 1000) as user_group
        
    
    union all
    
    
    select
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where ((select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 1000)and 10000 as user_group
        
    
    union all
    
    
    select
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where ((select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 10000)and 20000 as user_group
        
    
    union all
    
    
    select
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where ((select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 20000)and 30000 as user_group
        
    
    union all
    
    
    select
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where ((select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 30000)and 50000 as user_group
        
    
    union all
    
    
    select
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where ((select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 50000)and 100000 as user_group
        
    
    union all
    
    
    select
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where ((select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 100000)and 500000 as user_group
        
    
    
)

select * from a1
  );
  
09:57:24.248426 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword AS at [21:29]')
09:57:24.883509 [debug] [Thread-1  ]: finished collecting timing info
09:57:24.884126 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Expected ")" but got keyword AS at [21:29]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:57:24.884578 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f29452c9-1c5d-4b07-8a07-a95fad742d09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11350f430>]}
09:57:24.885148 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.03s]
09:57:24.885660 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:57:24.887053 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:57:24.887485 [info ] [MainThread]: 
09:57:24.887926 [info ] [MainThread]: Finished running 1 table model in 2.64s.
09:57:24.888228 [debug] [MainThread]: Connection 'master' was properly closed.
09:57:24.888397 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:57:24.898739 [info ] [MainThread]: 
09:57:24.899047 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:57:24.899472 [info ] [MainThread]: 
09:57:24.899732 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:57:24.899975 [error] [MainThread]:   Syntax error: Expected ")" but got keyword AS at [21:29]
09:57:24.900195 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:57:24.900422 [info ] [MainThread]: 
09:57:24.900652 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:57:24.900999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1134da6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11349afd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113505190>]}


============================== 2022-10-03 09:57:56.863907 | 2ebb5097-d45e-4439-a59a-14631e88a010 ==============================
09:57:56.863924 [info ] [MainThread]: Running with dbt=1.1.2
09:57:56.864538 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:57:56.864697 [debug] [MainThread]: Tracking: tracking
09:57:56.876737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069ac2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069acb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069ac3a0>]}
09:57:56.913138 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:57:56.913535 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:57:56.923793 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:57:56.936726 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:57:56.943785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2ebb5097-d45e-4439-a59a-14631e88a010', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b120d0>]}
09:57:56.948409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2ebb5097-d45e-4439-a59a-14631e88a010', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a56eb0>]}
09:57:56.948679 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:57:56.948933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ebb5097-d45e-4439-a59a-14631e88a010', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055fd670>]}
09:57:56.950243 [info ] [MainThread]: 
09:57:56.950640 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:57:56.951242 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:57:56.951475 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:57:58.102754 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:57:58.103275 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:57:58.513733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ebb5097-d45e-4439-a59a-14631e88a010', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b0d610>]}
09:57:58.514471 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:57:58.514838 [info ] [MainThread]: 
09:57:58.518962 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:57:58.519338 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:57:58.519879 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:57:58.520070 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:57:58.520308 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:57:58.525954 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:57:58.526533 [debug] [Thread-1  ]: finished collecting timing info
09:57:58.526737 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:57:58.565805 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:57:58.566508 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:57:58.566750 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (

    
    select
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 0 and 1000) as user_group
        
    
    union all
    
    
    select
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 1000)and 10000 as user_group
        
    
    union all
    
    
    select
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 10000)and 20000 as user_group
        
    
    union all
    
    
    select
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 20000)and 30000 as user_group
        
    
    union all
    
    
    select
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 30000)and 50000 as user_group
        
    
    union all
    
    
    select
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 50000)and 100000 as user_group
        
    
    union all
    
    
    select
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 100000)and 500000 as user_group
        
    
    
)

select * from a1
  );
  
09:57:58.966041 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected ")" at [34:21]')
09:58:00.308787 [debug] [Thread-1  ]: finished collecting timing info
09:58:00.309428 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Unexpected ")" at [34:21]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:58:00.309905 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ebb5097-d45e-4439-a59a-14631e88a010', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c3f280>]}
09:58:00.310429 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.79s]
09:58:00.310984 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:58:00.312385 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:58:00.312871 [info ] [MainThread]: 
09:58:00.313196 [info ] [MainThread]: Finished running 1 table model in 3.36s.
09:58:00.313487 [debug] [MainThread]: Connection 'master' was properly closed.
09:58:00.313652 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:58:00.323779 [info ] [MainThread]: 
09:58:00.324084 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:58:00.324382 [info ] [MainThread]: 
09:58:00.324627 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:58:00.324859 [error] [MainThread]:   Syntax error: Unexpected ")" at [34:21]
09:58:00.325078 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:58:00.325304 [info ] [MainThread]: 
09:58:00.325533 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:58:00.325878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b047f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106afdac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c27c70>]}


============================== 2022-10-03 09:58:30.440219 | d23fb459-e398-4bec-9a79-d52b09a56313 ==============================
09:58:30.440234 [info ] [MainThread]: Running with dbt=1.1.2
09:58:30.440791 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:58:30.441019 [debug] [MainThread]: Tracking: tracking
09:58:30.453092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bd2550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bd2b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bd23a0>]}
09:58:30.488665 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:58:30.489212 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:58:30.500105 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:58:30.512368 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:58:30.518785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd23fb459-e398-4bec-9a79-d52b09a56313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d380d0>]}
09:58:30.523446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd23fb459-e398-4bec-9a79-d52b09a56313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c7eeb0>]}
09:58:30.523687 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:58:30.523899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd23fb459-e398-4bec-9a79-d52b09a56313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088257c0>]}
09:58:30.524941 [info ] [MainThread]: 
09:58:30.525307 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:58:30.526013 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:58:30.526176 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:58:31.659119 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:58:31.659616 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:58:31.974987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd23fb459-e398-4bec-9a79-d52b09a56313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109baa340>]}
09:58:31.975750 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:58:31.976220 [info ] [MainThread]: 
09:58:31.980153 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:58:31.980514 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:58:31.981025 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:58:31.981209 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:58:31.981412 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:58:31.986932 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:58:31.987436 [debug] [Thread-1  ]: finished collecting timing info
09:58:31.987633 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:58:32.025978 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:58:32.026525 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:58:32.026744 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (

    
    select
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 0 and 1000) as user_group
        
    
    union all
    
    
    select
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 1000and 10000) as user_group
        
    
    union all
    
    
    select
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 10000and 20000) as user_group
        
    
    union all
    
    
    select
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 20000and 30000) as user_group
        
    
    union all
    
    
    select
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 30000and 50000) as user_group
        
    
    union all
    
    
    select
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 50000and 100000) as user_group
        
    
    union all
    
    
    select
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 100000and 500000) as user_group
        
    
    
)

select * from a1
  );
  
09:58:32.473645 [debug] [Thread-1  ]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Missing whitespace between literal and alias at [34:21]')
09:58:33.807989 [debug] [Thread-1  ]: finished collecting timing info
09:58:33.808626 [debug] [Thread-1  ]: Database Error in model prova_jinja2 (models/prova_jinja2.sql)
  Syntax error: Missing whitespace between literal and alias at [34:21]
  compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:58:33.809072 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd23fb459-e398-4bec-9a79-d52b09a56313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e68100>]}
09:58:33.809632 [error] [Thread-1  ]: 1 of 1 ERROR creating table model zz_xavier.prova_jinja2 ....................... [[31mERROR[0m in 1.83s]
09:58:33.810148 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:58:33.811553 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:58:33.811983 [info ] [MainThread]: 
09:58:33.812308 [info ] [MainThread]: Finished running 1 table model in 3.29s.
09:58:33.812608 [debug] [MainThread]: Connection 'master' was properly closed.
09:58:33.812777 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:58:33.823281 [info ] [MainThread]: 
09:58:33.823603 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
09:58:33.823904 [info ] [MainThread]: 
09:58:33.824152 [error] [MainThread]: [33mDatabase Error in model prova_jinja2 (models/prova_jinja2.sql)[0m
09:58:33.824387 [error] [MainThread]:   Syntax error: Missing whitespace between literal and alias at [34:21]
09:58:33.824607 [error] [MainThread]:   compiled SQL at target/run/exercise/models/prova_jinja2.sql
09:58:33.824833 [info ] [MainThread]: 
09:58:33.825128 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
09:58:33.825522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d2d7f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d24ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e55850>]}


============================== 2022-10-03 09:59:08.530832 | 7824ce3f-e052-456e-ab9b-35902526ab1c ==============================
09:59:08.530877 [info ] [MainThread]: Running with dbt=1.1.2
09:59:08.531680 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:59:08.532079 [debug] [MainThread]: Tracking: tracking
09:59:08.543835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae505e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae508e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae50910>]}
09:59:08.579494 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
09:59:08.579908 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
09:59:08.590196 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
09:59:08.603349 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
09:59:08.610171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7824ce3f-e052-456e-ab9b-35902526ab1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afdff10>]}
09:59:08.614698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7824ce3f-e052-456e-ab9b-35902526ab1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae20490>]}
09:59:08.614941 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
09:59:08.615180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7824ce3f-e052-456e-ab9b-35902526ab1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a73580>]}
09:59:08.616228 [info ] [MainThread]: 
09:59:08.616676 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:59:08.617300 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
09:59:08.617527 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:59:09.656822 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
09:59:09.657338 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:59:10.041944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7824ce3f-e052-456e-ab9b-35902526ab1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aef6be0>]}
09:59:10.042775 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
09:59:10.043180 [info ] [MainThread]: 
09:59:10.047460 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
09:59:10.047827 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
09:59:10.048342 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
09:59:10.048524 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
09:59:10.048731 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
09:59:10.053930 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
09:59:10.054445 [debug] [Thread-1  ]: finished collecting timing info
09:59:10.054638 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
09:59:10.092442 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
09:59:10.092984 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:59:10.093203 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (

    
    select
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 0 and 1000) as user_group
        
    
    union all
    
    
    select
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 1000 and 10000) as user_group
        
    
    union all
    
    
    select
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 10000 and 20000) as user_group
        
    
    union all
    
    
    select
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 20000 and 30000) as user_group
        
    
    union all
    
    
    select
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 30000 and 50000) as user_group
        
    
    union all
    
    
    select
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 50000 and 100000) as user_group
        
    
    union all
    
    
    select
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "purchase" group by ua2.user_id)
        
        between 100000 and 500000) as user_group
        
    
    
)

select * from a1
  );
  
09:59:30.316112 [debug] [Thread-1  ]: finished collecting timing info
09:59:30.316650 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7824ce3f-e052-456e-ab9b-35902526ab1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aef61c0>]}
09:59:30.317050 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.prova_jinja2 ........................... [[32mCREATE TABLE (7.0 rows, 362.2 MB processed)[0m in 20.27s]
09:59:30.317533 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
09:59:30.318770 [debug] [MainThread]: Acquiring new bigquery connection "master"
09:59:30.319180 [info ] [MainThread]: 
09:59:30.319477 [info ] [MainThread]: Finished running 1 table model in 21.70s.
09:59:30.319741 [debug] [MainThread]: Connection 'master' was properly closed.
09:59:30.319887 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
09:59:30.327710 [info ] [MainThread]: 
09:59:30.328025 [info ] [MainThread]: [32mCompleted successfully[0m
09:59:30.328324 [info ] [MainThread]: 
09:59:30.328576 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
09:59:30.328931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afa3160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afc0160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b076d90>]}


============================== 2022-10-03 10:14:36.234874 | e357ee3e-6efe-4f09-b53d-4c92da9c5e8d ==============================
10:14:36.234918 [info ] [MainThread]: Running with dbt=1.1.2
10:14:36.235579 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:14:36.236146 [debug] [MainThread]: Tracking: tracking
10:14:36.247676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107db6c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107db6850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107db6f40>]}
10:14:36.280470 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:14:36.280867 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
10:14:36.290893 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
10:14:36.303489 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
10:14:36.310001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e357ee3e-6efe-4f09-b53d-4c92da9c5e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f380d0>]}
10:14:36.314177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e357ee3e-6efe-4f09-b53d-4c92da9c5e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e3a0a0>]}
10:14:36.314399 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:14:36.314609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e357ee3e-6efe-4f09-b53d-4c92da9c5e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e3a5b0>]}
10:14:36.315619 [info ] [MainThread]: 
10:14:36.315955 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:14:36.316495 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:14:36.316823 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:14:37.564440 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:14:37.564902 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:14:37.940870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e357ee3e-6efe-4f09-b53d-4c92da9c5e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ddedc0>]}
10:14:37.941765 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:14:37.942161 [info ] [MainThread]: 
10:14:37.946474 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
10:14:37.946833 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
10:14:37.947354 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
10:14:37.947537 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
10:14:37.947741 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
10:14:37.953031 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
10:14:37.953570 [debug] [Thread-1  ]: finished collecting timing info
10:14:37.953761 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
10:14:37.970656 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:14:38.412246 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
10:14:38.412846 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (

    
    select
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 0 and 1000) as user_group
        
    
    union all
    
    
    select
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 1000 and 10000) as user_group
        
    
    union all
    
    
    select
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 10000 and 20000) as user_group
        
    
    union all
    
    
    select
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 20000 and 30000) as user_group
        
    
    union all
    
    
    select
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 30000 and 50000) as user_group
        
    
    union all
    
    
    select
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 50000 and 100000) as user_group
        
    
    union all
    
    
    select
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 100000 and 500000) as user_group
        
    
    
)

select * from a1
  );
  
10:15:07.399707 [debug] [Thread-1  ]: finished collecting timing info
10:15:07.400222 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e357ee3e-6efe-4f09-b53d-4c92da9c5e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10803f850>]}
10:15:07.400615 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.prova_jinja2 ........................... [[32mCREATE TABLE (7.0 rows, 362.2 MB processed)[0m in 29.45s]
10:15:07.401055 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
10:15:07.402234 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:15:07.402639 [info ] [MainThread]: 
10:15:07.402936 [info ] [MainThread]: Finished running 1 table model in 31.09s.
10:15:07.403195 [debug] [MainThread]: Connection 'master' was properly closed.
10:15:07.403336 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
10:15:07.410963 [info ] [MainThread]: 
10:15:07.411257 [info ] [MainThread]: [32mCompleted successfully[0m
10:15:07.411604 [info ] [MainThread]: 
10:15:07.411935 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
10:15:07.412380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f436d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f47a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108016a00>]}


============================== 2022-10-03 10:15:19.896351 | 84a8e9ad-d164-46e7-a31f-625b88ffad3a ==============================
10:15:19.896393 [info ] [MainThread]: Running with dbt=1.1.2
10:15:19.896990 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:15:19.897236 [debug] [MainThread]: Tracking: tracking
10:15:19.909848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5351c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e535b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5354f0>]}
10:15:19.944662 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:15:19.945039 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
10:15:19.955371 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
10:15:19.967848 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
10:15:19.974461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '84a8e9ad-d164-46e7-a31f-625b88ffad3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6d4f10>]}
10:15:19.978842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '84a8e9ad-d164-46e7-a31f-625b88ffad3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5f5d60>]}
10:15:19.979077 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:15:19.979323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84a8e9ad-d164-46e7-a31f-625b88ffad3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5f5f10>]}
10:15:19.980348 [info ] [MainThread]: 
10:15:19.980694 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:15:19.981261 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:15:19.981706 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:15:21.003646 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:15:21.004145 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:15:21.410652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84a8e9ad-d164-46e7-a31f-625b88ffad3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e531490>]}
10:15:21.411536 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:15:21.411974 [info ] [MainThread]: 
10:15:21.416577 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
10:15:21.416983 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
10:15:21.417550 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
10:15:21.417739 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
10:15:21.417945 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
10:15:21.423424 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
10:15:21.423961 [debug] [Thread-1  ]: finished collecting timing info
10:15:21.424148 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
10:15:21.441065 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:15:21.921271 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
10:15:21.921878 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (

    
    select
    1000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 0 and 1000) as user_group
        
    
    union all
    
    
    select
    10000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 1000 and 10000) as user_group
        
    
    union all
    
    
    select
    20000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 10000 and 20000) as user_group
        
    
    union all
    
    
    select
    30000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 20000 and 30000) as user_group
        
    
    union all
    
    
    select
    50000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 30000 and 50000) as user_group
        
    
    union all
    
    
    select
    100000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 50000 and 100000) as user_group
        
    
    union all
    
    
    select
    500000 as segment,
    ARRAY(select ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 100000 and 500000) as user_group
        
    
    
)

select * from a1 order by segment
  );
  
10:15:49.596768 [debug] [Thread-1  ]: finished collecting timing info
10:15:49.597294 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84a8e9ad-d164-46e7-a31f-625b88ffad3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7b7f40>]}
10:15:49.597676 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.prova_jinja2 ........................... [[32mCREATE TABLE (7.0 rows, 362.2 MB processed)[0m in 28.18s]
10:15:49.598111 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
10:15:49.599231 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:15:49.599596 [info ] [MainThread]: 
10:15:49.599935 [info ] [MainThread]: Finished running 1 table model in 29.62s.
10:15:49.600205 [debug] [MainThread]: Connection 'master' was properly closed.
10:15:49.600350 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
10:15:49.608296 [info ] [MainThread]: 
10:15:49.608619 [info ] [MainThread]: [32mCompleted successfully[0m
10:15:49.608935 [info ] [MainThread]: 
10:15:49.609190 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
10:15:49.609554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6979a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e697640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7e2ca0>]}


============================== 2022-10-03 10:19:35.772560 | 46d4fcdd-6876-4c14-b1d6-a7e0837755e9 ==============================
10:19:35.772597 [info ] [MainThread]: Running with dbt=1.1.2
10:19:35.773193 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/xavier.coll/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['prova_jinja2'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:19:35.773811 [debug] [MainThread]: Tracking: tracking
10:19:35.786011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092c4970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092c4eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092c4ee0>]}
10:19:35.820379 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:19:35.820758 [debug] [MainThread]: Partial parsing: updated file: exercise://models/prova_jinja2.sql
10:19:35.832090 [debug] [MainThread]: 1603: static parser failed on prova_jinja2.sql
10:19:35.845229 [debug] [MainThread]: 1602: parser fallback to jinja rendering on prova_jinja2.sql
10:19:35.851910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '46d4fcdd-6876-4c14-b1d6-a7e0837755e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10943e0d0>]}
10:19:35.856246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '46d4fcdd-6876-4c14-b1d6-a7e0837755e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092e3a60>]}
10:19:35.856474 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
10:19:35.856725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '46d4fcdd-6876-4c14-b1d6-a7e0837755e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092e3670>]}
10:19:35.857845 [info ] [MainThread]: 
10:19:35.858211 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:19:35.858921 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe"
10:19:35.859218 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:19:36.915407 [debug] [ThreadPool]: Acquiring new bigquery connection "list_dwh-adev-observe_zz_xavier"
10:19:36.915834 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:19:37.327370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '46d4fcdd-6876-4c14-b1d6-a7e0837755e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093366a0>]}
10:19:37.328223 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
10:19:37.328656 [info ] [MainThread]: 
10:19:37.332889 [debug] [Thread-1  ]: Began running node model.exercise.prova_jinja2
10:19:37.333289 [info ] [Thread-1  ]: 1 of 1 START table model zz_xavier.prova_jinja2 ................................ [RUN]
10:19:37.333834 [debug] [Thread-1  ]: Acquiring new bigquery connection "model.exercise.prova_jinja2"
10:19:37.334017 [debug] [Thread-1  ]: Began compiling node model.exercise.prova_jinja2
10:19:37.334223 [debug] [Thread-1  ]: Compiling model.exercise.prova_jinja2
10:19:37.339541 [debug] [Thread-1  ]: Writing injected SQL for node "model.exercise.prova_jinja2"
10:19:37.340084 [debug] [Thread-1  ]: finished collecting timing info
10:19:37.340282 [debug] [Thread-1  ]: Began executing node model.exercise.prova_jinja2
10:19:37.356415 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:19:37.831347 [debug] [Thread-1  ]: Writing runtime SQL for node "model.exercise.prova_jinja2"
10:19:37.831980 [debug] [Thread-1  ]: On model.exercise.prova_jinja2: /* {"app": "dbt", "dbt_version": "1.1.2", "profile_name": "exercise", "target_name": "dev", "node_id": "model.exercise.prova_jinja2"} */


  create or replace table `dwh-adev-observe`.`zz_xavier`.`prova_jinja2`
  
  
  OPTIONS()
  as (
    

with a1 as (

    
    select
    1000 as segment,
    ARRAY(select distinct ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 0 and 1000) as user_group
        
    
    union all
    
    
    select
    10000 as segment,
    ARRAY(select distinct ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 1000 and 10000) as user_group
        
    
    union all
    
    
    select
    20000 as segment,
    ARRAY(select distinct ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 10000 and 20000) as user_group
        
    
    union all
    
    
    select
    30000 as segment,
    ARRAY(select distinct ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 20000 and 30000) as user_group
        
    
    union all
    
    
    select
    50000 as segment,
    ARRAY(select distinct ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 30000 and 50000) as user_group
        
    
    union all
    
    
    select
    100000 as segment,
    ARRAY(select distinct ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 50000 and 100000) as user_group
        
    
    union all
    
    
    select
    500000 as segment,
    ARRAY(select distinct ua.user_id
        from dwh-adev-core.ae_challenge_data.ae_user_activity ua
        where (select sum(ua2.amount) from dwh-adev-core.ae_challenge_data.ae_user_activity ua2
        where ua.user_id = ua2.user_id and ua2.activity_type = "payment" group by ua2.user_id)
        
        between 100000 and 500000) as user_group
        
    
    
)

select * from a1 order by segment
  );
  
10:20:06.006114 [debug] [Thread-1  ]: finished collecting timing info
10:20:06.006644 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46d4fcdd-6876-4c14-b1d6-a7e0837755e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109464cd0>]}
10:20:06.007047 [info ] [Thread-1  ]: 1 of 1 OK created table model zz_xavier.prova_jinja2 ........................... [[32mCREATE TABLE (7.0 rows, 362.2 MB processed)[0m in 28.67s]
10:20:06.007521 [debug] [Thread-1  ]: Finished running node model.exercise.prova_jinja2
10:20:06.008811 [debug] [MainThread]: Acquiring new bigquery connection "master"
10:20:06.009242 [info ] [MainThread]: 
10:20:06.009540 [info ] [MainThread]: Finished running 1 table model in 30.15s.
10:20:06.009802 [debug] [MainThread]: Connection 'master' was properly closed.
10:20:06.009949 [debug] [MainThread]: Connection 'model.exercise.prova_jinja2' was properly closed.
10:20:06.017947 [info ] [MainThread]: 
10:20:06.018254 [info ] [MainThread]: [32mCompleted successfully[0m
10:20:06.018558 [info ] [MainThread]: 
10:20:06.018802 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
10:20:06.019158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10944e250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10944a430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10951dee0>]}
